<!DOCTYPE html>

<html lang="th">



<head>

┬а ┬а <meta charset="UTF-8">

┬а ┬а <meta name="viewport" content="width=device-width, initial-scale=1.0">

┬а ┬а <title>р╕гр╕░р╕Ър╕Ър╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Бр╕▓р╕гр╕Вр╕▓р╕вр╕вр╕▓р╕Зр╕Бр╣Йр╕нр╕Щр╕Цр╣Йр╕зр╕в</title>

┬а ┬а <script src="https://cdn.tailwindcss.com"></script>

┬а ┬а <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

┬а ┬а <link rel="preconnect" href="https://fonts.googleapis.com">

┬а ┬а <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

┬а ┬а <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;700&display=swap" rel="stylesheet">

┬а ┬а <style>

┬а ┬а ┬а ┬а body {

┬а ┬а ┬а ┬а ┬а ┬а font-family: 'Sarabun', sans-serif;

┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а .chart-container {

┬а ┬а ┬а ┬а ┬а ┬а position: relative;

┬а ┬а ┬а ┬а ┬а ┬а height: 300px;

┬а ┬а ┬а ┬а ┬а ┬а width: 100%;

┬а ┬а ┬а ┬а ┬а ┬а max-width: 500px;

┬а ┬а ┬а ┬а ┬а ┬а margin: auto;

┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а .tab-btn.active {

┬а ┬а ┬а ┬а ┬а ┬а border-color: #d97706;

┬а ┬а ┬а ┬а ┬а ┬а background-color: #fef3c7;

┬а ┬а ┬а ┬а ┬а ┬а color: #b45309;

┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а .tab-content {

┬а ┬а ┬а ┬а ┬а ┬а display: none;

┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а .tab-content.active {

┬а ┬а ┬а ┬а ┬а ┬а display: block;

┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а @media print {

┬а ┬а ┬а ┬а ┬а ┬а body * {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а visibility: hidden;

┬а ┬а ┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а ┬а ┬а #print-area,

┬а ┬а ┬а ┬а ┬а ┬а #print-area * {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а visibility: visible;

┬а ┬а ┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а ┬а ┬а #print-area {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а position: absolute;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а left: 0;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а top: 0;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а width: 100%;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а height: 100%;

┬а ┬а ┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а ┬а ┬а .no-print {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а display: none !important;

┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а }

┬а ┬а </style>

</head>



<body class="bg-stone-100 text-stone-800">

┬а ┬а <div id="app" class="container mx-auto p-4 sm:p-6 lg:p-8">

┬а ┬а ┬а ┬а <header class="mb-8 text-center">

┬а ┬а ┬а ┬а ┬а ┬а <h1 class="text-4xl font-bold text-stone-900">р╕гр╕░р╕Ър╕Ър╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕Вр╕▓р╕вр╕вр╕▓р╕Зр╕Бр╣Йр╕нр╕Щр╕Цр╣Йр╕зр╕в</h1>

┬а ┬а ┬а ┬а ┬а ┬а <p class="text-xl font-semibold text-stone-700 mt-2">р╕кр╕лр╕Бр╕гр╕Ур╣Мр╕Бр╕нр╕Зр╕Чр╕╕р╕Щр╕кр╕зр╕Щр╕вр╕▓р╕Зр╕Юр╕▓р╕гр╕▓р╣Ар╕Бр╕йр╕Хр╕гр╕кр╕бр╕Ър╕╣р╕гр╕Ур╣М р╕Ир╕│р╕Бр╕▒р╕Ф</p>

┬а ┬а ┬а ┬а ┬а ┬а <p class="text-stone-600 mt-2">р╕нр╕нр╕Бр╣Гр╕Ър╣Ар╕кр╕гр╣Зр╕И р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕е р╣Бр╕ер╕░р╕Фр╕╣р╕кр╕гр╕╕р╕Ыр╕вр╕нр╕Фр╕Вр╕▓р╕вр╣Гр╕Щр╕Чр╕╡р╣Ир╣Ар╕Фр╕╡р╕вр╕з</p>

┬а ┬а ┬а ┬а </header>

┬а ┬а ┬а ┬а <div class="mb-6 border-b border-stone-300">

┬а ┬а ┬а ┬а ┬а ┬а <nav id="tabs" class="flex flex-wrap -mb-px">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button data-tab="tab-receipt" class="tab-btn inline-block p-4 border-b-2 border-transparent rounded-t-lg hover:text-amber-600 hover:border-amber-300">1. р╕нр╕нр╕Бр╣Гр╕Ър╣Ар╕кр╕гр╣Зр╕И</button>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button data-tab="tab-history" class="tab-btn inline-block p-4 border-b-2 border-transparent rounded-t-lg hover:text-amber-600 hover:border-amber-300">2. р╕Ыр╕гр╕░р╕зр╕▒р╕Хр╕┤р╣Бр╕ер╕░р╕гр╕▓р╕вр╕Зр╕▓р╕Щ</button>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button data-tab="tab-dashboard" class="tab-btn inline-block p-4 border-b-2 border-transparent rounded-t-lg hover:text-amber-600 hover:border-amber-300">3. р╕кр╕гр╕╕р╕Ыр╕ар╕▓р╕Юр╕гр╕зр╕б</button>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button data-tab="tab-weighing-1" class="tab-btn inline-block p-4 border-b-2 border-transparent rounded-t-lg hover:text-amber-600 hover:border-amber-300">4. р╕гр╕▒р╕Ър╕зр╕▓р╕Зр╕вр╕▓р╕З (р╕Хр╕▓р╕Кр╕▒р╣Ир╕З 1)</button>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button data-tab="tab-weighing-2" class="tab-btn inline-block p-4 border-b-2 border-transparent rounded-t-lg hover:text-amber-600 hover:border-amber-300">5. р╕гр╕▒р╕Ър╕зр╕▓р╕Зр╕вр╕▓р╕З (р╕Хр╕▓р╕Кр╕▒р╣Ир╕З 2)</button>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button data-tab="tab-weighing-3" class="tab-btn inline-block p-4 border-b-2 border-transparent rounded-t-lg hover:text-amber-600 hover:border-amber-300">6. р╕гр╕▒р╕Ър╕зр╕▓р╕Зр╕вр╕▓р╕З (р╕Хр╕▓р╕Кр╕▒р╣Ир╕З 3)</button>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button data-tab="tab-weighing-4" class="tab-btn inline-block p-4 border-b-2 border-transparent rounded-t-lg hover:text-amber-600 hover:border-amber-300">7. р╕гр╕▒р╕Ър╕зр╕▓р╕Зр╕вр╕▓р╕З (р╕Хр╕▓р╕Кр╕▒р╣Ир╕З 4)</button>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button data-tab="tab-weighing-summary" class="tab-btn inline-block p-4 border-b-2 border-transparent rounded-t-lg hover:text-amber-600 hover:border-amber-300">8. р╕кр╕гр╕╕р╕Ыр╕Ьр╕ер╕гр╕зр╕бр╕Хр╕▓р╕Кр╕▒р╣Ир╕З</button>

┬а ┬а ┬а ┬а ┬а ┬а </nav>

┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а <main>

┬а ┬а ┬а ┬а ┬а ┬а <div id="tab-receipt" class="tab-content">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <section id="receipt-generator" class="bg-white p-6 rounded-xl shadow-md">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h2 class="text-2xl font-bold mb-2 border-b pb-3 text-stone-800">1. р╕Бр╕гр╕нр╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Ар╕Юр╕╖р╣Ир╕нр╕нр╕нр╕Бр╣Гр╕Ър╣Ар╕кр╕гр╣Зр╕И</h2>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p class="text-sm text-stone-500 mt-2 mb-4">р╕кр╣Ир╕зр╕Щр╕Щр╕╡р╣Йр╕Др╕╖р╕нр╕ир╕╣р╕Щр╕вр╣Мр╕Бр╕ер╕▓р╕Зр╕Бр╕▓р╕гр╕Чр╕│р╕Зр╕▓р╕Щ р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Бр╕▓р╕гр╕Вр╕▓р╕в р╕гр╕░р╕Ър╕Ър╕Ир╕░р╕Др╕│р╕Щр╕зр╕Ур╕вр╕нр╕Фр╕гр╕зр╕бр╣Гр╕лр╣Йр╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤ р╣Бр╕ер╕░р╣Ар╕бр╕╖р╣Ир╕нр╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Бр╕ер╣Йр╕зр╕Ир╕░р╕кр╕гр╣Йр╕▓р╕Зр╣Гр╕Ър╣Ар╕кр╕гр╣Зр╕Ир╕кр╕│р╕лр╕гр╕▒р╕Ър╕Юр╕┤р╕бр╕Юр╣Мр╣Др╕Фр╣Йр╕Чр╕▒р╕Щр╕Чр╕╡</p>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="seller-name" class="block text-sm font-medium text-stone-600 mb-1">р╕Кр╕╖р╣Ир╕н-р╕кр╕Бр╕╕р╕е р╕Ьр╕╣р╣Йр╕Вр╕▓р╕в</label>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="text" id="seller-name" class="w-full p-2 border border-stone-300 rounded-md shadow-sm focus:ring-amber-500 focus:border-amber-500" placeholder="р╣Ар╕Кр╣Ир╕Щ р╕Щр╕▓р╕вр╕кр╕бр╕Кр╕▓р╕в р╣Гр╕Ир╕Фр╕╡">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="scale-number" class="block text-sm font-medium text-stone-600 mb-1">р╕Хр╕▓р╕Кр╕▒р╣Ир╕Зр╕Чр╕╡р╣И</label>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="number" id="scale-number" min="1" max="9" class="w-full p-2 border border-stone-300 rounded-md shadow-sm focus:ring-amber-500 focus:border-amber-500" placeholder="1-9">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="md:col-span-2">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="receipt-date" class="block text-sm font-medium text-stone-600 mb-1">р╕зр╕▒р╕Щр╕Чр╕╡р╣И <span id="date-display" class="font-normal text-stone-500 ml-2"></span></label>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="date" id="receipt-date" class="w-full p-2 border border-stone-300 rounded-md shadow-sm focus:ring-amber-500 focus:border-amber-500">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="md:col-span-2">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label class="block text-sm font-medium text-stone-600 mb-1">р╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Б (р╕Бр╕Б.) - р╣Гр╕кр╣Ир╣Др╕Фр╣Йр╕кр╕╣р╕Зр╕кр╕╕р╕Ф 5 р╕гр╕▓р╕вр╕Бр╕▓р╕г</label>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div id="weight-inputs-container" class="grid grid-cols-2 sm:grid-cols-5 gap-4">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="number" class="weight-input w-full p-2 border border-stone-300 rounded-md shadow-sm text-center" placeholder="р╕Др╕гр╕▒р╣Йр╕Зр╕Чр╕╡р╣И 1">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="number" class="weight-input w-full p-2 border border-stone-300 rounded-md shadow-sm text-center" placeholder="р╕Др╕гр╕▒р╣Йр╕Зр╕Чр╕╡р╣И 2">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="number" class="weight-input w-full p-2 border border-stone-300 rounded-md shadow-sm text-center" placeholder="р╕Др╕гр╕▒р╣Йр╕Зр╕Чр╕╡р╣И 3">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="number" class="weight-input w-full p-2 border border-stone-300 rounded-md shadow-sm text-center" placeholder="р╕Др╕гр╕▒р╣Йр╕Зр╕Чр╕╡р╣И 4">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="number" class="weight-input w-full p-2 border border-stone-300 rounded-md shadow-sm text-center" placeholder="р╕Др╕гр╕▒р╣Йр╕Зр╕Чр╕╡р╣И 5">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="md:col-span-2">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="price-per-kg" class="block text-sm font-medium text-stone-600 mb-1">р╕гр╕▓р╕Др╕▓р╕Хр╣Ир╕нр╕лр╕Щр╣Ир╕зр╕в (р╕Ър╕▓р╕Ч/р╕Бр╕Б.)</label>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="number" id="price-per-kg" class="w-full p-2 border border-stone-300 rounded-md shadow-sm focus:ring-amber-500 focus:border-amber-500" placeholder="0.00">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="md:col-span-2 bg-stone-200 p-4 rounded-lg space-y-3">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="flex justify-between items-center">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span class="font-medium text-stone-600">р╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Бр╕гр╕зр╕б (р╕Бр╕Б.):</span>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span id="total-weight" class="text-xl font-bold text-stone-800">0.00</span>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="flex justify-between items-center">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span class="font-medium text-stone-600">р╕гр╕зр╕бр╣Ар╕Ыр╣Зр╕Щр╣Ар╕Зр╕┤р╕Щр╕Чр╕▒р╣Йр╕Зр╕кр╕┤р╣Йр╕Щ (р╕Ър╕▓р╕Ч):</span>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span id="total-amount" class="text-2xl font-bold text-amber-600">0.00</span>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="flex justify-between items-center text-right">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span class="font-medium text-stone-600">(р╕Хр╕▒р╕зр╕нр╕▒р╕Бр╕йр╕г):</span>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span id="total-amount-text" class="text-sm text-stone-500">-</span>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="mt-6 flex justify-end items-center gap-4">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button id="cancel-edit-button" class="hidden bg-stone-200 text-stone-700 font-bold py-2 px-6 rounded-lg hover:bg-stone-300 transition-colors">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а р╕вр╕Бр╣Ар╕ер╕┤р╕Б

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </button>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button id="save-button" class="bg-amber-600 text-white font-bold py-2 px-6 rounded-lg shadow-md hover:bg-amber-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-500 transition-colors">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╣Бр╕ер╕░р╕Юр╕┤р╕бр╕Юр╣Мр╣Гр╕Ър╣Ар╕кр╕гр╣Зр╕И

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </button>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </section>

┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а <div id="tab-history" class="tab-content">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <section id="sales-data" class="bg-white p-6 rounded-xl shadow-md">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="flex flex-col sm:flex-row justify-between sm:items-center mb-2 border-b pb-3">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h2 class="text-2xl font-bold text-stone-800">2. р╕Ыр╕гр╕░р╕зр╕▒р╕Хр╕┤р╣Бр╕ер╕░р╕гр╕▓р╕вр╕Зр╕▓р╕Щ</h2>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="text" id="search-box" class="mt-3 sm:mt-0 w-full sm:w-64 p-2 border border-stone-300 rounded-md shadow-sm" placeholder="ЁЯФН р╕Др╣Йр╕Щр╕лр╕▓р╕Хр╕▓р╕бр╕Кр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╕Вр╕▓р╕в...">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p class="text-sm text-stone-500 mt-2 mb-4">р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Бр╕▓р╕гр╕Вр╕▓р╕вр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Фр╕Чр╕╡р╣Ир╣Ар╕Др╕вр╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╣Др╕зр╣Йр╕Ир╕░р╣Бр╕кр╕Фр╕Зр╣Гр╕Щр╕Хр╕▓р╕гр╕▓р╕Зр╕Щр╕╡р╣Й р╕Др╕╕р╕Ур╕кр╕▓р╕бр╕▓р╕гр╕Цр╕Др╣Йр╕Щр╕лр╕▓р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Хр╕▓р╕бр╕Кр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╕Вр╕▓р╕в р╣Бр╕Бр╣Йр╣Др╕Вр╕гр╕▓р╕вр╕Бр╕▓р╕гр╕Чр╕╡р╣Ир╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Ф р╕лр╕гр╕╖р╕нр╕ер╕Ър╕гр╕▓р╕вр╕Бр╕▓р╕гр╕Чр╕╡р╣Ир╣Др╕бр╣Ир╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╣Др╕Фр╣Й</p>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="bg-stone-200 p-4 rounded-lg text-center">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p class="text-sm font-medium text-stone-600">р╕Ир╕│р╕Щр╕зр╕Щр╕Ьр╕╣р╣Йр╕Вр╕▓р╕вр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф</p>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p id="summary-total-sellers" class="text-2xl font-bold text-amber-600">0</p>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="bg-stone-200 p-4 rounded-lg text-center">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p class="text-sm font-medium text-stone-600">р╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Бр╕гр╕зр╕бр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф (р╕Бр╕Б.)</p>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p id="summary-total-weight" class="text-2xl font-bold text-amber-600">0.00</p>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="bg-stone-200 p-4 rounded-lg text-center">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p class="text-sm font-medium text-stone-600">р╕вр╕нр╕Фр╕Вр╕▓р╕вр╕гр╕зр╕бр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф (р╕Ър╕▓р╕Ч)</p>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p id="summary-total-price" class="text-2xl font-bold text-amber-600">0.00</p>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="border-t pt-4 mt-6">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h3 class="text-lg font-semibold text-stone-700">р╕кр╕гр╕╕р╕Ыр╕вр╕нр╕Фр╕Вр╕▓р╕вр╣Бр╕вр╕Бр╕Хр╕▓р╕бр╕Хр╕▓р╕Кр╕▒р╣Ир╕З (р╕зр╕▒р╕Щр╕Щр╕╡р╣Й)</h3>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div id="sales-summary-by-scale" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 mt-2">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="col-span-full text-center text-stone-500">р╣Др╕бр╣Ир╕бр╕╡р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Бр╕▓р╕гр╕Вр╕▓р╕вр╕кр╕│р╕лр╕гр╕▒р╕Ър╕зр╕▒р╕Щр╕Щр╕╡р╣Й</div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="border-t pt-4 mt-6">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h3 class="text-lg font-semibold text-stone-700">р╕Юр╕┤р╕бр╕Юр╣Мр╕гр╕▓р╕вр╕Зр╕▓р╕Щр╕кр╕гр╕╕р╕Ыр╕Ыр╕гр╕░р╕Ир╕│р╕зр╕▒р╕Щ</h3>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="flex items-center gap-4 mt-2">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="date" id="report-date" class="p-2 border border-stone-300 rounded-md shadow-sm focus:ring-amber-500 focus:border-amber-500">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button id="print-report-btn" class="bg-sky-600 text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-sky-700 transition-colors">р╕Юр╕┤р╕бр╕Юр╣Мр╕гр╕▓р╕вр╕Зр╕▓р╕Щ</button>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>



┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="overflow-x-auto mt-6">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <table class="w-full text-sm text-left text-stone-500">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <thead class="text-xs text-stone-700 uppercase bg-stone-200">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <tr>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th scope="col" class="px-6 py-3">р╕зр╕▒р╕Щр╕Чр╕╡р╣И</th>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th scope="col" class="px-6 py-3">р╕Кр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╕Вр╕▓р╕в</th>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th scope="col" class="px-6 py-3 text-right">р╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Б (р╕Бр╕Б.)</th>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th scope="col" class="px-6 py-3 text-right">р╕гр╕▓р╕Др╕▓/р╕лр╕Щр╣Ир╕зр╕в</th>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th scope="col" class="px-6 py-3 text-right">р╕вр╕нр╕Фр╕гр╕зр╕б (р╕Ър╕▓р╕Ч)</th>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th scope="col" class="px-6 py-3 text-center">р╕Бр╕▓р╕гр╕Фр╕│р╣Ар╕Щр╕┤р╕Щр╕Бр╕▓р╕г</th>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </tr>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </thead>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <tbody id="sales-table-body">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <tr>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td colspan="6" class="px-6 py-8 text-center text-stone-400">р╕Бр╕│р╕ер╕▒р╕Зр╣Вр╕лр╕ер╕Фр╕Вр╣Йр╕нр╕бр╕╣р╕е...</td>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </tr>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </tbody>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </table>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </section>

┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а <div id="tab-dashboard" class="tab-content">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <section id="dashboard" class="bg-white p-6 rounded-xl shadow-md">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="flex justify-between items-center mb-2 border-b pb-3">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h2 class="text-2xl font-bold text-stone-800">3. р╕кр╕гр╕╕р╕Ыр╕ар╕▓р╕Юр╕гр╕зр╕б</h2>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button id="print-dashboard-btn" class="bg-sky-600 text-white font-bold py-1 px-3 rounded-lg shadow-md hover:bg-sky-700 no-print">ЁЯЦия╕П р╕Юр╕┤р╕бр╕Юр╣М</button>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p class="text-sm text-stone-500 mt-2 mb-4">р╣Бр╕Фр╕Кр╕Ър╕нр╕гр╣Мр╕Фр╕Щр╕╡р╣Йр╕Ир╕░р╕кр╕гр╕╕р╕Ыр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Бр╕▓р╕гр╕Вр╕▓р╕вр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Фр╣Гр╕Щр╕гр╕╣р╕Ыр╣Бр╕Ър╕Ър╕Бр╕гр╕▓р╕Я р╕Кр╣Ир╕зр╕вр╣Гр╕лр╣Йр╣Ар╕лр╣Зр╕Щр╕ар╕▓р╕Юр╕гр╕зр╕бр╣Бр╕ер╕░р╣Бр╕Щр╕зр╣Вр╕Щр╣Йр╕бр╕Хр╣Ир╕▓р╕Зр╣Ж р╣Др╕Фр╣Йр╕нр╕вр╣Ир╕▓р╕Зр╕гр╕зр╕Фр╣Ар╕гр╣Зр╕з р╣Вр╕Фр╕вр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Ир╕░р╕нр╕▒р╕Ыр╣Ар╕Фр╕Хр╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤р╕Чр╕╕р╕Бр╕Др╕гр╕▒р╣Йр╕Зр╕Чр╕╡р╣Ир╕бр╕╡р╕Бр╕▓р╕гр╕Ър╕▒р╕Щр╕Чр╕╢р╕Б</p>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="space-y-8">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="border-b pb-4 mb-4">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h3 class="font-bold text-center mb-2 text-stone-700">р╕кр╕гр╕╕р╕Ыр╕вр╕нр╕Фр╕Ыр╕гр╕░р╕Ир╕│р╕зр╕▒р╕Щ</h3>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="bg-amber-100 p-4 rounded-lg text-center">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p class="text-sm font-medium text-amber-800">р╕Ыр╕гр╕┤р╕бр╕▓р╕Ур╕гр╕зр╕бр╕зр╕▒р╕Щр╕Щр╕╡р╣Й (р╕Бр╕Б.)</p>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p id="summary-daily-weight" class="text-2xl font-bold text-amber-700">0.00</p>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h3 class="font-bold text-center mb-2 text-stone-700">р╕кр╕▒р╕Фр╕кр╣Ир╕зр╕Щр╕вр╕нр╕Фр╕Вр╕▓р╕вр╕Хр╕▓р╕бр╕Ьр╕╣р╣Йр╕Вр╕▓р╕в</h3>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="chart-container">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <canvas id="sales-by-seller-chart"></canvas>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h3 class="font-bold text-center mb-2 text-stone-700">р╣Бр╕Щр╕зр╣Вр╕Щр╣Йр╕бр╕вр╕нр╕Фр╕Вр╕▓р╕вр╕гр╕▓р╕вр╕зр╕▒р╕Щ</h3>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="chart-container">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <canvas id="daily-sales-chart"></canvas>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </section>

┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а <div id="tab-weighing-1" class="tab-content"></div>

┬а ┬а ┬а ┬а ┬а ┬а <div id="tab-weighing-2" class="tab-content"></div>

┬а ┬а ┬а ┬а ┬а ┬а <div id="tab-weighing-3" class="tab-content"></div>

┬а ┬а ┬а ┬а ┬а ┬а <div id="tab-weighing-4" class="tab-content"></div>

┬а ┬а ┬а ┬а ┬а ┬а <div id="tab-weighing-summary" class="tab-content">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <section class="bg-white p-6 rounded-xl shadow-md">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h2 class="text-2xl font-bold mb-4 border-b pb-3 text-stone-800">8. р╕кр╕гр╕╕р╕Ыр╕Ьр╕ер╕гр╕зр╕бр╕Хр╕▓р╕Кр╕▒р╣Ир╕Зр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф (р╕кр╕│р╕лр╕гр╕▒р╕Ър╕зр╕▒р╕Щр╕Щр╕╡р╣Й)</h2>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="space-y-6">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="grid grid-cols-1 md:grid-cols-3 gap-6 bg-stone-50 p-6 rounded-lg items-center">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="text-center">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p class="text-base font-medium text-stone-600">р╕Ьр╕ер╕гр╕зр╕бр╕Ир╕│р╕Щр╕зр╕Щр╕Цр╕╕р╕Зр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф</p>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p id="summary-total-bags" class="text-4xl font-bold text-amber-600 mt-1">0</p>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="flex flex-col justify-center">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="summary-multiplier-weight" class="block text-sm font-medium text-stone-600 mb-1 text-center">р╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Б/р╕Цр╕╕р╕З (р╕Бр╕Б.)</label>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="number" id="summary-multiplier-weight" class="w-full p-2 border border-stone-300 rounded-md shadow-sm text-center text-lg" placeholder="р╕Бр╕гр╕нр╕Бр╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Бр╣Ар╕Йр╕ер╕╡р╣Ир╕в">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="text-center">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p class="text-base font-medium text-stone-600">р╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣Мр╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Бр╕гр╕зр╕б (р╕Бр╕Б.)</p>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p id="summary-calculated-weight" class="text-4xl font-bold text-green-600 mt-1">0.00</p>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>



┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="border-t pt-6 mt-6">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h3 class="text-lg font-semibold text-red-700">р╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕Вр╣Йр╕нр╕бр╕╣р╕е (р╕Бр╕▓р╕гр╕Бр╕гр╕░р╕Чр╕│р╕Щр╕╡р╣Йр╕бр╕╡р╕Др╕зр╕▓р╕бр╣Ар╕кр╕╡р╣Ир╕вр╕З)</h3>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p class="text-sm text-stone-500 mt-1 mb-4">р╣Гр╕Кр╣Йр╕кр╕│р╕лр╕гр╕▒р╕Ър╕ер╣Йр╕▓р╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Бр╕▓р╕гр╕гр╕▒р╕Ър╕зр╕▓р╕Зр╕вр╕▓р╕Зр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Фр╕Вр╕нр╕Зр╕зр╕▒р╕Щр╕Щр╕╡р╣Йр╣Ар╕бр╕╖р╣Ир╕нр╣Ар╕гр╕┤р╣Ир╕бр╕Бр╕▓р╕гр╕Кр╕▒р╣Ир╕Зр╕Ир╕гр╕┤р╕З</p>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button id="delete-all-weighings-btn" class="w-full md:w-auto bg-red-600 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ЁЯЧСя╕П р╕ер╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Чр╕╡р╣Ир╕зр╕▓р╕Зр╣Др╕зр╣Йр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф (р╕кр╕│р╕лр╕гр╕▒р╕Ър╕зр╕▒р╕Щр╕Щр╕╡р╣Й)

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </button>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </section>

┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а </main>

┬а ┬а </div>

┬а ┬а <div id="print-area"></div>

┬а ┬а <div id="modal" class="modal-backdrop fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden opacity-0" aria-labelledby="modal-title" role="dialog" aria-modal="true">

┬а ┬а ┬а ┬а <div class="modal-content bg-white rounded-xl shadow-2xl w-full max-w-md transform scale-95">

┬а ┬а ┬а ┬а ┬а ┬а <div class="p-6">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="text-center">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h3 id="modal-title" class="text-lg leading-6 font-bold text-stone-900"></h3>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="mt-2">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p id="modal-message" class="text-sm text-stone-500"></p>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а <div id="modal-actions" class="bg-stone-50 px-6 py-4 rounded-b-xl flex flex-row-reverse gap-3">

┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а </div>

┬а ┬а </div>



┬а ┬а <script type="module">

┬а ┬а ┬а ┬а import {

┬а ┬а ┬а ┬а ┬а ┬а initializeApp

┬а ┬а ┬а ┬а } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";

┬а ┬а ┬а ┬а import {

┬а ┬а ┬а ┬а ┬а ┬а getAnalytics

┬а ┬а ┬а ┬а } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-analytics.js";

┬а ┬а ┬а ┬а import {

┬а ┬а ┬а ┬а ┬а ┬а getAuth,

┬а ┬а ┬а ┬а ┬а ┬а signInAnonymously,

┬а ┬а ┬а ┬а ┬а ┬а signInWithCustomToken,

┬а ┬а ┬а ┬а ┬а ┬а onAuthStateChanged

┬а ┬а ┬а ┬а } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

┬а ┬а ┬а ┬а import {

┬а ┬а ┬а ┬а ┬а ┬а getFirestore,

┬а ┬а ┬а ┬а ┬а ┬а collection,

┬а ┬а ┬а ┬а ┬а ┬а doc,

┬а ┬а ┬а ┬а ┬а ┬а addDoc,

┬а ┬а ┬а ┬а ┬а ┬а updateDoc,

┬а ┬а ┬а ┬а ┬а ┬а deleteDoc,

┬а ┬а ┬а ┬а ┬а ┬а onSnapshot,

┬а ┬а ┬а ┬а ┬а ┬а query,

┬а ┬а ┬а ┬а ┬а ┬а where,

┬а ┬а ┬а ┬а ┬а ┬а getDocs,

┬а ┬а ┬а ┬а ┬а ┬а getDoc,

┬а ┬а ┬а ┬а ┬а ┬а writeBatch

┬а ┬а ┬а ┬а } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";



┬а ┬а ┬а ┬а // Firebase configuration (provided by the environment or a default)

┬а ┬а ┬а ┬а const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {

┬а ┬а ┬а ┬а ┬а ┬а apiKey: "AIzaSyCNVxG6s46SRXOYAeT0rJHAtz_-3IPUJNE",

┬а ┬а ┬а ┬а ┬а ┬а authDomain: "coopksb001.firebaseapp.com",

┬а ┬а ┬а ┬а ┬а ┬а projectId: "coopksb001",

┬а ┬а ┬а ┬а ┬а ┬а storageBucket: "coopksb001.appspot.com",

┬а ┬а ┬а ┬а ┬а ┬а messagingSenderId: "259378610497",

┬а ┬а ┬а ┬а ┬а ┬а appId: "1:259378610497:web:fd12679830e97bf5e761c0",

┬а ┬а ┬а ┬а ┬а ┬а measurementId: "G-1RHH9TMD73"

┬а ┬а ┬а ┬а };



┬а ┬а ┬а ┬а // Application ID (provided by the environment or a default)

┬а ┬а ┬а ┬а const appId = typeof __app_id !== 'undefined' ? __app_id : 'cup-rubber-sales-app';



┬а ┬а ┬а ┬а // Global variables for sales and weighing data

┬а ┬а ┬а ┬а let localSalesData = [];

┬а ┬а ┬а ┬а let salesBySellerChart, dailySalesChart;

┬а ┬а ┬а ┬а let editingId = null; // ID of the sale being edited

┬а ┬а ┬а ┬а let editingWeighingId = null; // ID of the weighing record being edited

┬а ┬а ┬а ┬а let db, auth, userId, salesCollectionRef, weighingsCollectionRef;

┬а ┬а ┬а ┬а let unsubscribeSales = null; // Function to unsubscribe from sales snapshot listener

┬а ┬а ┬а ┬а let unsubscribeWeighings = {}; // Stores unsubscribe functions for each weighing scale

┬а ┬а ┬а ┬а let dailyWeighingData = {}; // Stores daily weighing data by scale ID



┬а ┬а ┬а ┬а // UI elements mapping for easier access

┬а ┬а ┬а ┬а const ui = {

┬а ┬а ┬а ┬а ┬а ┬а appContainer: document.getElementById('app'),

┬а ┬а ┬а ┬а ┬а ┬а tabs: document.getElementById('tabs'),

┬а ┬а ┬а ┬а ┬а ┬а tabContents: document.querySelectorAll('.tab-content'),

┬а ┬а ┬а ┬а ┬а ┬а sellerNameInput: document.getElementById('seller-name'),

┬а ┬а ┬а ┬а ┬а ┬а receiptDateInput: document.getElementById('receipt-date'),

┬а ┬а ┬а ┬а ┬а ┬а dateDisplay: document.getElementById('date-display'),

┬а ┬а ┬а ┬а ┬а ┬а scaleNumberInput: document.getElementById('scale-number'),

┬а ┬а ┬а ┬а ┬а ┬а weightInputsContainer: document.getElementById('weight-inputs-container'),

┬а ┬а ┬а ┬а ┬а ┬а pricePerKgInput: document.getElementById('price-per-kg'),

┬а ┬а ┬а ┬а ┬а ┬а totalWeightEl: document.getElementById('total-weight'),

┬а ┬а ┬а ┬а ┬а ┬а totalAmountEl: document.getElementById('total-amount'),

┬а ┬а ┬а ┬а ┬а ┬а totalAmountTextEl: document.getElementById('total-amount-text'),

┬а ┬а ┬а ┬а ┬а ┬а saveButton: document.getElementById('save-button'),

┬а ┬а ┬а ┬а ┬а ┬а cancelEditButton: document.getElementById('cancel-edit-button'),

┬а ┬а ┬а ┬а ┬а ┬а salesTableBody: document.getElementById('sales-table-body'),

┬а ┬а ┬а ┬а ┬а ┬а searchBox: document.getElementById('search-box'),

┬а ┬а ┬а ┬а ┬а ┬а printArea: document.getElementById('print-area'),

┬а ┬а ┬а ┬а ┬а ┬а reportDateInput: document.getElementById('report-date'),

┬а ┬а ┬а ┬а ┬а ┬а printReportBtn: document.getElementById('print-report-btn'),

┬а ┬а ┬а ┬а ┬а ┬а printDashboardBtn: document.getElementById('print-dashboard-btn'),

┬а ┬а ┬а ┬а ┬а ┬а dashboardSection: document.getElementById('dashboard'),

┬а ┬а ┬а ┬а ┬а ┬а modal: document.getElementById('modal'),

┬а ┬а ┬а ┬а ┬а ┬а modalTitle: document.getElementById('modal-title'),

┬а ┬а ┬а ┬а ┬а ┬а modalMessage: document.getElementById('modal-message'),

┬а ┬а ┬а ┬а ┬а ┬а modalActions: document.getElementById('modal-actions'),

┬а ┬а ┬а ┬а ┬а ┬а summaryTotalSellers: document.getElementById('summary-total-sellers'),

┬а ┬а ┬а ┬а ┬а ┬а summaryTotalWeight: document.getElementById('summary-total-weight'),

┬а ┬а ┬а ┬а ┬а ┬а summaryTotalPrice: document.getElementById('summary-total-price'),

┬а ┬а ┬а ┬а ┬а ┬а summaryDailyWeight: document.getElementById('summary-daily-weight'),

┬а ┬а ┬а ┬а ┬а ┬а summaryTotalBags: document.getElementById('summary-total-bags'),

┬а ┬а ┬а ┬а ┬а ┬а summaryMultiplierWeight: document.getElementById('summary-multiplier-weight'),

┬а ┬а ┬а ┬а ┬а ┬а summaryCalculatedWeight: document.getElementById('summary-calculated-weight'),

┬а ┬а ┬а ┬а ┬а ┬а deleteAllWeighingsBtn: document.getElementById('delete-all-weighings-btn'),

┬а ┬а ┬а ┬а ┬а ┬а salesSummaryByScale: document.getElementById('sales-summary-by-scale'), // NEW: Element for scale summaries

┬а ┬а ┬а ┬а };



┬а ┬а ┬а ┬а /**

┬а ┬а ┬а ┬а ┬а* Displays a modal dialog with a title, message, and customizable buttons.

┬а ┬а ┬а ┬а ┬а* @param {string} title - The title of the modal.

┬а ┬а ┬а ┬а ┬а* @param {string} message - The message content of the modal.

┬а ┬а ┬а ┬а ┬а* @param {Array<Object>} buttons - An array of button configurations. Each object should have `text`, `classes`, and an optional `onClick` function.

┬а ┬а ┬а ┬а ┬а*/

┬а ┬а ┬а ┬а function showModal(title, message, buttons) {

┬а ┬а ┬а ┬а ┬а ┬а ui.modalTitle.textContent = title;

┬а ┬а ┬а ┬а ┬а ┬а ui.modalMessage.textContent = message;

┬а ┬а ┬а ┬а ┬а ┬а ui.modalActions.innerHTML = ''; // Clear previous buttons

┬а ┬а ┬а ┬а ┬а ┬а buttons.forEach(btn => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const buttonEl = document.createElement('button');

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а buttonEl.textContent = btn.text;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а buttonEl.className = btn.classes;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а buttonEl.onclick = () => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а hideModal(); // Hide modal when button is clicked

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (btn.onClick) btn.onClick(); // Execute custom onClick handler

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а };

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.modalActions.appendChild(buttonEl);

┬а ┬а ┬а ┬а ┬а ┬а });

┬а ┬а ┬а ┬а ┬а ┬а ui.modal.classList.remove('hidden'); // Show the modal backdrop

┬а ┬а ┬а ┬а ┬а ┬а setTimeout(() => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.modal.classList.remove('opacity-0'); // Animate opacity

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.modal.querySelector('.modal-content').classList.remove('scale-95'); // Animate scale

┬а ┬а ┬а ┬а ┬а ┬а }, 10);

┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а /**

┬а ┬а ┬а ┬а ┬а* Hides the currently displayed modal.

┬а ┬а ┬а ┬а ┬а*/

┬а ┬а ┬а ┬а function hideModal() {

┬а ┬а ┬а ┬а ┬а ┬а ui.modal.classList.add('opacity-0'); // Animate opacity out

┬а ┬а ┬а ┬а ┬а ┬а ui.modal.querySelector('.modal-content').classList.add('scale-95'); // Animate scale out

┬а ┬а ┬а ┬а ┬а ┬а setTimeout(() => ui.modal.classList.add('hidden'), 300); // Hide completely after animation

┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а /**

┬а ┬а ┬а ┬а ┬а* Shows a simple alert modal with an "OK" button.

┬а ┬а ┬а ┬а ┬а* @param {string} message - The message to display.

┬а ┬а ┬а ┬а ┬а*/

┬а ┬а ┬а ┬а function showAlert(message) {

┬а ┬а ┬а ┬а ┬а ┬а showModal('р╣Бр╕Ир╣Йр╕Зр╣Ар╕Хр╕╖р╕нр╕Щ', message, [{

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а text: 'р╕Хр╕Бр╕ер╕З',

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а classes: 'w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-amber-600 text-base font-medium text-white hover:bg-amber-700 sm:w-auto sm:text-sm'

┬а ┬а ┬а ┬а ┬а ┬а }]);

┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а /**

┬а ┬а ┬а ┬а ┬а* Shows a confirmation modal with "Confirm" and "Cancel" buttons.

┬а ┬а ┬а ┬а ┬а* @param {string} message - The confirmation message.

┬а ┬а ┬а ┬а ┬а* @param {Function} onConfirm - The function to execute if the user confirms.

┬а ┬а ┬а ┬а ┬а*/

┬а ┬а ┬а ┬а function showConfirm(message, onConfirm) {

┬а ┬а ┬а ┬а ┬а ┬а showModal('р╕вр╕╖р╕Щр╕вр╕▒р╕Щр╕Бр╕▓р╕гр╕Фр╕│р╣Ар╕Щр╕┤р╕Щр╕Бр╕▓р╕г', message, [{

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а text: 'р╕вр╕╖р╕Щр╕вр╕▒р╕Щ',

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а classes: 'w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 sm:ml-3 sm:w-auto sm:text-sm',

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а onClick: onConfirm

┬а ┬а ┬а ┬а ┬а ┬а }, {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а text: 'р╕вр╕Бр╣Ар╕ер╕┤р╕Б',

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а classes: 'mt-3 w-full inline-flex justify-center rounded-md border border-stone-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-stone-700 hover:bg-stone-50 sm:mt-0 sm:w-auto sm:text-sm'

┬а ┬а ┬а ┬а ┬а ┬а }]);

┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а /**

┬а ┬а ┬а ┬а ┬а* Converts a number to Thai baht text (р╕Хр╕▒р╕зр╕нр╕▒р╕Бр╕йр╕г).

┬а ┬а ┬а ┬а ┬а* @param {number} number - The number to convert.

┬а ┬а ┬а ┬а ┬а* @returns {string} The Thai baht text representation.

┬а ┬а ┬а ┬а ┬а*/

┬а ┬а ┬а ┬а function bahttext(number) {

┬а ┬а ┬а ┬а ┬а ┬а number = Number(number).toFixed(2); // Ensure two decimal places

┬а ┬а ┬а ┬а ┬а ┬а let [integer, fraction] = number.split('.');

┬а ┬а ┬а ┬а ┬а ┬а const t = ['', 'р╕лр╕Щр╕╢р╣Ир╕З', 'р╕кр╕нр╕З', 'р╕кр╕▓р╕б', 'р╕кр╕╡р╣И', 'р╕лр╣Йр╕▓', 'р╕лр╕Б', 'р╣Ар╕Ир╣Зр╕Ф', 'р╣Бр╕Ыр╕Ф', 'р╣Ар╕Бр╣Йр╕▓'];

┬а ┬а ┬а ┬а ┬а ┬а const r = ['', 'р╕кр╕┤р╕Ъ', 'р╕гр╣Йр╕нр╕в', 'р╕Юр╕▒р╕Щ', 'р╕лр╕бр╕╖р╣Ир╕Щ', 'р╣Бр╕кр╕Щ', 'р╕ер╣Йр╕▓р╕Щ'];



┬а ┬а ┬а ┬а ┬а ┬а function convert(n) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а let s = '';

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а let l = n.length;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а for (let i = 0; i < l; i++) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а let d = parseInt(n.charAt(i));

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а let p = l - i - 1;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (d > 0) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (p === 1 && d === 2) s += 'р╕вр╕╡р╣И';

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а else if (p === 1 && d === 1) s += ''; // 'р╕кр╕┤р╕Ъ' becomes 'р╕кр╕┤р╕Ъ' not 'р╕лр╕Щр╕╢р╣Ир╕Зр╕кр╕┤р╕Ъ'

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а else if (p === 0 && d === 1 && s.length > 0 && n.length > 1) s += 'р╣Ар╕нр╣Зр╕Ф'; // 'р╕лр╕Щр╕╢р╣Ир╕З' becomes 'р╣Ар╕нр╣Зр╕Ф' when not first digit and length > 1

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а else s += t[d];

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а s += r[p];

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return s;

┬а ┬а ┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а ┬а ┬а let intText = convert(integer) || 'р╕ир╕╣р╕Щр╕вр╣М';

┬а ┬а ┬а ┬а ┬а ┬а let fracText = '';

┬а ┬а ┬а ┬а ┬а ┬а if (parseInt(fraction, 10) > 0) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а fracText = convert(fraction) + 'р╕кр╕Хр╕▓р╕Зр╕Др╣М';

┬а ┬а ┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а ┬а ┬а if (!intText && !fracText) return 'р╕ир╕╣р╕Щр╕вр╣Мр╕Ър╕▓р╕Чр╕Цр╣Йр╕зр╕Щ';

┬а ┬а ┬а ┬а ┬а ┬а return (intText ? intText + 'р╕Ър╕▓р╕Ч' : '') + (parseInt(fraction) === 0 ? 'р╕Цр╣Йр╕зр╕Щ' : fracText);

┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а /**

┬а ┬а ┬а ┬а ┬а* Calculates and updates the total weight and total amount in the receipt section.

┬а ┬а ┬а ┬а ┬а*/

┬а ┬а ┬а ┬а function calculateTotals() {

┬а ┬а ┬а ┬а ┬а ┬а let totalWeight = 0;

┬а ┬а ┬а ┬а ┬а ┬а const weightInputs = ui.weightInputsContainer.querySelectorAll('.weight-input');

┬а ┬а ┬а ┬а ┬а ┬а weightInputs.forEach(input => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а totalWeight += parseFloat(input.value) || 0;

┬а ┬а ┬а ┬а ┬а ┬а });

┬а ┬а ┬а ┬а ┬а ┬а const pricePerKg = parseFloat(ui.pricePerKgInput.value) || 0;

┬а ┬а ┬а ┬а ┬а ┬а const totalAmount = totalWeight * pricePerKg;



┬а ┬а ┬а ┬а ┬а ┬а ui.totalWeightEl.textContent = totalWeight.toFixed(2);

┬а ┬а ┬а ┬а ┬а ┬а ui.totalAmountEl.textContent = totalAmount.toLocaleString('th-TH', {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а minimumFractionDigits: 2,

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а maximumFractionDigits: 2

┬а ┬а ┬а ┬а ┬а ┬а });

┬а ┬а ┬а ┬а ┬а ┬а ui.totalAmountTextEl.textContent = bahttext(totalAmount);

┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а /**

┬а ┬а ┬а ┬а ┬а* Renders the sales data into the sales table in the history tab.

┬а ┬а ┬а ┬а ┬а* @param {Array<Object>} dataToRender - The array of sales data to display.

┬а ┬а ┬а ┬а ┬а*/

┬а ┬а ┬а ┬а function renderTable(dataToRender) {

┬а ┬а ┬а ┬а ┬а ┬а ui.salesTableBody.innerHTML = ''; // Clear existing rows

┬а ┬а ┬а ┬а ┬а ┬а if (dataToRender.length === 0) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.salesTableBody.innerHTML = '<tr><td colspan="6" class="px-6 py-8 text-center text-stone-400">р╕вр╕▒р╕Зр╣Др╕бр╣Ир╕бр╕╡р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Бр╕▓р╕гр╕Вр╕▓р╕в...</td></tr>';

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return;

┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а dataToRender.forEach(sale => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const row = document.createElement('tr');

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а row.className = 'bg-white border-b hover:bg-stone-50';

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // Convert Firebase Timestamp to Date object if necessary

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const saleDate = sale.date instanceof Date ? sale.date : sale.date.toDate();

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а row.innerHTML = `

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-6 py-4">${saleDate.toLocaleDateString('th-TH')}</td>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-6 py-4 font-medium text-stone-900 whitespace-nowrap">${sale.seller}</td>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-6 py-4 text-right">${sale.weight.toFixed(2)}</td>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-6 py-4 text-right">${sale.price.toFixed(2)}</td>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-6 py-4 text-right font-bold text-amber-600">${sale.total.toLocaleString('th-TH', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-6 py-4 text-center space-x-2">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button class="reprint-btn text-gray-500 hover:text-gray-700 p-1" data-id="${sale.id}" title="р╕Юр╕┤р╕бр╕Юр╣Мр╕Лр╣Йр╕│">ЁЯЦия╕П</button>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button class="edit-btn text-blue-600 hover:text-blue-800 p-1" data-id="${sale.id}" title="р╣Бр╕Бр╣Йр╣Др╕В">тЬПя╕П</button>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button class="delete-btn text-red-600 hover:text-red-800 p-1" data-id="${sale.id}" title="р╕ер╕Ъ">ЁЯЧСя╕П</button>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </td>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а `;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.salesTableBody.appendChild(row);

┬а ┬а ┬а ┬а ┬а ┬а });

┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а /**

┬а ┬а ┬а ┬а ┬а* Renders the overall summary (total sellers, weight, price) in the history tab.

┬а ┬а ┬а ┬а ┬а*/

┬а ┬а ┬а ┬а function renderSummary() {

┬а ┬а ┬а ┬а ┬а ┬а if (!localSalesData || localSalesData.length === 0) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.summaryTotalSellers.textContent = '0';

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.summaryTotalWeight.textContent = '0.00';

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.summaryTotalPrice.textContent = '0.00';

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return;

┬а ┬а ┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а ┬а ┬а const totalSellers = new Set(localSalesData.map(s => s.seller)).size;

┬а ┬а ┬а ┬а ┬а ┬а const totalWeight = localSalesData.reduce((acc, sale) => acc + sale.weight, 0);

┬а ┬а ┬а ┬а ┬а ┬а const totalPrice = localSalesData.reduce((acc, sale) => acc + sale.total, 0);



┬а ┬а ┬а ┬а ┬а ┬а ui.summaryTotalSellers.textContent = totalSellers.toLocaleString('th-TH');

┬а ┬а ┬а ┬а ┬а ┬а ui.summaryTotalWeight.textContent = totalWeight.toLocaleString('th-TH', {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а minimumFractionDigits: 2,

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а maximumFractionDigits: 2

┬а ┬а ┬а ┬а ┬а ┬а });

┬а ┬а ┬а ┬а ┬а ┬а ui.summaryTotalPrice.textContent = totalPrice.toLocaleString('th-TH', {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а minimumFractionDigits: 2,

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а maximumFractionDigits: 2

┬а ┬а ┬а ┬а ┬а ┬а });

┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а /**

┬а ┬а ┬а ┬а ┬а* Renders the daily summary (total weight for today) in the dashboard tab.

┬а ┬а ┬а ┬а ┬а*/

┬а ┬а ┬а ┬а function renderDailySummary() {

┬а ┬а ┬а ┬а ┬а ┬а const today = new Date();

┬а ┬а ┬а ┬а ┬а ┬а // Set time to beginning of the day for comparison

┬а ┬а ┬а ┬а ┬а ┬а const todayStart = new Date(today.getFullYear(), today.getMonth(), today.getDate());

┬а ┬а ┬а ┬а ┬а ┬а const todayEnd = new Date(today.getFullYear(), today.getMonth(), today.getDate(), 23, 59, 59, 999);



┬а ┬а ┬а ┬а ┬а ┬а // Filter sales data for today's date

┬а ┬а ┬а ┬а ┬а ┬а const salesToday = localSalesData.filter(sale => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const saleDate = sale.date instanceof Date ? sale.date : sale.date.toDate();

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return saleDate >= todayStart && saleDate <= todayEnd;

┬а ┬а ┬а ┬а ┬а ┬а });



┬а ┬а ┬а ┬а ┬а ┬а const dailyWeight = salesToday.reduce((acc, sale) => acc + sale.weight, 0);



┬а ┬а ┬а ┬а ┬а ┬а if (ui.summaryDailyWeight) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.summaryDailyWeight.textContent = dailyWeight.toLocaleString('th-TH', {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а minimumFractionDigits: 2,

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а maximumFractionDigits: 2

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });

┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а /**

┬а ┬а ┬а ┬а ┬а* Renders the dashboard charts (sales by seller and daily sales trend).

┬а ┬а ┬а ┬а ┬а*/

┬а ┬а ┬а ┬а function renderDashboard() {

┬а ┬а ┬а ┬а ┬а ┬а renderSalesBySellerChart();

┬а ┬а ┬а ┬а ┬а ┬а renderDailySalesChart();

┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а /**

┬а ┬а ┬а ┬а ┬а* Generates an array of colors for chart visualization.

┬а ┬а ┬а ┬а ┬а* @param {number} count - The number of colors needed.

┬а ┬а ┬а ┬а ┬а* @returns {Array<string>} An array of hex color strings.

┬а ┬а ┬а ┬а ┬а*/

┬а ┬а ┬а ┬а function getChartColors(count) {

┬а ┬а ┬а ┬а ┬а ┬а const baseColors = ['#d97706', '#f59e0b', '#fcd34d', '#fef3c7', '#fffbeb', '#b45309', '#92400e'];

┬а ┬а ┬а ┬а ┬а ┬а let colors = [];

┬а ┬а ┬а ┬а ┬а ┬а for (let i = 0; i < count; i++) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а colors.push(baseColors[i % baseColors.length]);

┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а return colors;

┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а /**

┬а ┬а ┬а ┬а ┬а* Renders the doughnut chart showing sales proportion by seller.

┬а ┬а ┬а ┬а ┬а*/

┬а ┬а ┬а ┬а function renderSalesBySellerChart() {

┬а ┬а ┬а ┬а ┬а ┬а const salesBySeller = localSalesData.reduce((acc, sale) => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а acc[sale.seller] = (acc[sale.seller] || 0) + sale.total;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return acc;

┬а ┬а ┬а ┬а ┬а ┬а }, {});

┬а ┬а ┬а ┬а ┬а ┬а const labels = Object.keys(salesBySeller);

┬а ┬а ┬а ┬а ┬а ┬а const data = Object.values(salesBySeller);



┬а ┬а ┬а ┬а ┬а ┬а if (salesBySellerChart) salesBySellerChart.destroy(); // Destroy previous chart instance



┬а ┬а ┬а ┬а ┬а ┬а const canvas = document.getElementById('sales-by-seller-chart');

┬а ┬а ┬а ┬а ┬а ┬а if (canvas) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а salesBySellerChart = new Chart(canvas.getContext('2d'), {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а type: 'doughnut',

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а data: {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а labels: labels,

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а datasets: [{

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а label: 'р╕вр╕нр╕Фр╕Вр╕▓р╕в',

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а data: data,

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а backgroundColor: getChartColors(labels.length),

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а borderColor: '#ffffff',

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а borderWidth: 2

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }]

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а },

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а options: {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а responsive: true,

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а maintainAspectRatio: false,

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а plugins: {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а legend: {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а position: 'bottom'

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });

┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а /**

┬а ┬а ┬а ┬а ┬а* Renders the line chart showing daily sales trend.

┬а ┬а ┬а ┬а ┬а*/

┬а ┬а ┬а ┬а function renderDailySalesChart() {

┬а ┬а ┬а ┬а ┬а ┬а const salesByDay = localSalesData.reduce((acc, sale) => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const saleDate = sale.date instanceof Date ? sale.date : sale.date.toDate();

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // Format date for chart labels (Thai locale, short year)

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const day = saleDate.toLocaleDateString('th-TH', {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а year: '2-digit',

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а month: 'short',

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а day: 'numeric'

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а acc[day] = (acc[day] || 0) + sale.total;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return acc;

┬а ┬а ┬а ┬а ┬а ┬а }, {});



┬а ┬а ┬а ┬а ┬а ┬а // Sort labels chronologically

┬а ┬а ┬а ┬а ┬а ┬а const sortedLabels = Object.keys(salesByDay).sort((a, b) => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // Convert Thai date string to Date object for proper sorting

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const parseThaiDate = (dateString) => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const parts = dateString.split(' ');

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const day = parseInt(parts[0]);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const monthMap = { 'р╕б.р╕Д.': 0, 'р╕Б.р╕Ю.': 1, 'р╕бр╕╡.р╕Д.': 2, 'р╣Ар╕б.р╕в.': 3, 'р╕Ю.р╕Д.': 4, 'р╕бр╕┤.р╕в.': 5, 'р╕Б.р╕Д.': 6, 'р╕к.р╕Д.': 7, 'р╕Б.р╕в.': 8, 'р╕Х.р╕Д.': 9, 'р╕Ю.р╕в.': 10, 'р╕Ш.р╕Д.': 11 };

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const month = monthMap[parts[1]];

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const year = parseInt(parts[2]) + 2500 - 543; // Convert Buddhist year to Gregorian

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return new Date(year, month, day);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а };

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return parseThaiDate(a) - parseThaiDate(b);

┬а ┬а ┬а ┬а ┬а ┬а });

┬а ┬а ┬а ┬а ┬а ┬а const data = sortedLabels.map(label => salesByDay[label]);



┬а ┬а ┬а ┬а ┬а ┬а if (dailySalesChart) dailySalesChart.destroy(); // Destroy previous chart instance



┬а ┬а ┬а ┬а ┬а ┬а const canvas = document.getElementById('daily-sales-chart');

┬а ┬а ┬а ┬а ┬а ┬а if (canvas) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а dailySalesChart = new Chart(canvas.getContext('2d'), {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а type: 'line',

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а data: {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а labels: sortedLabels,

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а datasets: [{

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а label: 'р╕вр╕нр╕Фр╕Вр╕▓р╕вр╕гр╕зр╕бр╕гр╕▓р╕вр╕зр╕▒р╕Щ',

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а data: data,

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а fill: true,

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а backgroundColor: 'rgba(217, 119, 6, 0.2)',

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а borderColor: 'rgb(217, 119, 6)',

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а tension: 0.1,

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а pointBackgroundColor: 'rgb(217, 119, 6)',

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а pointRadius: 4

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }]

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а },

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а options: {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а responsive: true,

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а maintainAspectRatio: false,

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а scales: {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а y: {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а beginAtZero: true

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });

┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а /**

┬а ┬а ┬а ┬а ┬а* Creates the HTML for a printable receipt (original and copy).

┬а ┬а ┬а ┬а ┬а* @param {Object} sale - The sales data object to create the receipt for.

┬а ┬а ┬а ┬а ┬а*/

┬а ┬а ┬а ┬а function createPrintableReceipt(sale) {

┬а ┬а ┬а ┬а ┬а ┬а const saleDate = sale.date instanceof Date ? sale.date : sale.date.toDate();



┬а ┬а ┬а ┬а ┬а ┬а const generateSingleReceiptHTML = (title) => `

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="w-1/2 p-4 border border-dashed border-stone-400 h-full flex flex-col text-sm">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="text-center mb-4">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h2 class="text-base font-bold">${title}</h2>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h3 class="text-sm font-semibold mt-1">р╕кр╕лр╕Бр╕гр╕Ур╣Мр╕Бр╕нр╕Зр╕Чр╕╕р╕Щр╕кр╕зр╕Щр╕вр╕▓р╕Зр╕Юр╕▓р╕гр╕▓р╣Ар╕Бр╕йр╕Хр╕гр╕кр╕бр╕Ър╕╣р╕гр╕Ур╣М р╕Ир╕│р╕Бр╕▒р╕Ф</h3>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p class="text-xs text-stone-600">15/1 р╕б.6 р╕Х.р╕лр╕Щр╕нр╕Зр╣Вр╕Юр╕Щр╕Зр╕▓р╕б р╕н.р╣Ар╕Бр╕йр╕Хр╕гр╕кр╕бр╕Ър╕╣р╕гр╕Ур╣М р╕И.р╕Кр╕▒р╕вр╕ар╕╣р╕бр╕┤</p>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="border-y border-stone-300 py-1 mb-2">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="flex justify-between">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span class="font-semibold">р╣Ар╕ер╕Вр╕Чр╕╡р╣Ир╣Гр╕Ър╣Ар╕кр╕гр╣Зр╕И:</span>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span>${sale.receiptId || 'N/A'}</span>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="flex justify-between mt-1">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span class="font-semibold">р╕зр╕▒р╕Щр╕Чр╕╡р╣И:</span>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span>${saleDate.toLocaleDateString('th-TH', { year: 'numeric', month: 'long', day: 'numeric' })}</span>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="flex justify-between mt-1">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span class="font-semibold">р╕Хр╕▓р╕Кр╕▒р╣Ир╕Зр╕Чр╕╡р╣И:</span>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span>${sale.scaleNumber || '-'}</span>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="mb-2">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span class="font-semibold">р╕Ьр╕╣р╣Йр╕Вр╕▓р╕в:</span>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span class="text-lg font-bold">${sale.seller}</span>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <table class="w-full my-1">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <thead class="border-y border-stone-300">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <tr>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th class="py-1 text-left font-semibold">р╕гр╕▓р╕вр╕Бр╕▓р╕г</th>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th class="py-1 text-right font-semibold">р╕вр╕нр╕Фр╕гр╕зр╕б (р╕Ър╕▓р╕Ч)</th>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </tr>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </thead>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <tbody class="border-b border-stone-300">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <tr>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="py-2 align-top">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а р╕Др╣Ир╕▓р╕вр╕▓р╕Зр╕Бр╣Йр╕нр╕Щр╕Цр╣Йр╕зр╕в

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span class="block text-xs text-stone-600">р╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Б: ${sale.weight.toFixed(2)} р╕Бр╕Б. @ ${sale.price.toFixed(2)} р╕Ър╕▓р╕Ч/р╕Бр╕Б.</span>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </td>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="text-right align-top pt-2 text-lg font-bold">${Math.round(sale.total).toLocaleString('th-TH')}</td>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </tr>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </tbody>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <tfoot>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <tr class="font-bold">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="py-2 text-lg">р╕гр╕зр╕бр╣Ар╕Ыр╣Зр╕Щр╣Ар╕Зр╕┤р╕Щ</td>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="text-right text-lg">${Math.round(sale.total).toLocaleString('th-TH')}</td>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </tr>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </tfoot>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </table>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а┬а

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="flex-grow"></div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="flex justify-center text-center mt-4">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p class="pb-1">........................................</p>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p>(р╕Ьр╕╣р╣Йр╕Ир╣Ир╕▓р╕вр╣Ар╕Зр╕┤р╕Щ)</p>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а `;

┬а ┬а ┬а ┬а ┬а ┬а ui.printArea.innerHTML = `

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="flex gap-4">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ${generateSingleReceiptHTML('р╣Гр╕Ър╣Ар╕кр╕гр╣Зр╕Ир╕гр╕▒р╕Ър╣Ар╕Зр╕┤р╕Щ р╕Хр╣Йр╕Щр╕Йр╕Ър╕▒р╕Ъ')}

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ${generateSingleReceiptHTML('р╣Гр╕Ър╣Ар╕кр╕гр╣Зр╕Ир╕гр╕▒р╕Ър╣Ар╕Зр╕┤р╕Щ (р╕кр╕│р╣Ар╕Щр╕▓)')}

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а `;

┬а ┬а ┬а ┬а ┬а ┬а window.print(); // Trigger browser print dialog

┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а /**

┬а ┬а ┬а ┬а ┬а* Creates and prints a daily summary report based on the selected date.

┬а ┬а ┬а ┬а ┬а*/

┬а ┬а ┬а ┬а function createDailySummaryReport() {

┬а ┬а ┬а ┬а ┬а ┬а const reportDateStr = ui.reportDateInput.value;

┬а ┬а ┬а ┬а ┬а ┬а if (!reportDateStr) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showAlert('р╕Бр╕гр╕╕р╕Ур╕▓р╣Ар╕ер╕╖р╕нр╕Бр╕зр╕▒р╕Щр╕Чр╕╡р╣Ир╕Чр╕╡р╣Ир╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕Чр╕│р╕гр╕▓р╕вр╕Зр╕▓р╕Щ');

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return;

┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а const reportDate = new Date(reportDateStr);

┬а ┬а ┬а ┬а ┬а ┬а const formattedDate = reportDate.toLocaleDateString('th-TH', {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а year: 'numeric',

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а month: 'long',

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а day: 'numeric'

┬а ┬а ┬а ┬а ┬а ┬а });



┬а ┬а ┬а ┬а ┬а ┬а // Set report date to start and end of the day for filtering

┬а ┬а ┬а ┬а ┬а ┬а const reportStart = new Date(reportDate.getFullYear(), reportDate.getMonth(), reportDate.getDate());

┬а ┬а ┬а ┬а ┬а ┬а const reportEnd = new Date(reportDate.getFullYear(), reportDate.getMonth(), reportDate.getDate(), 23, 59, 59, 999);



┬а ┬а ┬а ┬а ┬а ┬а const salesForDay = localSalesData.filter(sale => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const saleDate = sale.date instanceof Date ? sale.date : sale.date.toDate();

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return saleDate >= reportStart && saleDate <= reportEnd;

┬а ┬а ┬а ┬а ┬а ┬а });



┬а ┬а ┬а ┬а ┬а ┬а if (salesForDay.length === 0) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showAlert(`р╣Др╕бр╣Ир╕Юр╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Бр╕▓р╕гр╕Вр╕▓р╕вр╣Гр╕Щр╕зр╕▒р╕Щр╕Чр╕╡р╣И ${reportStart.toLocaleDateString('th-TH')}`);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return;

┬а ┬а ┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а ┬а ┬а let tableRows = '';

┬а ┬а ┬а ┬а ┬а ┬а salesForDay.forEach((sale, index) => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а tableRows += `

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <tr class="border-b">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-2 py-2 text-center">${index + 1}</td>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-2 py-2">${sale.seller}</td>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-2 py-2 text-right">${sale.weight.toFixed(2)}</td>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-2 py-2 text-right">${sale.price.toFixed(2)}</td>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-2 py-2 text-right">${sale.total.toFixed(2)}</td>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-2 py-2 text-center">${sale.scaleNumber || ''}</td>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-2 py-2 border-l"></td>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </tr>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а `;

┬а ┬а ┬а ┬а ┬а ┬а });



┬а ┬а ┬а ┬а ┬а ┬а const reportHTML = `

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="p-8 bg-white text-black">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="text-center mb-4">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h2 class="text-xl font-bold">р╕кр╕лр╕Бр╕гр╕Ур╣Мр╕Бр╕нр╕Зр╕Чр╕╕р╕Щр╕кр╕зр╕Щр╕вр╕▓р╕Зр╕Юр╕▓р╕гр╕▓р╣Ар╕Бр╕йр╕Хр╕гр╕кр╕бр╕Ър╕╣р╕гр╕Ур╣М р╕Ир╕│р╕Бр╕▒р╕Ф</h2>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h3 class="text-lg">р╕гр╕▓р╕вр╕Зр╕▓р╕Щр╕Бр╕▓р╕гр╕Кр╕▒р╣Ир╕Зр╕вр╕▓р╕Зр╕Ыр╕гр╕░р╕Ир╕│р╕зр╕▒р╕Щр╕Чр╕╡р╣И ${formattedDate}</h3>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <table class="w-full text-sm border-collapse border border-black">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <thead class="bg-stone-200">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <tr class="border-b border-black">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th class="px-2 py-2 border-r border-black">р╕ер╕│р╕Фр╕▒р╕Ър╕Чр╕╡р╣И</th>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th class="px-2 py-2 border-r border-black">р╕Кр╕╖р╣Ир╕н</th>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th class="px-2 py-2 border-r border-black">р╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Б</th>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th class="px-2 py-2 border-r border-black">р╕гр╕▓р╕Др╕▓</th>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th class="px-2 py-2 border-r border-black">р╕вр╕нр╕Фр╕гр╕зр╕б</th>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th class="px-2 py-2 border-r border-black">р╕Хр╕▓р╕Кр╕▒р╣Ир╕Зр╕Чр╕╡р╣И</th>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th class="px-2 py-2">р╕ер╕▓р╕вр╣Ар╕Лр╣Зр╕Щ</th>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </tr>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </thead>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <tbody>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ${tableRows}

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </tbody>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </table>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а `;

┬а ┬а ┬а ┬а ┬а ┬а ui.printArea.innerHTML = reportHTML;

┬а ┬а ┬а ┬а ┬а ┬а window.print(); // Trigger browser print dialog

┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а /**

┬а ┬а ┬а ┬а ┬а* Clears the receipt input form and resets the editing state.

┬а ┬а ┬а ┬а ┬а*/

┬а ┬а ┬а ┬а function clearForm() {

┬а ┬а ┬а ┬а ┬а ┬а ui.sellerNameInput.value = '';

┬а ┬а ┬а ┬а ┬а ┬а ui.scaleNumberInput.value = '';

┬а ┬а ┬а ┬а ┬а ┬а const weightInputs = ui.weightInputsContainer.querySelectorAll('.weight-input');

┬а ┬а ┬а ┬а ┬а ┬а weightInputs.forEach(input => input.value = '');

┬а ┬а ┬а ┬а ┬а ┬а ui.pricePerKgInput.value = '';

┬а ┬а ┬а ┬а ┬а ┬а editingId = null; // Clear editing ID

┬а ┬а ┬а ┬а ┬а ┬а ui.saveButton.textContent = 'р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╣Бр╕ер╕░р╕Юр╕┤р╕бр╕Юр╣Мр╣Гр╕Ър╣Ар╕кр╕гр╣Зр╕И';

┬а ┬а ┬а ┬а ┬а ┬а ui.cancelEditButton.classList.add('hidden');

┬а ┬а ┬а ┬а ┬а ┬а calculateTotals(); // Recalculate totals after clearing

┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а /**

┬а ┬а ┬а ┬а ┬а* Handles saving (add or update) a sales record to Firestore.

┬а ┬а ┬а ┬а ┬а*/

┬а ┬а ┬а ┬а async function handleSave() {

┬а ┬а ┬а ┬а ┬а ┬а if (!salesCollectionRef) return showAlert('р╕вр╕▒р╕Зр╣Др╕бр╣Ир╕Юр╕гр╣Йр╕нр╕бр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ р╕Бр╕гр╕╕р╕Ур╕▓р╕гр╕нр╕кр╕▒р╕Бр╕Др╕гр╕╣р╣И');



┬а ┬а ┬а ┬а ┬а ┬а const seller = ui.sellerNameInput.value.trim();

┬а ┬а ┬а ┬а ┬а ┬а const date = ui.receiptDateInput.valueAsDate;

┬а ┬а ┬а ┬а ┬а ┬а const scaleNumber = ui.scaleNumberInput.value;

┬а ┬а ┬а ┬а ┬а ┬а const weight = parseFloat(ui.totalWeightEl.textContent.replace(/,/g, '')) || 0;

┬а ┬а ┬а ┬а ┬а ┬а const price = parseFloat(ui.pricePerKgInput.value) || 0;

┬а ┬а ┬а ┬а ┬а ┬а const total = parseFloat(ui.totalAmountEl.textContent.replace(/,/g, '')) || 0;

┬а ┬а ┬а ┬а ┬а ┬а const weightInputs = Array.from(ui.weightInputsContainer.querySelectorAll('.weight-input'))

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а .map(input => parseFloat(input.value) || 0)

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а .filter(v => v > 0); // Filter out zero or empty weights



┬а ┬а ┬а ┬а ┬а ┬а // Basic input validation

┬а ┬а ┬а ┬а ┬а ┬а if (weightInputs.length === 0) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showAlert('р╕Бр╕гр╕╕р╕Ур╕▓р╕Бр╕гр╕нр╕Бр╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Бр╕нр╕вр╣Ир╕▓р╕Зр╕Щр╣Йр╕нр╕в 1 р╕гр╕▓р╕вр╕Бр╕▓р╕г');

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return;

┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а if (total <= 0) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showAlert('р╕вр╕нр╕Фр╕гр╕зр╕бр╕Хр╣Йр╕нр╕Зр╕бр╕▓р╕Бр╕Бр╕зр╣Ир╕▓ 0 р╕Ър╕▓р╕Ч');

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return;

┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а if (!seller || !date || weight <= 0 || price <= 0) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showAlert('р╕Бр╕гр╕╕р╕Ур╕▓р╕Бр╕гр╕нр╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Гр╕лр╣Йр╕Др╕гр╕Ър╕Цр╣Йр╕зр╕Щ: р╕Кр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╕Вр╕▓р╕в, р╕зр╕▒р╕Щр╕Чр╕╡р╣И, р╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Б р╣Бр╕ер╕░р╕гр╕▓р╕Др╕▓');

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return;

┬а ┬а ┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а ┬а ┬а const saleData = {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а seller,

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а date,

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а scaleNumber,

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а weight,

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а weights: weightInputs,

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а price,

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а total,

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а timestamp: new Date(), // NEW: Add timestamp for sorting

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а userId

┬а ┬а ┬а ┬а ┬а ┬а };



┬а ┬а ┬а ┬а ┬а ┬а try {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (editingId) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // Update existing document

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const docRef = doc(salesCollectionRef, editingId);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const dataToUpdate = { ...saleData

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а };

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // Preserve receiptId if exists during edit

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const originalDoc = localSalesData.find(s => s.id === editingId);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (originalDoc && originalDoc.receiptId) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а dataToUpdate.receiptId = originalDoc.receiptId;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а await updateDoc(docRef, dataToUpdate);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showAlert('р╕нр╕▒р╕Ыр╣Ар╕Фр╕Хр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕кр╕│р╣Ар╕гр╣Зр╕И');

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а } else {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // Add new document

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const now = new Date();

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const year = now.getFullYear();

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const month = (now.getMonth() + 1).toString().padStart(2, '0');

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const day = now.getDate().toString().padStart(2, '0');



┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // Get today's sales to determine the next receipt number

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const todayStart = new Date(now.setHours(0, 0, 0, 0));

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const salesToday = localSalesData.filter(sale => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const saleDate = sale.date.toDate();

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return saleDate >= todayStart;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const nextReceiptNumber = salesToday.length + 1;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а saleData.receiptId = `${year}${month}${day}-${String(nextReceiptNumber).padStart(3, '0')}`; // Generate receipt ID



┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const docRef = await addDoc(salesCollectionRef, saleData);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showAlert('р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕кр╕│р╣Ар╕гр╣Зр╕И');

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а createPrintableReceipt({ ...saleData,

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а id: docRef.id

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }); // Print receipt for new sale

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а clearForm(); // Clear form after saving

┬а ┬а ┬а ┬а ┬а ┬а } catch (error) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а console.error("Error saving document: ", error);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showAlert(`р╣Ар╕Бр╕┤р╕Фр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╣Гр╕Щр╕Бр╕▓р╕гр╕Ър╕▒р╕Щр╕Чр╕╢р╕Б: ${error.message}`);

┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а /**

┬а ┬а ┬а ┬а ┬а* Handles click events on the sales table (delete, edit, reprint buttons).

┬а ┬а ┬а ┬а ┬а* @param {Event} e - The click event object.

┬а ┬а ┬а ┬а ┬а*/

┬а ┬а ┬а ┬а function handleTableClick(e) {

┬а ┬а ┬а ┬а ┬а ┬а const target = e.target.closest('button');

┬а ┬а ┬а ┬а ┬а ┬а if (!target) return;



┬а ┬а ┬а ┬а ┬а ┬а const id = target.dataset.id;

┬а ┬а ┬а ┬а ┬а ┬а const saleToProcess = localSalesData.find(sale => sale.id === id);

┬а ┬а ┬а ┬а ┬а ┬а if (!saleToProcess) return;



┬а ┬а ┬а ┬а ┬а ┬а if (target.classList.contains('delete-btn')) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showConfirm('р╕Др╕╕р╕Ур╣Бр╕Щр╣Ир╣Гр╕Ир╕зр╣Ир╕▓р╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕ер╕Ър╕гр╕▓р╕вр╕Бр╕▓р╕гр╕Щр╕╡р╣Й?', async () => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а try {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а await deleteDoc(doc(salesCollectionRef, id));

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showAlert('р╕ер╕Ър╕гр╕▓р╕вр╕Бр╕▓р╕гр╕кр╕│р╣Ар╕гр╣Зр╕И');

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а } catch (error) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а console.error("Error deleting document: ", error);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showAlert(`р╣Ар╕Бр╕┤р╕Фр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╣Гр╕Щр╕Бр╕▓р╕гр╕ер╕Ъ: ${error.message}`);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });

┬а ┬а ┬а ┬а ┬а ┬а } else if (target.classList.contains('edit-btn')) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // Populate form for editing

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а editingId = id;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.sellerNameInput.value = saleToProcess.seller;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const saleDate = saleToProcess.date instanceof Date ? saleToProcess.date : saleToProcess.date.toDate();

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.receiptDateInput.value = saleDate.toISOString().split('T')[0];

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.scaleNumberInput.value = saleToProcess.scaleNumber || '';

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.pricePerKgInput.value = saleToProcess.price;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const weightInputs = ui.weightInputsContainer.querySelectorAll('.weight-input');

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а weightInputs.forEach((input, index) => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а input.value = saleToProcess.weights[index] || '';

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а calculateTotals();

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.saveButton.textContent = 'р╕нр╕▒р╕Ыр╣Ар╕Фр╕Хр╕Вр╣Йр╕нр╕бр╕╣р╕е';

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.cancelEditButton.classList.remove('hidden');

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а window.scrollTo({

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а top: 0,

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а behavior: 'smooth'

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }); // Scroll to top for editing

┬а ┬а ┬а ┬а ┬а ┬а } else if (target.classList.contains('reprint-btn')) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а createPrintableReceipt(saleToProcess);

┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а /**

┬а ┬а ┬а ┬а ┬а* Updates the displayed date next to the "р╕зр╕▒р╕Щр╕Чр╕╡р╣И" label.

┬а ┬а ┬а ┬а ┬а*/

┬а ┬а ┬а ┬а function updateDateDisplay() {

┬а ┬а ┬а ┬а ┬а ┬а const date = ui.receiptDateInput.valueAsDate;

┬а ┬а ┬а ┬а ┬а ┬а if (date) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.dateDisplay.textContent = `(${date.toLocaleDateString('th-TH')})`;

┬а ┬а ┬а ┬а ┬а ┬а } else {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const today = new Date();

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.dateDisplay.textContent = `(${today.toLocaleDateString('th-TH')})`;

┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а /**

┬а ┬а ┬а ┬а ┬а* Generates the HTML structure for a single weighing station tab.

┬а ┬а ┬а ┬а ┬а* @param {number} scaleId - The ID of the weighing scale.

┬а ┬а ┬а ┬а ┬а* @returns {string} The HTML string for the weighing station.

┬а ┬а ┬а ┬а ┬а*/

┬а ┬а ┬а ┬а function createWeighingStationHTML(scaleId) {

┬а ┬а ┬а ┬а ┬а ┬а return `

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <section class="bg-white p-6 rounded-xl shadow-md">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h2 class="text-2xl font-bold mb-4 border-b pb-3 text-stone-800">р╕гр╕▒р╕Ър╕зр╕▓р╕Зр╕вр╕▓р╕З (р╕Хр╕▓р╕Кр╕▒р╣Ир╕Зр╕Чр╕╡р╣И ${scaleId})</h2>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="grid grid-cols-1 md:grid-cols-3 gap-4">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="md:col-span-2">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="weighing-seller-${scaleId}" class="block text-sm font-medium text-stone-600 mb-1">р╕Кр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╕Вр╕▓р╕в</label>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="text" id="weighing-seller-${scaleId}" class="w-full p-2 border border-stone-300 rounded-md shadow-sm" placeholder="р╕Др╣Йр╕Щр╕лр╕▓р╕лр╕гр╕╖р╕нр╕Ыр╣Йр╕нр╕Щр╕Кр╕╖р╣Ир╕н">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="weighing-weight-${scaleId}" class="block text-sm font-medium text-stone-600 mb-1">р╕Ир╕│р╕Щр╕зр╕Щр╕Цр╕╕р╕З</label>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="number" id="weighing-weight-${scaleId}" class="w-full p-2 border border-stone-300 rounded-md shadow-sm" step="any">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="md:col-span-3">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button id="save-weighing-${scaleId}" data-scale="${scaleId}" class="w-full bg-green-600 text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-green-700">р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Ир╕│р╕Щр╕зр╕Щр╕Цр╕╕р╕З</button>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="mt-6 border-t pt-4">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="grid grid-cols-3 gap-4 items-end">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label class="block text-sm font-medium text-stone-600">р╕Ьр╕ер╕гр╕зр╕бр╕Ир╕│р╕Щр╕зр╕Щр╕Цр╕╕р╕З</label>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p id="total-bags-${scaleId}" class="text-lg font-bold">0</p>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="multiplier-weight-${scaleId}" class="block text-sm font-medium text-stone-600">р╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Б/р╕Цр╕╕р╕З (р╕Бр╕Б.)</label>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="number" id="multiplier-weight-${scaleId}" class="w-full p-2 border border-stone-300 rounded-md shadow-sm">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label class="block text-sm font-medium text-stone-600">р╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣М (р╕Бр╕Б.)</label>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p id="total-calculated-weight-${scaleId}" class="text-lg font-bold">0.00</p>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="mt-4 flex justify-end">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button id="print-weighing-log-${scaleId}" data-scale="${scaleId}" class="bg-sky-600 text-white font-bold py-1 px-3 rounded-lg shadow-md hover:bg-sky-700">р╕Ыр╕гр╕┤р╣Йр╕Щр╕гр╕▓р╕вр╕Бр╕▓р╕гр╕Хр╕▓р╕Кр╕▒р╣Ир╕З</button>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="mt-6">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h3 class="font-semibold mb-2">р╕гр╕▓р╕вр╕Кр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╕бр╕▓р╕Вр╕▓р╕вр╕вр╕▓р╕Зр╕Юр╕▓р╕гр╕▓ (р╕Хр╕▓р╕Кр╕▒р╣Ир╕Зр╕Чр╕╡р╣И ${scaleId})</h3>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="overflow-y-auto h-64 border rounded-lg">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <table class="w-full text-sm text-left">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <thead class="bg-stone-100 sticky top-0">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <tr>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th class="px-4 py-2">р╣Ар╕зр╕ер╕▓</th>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th class="px-4 py-2">р╕Кр╕╖р╣Ир╕н</th>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th class="px-4 py-2 text-right">р╕Ир╕│р╕Щр╕зр╕Щр╕Цр╕╕р╕З</th>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th class="px-4 py-2 text-center">р╕Ир╕▒р╕Фр╕Бр╕▓р╕г</th>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </tr>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </thead>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <tbody id="weighing-table-body-${scaleId}">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <tr><td colspan="4" class="text-center p-4 text-stone-400">р╕вр╕▒р╕Зр╣Др╕бр╣Ир╕бр╕╡р╕гр╕▓р╕вр╕Бр╕▓р╕г</td></tr>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </tbody>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </table>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </section>

┬а ┬а ┬а ┬а ┬а ┬а `;

┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а /**

┬а ┬а ┬а ┬а ┬а* Renders all weighing station tabs and attaches their event listeners.

┬а ┬а ┬а ┬а ┬а*/

┬а ┬а ┬а ┬а function renderWeighingStations() {

┬а ┬а ┬а ┬а ┬а ┬а for (let i = 1; i <= 4; i++) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const tabContent = document.getElementById(`tab-weighing-${i}`);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (tabContent) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а tabContent.innerHTML = createWeighingStationHTML(i);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // Attach event listeners for each scale

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById(`save-weighing-${i}`).addEventListener('click', saveWeighing);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById(`multiplier-weight-${i}`).addEventListener('input', () => calculateTotalWeight(i));

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById(`weighing-weight-${i}`).addEventListener('input', () => calculateTotalWeight(i));

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById(`print-weighing-log-${i}`).addEventListener('click', printWeighingLog);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById(`weighing-table-body-${i}`).addEventListener('click', handleWeighingTableClick);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а /**

┬а ┬а ┬а ┬а ┬а* Saves a new weighing record or updates an existing one to Firestore.

┬а ┬а ┬а ┬а ┬а* @param {Event} event - The click event from the save button.

┬а ┬а ┬а ┬а ┬а*/

┬а ┬а ┬а ┬а async function saveWeighing(event) {

┬а ┬а ┬а ┬а ┬а ┬а if (!weighingsCollectionRef) return showAlert('р╕вр╕▒р╕Зр╣Др╕бр╣Ир╕Юр╕гр╣Йр╕нр╕бр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ р╕Бр╕гр╕╕р╕Ур╕▓р╕гр╕нр╕кр╕▒р╕Бр╕Др╕гр╕╣р╣И');

┬а ┬а ┬а ┬а ┬а ┬а const scaleId = parseInt(event.target.dataset.scale);

┬а ┬а ┬а ┬а ┬а ┬а const sellerName = document.getElementById(`weighing-seller-${scaleId}`).value.trim();

┬а ┬а ┬а ┬а ┬а ┬а const bags = parseFloat(document.getElementById(`weighing-weight-${scaleId}`).value);



┬а ┬а ┬а ┬а ┬а ┬а if (!sellerName || !bags || bags <= 0) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showAlert('р╕Бр╕гр╕╕р╕Ур╕▓р╕Бр╕гр╕нр╕Бр╕Кр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╕Вр╕▓р╕вр╣Бр╕ер╕░р╕Ир╕│р╕Щр╕зр╕Щр╕Цр╕╕р╕Зр╣Гр╕лр╣Йр╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З');

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return;

┬а ┬а ┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а ┬а ┬а try {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (editingWeighingId) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // Update existing weighing record

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const docRef = doc(weighingsCollectionRef, editingWeighingId);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а await updateDoc(docRef, {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а sellerName,

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а bags

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а editingWeighingId = null; // Clear editing ID after update

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а } else {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // Add new weighing record

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а await addDoc(weighingsCollectionRef, {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а sellerName,

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а bags,

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а scaleId: scaleId,

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а timestamp: new Date(), // Add timestamp for entry order

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а userId

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // Clear inputs and refocus after saving

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById(`weighing-seller-${scaleId}`).value = '';

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById(`weighing-weight-${scaleId}`).value = '';

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById(`weighing-seller-${scaleId}`).focus();



┬а ┬а ┬а ┬а ┬а ┬а } catch (error) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а console.error("Error saving weighing: ", error);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showAlert(`р╣Ар╕Бр╕┤р╕Фр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╣Гр╕Щр╕Бр╕▓р╕гр╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Б: ${error.message}`);

┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а /**

┬а ┬а ┬а ┬а ┬а* Calculates the total weight for a specific scale based on total bags and multiplier.

┬а ┬а ┬а ┬а ┬а* @param {number} scaleId - The ID of the weighing scale.

┬а ┬а ┬а ┬а ┬а*/

┬а ┬а ┬а ┬а function calculateTotalWeight(scaleId) {

┬а ┬а ┬а ┬а ┬а ┬а const totalBagsEl = document.getElementById(`total-bags-${scaleId}`);

┬а ┬а ┬а ┬а ┬а ┬а const multiplierEl = document.getElementById(`multiplier-weight-${scaleId}`);

┬а ┬а ┬а ┬а ┬а ┬а const resultEl = document.getElementById(`total-calculated-weight-${scaleId}`);



┬а ┬а ┬а ┬а ┬а ┬а const totalBags = parseFloat(totalBagsEl.textContent) || 0;

┬а ┬а ┬а ┬а ┬а ┬а const multiplier = parseFloat(multiplierEl.value) || 0;



┬а ┬а ┬а ┬а ┬а ┬а resultEl.textContent = (totalBags * multiplier).toFixed(2);

┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а /**

┬а ┬а ┬а ┬а ┬а* Prints the weighing log for a specific scale for the current day.

┬а ┬а ┬а ┬а ┬а* @param {Event} event - The click event from the print button.

┬а ┬а ┬а ┬а ┬а*/

┬а ┬а ┬а ┬а function printWeighingLog(event) {

┬а ┬а ┬а ┬а ┬а ┬а if (!weighingsCollectionRef) return showAlert("р╕вр╕▒р╕Зр╣Др╕бр╣Ир╕Юр╕гр╣Йр╕нр╕бр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ р╕Бр╕гр╕╕р╕Ур╕▓р╕гр╕нр╕кр╕▒р╕Бр╕Др╕гр╕╣р╣И");

┬а ┬а ┬а ┬а ┬а ┬а const scaleId = event.target.dataset.scale;



┬а ┬а ┬а ┬а ┬а ┬а const q = query(weighingsCollectionRef, where("scaleId", "==", parseInt(scaleId)));



┬а ┬а ┬а ┬а ┬а ┬а getDocs(q).then(snapshot => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const today = new Date();

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а today.setHours(0, 0, 0, 0); // Set to start of today



┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // Filter documents for today and sort by timestamp

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const salesForDay = snapshot.docs

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а .map(doc => doc.data())

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а .filter(data => data.timestamp.toDate() >= today)

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а .sort((a, b) => a.timestamp.toDate() - b.timestamp.toDate()); // Sort by time entered (ascending)



┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (salesForDay.length === 0) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showAlert(`р╣Др╕бр╣Ир╕Юр╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╕кр╕│р╕лр╕гр╕▒р╕Ър╕Хр╕▓р╕Кр╕▒р╣Ир╕Зр╕Чр╕╡р╣И ${scaleId} р╣Гр╕Щр╕зр╕▒р╕Щр╕Щр╕╡р╣Й`);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а let tableRows = '';

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а let index = 1;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а salesForDay.forEach(data => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а tableRows += `

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <tr class="border-b">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-2 py-2 text-center">${index++}</td>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-2 py-2">${data.sellerName}</td>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-2 py-2 text-center">${data.bags}</td>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-2 py-2 text-center border-l"></td>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </tr>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а `;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });



┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const reportHTML = `

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <style>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а @media print {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а @page { size: A4; margin: 1.5cm; }

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а body { -webkit-print-color-adjust: exact; print-color-adjust: exact; }

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а .print-container { width: 100%; margin: 0; padding: 0; }

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а .print-table { width: 100%; border-collapse: collapse; font-size: 10pt; }

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а .print-table th, .print-table td { border: 1px solid black; padding: 4px 8px; text-align: left; }

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а .print-table th { background-color: #f5f5f4 !important; }

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а .text-center { text-align: center; }

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </style>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="print-container">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="text-center mb-4">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h2 class="text-xl font-bold">р╕кр╕лр╕Бр╕гр╕Ур╣Мр╕Бр╕нр╕Зр╕Чр╕╕р╕Щр╕кр╕зр╕Щр╕вр╕▓р╕Зр╕Юр╕▓р╕гр╕▓р╣Ар╕Бр╕йр╕Хр╕гр╕кр╕бр╕Ър╕╣р╕гр╕Ур╣М р╕Ир╕│р╕Бр╕▒р╕Ф</h2>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h3 class="text-lg">р╕гр╕▓р╕вр╕Зр╕▓р╕Щр╕Бр╕▓р╕гр╕Кр╕▒р╣Ир╕Зр╕вр╕▓р╕Зр╕Ыр╕гр╕░р╕Ир╕│р╕зр╕▒р╕Щр╕Чр╕╡р╣И ${today.toLocaleDateString('th-TH', { year: 'numeric', month: 'long', day: 'numeric' })} (р╕Хр╕▓р╕Кр╕▒р╣Ир╕Зр╕Чр╕╡р╣И ${scaleId})</h3>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <table class="print-table">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <thead class="bg-stone-200">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <tr class="border-b border-black">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th class="text-center" style="width: 10%;">р╕ер╕│р╕Фр╕▒р╕Ър╕Чр╕╡р╣И</th>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th style="width: 40%;">р╕Кр╕╖р╣Ир╕н</th>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th class="text-center" style="width: 20%;">р╕Ир╕│р╕Щр╕зр╕Щр╕Цр╕╕р╕З</th>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th class="text-center" style="width: 30%;">р╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Бр╕Чр╕╡р╣Ир╕Кр╕▒р╣Ир╕З</th>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </tr>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </thead>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <tbody>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ${tableRows}

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </tbody>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </table>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а `;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.printArea.innerHTML = reportHTML;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а window.print(); // Trigger browser print dialog

┬а ┬а ┬а ┬а ┬а ┬а });

┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а /**

┬а ┬а ┬а ┬а ┬а* Calculates and updates the overall summary weight in the weighing summary tab.

┬а ┬а ┬а ┬а ┬а*/

┬а ┬а ┬а ┬а function calculateSummaryTotalWeight() {

┬а ┬а ┬а ┬а ┬а ┬а const totalBags = parseFloat(ui.summaryTotalBags.textContent) || 0;

┬а ┬а ┬а ┬а ┬а ┬а const multiplier = parseFloat(ui.summaryMultiplierWeight.value) || 0;

┬а ┬а ┬а ┬а ┬а ┬а ui.summaryCalculatedWeight.textContent = (totalBags * multiplier).toFixed(2);

┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а /**

┬а ┬а ┬а ┬а ┬а* Updates the weighing summary tab with total bags from all scales for today.

┬а ┬а ┬а ┬а ┬а*/

┬а ┬а ┬а ┬а function updateWeighingSummary() {

┬а ┬а ┬а ┬а ┬а ┬а let totalBags = 0;

┬а ┬а ┬а ┬а ┬а ┬а for (const scaleId in dailyWeighingData) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const scaleDocs = dailyWeighingData[scaleId];

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а totalBags += scaleDocs.reduce((sum, doc) => sum + doc.bags, 0);

┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а ui.summaryTotalBags.textContent = totalBags;

┬а ┬а ┬а ┬а ┬а ┬а calculateSummaryTotalWeight(); // Recalculate combined weight

┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а /**

┬а ┬а ┬а ┬а ┬а* Deletes all weighing records for the current day from Firestore.

┬а ┬а ┬а ┬а ┬а*/

┬а ┬а ┬а ┬а async function deleteAllTodaysWeighings() {

┬а ┬а ┬а ┬а ┬а ┬а showConfirm(

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а 'р╕Др╕╕р╕Ур╣Бр╕Щр╣Ир╣Гр╕Ир╕лр╕гр╕╖р╕нр╣Др╕бр╣Ир╕зр╣Ир╕▓р╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕ер╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Бр╕▓р╕гр╕зр╕▓р╕Зр╕вр╕▓р╕Зр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Фр╕Вр╕нр╕Зр╕зр╕▒р╕Щр╕Щр╕╡р╣Й? р╕Бр╕▓р╕гр╕Бр╕гр╕░р╕Чр╕│р╕Щр╕╡р╣Йр╣Др╕бр╣Ир╕кр╕▓р╕бр╕▓р╕гр╕Цр╕вр╣Йр╕нр╕Щр╕Бр╕ер╕▒р╕Ър╣Др╕Фр╣Й',

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а async () => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const todayStart = new Date();

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а todayStart.setHours(0, 0, 0, 0); // Set to start of today



┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // Query for all weighing records created today

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const q = query(weighingsCollectionRef, where("timestamp", ">=", todayStart));



┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а try {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const querySnapshot = await getDocs(q);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (querySnapshot.empty) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showAlert('р╣Др╕бр╣Ир╕Юр╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Бр╕▓р╕гр╕зр╕▓р╕Зр╕вр╕▓р╕Зр╕Вр╕нр╕Зр╕зр╕▒р╕Щр╕Щр╕╡р╣Йр╣Гр╕лр╣Йр╕ер╕Ъ');

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // Use a batch write for efficient deletion

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const batch = writeBatch(db);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а querySnapshot.forEach(doc => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а batch.delete(doc.ref);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });



┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а await batch.commit(); // Commit the batch deletion



┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // Clear local data and update UI

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.summaryMultiplierWeight.value = '';

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а Object.keys(dailyWeighingData).forEach(key => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а dailyWeighingData[key] = [];

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }); // Clear daily weighing data

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а updateWeighingSummary(); // Update the summary UI



┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showAlert(`р╕ер╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Бр╕▓р╕гр╕зр╕▓р╕Зр╕вр╕▓р╕Зр╕Вр╕нр╕Зр╕зр╕▒р╕Щр╕Щр╕╡р╣Йр╕Ир╕│р╕Щр╕зр╕Щ ${querySnapshot.size} р╕гр╕▓р╕вр╕Бр╕▓р╕гр╣Ар╕гр╕╡р╕вр╕Ър╕гр╣Йр╕нр╕вр╣Бр╕ер╣Йр╕з`);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а } catch (error) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а console.error("Error deleting all weighings: ", error);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showAlert(`р╣Ар╕Бр╕┤р╕Фр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╣Гр╕Щр╕Бр╕▓р╕гр╕ер╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕е: ${error.message}`);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а );

┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а /**

┬а ┬а ┬а ┬а ┬а* Sets up real-time listeners for each weighing station.

┬а ┬а ┬а ┬а ┬а*/

┬а ┬а ┬а ┬а function setupWeighingListeners() {

┬а ┬а ┬а ┬а ┬а ┬а if (!weighingsCollectionRef) return;

┬а ┬а ┬а ┬а ┬а ┬а for (let i = 1; i <= 4; i++) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const q = query(weighingsCollectionRef, where("scaleId", "==", i));



┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // Unsubscribe from previous listener if exists

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (unsubscribeWeighings[i]) unsubscribeWeighings[i]();



┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а unsubscribeWeighings[i] = onSnapshot(q, (snapshot) => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const todayStart = new Date();

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а todayStart.setHours(0, 0, 0, 0); // Set to start of today



┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const tableBody = document.getElementById(`weighing-table-body-${i}`);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (!tableBody) return; // Ensure element exists

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а tableBody.innerHTML = ''; // Clear table body

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а let totalBags = 0;



┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const docs = snapshot.docs.map(doc => ({

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а id: doc.id,

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ...doc.data()

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }));



┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // Filter for today's data and sort by timestamp

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const todaysDocs = docs.filter(data => data.timestamp.toDate() >= todayStart);



┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а dailyWeighingData[i] = todaysDocs; // Update global store for daily weighing data

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а updateWeighingSummary(); // Update the combined summary tab



┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (todaysDocs.length === 0) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а tableBody.innerHTML = '<tr><td colspan="4" class="text-center p-4 text-stone-400">р╕вр╕▒р╕Зр╣Др╕бр╣Ир╕бр╕╡р╕гр╕▓р╕вр╕Бр╕▓р╕г</td></tr>';

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а } else {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // Sort by timestamp descending (most recent first in the log)

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а todaysDocs.sort((a, b) => b.timestamp.toDate() - a.timestamp.toDate()).forEach(data => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а totalBags += data.bags;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const row = document.createElement('tr');

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а row.className = 'border-b';

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а row.innerHTML = `

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-4 py-2">${data.timestamp.toDate().toLocaleTimeString('th-TH')}</td>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-4 py-2">${data.sellerName}</td>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-4 py-2 text-right">${data.bags}</td>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-4 py-2 text-center space-x-2">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button class="edit-weighing-btn text-blue-600 hover:text-blue-800 p-1" data-id="${data.id}" data-scale="${i}" title="р╣Бр╕Бр╣Йр╣Др╕В">тЬПя╕П</button>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button class="delete-weighing-btn text-red-600 hover:text-red-800 p-1" data-id="${data.id}" title="р╕ер╕Ъ">ЁЯЧСя╕П</button>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </td>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а `;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а tableBody.appendChild(row);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // Update total bags display for the specific scale

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const totalBagsEl = document.getElementById(`total-bags-${i}`);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (totalBagsEl) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а totalBagsEl.textContent = totalBags;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а calculateTotalWeight(i); // Recalculate based on current bags and multiplier

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });

┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а /**

┬а ┬а ┬а ┬а ┬а* Fetches today's weighing records for a given seller and populates the receipt form.

┬а ┬а ┬а ┬а ┬а* Also prompts the user to clear these weighing records if found.

┬а ┬а ┬а ┬а ┬а* @param {string} sellerName - The name of the seller to search for.

┬а ┬а ┬а ┬а ┬а*/

┬а ┬а ┬а ┬а async function fetchAndPopulateWeights(sellerName) {

┬а ┬а ┬а ┬а ┬а ┬а if (!weighingsCollectionRef) return;

┬а ┬а ┬а ┬а ┬а ┬а const q = query(weighingsCollectionRef, where("sellerName", "==", sellerName));

┬а ┬а ┬а ┬а ┬а ┬а const querySnapshot = await getDocs(q);



┬а ┬а ┬а ┬а ┬а ┬а const todayStart = new Date();

┬а ┬а ┬а ┬а ┬а ┬а todayStart.setHours(0, 0, 0, 0);



┬а ┬а ┬а ┬а ┬а ┬а // Filter for only today's weighing records for the seller

┬а ┬а ┬а ┬а ┬а ┬а const todaysDocs = querySnapshot.docs.filter(doc => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const ts = doc.data().timestamp;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (!ts) return false;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return ts.toDate() >= todayStart;

┬а ┬а ┬а ┬а ┬а ┬а });



┬а ┬а ┬а ┬а ┬а ┬а if (todaysDocs.length === 0) return; // No records found for today



┬а ┬а ┬а ┬а ┬а ┬а const weights = todaysDocs.map(doc => doc.data().bags);

┬а ┬а ┬а ┬а ┬а ┬а const weightInputs = document.querySelectorAll('#weight-inputs-container .weight-input');



┬а ┬а ┬а ┬а ┬а ┬а // Populate weight inputs in the receipt form

┬а ┬а ┬а ┬а ┬а ┬а weights.forEach((weight, index) => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (index < weightInputs.length) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а weightInputs[index].value = weight;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а });

┬а ┬а ┬а ┬а ┬а ┬а calculateTotals(); // Recalculate totals in the receipt form



┬а ┬а ┬а ┬а ┬а ┬а // Prompt to clear the weighing data after importing to receipt

┬а ┬а ┬а ┬а ┬а ┬а showConfirm(`р╕Юр╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╕зр╕▓р╕Зр╕вр╕▓р╕З ${weights.length} р╕гр╕▓р╕вр╕Бр╕▓р╕гр╕Вр╕нр╕З ${sellerName} р╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕ер╣Йр╕▓р╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Щр╕╡р╣Йр╕лр╕гр╕╖р╕нр╣Др╕бр╣И?`, async () => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а todaysDocs.forEach(async (d) => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а await deleteDoc(doc(weighingsCollectionRef, d.id));

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });

┬а ┬а ┬а ┬а ┬а ┬а });

┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а /**

┬а ┬а ┬а ┬а ┬а* Initializes the Firebase application and sets up authentication and data listeners.

┬а ┬а ┬а ┬а ┬а*/

┬а ┬а ┬а ┬а async function initApp() {

┬а ┬а ┬а ┬а ┬а ┬а if (Object.keys(firebaseConfig).length === 0 || !firebaseConfig.apiKey) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showAlert('р╕Бр╕▓р╕гр╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓ Firebase р╣Др╕бр╣Ир╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З р╣Др╕бр╣Ир╕кр╕▓р╕бр╕▓р╕гр╕Цр╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕нр╕Рр╕▓р╕Щр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Др╕Фр╣Й');

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а console.error('Firebase config is missing.');

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return;

┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а try {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const app = initializeApp(firebaseConfig);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const analytics = getAnalytics(app); // Initialize analytics (optional)

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а auth = getAuth(app);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а db = getFirestore(app);



┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // Listen for authentication state changes

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а onAuthStateChanged(auth, async (user) => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (user) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а userId = user.uid; // Set user ID

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // Define Firestore collection references

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а salesCollectionRef = collection(db, "artifacts", appId, "public", "data", "sales");

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а weighingsCollectionRef = collection(db, "artifacts", appId, "public", "data", "weighings");



┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // Set up real-time listener for sales data

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (unsubscribeSales) unsubscribeSales(); // Unsubscribe previous listener

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const salesQuery = query(salesCollectionRef);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а unsubscribeSales = onSnapshot(salesQuery, (snapshot) => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // Map Firestore documents to local sales data objects

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а localSalesData = snapshot.docs.map(doc => ({

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а id: doc.id,

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ...doc.data()

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }));

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // Sort sales data by timestamp ascending (oldest first)

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а localSalesData.sort((a, b) => a.timestamp.toDate() - b.timestamp.toDate());

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а renderTable(localSalesData); // Render sales table

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а renderDashboard(); // Update dashboard charts

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а renderSummary(); // Update general summary

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а renderDailySummary(); // Update daily summary on dashboard

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а renderScaleSummaries(); // NEW: Update scale summaries

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }, (error) => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а console.error("Error fetching data with onSnapshot: ", error);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showAlert(`р╣Ар╕Бр╕┤р╕Фр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╣Гр╕Щр╕Бр╕▓р╕гр╕Фр╕╢р╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕е: ${error.message}`);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а setupWeighingListeners(); // Setup listeners for weighing stations

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а } else {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // Attempt to sign in anonymously or with custom token if available

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а try {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а await signInWithCustomToken(auth, __initial_auth_token);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а } else {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а await signInAnonymously(auth);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а } catch (error) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а console.error('Sign-in failed:', error);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showAlert(`р╕Бр╕▓р╕гр╕вр╕╖р╕Щр╕вр╕▒р╕Щр╕Хр╕▒р╕зр╕Хр╕Щр╕ер╣Йр╕бр╣Ар╕лр╕ер╕з: ${error.message}`);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });



┬а ┬а ┬а ┬а ┬а ┬а } catch (error) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а console.error("Firebase initialization error: ", error);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showAlert(`р╣Ар╕Бр╕┤р╕Фр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╣Гр╕Щр╕Бр╕▓р╕гр╣Ар╕гр╕┤р╣Ир╕бр╕Хр╣Йр╕Щр╕гр╕░р╕Ър╕Ъ: ${error.message}`);

┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а /**

┬а ┬а ┬а ┬а ┬а* Handles click events on the weighing station tables (edit, delete buttons).

┬а ┬а ┬а ┬а ┬а* @param {Event} e - The click event object.

┬а ┬а ┬а ┬а ┬а*/

┬а ┬а ┬а ┬а async function handleWeighingTableClick(e) {

┬а ┬а ┬а ┬а ┬а ┬а const target = e.target.closest('button');

┬а ┬а ┬а ┬а ┬а ┬а if (!target) return;



┬а ┬а ┬а ┬а ┬а ┬а const id = target.dataset.id;

┬а ┬а ┬а ┬а ┬а ┬а const scaleId = target.dataset.scale; // Get scaleId from button data attribute



┬а ┬а ┬а ┬а ┬а ┬а if (target.classList.contains('delete-weighing-btn')) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showConfirm('р╕Др╕╕р╕Ур╣Бр╕Щр╣Ир╣Гр╕Ир╕зр╣Ир╕▓р╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕ер╕Ър╕гр╕▓р╕вр╕Бр╕▓р╕гр╕зр╕▓р╕Зр╕вр╕▓р╕Зр╕Щр╕╡р╣Й?', async () => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const docRef = doc(weighingsCollectionRef, id)

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а await deleteDoc(docRef);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showAlert('р╕ер╕Ър╕гр╕▓р╕вр╕Бр╕▓р╕гр╕кр╕│р╣Ар╕гр╣Зр╕И');

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });

┬а ┬а ┬а ┬а ┬а ┬а } else if (target.classList.contains('edit-weighing-btn')) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const docRef = doc(weighingsCollectionRef, id);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const docSnap = await getDoc(docRef);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (docSnap.exists()) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const data = docSnap.data();

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // Populate weighing form for editing

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById(`weighing-seller-${scaleId}`).value = data.sellerName;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById(`weighing-weight-${scaleId}`).value = data.bags;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а editingWeighingId = id; // Set editing ID

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а /**

┬а ┬а ┬а ┬а ┬а* Renders the summary of sales grouped by scale number for today.

┬а ┬а ┬а ┬а ┬а*/

┬а ┬а ┬а ┬а function renderScaleSummaries() {

┬а ┬а ┬а ┬а ┬а ┬а const today = new Date();

┬а ┬а ┬а ┬а ┬а ┬а today.setHours(0, 0, 0, 0); // Start of today



┬а ┬а ┬а ┬а ┬а ┬а // Group sales by scale number for today

┬а ┬а ┬а ┬а ┬а ┬а const salesByScaleToday = localSalesData.reduce((acc, sale) => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const saleDate = sale.date instanceof Date ? sale.date : sale.date.toDate();

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (saleDate >= today) { // Only include sales from today

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const scale = sale.scaleNumber || 'р╣Др╕бр╣Ир╕гр╕░р╕Ър╕╕';

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (!acc[scale]) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а acc[scale] = {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а totalWeight: 0,

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а totalAmount: 0,

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а count: 0

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а };

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а acc[scale].totalWeight += sale.weight;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а acc[scale].totalAmount += sale.total;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а acc[scale].count++;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return acc;

┬а ┬а ┬а ┬а ┬а ┬а }, {});



┬а ┬а ┬а ┬а ┬а ┬а ui.salesSummaryByScale.innerHTML = ''; // Clear previous summaries



┬а ┬а ┬а ┬а ┬а ┬а if (Object.keys(salesByScaleToday).length === 0) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.salesSummaryByScale.innerHTML = '<div class="col-span-full text-center text-stone-500">р╣Др╕бр╣Ир╕бр╕╡р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Бр╕▓р╕гр╕Вр╕▓р╕вр╕кр╕│р╕лр╕гр╕▒р╕Ър╕зр╕▒р╕Щр╕Щр╕╡р╣Й</div>';

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return;

┬а ┬а ┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а ┬а ┬а // Render each scale summary

┬а ┬а ┬а ┬а ┬а ┬а for (const scale in salesByScaleToday) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const summary = salesByScaleToday[scale];

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const summaryHtml = `

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="bg-amber-100 p-3 rounded-lg text-center">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p class="text-sm font-medium text-amber-800">р╕Хр╕▓р╕Кр╕▒р╣Ир╕Зр╕Чр╕╡р╣И ${scale}</p>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p class="text-lg font-bold text-amber-700">${summary.totalWeight.toFixed(2)} р╕Бр╕Б.</p>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p class="text-sm text-amber-600">${summary.totalAmount.toLocaleString('th-TH', {minimumFractionDigits: 2, maximumFractionDigits: 2})} р╕Ър╕▓р╕Ч</p>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а `;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.salesSummaryByScale.insertAdjacentHTML('beforeend', summaryHtml);

┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а }





┬а ┬а ┬а ┬а // Event listeners attached once the DOM is fully loaded

┬а ┬а ┬а ┬а document.addEventListener('DOMContentLoaded', () => {

┬а ┬а ┬а ┬а ┬а ┬а renderWeighingStations(); // Initialize weighing station HTML and basic listeners



┬а ┬а ┬а ┬а ┬а ┬а // Tab switching logic

┬а ┬а ┬а ┬а ┬а ┬а ui.tabs.addEventListener('click', (e) => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (e.target.dataset.tab) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const targetTab = e.target.dataset.tab;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.tabs.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.tabContents.forEach(content => content.classList.remove('active'));

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а e.target.classList.add('active');

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById(targetTab).classList.add('active');

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а });



┬а ┬а ┬а ┬а ┬а ┬а // Set default active tab to 'receipt'

┬а ┬а ┬а ┬а ┬а ┬а document.querySelector('[data-tab="tab-receipt"]').classList.add('active');

┬а ┬а ┬а ┬а ┬а ┬а document.getElementById('tab-receipt').classList.add('active');



┬а ┬а ┬а ┬а ┬а ┬а // Fetch and populate weights when seller name input loses focus

┬а ┬а ┬а ┬а ┬а ┬а ui.sellerNameInput.addEventListener('blur', (e) => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const sellerName = e.target.value.trim();

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (sellerName) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а fetchAndPopulateWeights(sellerName);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а });



┬а ┬а ┬а ┬а ┬а ┬а // Button event listeners for receipt section

┬а ┬а ┬а ┬а ┬а ┬а ui.saveButton.addEventListener('click', handleSave);

┬а ┬а ┬а ┬а ┬а ┬а ui.cancelEditButton.addEventListener('click', clearForm);



┬а ┬а ┬а ┬а ┬а ┬а // Event listener for sales table actions (delete, edit, reprint)

┬а ┬а ┬а ┬а ┬а ┬а ui.salesTableBody.addEventListener('click', handleTableClick);



┬а ┬а ┬а ┬а ┬а ┬а // Event listener for printing daily report

┬а ┬а ┬а ┬а ┬а ┬а ui.printReportBtn.addEventListener('click', createDailySummaryReport);



┬а ┬а ┬а ┬а ┬а ┬а // Event listener for printing dashboard

┬а ┬а ┬а ┬а ┬а ┬а if (ui.printDashboardBtn) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.printDashboardBtn.addEventListener('click', () => window.print());

┬а ┬а ┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а ┬а ┬а // Update date display on date input change

┬а ┬а ┬а ┬а ┬а ┬а ui.receiptDateInput.addEventListener('input', updateDateDisplay);



┬а ┬а ┬а ┬а ┬а ┬а // Event listeners for recalculating totals on weight/price input change

┬а ┬а ┬а ┬а ┬а ┬а const calculationInputs = [...document.querySelectorAll('.weight-input'), ui.pricePerKgInput];

┬а ┬а ┬а ┬а ┬а ┬а calculationInputs.forEach(input => input.addEventListener('input', calculateTotals));



┬а ┬а ┬а ┬а ┬а ┬а // Search functionality for the sales table

┬а ┬а ┬а ┬а ┬а ┬а ui.searchBox.addEventListener('input', (e) => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const searchTerm = e.target.value.toLowerCase();

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const filteredData = localSalesData.filter(sale =>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а sale.seller.toLowerCase().includes(searchTerm) ||

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а sale.date.toDate().toLocaleDateString('th-TH').includes(searchTerm)

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а );

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а renderTable(filteredData);

┬а ┬а ┬а ┬а ┬а ┬а });



┬а ┬а ┬а ┬а ┬а ┬а // NEW Event Listeners for Summary Tab

┬а ┬а ┬а ┬а ┬а ┬а ui.summaryMultiplierWeight.addEventListener('input', calculateSummaryTotalWeight);

┬а ┬а ┬а ┬а ┬а ┬а ui.deleteAllWeighingsBtn.addEventListener('click', deleteAllTodaysWeighings);





┬а ┬а ┬а ┬а ┬а ┬а // Set initial date values to today

┬а ┬а ┬а ┬а ┬а ┬а ui.receiptDateInput.valueAsDate = new Date();

┬а ┬а ┬а ┬а ┬а ┬а ui.reportDateInput.valueAsDate = new Date();

┬а ┬а ┬а ┬а ┬а ┬а updateDateDisplay(); // Update display for current date



┬а ┬а ┬а ┬а ┬а ┬а initApp(); // Initialize Firebase and app data

┬а ┬а ┬а ┬а });

┬а ┬а </script>

</body>



</html>

```
