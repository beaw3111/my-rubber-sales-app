
р╕Бр╕▓р╕гр╕кр╕Щр╕Чр╕Щр╕▓р╕Бр╕▒р╕Ъ Gemini
<!DOCTYPE html>

<html lang="th">

<head>

┬а ┬а <meta charset="UTF-8">

┬а ┬а <meta name="viewport" content="width=device-width, initial-scale=1.0">

┬а ┬а <title>р╕гр╕░р╕Ър╕Ър╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Бр╕▓р╕гр╕Вр╕▓р╕вр╕вр╕▓р╕Зр╕Бр╣Йр╕нр╕Щр╕Цр╣Йр╕зр╕в</title>

┬а ┬а <!-- Chosen Palette: Warm Harmony (Stone, Amber, White) -->

┬а ┬а <!-- Application Structure Plan: A tab-based navigation system is implemented to separate distinct user tasks, improving clarity and workflow. The tabs include: a primary receipt creation form, four dedicated weighing station logs, a comprehensive history/reporting view, and an analytics dashboard. This modular structure allows users to focus on a single task at a time (e.g., logging weights at a specific scale) before consolidating data for the final receipt, which streamlines the real-world process. -->

┬а ┬а <!-- Visualization & Content Choices: - Weighing Logs (New) -> Goal: Organize/Inform -> Method: HTML Form + Dynamic Table per scale -> Interaction: Users select a scale, log weights for sellers, and this data is temporarily stored in Firestore. The table updates in real-time. Justification: To decouple initial weighing from final payment, mirroring a likely real-world workflow and reducing errors by allowing pre-consolidation data entry. - Receipt Form Integration -> Goal: Streamline -> Method: JS function -> Interaction: On the main receipt form, entering a seller's name queries the temporary weighing logs and auto-populates weight fields. Justification: This connects the two separate tasks, reducing manual re-entry and increasing efficiency. Other visualizations remain the same but are now organized into their respective tabs. -->

┬а ┬а <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->

┬а ┬а <script src="https://cdn.tailwindcss.com"></script>

┬а ┬а <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

┬а ┬а <link rel="preconnect" href="https://fonts.googleapis.com">

┬а ┬а <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

┬а ┬а <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;700&display=swap" rel="stylesheet">

┬а ┬а <style>

┬а ┬а ┬а ┬а body { font-family: 'Sarabun', sans-serif; }

┬а ┬а ┬а ┬а .chart-container { position: relative; height: 300px; width: 100%; max-width: 500px; margin: auto; }

┬а ┬а ┬а ┬а .tab-btn.active { border-color: #d97706; background-color: #fef3c7; color: #b45309; }

┬а ┬а ┬а ┬а .tab-content { display: none; }

┬а ┬а ┬а ┬а .tab-content.active { display: block; }

┬а ┬а ┬а ┬а @media print {

┬а ┬а ┬а ┬а ┬а ┬а body * { visibility: hidden; }

┬а ┬а ┬а ┬а ┬а ┬а #print-area, #print-area * { visibility: visible; }

┬а ┬а ┬а ┬а ┬а ┬а #print-area { position: absolute; left: 0; top: 0; width: 100%; height: 100%; }

┬а ┬а ┬а ┬а ┬а ┬а .no-print { display: none !important; }

┬а ┬а ┬а ┬а }

┬а ┬а </style>

</head>

<body class="bg-stone-100 text-stone-800">



┬а ┬а <div id="app" class="container mx-auto p-4 sm:p-6 lg:p-8">

┬а ┬а ┬а ┬а┬а

┬а ┬а ┬а ┬а <header class="mb-8">

┬а ┬а ┬а ┬а ┬а ┬а <h1 class="text-4xl font-bold text-stone-900">р╕гр╕░р╕Ър╕Ър╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕Вр╕▓р╕вр╕вр╕▓р╕Зр╕Бр╣Йр╕нр╕Щр╕Цр╣Йр╕зр╕в</h1>

┬а ┬а ┬а ┬а ┬а ┬а <p class="text-stone-600 mt-1">р╕нр╕нр╕Бр╣Гр╕Ър╣Ар╕кр╕гр╣Зр╕И р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕е р╣Бр╕ер╕░р╕Фр╕╣р╕кр╕гр╕╕р╕Ыр╕вр╕нр╕Фр╕Вр╕▓р╕вр╣Гр╕Щр╕Чр╕╡р╣Ир╣Ар╕Фр╕╡р╕вр╕з</p>

┬а ┬а ┬а ┬а </header>



┬а ┬а ┬а ┬а <!-- Tab Navigation -->

┬а ┬а ┬а ┬а <div class="mb-6 border-b border-stone-300">

┬а ┬а ┬а ┬а ┬а ┬а <nav id="tabs" class="flex flex-wrap -mb-px">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button data-tab="tab-receipt" class="tab-btn inline-block p-4 border-b-2 border-transparent rounded-t-lg hover:text-amber-600 hover:border-amber-300">1. р╕нр╕нр╕Бр╣Гр╕Ър╣Ар╕кр╕гр╣Зр╕И</button>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button data-tab="tab-history" class="tab-btn inline-block p-4 border-b-2 border-transparent rounded-t-lg hover:text-amber-600 hover:border-amber-300">2. р╕Ыр╕гр╕░р╕зр╕▒р╕Хр╕┤р╣Бр╕ер╕░р╕гр╕▓р╕вр╕Зр╕▓р╕Щ</button>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button data-tab="tab-dashboard" class="tab-btn inline-block p-4 border-b-2 border-transparent rounded-t-lg hover:text-amber-600 hover:border-amber-300">3. р╕кр╕гр╕╕р╕Ыр╕ар╕▓р╕Юр╕гр╕зр╕б</button>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button data-tab="tab-weighing-1" class="tab-btn inline-block p-4 border-b-2 border-transparent rounded-t-lg hover:text-amber-600 hover:border-amber-300">4. р╕гр╕▒р╕Ър╕зр╕▓р╕Зр╕вр╕▓р╕З (р╕Хр╕▓р╕Кр╕▒р╣Ир╕З 1)</button>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button data-tab="tab-weighing-2" class="tab-btn inline-block p-4 border-b-2 border-transparent rounded-t-lg hover:text-amber-600 hover:border-amber-300">5. р╕гр╕▒р╕Ър╕зр╕▓р╕Зр╕вр╕▓р╕З (р╕Хр╕▓р╕Кр╕▒р╣Ир╕З 2)</button>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button data-tab="tab-weighing-3" class="tab-btn inline-block p-4 border-b-2 border-transparent rounded-t-lg hover:text-amber-600 hover:border-amber-300">6. р╕гр╕▒р╕Ър╕зр╕▓р╕Зр╕вр╕▓р╕З (р╕Хр╕▓р╕Кр╕▒р╣Ир╕З 3)</button>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button data-tab="tab-weighing-4" class="tab-btn inline-block p-4 border-b-2 border-transparent rounded-t-lg hover:text-amber-600 hover:border-amber-300">7. р╕гр╕▒р╕Ър╕зр╕▓р╕Зр╕вр╕▓р╕З (р╕Хр╕▓р╕Кр╕▒р╣Ир╕З 4)</button>

┬а ┬а ┬а ┬а ┬а ┬а </nav>

┬а ┬а ┬а ┬а </div>



┬а ┬а ┬а ┬а <main>

┬а ┬а ┬а ┬а ┬а ┬а <!-- Tab 1: Receipt Generator -->

┬а ┬а ┬а ┬а ┬а ┬а <div id="tab-receipt" class="tab-content">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <section id="receipt-generator" class="bg-white p-6 rounded-xl shadow-md">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h2 class="text-2xl font-bold mb-2 border-b pb-3 text-stone-800">1. р╕Бр╕гр╕нр╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Ар╕Юр╕╖р╣Ир╕нр╕нр╕нр╕Бр╣Гр╕Ър╣Ар╕кр╕гр╣Зр╕И</h2>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p class="text-sm text-stone-500 mt-2 mb-4">р╕кр╣Ир╕зр╕Щр╕Щр╕╡р╣Йр╕Др╕╖р╕нр╕ир╕╣р╕Щр╕вр╣Мр╕Бр╕ер╕▓р╕Зр╕Бр╕▓р╕гр╕Чр╕│р╕Зр╕▓р╕Щ р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Бр╕▓р╕гр╕Вр╕▓р╕в р╕гр╕░р╕Ър╕Ър╕Ир╕░р╕Др╕│р╕Щр╕зр╕Ур╕вр╕нр╕Фр╕гр╕зр╕бр╣Гр╕лр╣Йр╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤ р╣Бр╕ер╕░р╣Ар╕бр╕╖р╣Ир╕нр╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Бр╕ер╣Йр╕зр╕Ир╕░р╕кр╕гр╣Йр╕▓р╕Зр╣Гр╕Ър╣Ар╕кр╕гр╣Зр╕Ир╕кр╕│р╕лр╕гр╕▒р╕Ър╕Юр╕┤р╕бр╕Юр╣Мр╣Др╕Фр╣Йр╕Чр╕▒р╕Щр╕Чр╕╡</p>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="seller-name" class="block text-sm font-medium text-stone-600 mb-1">р╕Кр╕╖р╣Ир╕н-р╕кр╕Бр╕╕р╕е р╕Ьр╕╣р╣Йр╕Вр╕▓р╕в</label>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="text" id="seller-name" class="w-full p-2 border border-stone-300 rounded-md shadow-sm focus:ring-amber-500 focus:border-amber-500" placeholder="р╣Ар╕Кр╣Ир╕Щ р╕Щр╕▓р╕вр╕кр╕бр╕Кр╕▓р╕в р╣Гр╕Ир╕Фр╕╡">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="scale-number" class="block text-sm font-medium text-stone-600 mb-1">р╕Хр╕▓р╕Кр╕▒р╣Ир╕Зр╕Чр╕╡р╣И</label>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="number" id="scale-number" min="1" max="9" class="w-full p-2 border border-stone-300 rounded-md shadow-sm focus:ring-amber-500 focus:border-amber-500" placeholder="1-9">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="md:col-span-2">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="receipt-date" class="block text-sm font-medium text-stone-600 mb-1">р╕зр╕▒р╕Щр╕Чр╕╡р╣И <span id="date-display" class="font-normal text-stone-500 ml-2"></span></label>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="date" id="receipt-date" class="w-full p-2 border border-stone-300 rounded-md shadow-sm focus:ring-amber-500 focus:border-amber-500">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="md:col-span-2">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label class="block text-sm font-medium text-stone-600 mb-1">р╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Б (р╕Бр╕Б.) - р╣Гр╕кр╣Ир╣Др╕Фр╣Йр╕кр╕╣р╕Зр╕кр╕╕р╕Ф 5 р╕гр╕▓р╕вр╕Бр╕▓р╕г</label>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div id="weight-inputs-container" class="grid grid-cols-2 sm:grid-cols-5 gap-4">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="number" class="weight-input w-full p-2 border border-stone-300 rounded-md shadow-sm text-center" placeholder="р╕Др╕гр╕▒р╣Йр╕Зр╕Чр╕╡р╣И 1">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="number" class="weight-input w-full p-2 border border-stone-300 rounded-md shadow-sm text-center" placeholder="р╕Др╕гр╕▒р╣Йр╕Зр╕Чр╕╡р╣И 2">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="number" class="weight-input w-full p-2 border border-stone-300 rounded-md shadow-sm text-center" placeholder="р╕Др╕гр╕▒р╣Йр╕Зр╕Чр╕╡р╣И 3">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="number" class="weight-input w-full p-2 border border-stone-300 rounded-md shadow-sm text-center" placeholder="р╕Др╕гр╕▒р╣Йр╕Зр╕Чр╕╡р╣И 4">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="number" class="weight-input w-full p-2 border border-stone-300 rounded-md shadow-sm text-center" placeholder="р╕Др╕гр╕▒р╣Йр╕Зр╕Чр╕╡р╣И 5">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="md:col-span-2">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="price-per-kg" class="block text-sm font-medium text-stone-600 mb-1">р╕гр╕▓р╕Др╕▓р╕Хр╣Ир╕нр╕лр╕Щр╣Ир╕зр╕в (р╕Ър╕▓р╕Ч/р╕Бр╕Б.)</label>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="number" id="price-per-kg" class="w-full p-2 border border-stone-300 rounded-md shadow-sm focus:ring-amber-500 focus:border-amber-500" placeholder="0.00">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="md:col-span-2 bg-stone-200 p-4 rounded-lg space-y-3">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="flex justify-between items-center">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span class="font-medium text-stone-600">р╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Бр╕гр╕зр╕б (р╕Бр╕Б.):</span>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span id="total-weight" class="text-xl font-bold text-stone-800">0.00</span>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="flex justify-between items-center">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span class="font-medium text-stone-600">р╕гр╕зр╕бр╣Ар╕Ыр╣Зр╕Щр╣Ар╕Зр╕┤р╕Щр╕Чр╕▒р╣Йр╕Зр╕кр╕┤р╣Йр╕Щ (р╕Ър╕▓р╕Ч):</span>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span id="total-amount" class="text-2xl font-bold text-amber-600">0.00</span>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="flex justify-between items-center text-right">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span class="font-medium text-stone-600">(р╕Хр╕▒р╕зр╕нр╕▒р╕Бр╕йр╕г):</span>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span id="total-amount-text" class="text-sm text-stone-500">-</span>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="mt-6 flex justify-end items-center gap-4">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button id="cancel-edit-button" class="hidden bg-stone-200 text-stone-700 font-bold py-2 px-6 rounded-lg hover:bg-stone-300 transition-colors">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а р╕вр╕Бр╣Ар╕ер╕┤р╕Б

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </button>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button id="save-button" class="bg-amber-600 text-white font-bold py-2 px-6 rounded-lg shadow-md hover:bg-amber-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-500 transition-colors">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╣Бр╕ер╕░р╕Юр╕┤р╕бр╕Юр╣Мр╣Гр╕Ър╣Ар╕кр╕гр╣Зр╕И

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </button>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </section>

┬а ┬а ┬а ┬а ┬а ┬а </div>



┬а ┬а ┬а ┬а ┬а ┬а <!-- Tab 2: History and Reports -->

┬а ┬а ┬а ┬а ┬а ┬а <div id="tab-history" class="tab-content">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а<section id="sales-data" class="bg-white p-6 rounded-xl shadow-md">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="flex flex-col sm:flex-row justify-between sm:items-center mb-2 border-b pb-3">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h2 class="text-2xl font-bold text-stone-800">2. р╕Ыр╕гр╕░р╕зр╕▒р╕Хр╕┤р╣Бр╕ер╕░р╕гр╕▓р╕вр╕Зр╕▓р╕Щ</h2>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="text" id="search-box" class="mt-3 sm:mt-0 w-full sm:w-64 p-2 border border-stone-300 rounded-md shadow-sm" placeholder="ЁЯФН р╕Др╣Йр╕Щр╕лр╕▓р╕Хр╕▓р╕бр╕Кр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╕Вр╕▓р╕в...">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а<p class="text-sm text-stone-500 mt-2 mb-4">р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Бр╕▓р╕гр╕Вр╕▓р╕вр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Фр╕Чр╕╡р╣Ир╣Ар╕Др╕вр╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╣Др╕зр╣Йр╕Ир╕░р╣Бр╕кр╕Фр╕Зр╣Гр╕Щр╕Хр╕▓р╕гр╕▓р╕Зр╕Щр╕╡р╣Й р╕Др╕╕р╕Ур╕кр╕▓р╕бр╕▓р╕гр╕Цр╕Др╣Йр╕Щр╕лр╕▓р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Хр╕▓р╕бр╕Кр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╕Вр╕▓р╕в р╣Бр╕Бр╣Йр╣Др╕Вр╕гр╕▓р╕вр╕Бр╕▓р╕гр╕Чр╕╡р╣Ир╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Ф р╕лр╕гр╕╖р╕нр╕ер╕Ър╕гр╕▓р╕вр╕Бр╕▓р╕гр╕Чр╕╡р╣Ир╣Др╕бр╣Ир╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╣Др╕Фр╣Й</p>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="bg-stone-200 p-4 rounded-lg text-center">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p class="text-sm font-medium text-stone-600">р╕Ир╕│р╕Щр╕зр╕Щр╕Ьр╕╣р╣Йр╕Вр╕▓р╕вр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф</p>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p id="summary-total-sellers" class="text-2xl font-bold text-amber-600">0</p>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="bg-stone-200 p-4 rounded-lg text-center">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p class="text-sm font-medium text-stone-600">р╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Бр╕гр╕зр╕бр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф (р╕Бр╕Б.)</p>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p id="summary-total-weight" class="text-2xl font-bold text-amber-600">0.00</p>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="bg-stone-200 p-4 rounded-lg text-center">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p class="text-sm font-medium text-stone-600">р╕вр╕нр╕Фр╕Вр╕▓р╕вр╕гр╕зр╕бр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф (р╕Ър╕▓р╕Ч)</p>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p id="summary-total-price" class="text-2xl font-bold text-amber-600">0.00</p>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>



┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="border-t pt-4 mt-6">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h3 class="text-lg font-semibold text-stone-700">р╕Юр╕┤р╕бр╕Юр╣Мр╕гр╕▓р╕вр╕Зр╕▓р╕Щр╕кр╕гр╕╕р╕Ыр╕Ыр╕гр╕░р╕Ир╕│р╕зр╕▒р╕Щ</h3>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="flex items-center gap-4 mt-2">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а<input type="date" id="report-date" class="p-2 border border-stone-300 rounded-md shadow-sm focus:ring-amber-500 focus:border-amber-500">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а<button id="print-report-btn" class="bg-sky-600 text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-sky-700 transition-colors">р╕Юр╕┤р╕бр╕Юр╣Мр╕гр╕▓р╕вр╕Зр╕▓р╕Щ</button>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>





┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="overflow-x-auto mt-6">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <table class="w-full text-sm text-left text-stone-500">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <thead class="text-xs text-stone-700 uppercase bg-stone-200">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <tr>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th scope="col" class="px-6 py-3">р╕зр╕▒р╕Щр╕Чр╕╡р╣И</th>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th scope="col" class="px-6 py-3">р╕Кр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╕Вр╕▓р╕в</th>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th scope="col" class="px-6 py-3 text-right">р╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Б (р╕Бр╕Б.)</th>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th scope="col" class="px-6 py-3 text-right">р╕гр╕▓р╕Др╕▓/р╕лр╕Щр╣Ир╕зр╕в</th>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th scope="col" class="px-6 py-3 text-right">р╕вр╕нр╕Фр╕гр╕зр╕б (р╕Ър╕▓р╕Ч)</th>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th scope="col" class="px-6 py-3 text-center">р╕Бр╕▓р╕гр╕Фр╕│р╣Ар╕Щр╕┤р╕Щр╕Бр╕▓р╕г</th>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </tr>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </thead>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <tbody id="sales-table-body">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <tr>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td colspan="6" class="px-6 py-8 text-center text-stone-400">р╕Бр╕│р╕ер╕▒р╕Зр╣Вр╕лр╕ер╕Фр╕Вр╣Йр╕нр╕бр╕╣р╕е...</td>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </tr>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </tbody>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </table>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </section>

┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а┬а

┬а ┬а ┬а ┬а ┬а ┬а <!-- Tab 3: Dashboard -->

┬а ┬а ┬а ┬а ┬а ┬а <div id="tab-dashboard" class="tab-content">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <section id="dashboard" class="bg-white p-6 rounded-xl shadow-md">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="flex justify-between items-center mb-2 border-b pb-3">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h2 class="text-2xl font-bold text-stone-800">3. р╕кр╕гр╕╕р╕Ыр╕ар╕▓р╕Юр╕гр╕зр╕б</h2>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button id="print-dashboard-btn" class="bg-sky-600 text-white font-bold py-1 px-3 rounded-lg shadow-md hover:bg-sky-700 no-print">ЁЯЦия╕П р╕Юр╕┤р╕бр╕Юр╣М</button>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p class="text-sm text-stone-500 mt-2 mb-4">р╣Бр╕Фр╕Кр╕Ър╕нр╕гр╣Мр╕Фр╕Щр╕╡р╣Йр╕Ир╕░р╕кр╕гр╕╕р╕Ыр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Бр╕▓р╕гр╕Вр╕▓р╕вр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Фр╣Гр╕Щр╕гр╕╣р╕Ыр╣Бр╕Ър╕Ър╕Бр╕гр╕▓р╕Я р╕Кр╣Ир╕зр╕вр╣Гр╕лр╣Йр╣Ар╕лр╣Зр╕Щр╕ар╕▓р╕Юр╕гр╕зр╕бр╣Бр╕ер╕░р╣Бр╕Щр╕зр╣Вр╕Щр╣Йр╕бр╕Хр╣Ир╕▓р╕Зр╣Ж р╣Др╕Фр╣Йр╕нр╕вр╣Ир╕▓р╕Зр╕гр╕зр╕Фр╣Ар╕гр╣Зр╕з р╣Вр╕Фр╕вр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Ир╕░р╕нр╕▒р╕Ыр╣Ар╕Фр╕Хр╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤р╕Чр╕╕р╕Бр╕Др╕гр╕▒р╣Йр╕Зр╕Чр╕╡р╣Ир╕бр╕╡р╕Бр╕▓р╕гр╕Ър╕▒р╕Щр╕Чр╕╢р╕Б</p>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="space-y-8">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="border-b pb-4 mb-4">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h3 class="font-bold text-center mb-2 text-stone-700">р╕кр╕гр╕╕р╕Ыр╕вр╕нр╕Фр╕Ыр╕гр╕░р╕Ир╕│р╕зр╕▒р╕Щ</h3>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="bg-amber-100 p-4 rounded-lg text-center">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p class="text-sm font-medium text-amber-800">р╕Ыр╕гр╕┤р╕бр╕▓р╕Ур╕гр╕зр╕бр╕зр╕▒р╕Щр╕Щр╕╡р╣Й (р╕Бр╕Б.)</p>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p id="summary-daily-weight" class="text-2xl font-bold text-amber-700">0.00</p>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h3 class="font-bold text-center mb-2 text-stone-700">р╕кр╕▒р╕Фр╕кр╣Ир╕зр╕Щр╕вр╕нр╕Фр╕Вр╕▓р╕вр╕Хр╕▓р╕бр╕Ьр╕╣р╣Йр╕Вр╕▓р╕в</h3>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="chart-container">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <canvas id="sales-by-seller-chart"></canvas>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h3 class="font-bold text-center mb-2 text-stone-700">р╣Бр╕Щр╕зр╣Вр╕Щр╣Йр╕бр╕вр╕нр╕Фр╕Вр╕▓р╕вр╕гр╕▓р╕вр╕зр╕▒р╕Щ</h3>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="chart-container">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <canvas id="daily-sales-chart"></canvas>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </section>

┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а┬а

┬а ┬а ┬а ┬а ┬а ┬а <!-- Tabs 4, 5, 6, 7: Weighing Stations -->

┬а ┬а ┬а ┬а ┬а ┬а <div id="tab-weighing-1" class="tab-content"></div>

┬а ┬а ┬а ┬а ┬а ┬а <div id="tab-weighing-2" class="tab-content"></div>

┬а ┬а ┬а ┬а ┬а ┬а <div id="tab-weighing-3" class="tab-content"></div>

┬а ┬а ┬а ┬а ┬а ┬а <div id="tab-weighing-4" class="tab-content"></div>



┬а ┬а ┬а ┬а </main>

┬а ┬а </div>



┬а ┬а <div id="print-area"></div>

┬а ┬а┬а

┬а ┬а <div id="modal" class="modal-backdrop fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden opacity-0" aria-labelledby="modal-title" role="dialog" aria-modal="true">

┬а ┬а ┬а ┬а <div class="modal-content bg-white rounded-xl shadow-2xl w-full max-w-md transform scale-95">

┬а ┬а ┬а ┬а ┬а ┬а <div class="p-6">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="text-center">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а<h3 id="modal-title" class="text-lg leading-6 font-bold text-stone-900"></h3>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="mt-2">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p id="modal-message" class="text-sm text-stone-500"></p>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а <div id="modal-actions" class="bg-stone-50 px-6 py-4 rounded-b-xl flex flex-row-reverse gap-3">

┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а </div>

┬а ┬а </div>





┬а ┬а <script type="module">

┬а ┬а ┬а ┬а import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";

┬а ┬а ┬а ┬а import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-analytics.js";

┬а ┬а ┬а ┬а import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

┬а ┬а ┬а ┬а import { getFirestore, collection, doc, addDoc, updateDoc, deleteDoc, onSnapshot, query, where, getDocs, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

┬а ┬а ┬а ┬а┬а

┬а ┬а ┬а ┬а const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {

┬а ┬а ┬а ┬а ┬а ┬а apiKey: "AIzaSyCNVxG6s46SRXOYAeT0rJHAtz_-3IPUJNE",

┬а ┬а ┬а ┬а ┬а ┬а authDomain: "coopksb001.firebaseapp.com",

┬а ┬а ┬а ┬а ┬а ┬а projectId: "coopksb001",

┬а ┬а ┬а ┬а ┬а ┬а storageBucket: "coopksb001.appspot.com",

┬а ┬а ┬а ┬а ┬а ┬а messagingSenderId: "259378610497",

┬а ┬а ┬а ┬а ┬а ┬а appId: "1:259378610497:web:fd12679830e97bf5e761c0",

┬а ┬а ┬а ┬а ┬а ┬а measurementId: "G-1RHH9TMD73"

┬а ┬а ┬а ┬а };

┬а ┬а ┬а ┬а┬а

┬а ┬а ┬а ┬а const appId = typeof __app_id !== 'undefined' ? __app_id : 'cup-rubber-sales-app';



┬а ┬а ┬а ┬а let localSalesData = [];

┬а ┬а ┬а ┬а let salesBySellerChart, dailySalesChart;

┬а ┬а ┬а ┬а let editingId = null;

┬а ┬а ┬а ┬а let editingWeighingId = null;

┬а ┬а ┬а ┬а let db, auth, userId, salesCollectionRef, weighingsCollectionRef;

┬а ┬а ┬а ┬а let unsubscribeSales = null;┬а

┬а ┬а ┬а ┬а let unsubscribeWeighings = {};



┬а ┬а ┬а ┬а const ui = {

┬а ┬а ┬а ┬а ┬а ┬а appContainer: document.getElementById('app'),

┬а ┬а ┬а ┬а ┬а ┬а tabs: document.getElementById('tabs'),

┬а ┬а ┬а ┬а ┬а ┬а tabContents: document.querySelectorAll('.tab-content'),

┬а ┬а ┬а ┬а ┬а ┬а sellerNameInput: document.getElementById('seller-name'),

┬а ┬а ┬а ┬а ┬а ┬а receiptDateInput: document.getElementById('receipt-date'),

┬а ┬а ┬а ┬а ┬а ┬а dateDisplay: document.getElementById('date-display'),

┬а ┬а ┬а ┬а ┬а ┬а scaleNumberInput: document.getElementById('scale-number'),

┬а ┬а ┬а ┬а ┬а ┬а weightInputsContainer: document.getElementById('weight-inputs-container'),

┬а ┬а ┬а ┬а ┬а ┬а pricePerKgInput: document.getElementById('price-per-kg'),

┬а ┬а ┬а ┬а ┬а ┬а totalWeightEl: document.getElementById('total-weight'),

┬а ┬а ┬а ┬а ┬а ┬а totalAmountEl: document.getElementById('total-amount'),

┬а ┬а ┬а ┬а ┬а ┬а totalAmountTextEl: document.getElementById('total-amount-text'),

┬а ┬а ┬а ┬а ┬а ┬а saveButton: document.getElementById('save-button'),

┬а ┬а ┬а ┬а ┬а ┬а cancelEditButton: document.getElementById('cancel-edit-button'),

┬а ┬а ┬а ┬а ┬а ┬а salesTableBody: document.getElementById('sales-table-body'),

┬а ┬а ┬а ┬а ┬а ┬а searchBox: document.getElementById('search-box'),

┬а ┬а ┬а ┬а ┬а ┬а printArea: document.getElementById('print-area'),

┬а ┬а ┬а ┬а ┬а ┬а reportDateInput: document.getElementById('report-date'),

┬а ┬а ┬а ┬а ┬а ┬а printReportBtn: document.getElementById('print-report-btn'),

┬а ┬а ┬а ┬а ┬а ┬а printDashboardBtn: document.getElementById('print-dashboard-btn'),

┬а ┬а ┬а ┬а ┬а ┬а dashboardSection: document.getElementById('dashboard'),

┬а ┬а ┬а ┬а ┬а ┬а modal: document.getElementById('modal'),

┬а ┬а ┬а ┬а ┬а ┬а modalTitle: document.getElementById('modal-title'),

┬а ┬а ┬а ┬а ┬а ┬а modalMessage: document.getElementById('modal-message'),

┬а ┬а ┬а ┬а ┬а ┬а modalActions: document.getElementById('modal-actions'),

┬а ┬а ┬а ┬а ┬а ┬а summaryTotalSellers: document.getElementById('summary-total-sellers'),

┬а ┬а ┬а ┬а ┬а ┬а summaryTotalWeight: document.getElementById('summary-total-weight'),

┬а ┬а ┬а ┬а ┬а ┬а summaryTotalPrice: document.getElementById('summary-total-price'),

┬а ┬а ┬а ┬а ┬а ┬а summaryDailyWeight: document.getElementById('summary-daily-weight'),

┬а ┬а ┬а ┬а };



┬а ┬а ┬а ┬а function showModal(title, message, buttons) {

┬а ┬а ┬а ┬а ┬а ┬а ui.modalTitle.textContent = title;

┬а ┬а ┬а ┬а ┬а ┬а ui.modalMessage.textContent = message;

┬а ┬а ┬а ┬а ┬а ┬а ui.modalActions.innerHTML = '';

┬а ┬а ┬а ┬а ┬а ┬а buttons.forEach(btn => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const buttonEl = document.createElement('button');

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а buttonEl.textContent = btn.text;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а buttonEl.className = btn.classes;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а buttonEl.onclick = () => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а hideModal();

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (btn.onClick) btn.onClick();

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а };

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.modalActions.appendChild(buttonEl);

┬а ┬а ┬а ┬а ┬а ┬а });

┬а ┬а ┬а ┬а ┬а ┬а ui.modal.classList.remove('hidden');

┬а ┬а ┬а ┬а ┬а ┬а setTimeout(() => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.modal.classList.remove('opacity-0');

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.modal.querySelector('.modal-content').classList.remove('scale-95');

┬а ┬а ┬а ┬а ┬а ┬а }, 10);

┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а function hideModal() {

┬а ┬а ┬а ┬а ┬а ┬а ui.modal.classList.add('opacity-0');

┬а ┬а ┬а ┬а ┬а ┬а ui.modal.querySelector('.modal-content').classList.add('scale-95');

┬а ┬а ┬а ┬а ┬а ┬а setTimeout(() => ui.modal.classList.add('hidden'), 300);

┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а┬а

┬а ┬а ┬а ┬а function showAlert(message) {

┬а ┬а ┬а ┬а ┬а ┬а ┬аshowModal('р╣Бр╕Ир╣Йр╕Зр╣Ар╕Хр╕╖р╕нр╕Щ', message, [

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а { text: 'р╕Хр╕Бр╕ер╕З', classes: 'w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-amber-600 text-base font-medium text-white hover:bg-amber-700 sm:w-auto sm:text-sm' }

┬а ┬а ┬а ┬а ┬а ┬а ┬а]);

┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а┬а

┬а ┬а ┬а ┬а function showConfirm(message, onConfirm) {

┬а ┬а ┬а ┬а ┬а ┬а showModal('р╕вр╕╖р╕Щр╕вр╕▒р╕Щр╕Бр╕▓р╕гр╕Фр╕│р╣Ар╕Щр╕┤р╕Щр╕Бр╕▓р╕г', message, [

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а { text: 'р╕вр╕╖р╕Щр╕вр╕▒р╕Щ', classes: 'w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 sm:ml-3 sm:w-auto sm:text-sm', onClick: onConfirm },

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а { text: 'р╕вр╕Бр╣Ар╕ер╕┤р╕Б', classes: 'mt-3 w-full inline-flex justify-center rounded-md border border-stone-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-stone-700 hover:bg-stone-50 sm:mt-0 sm:w-auto sm:text-sm' }

┬а ┬а ┬а ┬а ┬а ┬а ]);

┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а function bahttext(number) {

┬а ┬а ┬а ┬а ┬а ┬а number = Number(number).toFixed(2);

┬а ┬а ┬а ┬а ┬а ┬а let [integer, fraction] = number.split('.');

┬а ┬а ┬а ┬а ┬а ┬а const t = ['', 'р╕лр╕Щр╕╢р╣Ир╕З', 'р╕кр╕нр╕З', 'р╕кр╕▓р╕б', 'р╕кр╕╡р╣И', 'р╕лр╣Йр╕▓', 'р╕лр╕Б', 'р╣Ар╕Ир╣Зр╕Ф', 'р╣Бр╕Ыр╕Ф', 'р╣Ар╕Бр╣Йр╕▓'];

┬а ┬а ┬а ┬а ┬а ┬а const r = ['', 'р╕кр╕┤р╕Ъ', 'р╕гр╣Йр╕нр╕в', 'р╕Юр╕▒р╕Щ', 'р╕лр╕бр╕╖р╣Ир╕Щ', 'р╣Бр╕кр╕Щ', 'р╕ер╣Йр╕▓р╕Щ'];

┬а ┬а ┬а ┬а ┬а ┬а┬а

┬а ┬а ┬а ┬а ┬а ┬а function convert(n) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а let s = '';

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а let l = n.length;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а for (let i = 0; i < l; i++) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а let d = parseInt(n.charAt(i));

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а let p = l - i - 1;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (d > 0) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (p === 1 && d === 2) s += 'р╕вр╕╡р╣И';

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а else if (p === 1 && d === 1) s += '';

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а else if (p === 0 && d === 1 && s.length > 0 && n.length > 1) s += 'р╣Ар╕нр╣Зр╕Ф';

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а else s += t[d];

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а s += r[p];

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return s;

┬а ┬а ┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а ┬а ┬а let intText = convert(integer) || 'р╕ир╕╣р╕Щр╕вр╣М';

┬а ┬а ┬а ┬а ┬а ┬а let fracText = '';

┬а ┬а ┬а ┬а ┬а ┬а if (parseInt(fraction, 10) > 0) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬аfracText = convert(fraction) + 'р╕кр╕Хр╕▓р╕Зр╕Др╣М';

┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а

┬а ┬а ┬а ┬а ┬а ┬а if (!intText && !fracText) return 'р╕ир╕╣р╕Щр╕вр╣Мр╕Ър╕▓р╕Чр╕Цр╣Йр╕зр╕Щ';

┬а ┬а ┬а ┬а ┬а ┬а return (intText ? intText + 'р╕Ър╕▓р╕Ч' : '') + (parseInt(fraction) === 0 ? 'р╕Цр╣Йр╕зр╕Щ' : fracText);

┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а┬а

┬а ┬а ┬а ┬а function calculateTotals() {

┬а ┬а ┬а ┬а ┬а ┬а let totalWeight = 0;

┬а ┬а ┬а ┬а ┬а ┬а const weightInputs = ui.weightInputsContainer.querySelectorAll('.weight-input');

┬а ┬а ┬а ┬а ┬а ┬а weightInputs.forEach(input => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а totalWeight += parseFloat(input.value) || 0;

┬а ┬а ┬а ┬а ┬а ┬а });

┬а ┬а ┬а ┬а ┬а ┬а const pricePerKg = parseFloat(ui.pricePerKgInput.value) || 0;

┬а ┬а ┬а ┬а ┬а ┬а const totalAmount = totalWeight * pricePerKg;

┬а ┬а ┬а ┬а ┬а ┬а ui.totalWeightEl.textContent = totalWeight.toFixed(2);

┬а ┬а ┬а ┬а ┬а ┬а ui.totalAmountEl.textContent = totalAmount.toFixed(2);

┬а ┬а ┬а ┬а ┬а ┬а ui.totalAmountTextEl.textContent = bahttext(totalAmount);

┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а function renderTable(dataToRender) {

┬а ┬а ┬а ┬а ┬а ┬а ui.salesTableBody.innerHTML = '';

┬а ┬а ┬а ┬а ┬а ┬а if (dataToRender.length === 0) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.salesTableBody.innerHTML = '<tr><td colspan="6" class="px-6 py-8 text-center text-stone-400">р╕вр╕▒р╕Зр╣Др╕бр╣Ир╕бр╕╡р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Бр╕▓р╕гр╕Вр╕▓р╕в...</td></tr>';

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return;

┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а dataToRender.forEach(sale => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const row = document.createElement('tr');

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а row.className = 'bg-white border-b hover:bg-stone-50';

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const saleDate = sale.date instanceof Date ? sale.date : sale.date.toDate();

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а row.innerHTML = `

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-6 py-4">${saleDate.toLocaleDateString('th-TH')}</td>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-6 py-4 font-medium text-stone-900 whitespace-nowrap">${sale.seller}</td>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-6 py-4 text-right">${sale.weight.toFixed(2)}</td>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-6 py-4 text-right">${sale.price.toFixed(2)}</td>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-6 py-4 text-right font-bold text-amber-600">${sale.total.toFixed(2)}</td>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-6 py-4 text-center space-x-2">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-6 py-4 text-right font-bold text-amber-600">${sale.total.toLocaleString('th-TH', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button class="reprint-btn text-gray-500 hover:text-gray-700 p-1" data-id="${sale.id}" title="р╕Юр╕┤р╕бр╕Юр╣Мр╕Лр╣Йр╕│">ЁЯЦия╕П</button>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button class="edit-btn text-blue-600 hover:text-blue-800 p-1" data-id="${sale.id}" title="р╣Бр╕Бр╣Йр╣Др╕В">тЬПя╕П</button>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button class="delete-btn text-red-600 hover:text-red-800 p-1" data-id="${sale.id}" title="р╕ер╕Ъ">ЁЯЧСя╕П</button>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </td>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а `;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.salesTableBody.appendChild(row);

┬а ┬а ┬а ┬а ┬а ┬а });

┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а┬а

┬а ┬а ┬а ┬а function renderSummary() {

┬а ┬а ┬а ┬а ┬а ┬а if (!localSalesData || localSalesData.length === 0) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.summaryTotalSellers.textContent = '0';

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.summaryTotalWeight.textContent = '0.00';

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.summaryTotalPrice.textContent = '0.00';

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return;

┬а ┬а ┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а ┬а ┬а const totalSellers = new Set(localSalesData.map(s => s.seller)).size;

┬а ┬а ┬а ┬а ┬а ┬а const totalWeight = localSalesData.reduce((acc, sale) => acc + sale.weight, 0);

┬а ┬а ┬а ┬а ┬а ┬а const totalPrice = localSalesData.reduce((acc, sale) => acc + sale.total, 0);



┬а ┬а ┬а ┬а ┬а ┬а ui.summaryTotalSellers.textContent = totalSellers.toLocaleString('th-TH');

┬а ┬а ┬а ┬а ┬а ┬а ui.summaryTotalWeight.textContent = totalWeight.toLocaleString('th-TH', { minimumFractionDigits: 2, maximumFractionDigits: 2 });

┬а ┬а ┬а ┬а ┬а ┬а ui.summaryTotalPrice.textContent = totalPrice.toLocaleString('th-TH', { minimumFractionDigits: 2, maximumFractionDigits: 2 });

┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а function renderDailySummary() {

┬а ┬а ┬а ┬а ┬а ┬а const today = new Date();

┬а ┬а ┬а ┬а ┬а ┬а const todayStart = new Date(today.getFullYear(), today.getMonth(), today.getDate());

┬а ┬а ┬а ┬а ┬а ┬а const todayEnd = new Date(today.getFullYear(), today.getMonth(), today.getDate(), 23, 59, 59, 999);



┬а ┬а ┬а ┬а ┬а ┬а const salesToday = localSalesData.filter(sale => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const saleDate = sale.date.toDate();

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return saleDate >= todayStart && saleDate <= todayEnd;

┬а ┬а ┬а ┬а ┬а ┬а });

┬а ┬а ┬а ┬а ┬а ┬а┬а

┬а ┬а ┬а ┬а ┬а ┬а const dailyWeight = salesToday.reduce((acc, sale) => acc + sale.weight, 0);



┬а ┬а ┬а ┬а ┬а ┬а if(ui.summaryDailyWeight) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.summaryDailyWeight.textContent = dailyWeight.toLocaleString('th-TH', { minimumFractionDigits: 2, maximumFractionDigits: 2 });

┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а }





┬а ┬а ┬а ┬а function renderDashboard() {

┬а ┬а ┬а ┬а ┬а ┬а renderSalesBySellerChart();

┬а ┬а ┬а ┬а ┬а ┬а renderDailySalesChart();

┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а┬а

┬а ┬а ┬а ┬а function getChartColors(count) {

┬а ┬а ┬а ┬а ┬а ┬а const baseColors = ['#d97706', '#f59e0b', '#fcd34d', '#fef3c7', '#fffbeb', '#b45309', '#92400e'];

┬а ┬а ┬а ┬а ┬а ┬а let colors = [];

┬а ┬а ┬а ┬а ┬а ┬а for(let i = 0; i < count; i++) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а colors.push(baseColors[i % baseColors.length]);

┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а return colors;

┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а function renderSalesBySellerChart() {

┬а ┬а ┬а ┬а ┬а ┬а const salesBySeller = localSalesData.reduce((acc, sale) => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а acc[sale.seller] = (acc[sale.seller] || 0) + sale.total;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return acc;

┬а ┬а ┬а ┬а ┬а ┬а }, {});

┬а ┬а ┬а ┬а ┬а ┬а const labels = Object.keys(salesBySeller);

┬а ┬а ┬а ┬а ┬а ┬а const data = Object.values(salesBySeller);

┬а ┬а ┬а ┬а ┬а ┬а if (salesBySellerChart) salesBySellerChart.destroy();

┬а ┬а ┬а ┬а ┬а ┬а const canvas = document.getElementById('sales-by-seller-chart');

┬а ┬а ┬а ┬а ┬а ┬а if(canvas){

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а salesBySellerChart = new Chart(canvas.getContext('2d'), {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а type: 'doughnut',

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а data: {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а labels: labels,

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а datasets: [{ label: 'р╕вр╕нр╕Фр╕Вр╕▓р╕в', data: data, backgroundColor: getChartColors(labels.length), borderColor: '#ffffff', borderWidth: 2 }]

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а },

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } }

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });

┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а function renderDailySalesChart() {

┬а ┬а ┬а ┬а ┬а ┬а const salesByDay = localSalesData.reduce((acc, sale) => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const saleDate = sale.date instanceof Date ? sale.date : sale.date.toDate();

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const day = saleDate.toLocaleDateString('th-TH', { year: '2-digit', month: 'short', day: 'numeric'});

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а acc[day] = (acc[day] || 0) + sale.total;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return acc;

┬а ┬а ┬а ┬а ┬а ┬а }, {});

┬а ┬а ┬а ┬а ┬а ┬а const sortedLabels = Object.keys(salesByDay).sort((a,b) => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬аconst dateA = new Date(a.split('/')[2] - 543, a.split('/')[1] -1, a.split('/')[0]);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬аconst dateB = new Date(b.split('/')[2] - 543, b.split('/')[1] -1, b.split('/')[0]);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬аreturn dateA - dateB;

┬а ┬а ┬а ┬а ┬а ┬а });

┬а ┬а ┬а ┬а ┬а ┬а const data = sortedLabels.map(label => salesByDay[label]);

┬а ┬а ┬а ┬а ┬а ┬а if (dailySalesChart) dailySalesChart.destroy();

┬а ┬а ┬а ┬а ┬а ┬а const canvas = document.getElementById('daily-sales-chart');

┬а ┬а ┬а ┬а ┬а ┬а if(canvas){

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а dailySalesChart = new Chart(canvas.getContext('2d'), {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а type: 'line',

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а data: {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а labels: sortedLabels,

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а datasets: [{ label: 'р╕вр╕нр╕Фр╕Вр╕▓р╕вр╕гр╕зр╕бр╕гр╕▓р╕вр╕зр╕▒р╕Щ', data: data, fill: true, backgroundColor: 'rgba(217, 119, 6, 0.2)', borderColor: 'rgb(217, 119, 6)', tension: 0.1, pointBackgroundColor: 'rgb(217, 119, 6)', pointRadius: 4 }]

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а },

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true } } }

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });

┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а function createPrintableReceipt(sale) {

┬а ┬а ┬а ┬а ┬а ┬а const saleDate = sale.date instanceof Date ? sale.date : sale.date.toDate();

┬а ┬а ┬а ┬а ┬а ┬а┬а

┬а ┬а ┬а ┬а ┬а ┬а const generateSingleReceiptHTML = (title) => `

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="w-1/2 p-4 border border-dashed border-stone-400 h-full flex flex-col text-xs">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="text-center mb-4">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h2 class="text-base font-bold">${title}</h2>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h3 class="text-sm font-semibold mt-1">р╕кр╕лр╕Бр╕гр╕Ур╣Мр╕Бр╕нр╕Зр╕Чр╕╕р╕Щр╕кр╕зр╕Щр╕вр╕▓р╕Зр╕Юр╕▓р╕гр╕▓р╣Ар╕Бр╕йр╕Хр╕гр╕кр╕бр╕Ър╕╣р╕гр╕Ур╣М р╕Ир╕│р╕Бр╕▒р╕Ф</h3>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p class="text-xs text-stone-600">15/1 р╕б.6 р╕Х.р╕лр╕Щр╕нр╕Зр╣Вр╕Юр╕Щр╕Зр╕▓р╕б р╕н.р╣Ар╕Бр╕йр╕Хр╕гр╕кр╕бр╕Ър╕╣р╕гр╕Ур╣М р╕И.р╕Кр╕▒р╕вр╕ар╕╣р╕бр╕┤</p>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="border-y border-stone-300 py-1 mb-2">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="flex justify-between">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span class="font-semibold">р╣Ар╕ер╕Вр╕Чр╕╡р╣Ир╣Гр╕Ър╣Ар╕кр╕гр╣Зр╕И:</span>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span>${sale.receiptId || 'N/A'}</span>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="flex justify-between mt-1">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span class="font-semibold">р╕зр╕▒р╕Щр╕Чр╕╡р╣И:</span>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span>${saleDate.toLocaleDateString('th-TH', { year: 'numeric', month: 'long', day: 'numeric' })}</span>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а<div class="flex justify-between mt-1">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span class="font-semibold">р╕Хр╕▓р╕Кр╕▒р╣Ир╕Зр╕Чр╕╡р╣И:</span>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span>${sale.scaleNumber || '-'}</span>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="mb-2">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span class="font-semibold">р╕Ьр╕╣р╣Йр╕Вр╕▓р╕в:</span>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span>${sale.seller}</span>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <table class="w-full my-1">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <thead class="border-y border-stone-300">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <tr>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th class="py-1 text-left font-semibold">р╕гр╕▓р╕вр╕Бр╕▓р╕г</th>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th class="py-1 text-right font-semibold">р╕вр╕нр╕Фр╕гр╕зр╕б (р╕Ър╕▓р╕Ч)</th>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </tr>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </thead>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <tbody class="border-b border-stone-300">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <tr>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="py-2 align-top">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а р╕Др╣Ир╕▓р╕вр╕▓р╕Зр╕Бр╣Йр╕нр╕Щр╕Цр╣Йр╕зр╕в

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span class="block text-xs text-stone-600">р╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Б: ${sale.weight.toFixed(2)} р╕Бр╕Б. @ ${sale.price.toFixed(2)} р╕Ър╕▓р╕Ч/р╕Бр╕Б.</span>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </td>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="text-right align-top pt-2">${sale.total.toFixed(2)}</td>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </tr>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </tbody>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <tfoot>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <tr class="font-bold">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="py-2">р╕гр╕зр╕бр╣Ар╕Ыр╣Зр╕Щр╣Ар╕Зр╕┤р╕Щ</td>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="text-right">${sale.total.toFixed(2)}</td>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </tr>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </tfoot>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </table>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p class="text-center mb-4 font-semibold">(${bahttext(sale.total)})</p>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="flex-grow"></div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="flex justify-center text-center mt-4">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p class="pb-1">........................................</p>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p>(р╕Ьр╕╣р╣Йр╕Ир╣Ир╕▓р╕вр╣Ар╕Зр╕┤р╕Щ)</p>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а `;



┬а ┬а ┬а ┬а ┬а ┬а ui.printArea.innerHTML = `

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="flex gap-4">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ${generateSingleReceiptHTML('р╣Гр╕Ър╣Ар╕кр╕гр╣Зр╕Ир╕гр╕▒р╕Ър╣Ар╕Зр╕┤р╕Щ р╕Хр╣Йр╕Щр╕Йр╕Ър╕▒р╕Ъ')}

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ${generateSingleReceiptHTML('р╣Гр╕Ър╣Ар╕кр╕гр╣Зр╕Ир╕гр╕▒р╕Ър╣Ар╕Зр╕┤р╕Щ (р╕кр╕│р╣Ар╕Щр╕▓)')}

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а `;

┬а ┬а ┬а ┬а ┬а ┬а window.print();

┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а┬а

┬а ┬а ┬а ┬а function createDailySummaryReport() {

┬а ┬а ┬а ┬а ┬а ┬а const reportDate = new Date();

┬а ┬а ┬а ┬а ┬а ┬а const formattedDate = reportDate.toLocaleDateString('th-TH', {┬а

┬а ┬а ┬а ┬а ┬а ┬а year: 'numeric',┬а

┬а ┬а ┬а ┬а ┬а ┬а month: 'long',┬а

┬а ┬а ┬а ┬а ┬а ┬а day: 'numeric'┬а

┬а ┬а ┬а ┬а ┬а ┬а }); {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showAlert('р╕Бр╕гр╕╕р╕Ур╕▓р╣Ар╕ер╕╖р╕нр╕Бр╕зр╕▒р╕Щр╕Чр╕╡р╣Ир╕Чр╕╡р╣Ир╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕Чр╕│р╕гр╕▓р╕вр╕Зр╕▓р╕Щ');

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return;

┬а ┬а ┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а ┬а ┬а const reportStart = new Date(reportDate.getFullYear(), reportDate.getMonth(), reportDate.getDate());

┬а ┬а ┬а ┬а ┬а ┬а const reportEnd = new Date(reportDate.getFullYear(), reportDate.getMonth(), reportDate.getDate(), 23, 59, 59, 999);

┬а ┬а ┬а ┬а ┬а ┬а┬а

┬а ┬а ┬а ┬а ┬а ┬а const salesForDay = localSalesData.filter(sale => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const saleDate = sale.date.toDate();

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return saleDate >= reportStart && saleDate <= reportEnd;

┬а ┬а ┬а ┬а ┬а ┬а });



┬а ┬а ┬а ┬а ┬а ┬а if (salesForDay.length === 0) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showAlert(`р╣Др╕бр╣Ир╕Юр╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Бр╕▓р╕гр╕Вр╕▓р╕вр╣Гр╕Щр╕зр╕▒р╕Щр╕Чр╕╡р╣И ${reportStart.toLocaleDateString('th-TH')}`);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return;

┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а if (salesForDay.length === 0) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showAlert(`р╣Др╕бр╣Ир╕Юр╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Бр╕▓р╕гр╕Вр╕▓р╕вр╣Гр╕Щр╕зр╕▒р╕Щр╕Чр╕╡р╣И ${reportStart.toLocaleDateString('th-TH')}`);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return;

┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а let tableRows = '';

┬а ┬а ┬а ┬а ┬а ┬а salesForDay.forEach((sale, index) => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а tableRows += `

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <tr class="border-b">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-2 py-2 text-center">${index + 1}</td>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-2 py-2">${sale.seller}</td>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-2 py-2 text-right">${sale.weight.toFixed(2)}</td>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-2 py-2 text-right">${sale.price.toFixed(2)}</td>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-2 py-2 text-right">${sale.total.toFixed(2)}</td>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-2 py-2 text-center">${sale.scaleNumber || ''}</td>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-2 py-2 border-l"></td>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </tr>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а `;

┬а ┬а ┬а ┬а ┬а ┬а });



┬а ┬а ┬а ┬а ┬а ┬а const reportHTML = `

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="p-8 bg-white text-black">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="text-center mb-4">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h2 class="text-xl font-bold">р╕кр╕лр╕Бр╕гр╕Ур╣Мр╕Бр╕нр╕Зр╕Чр╕╕р╕Щр╕кр╕зр╕Щр╕вр╕▓р╕Зр╕Юр╕▓р╕гр╕▓р╣Ар╕Бр╕йр╕Хр╕гр╕кр╕бр╕Ър╕╣р╕гр╕Ур╣М р╕Ир╕│р╕Бр╕▒р╕Ф</h2>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h3 class="text-lg">р╕гр╕▓р╕вр╕Зр╕▓р╕Щр╕Бр╕▓р╕гр╕Кр╕▒р╣Ир╕Зр╕вр╕▓р╕Зр╕Ыр╕гр╕░р╕Ир╕│р╕зр╕▒р╕Щр╕Чр╕╡р╣И ${formattedDate} (р╕Хр╕▓р╕Кр╕▒р╣Ир╕Зр╕Чр╕╡р╣И ${scaleId})</h3>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <table class="w-full text-sm border-collapse border border-black">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <thead class="bg-stone-200">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <tr class="border-b border-black">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th class="px-2 py-2 border-r border-black">р╕ер╕│р╕Фр╕▒р╕Ър╕Чр╕╡р╣И</th>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th class="px-2 py-2 border-r border-black">р╕Кр╕╖р╣Ир╕н</th>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th class="px-2 py-2 border-r border-black">р╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Б</th>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th class="px-2 py-2 border-r border-black">р╕гр╕▓р╕Др╕▓</th>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th class="px-2 py-2 border-r border-black">р╕вр╕нр╕Фр╕гр╕зр╕б</th>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th class="px-2 py-2 border-r border-black">р╕Хр╕▓р╕Кр╕▒р╣Ир╕Зр╕Чр╕╡р╣И</th>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th class="px-2 py-2">р╕ер╕▓р╕вр╣Ар╕Лр╣Зр╕Щ</th>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </tr>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </thead>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <tbody>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ${tableRows}

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </tbody>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </table>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а `;

┬а ┬а ┬а ┬а ┬а ┬а┬а

┬а ┬а ┬а ┬а ┬а ┬а ui.printArea.innerHTML = reportHTML;

┬а ┬а ┬а ┬а ┬а ┬а window.print();

┬а ┬а ┬а ┬а }





┬а ┬а ┬а ┬а function clearForm() {

┬а ┬а ┬а ┬а ┬а ┬а ui.sellerNameInput.value = '';

┬а ┬а ┬а ┬а ┬а ┬а ui.scaleNumberInput.value = '';

┬а ┬а ┬а ┬а ┬а ┬а const weightInputs = ui.weightInputsContainer.querySelectorAll('.weight-input');

┬а ┬а ┬а ┬а ┬а ┬а weightInputs.forEach(input => input.value = '');

┬а ┬а ┬а ┬а ┬а ┬а ui.pricePerKgInput.value = '';

┬а ┬а ┬а ┬а ┬а ┬а editingId = null;

┬а ┬а ┬а ┬а ┬а ┬а ui.saveButton.textContent = 'р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╣Бр╕ер╕░р╕Юр╕┤р╕бр╕Юр╣Мр╣Гр╕Ър╣Ар╕кр╕гр╣Зр╕И';

┬а ┬а ┬а ┬а ┬а ┬а ui.cancelEditButton.classList.add('hidden');

┬а ┬а ┬а ┬а ┬а ┬а calculateTotals();

┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а async function handleSave() {

┬а ┬а ┬а ┬а ┬а ┬а if (!salesCollectionRef) return showAlert('р╕вр╕▒р╕Зр╣Др╕бр╣Ир╕Юр╕гр╣Йр╕нр╕бр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ р╕Бр╕гр╕╕р╕Ур╕▓р╕гр╕нр╕кр╕▒р╕Бр╕Др╕гр╕╣р╣И');

┬а ┬а ┬а ┬а ┬а ┬а if (weightInputs.length === 0) {showAlert('р╕Бр╕гр╕╕р╕Ур╕▓р╕Бр╕гр╕нр╕Бр╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Бр╕нр╕вр╣Ир╕▓р╕Зр╕Щр╣Йр╕нр╕в 1 р╕гр╕▓р╕вр╕Бр╕▓р╕г');

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return;

┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а if (total <= 0) {showAlert('р╕вр╕нр╕Фр╕гр╕зр╕бр╕Хр╣Йр╕нр╕Зр╕бр╕▓р╕Бр╕Бр╕зр╣Ир╕▓ 0 р╕Ър╕▓р╕Ч');

┬а ┬а ┬а ┬а ┬а ┬а return;

┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а const seller = ui.sellerNameInput.value.trim();

┬а ┬а ┬а ┬а ┬а ┬а const date = ui.receiptDateInput.valueAsDate;

┬а ┬а ┬а ┬а ┬а ┬а const scaleNumber = ui.scaleNumberInput.value;

┬а ┬а ┬а ┬а ┬а ┬а const weight = parseFloat(ui.totalWeightEl.textContent) || 0;

┬а ┬а ┬а ┬а ┬а ┬а const price = parseFloat(ui.pricePerKgInput.value) || 0;

┬а ┬а ┬а ┬а ┬а ┬а const total = parseFloat(ui.totalAmountEl.textContent) || 0;

┬а ┬а ┬а ┬а ┬а ┬а const weightInputs = Array.from(ui.weightInputsContainer.querySelectorAll('.weight-input')).map(input => parseFloat(input.value) || 0).filter(v => v > 0);



┬а ┬а ┬а ┬а ┬а ┬а if (!seller || !date || weight <= 0 || price <= 0) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showAlert('р╕Бр╕гр╕╕р╕Ур╕▓р╕Бр╕гр╕нр╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Гр╕лр╣Йр╕Др╕гр╕Ър╕Цр╣Йр╕зр╕Щ: р╕Кр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╕Вр╕▓р╕в, р╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Б р╣Бр╕ер╕░р╕гр╕▓р╕Др╕▓');

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return;

┬а ┬а ┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а ┬а ┬а const saleData = { seller, date, scaleNumber, weight, weights: weightInputs, price, total, userId };



┬а ┬а ┬а ┬а ┬а ┬а try {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (editingId) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const docRef = doc(db, "sales", editingId);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const dataToUpdate = { ...saleData };

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const originalDoc = localSalesData.find(s => s.id === editingId);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (originalDoc && originalDoc.receiptId) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬аdataToUpdate.receiptId = originalDoc.receiptId;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а await updateDoc(docRef, dataToUpdate);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showAlert('р╕нр╕▒р╕Ыр╣Ар╕Фр╕Хр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕кр╕│р╣Ар╕гр╣Зр╕И');

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а } else {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const now = new Date();

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const year = now.getFullYear();

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const month = (now.getMonth() + 1).toString().padStart(2, '0');

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const day = now.getDate().toString().padStart(2, '0');

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const todayStart = new Date(now.setHours(0, 0, 0, 0));

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const salesToday = localSalesData.filter(sale => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const saleDate = sale.date.toDate();

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return saleDate >= todayStart;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const nextReceiptNumber = salesToday.length + 1;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а saleData.receiptId = `${year}${month}${day}-${String(nextReceiptNumber).padStart(3, '0')}`;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const docRef = await addDoc(salesCollectionRef, saleData);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showAlert('р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕кр╕│р╣Ар╕гр╣Зр╕И');

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а createPrintableReceipt({...saleData, id: docRef.id });

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а clearForm();

┬а ┬а ┬а ┬а ┬а ┬а } catch (error) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а console.error("Error saving document: ", error);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showAlert(`р╣Ар╕Бр╕┤р╕Фр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╣Гр╕Щр╕Бр╕▓р╕гр╕Ър╕▒р╕Щр╕Чр╕╢р╕Б: ${error.message}`);

┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а┬а

┬а ┬а ┬а ┬а function handleTableClick(e) {

┬а ┬а ┬а ┬а ┬а ┬а const target = e.target.closest('button');

┬а ┬а ┬а ┬а ┬а ┬а if (!target) return;



┬а ┬а ┬а ┬а ┬а ┬а const id = target.dataset.id;

┬а ┬а ┬а ┬а ┬а ┬а const saleToProcess = localSalesData.find(sale => sale.id === id);

┬а ┬а ┬а ┬а ┬а ┬а if (!saleToProcess) return;



┬а ┬а ┬а ┬а ┬а ┬а if (target.classList.contains('delete-btn')) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showConfirm('р╕Др╕╕р╕Ур╣Бр╕Щр╣Ир╣Гр╕Ир╕зр╣Ир╕▓р╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕ер╕Ър╕гр╕▓р╕вр╕Бр╕▓р╕гр╕Щр╕╡р╣Й?', async () => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а try {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а await deleteDoc(doc(db, "sales", id));

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showAlert('р╕ер╕Ър╕гр╕▓р╕вр╕Бр╕▓р╕гр╕кр╕│р╣Ар╕гр╣Зр╕И');

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а } catch (error) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬аconsole.error("Error deleting document: ", error);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬аshowAlert(`р╣Ар╕Бр╕┤р╕Фр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╣Гр╕Щр╕Бр╕▓р╕гр╕ер╕Ъ: ${error.message}`);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });

┬а ┬а ┬а ┬а ┬а ┬а } else if (target.classList.contains('edit-btn')) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а editingId = id;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.sellerNameInput.value = saleToProcess.seller;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const saleDate = saleToProcess.date instanceof Date ? saleToProcess.date : saleToProcess.date.toDate();

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.receiptDateInput.value = saleDate.toISOString().split('T')[0];

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.scaleNumberInput.value = saleToProcess.scaleNumber || '';

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.pricePerKgInput.value = saleToProcess.price;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const weightInputs = ui.weightInputsContainer.querySelectorAll('.weight-input');

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а weightInputs.forEach((input, index) => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а input.value = saleToProcess.weights[index] || '';

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а calculateTotals();

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.saveButton.textContent = 'р╕нр╕▒р╕Ыр╣Ар╕Фр╕Хр╕Вр╣Йр╕нр╕бр╕╣р╕е';

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.cancelEditButton.classList.remove('hidden');

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а window.scrollTo({ top: 0, behavior: 'smooth' });

┬а ┬а ┬а ┬а ┬а ┬а } else if (target.classList.contains('reprint-btn')) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а createPrintableReceipt(saleToProcess);

┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а┬а

┬а ┬а ┬а ┬а function updateDateDisplay() {

┬а ┬а ┬а ┬а ┬а ┬а const date = ui.receiptDateInput.valueAsDate;

┬а ┬а ┬а ┬а ┬а ┬а if (date) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.dateDisplay.textContent = `(${date.toLocaleDateString('th-TH')})`;

┬а ┬а ┬а ┬а ┬а ┬а } else {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const today = new Date();

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.dateDisplay.textContent = `(${today.toLocaleDateString('th-TH')})`;

┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а function createWeighingStationHTML(scaleId) {

┬а ┬а ┬а ┬а ┬а ┬а return `

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <section class="bg-white p-6 rounded-xl shadow-md">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h2 class="text-2xl font-bold mb-4 border-b pb-3 text-stone-800">р╕гр╕▒р╕Ър╕зр╕▓р╕Зр╕вр╕▓р╕З (р╕Хр╕▓р╕Кр╕▒р╣Ир╕Зр╕Чр╕╡р╣И ${scaleId})</h2>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="grid grid-cols-1 md:grid-cols-3 gap-4">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="md:col-span-2">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="weighing-seller-${scaleId}" class="block text-sm font-medium text-stone-600 mb-1">р╕Кр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╕Вр╕▓р╕в</label>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="text" id="weighing-seller-${scaleId}" class="w-full p-2 border border-stone-300 rounded-md shadow-sm" placeholder="р╕Др╣Йр╕Щр╕лр╕▓р╕лр╕гр╕╖р╕нр╕Ыр╣Йр╕нр╕Щр╕Кр╕╖р╣Ир╕н">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="weighing-weight-${scaleId}" class="block text-sm font-medium text-stone-600 mb-1">р╕Ир╕│р╕Щр╕зр╕Щр╕Цр╕╕р╕З</label>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="number" id="weighing-weight-${scaleId}" class="w-full p-2 border border-stone-300 rounded-md shadow-sm">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="md:col-span-3">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а<button id="save-weighing-${scaleId}" data-scale="${scaleId}" class="w-full bg-green-600 text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-green-700">р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Б</button>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="mt-6 border-t pt-4">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="grid grid-cols-3 gap-4 items-end">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label class="block text-sm font-medium text-stone-600">р╕Ьр╕ер╕гр╕зр╕бр╕Ир╕│р╕Щр╕зр╕Щр╕Цр╕╕р╕З</label>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p id="total-bags-${scaleId}" class="text-lg font-bold">0</p>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="multiplier-weight-${scaleId}" class="block text-sm font-medium text-stone-600">р╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Б/р╕Цр╕╕р╕З (р╕Бр╕Б.)</label>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="number" id="multiplier-weight-${scaleId}" class="w-full p-2 border border-stone-300 rounded-md shadow-sm">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label class="block text-sm font-medium text-stone-600">р╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣М (р╕Бр╕Б.)</label>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p id="total-calculated-weight-${scaleId}" class="text-lg font-bold">0.00</p>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а<div class="mt-4 flex justify-end">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button id="print-weighing-log-${scaleId}" data-scale="${scaleId}" class="bg-sky-600 text-white font-bold py-1 px-3 rounded-lg shadow-md hover:bg-sky-700">р╕Ыр╕гр╕┤р╣Йр╕Щр╕гр╕▓р╕вр╕Бр╕▓р╕гр╕Хр╕▓р╕Кр╕▒р╣Ир╕З</button>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="mt-6">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h3 class="font-semibold mb-2">р╕гр╕▓р╕вр╕Бр╕▓р╕гр╕Чр╕╡р╣Ир╕Кр╕▒р╣Ир╕Зр╕зр╕▒р╕Щр╕Щр╕╡р╣Й (р╕Хр╕▓р╕Кр╕▒р╣Ир╕Зр╕Чр╕╡р╣И ${scaleId})</h3>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="overflow-y-auto h-64 border rounded-lg">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а<table class="w-full text-sm text-left">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <thead class="bg-stone-100 sticky top-0">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <tr>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th class="px-4 py-2">р╣Ар╕зр╕ер╕▓</th>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th class="px-4 py-2">р╕Кр╕╖р╣Ир╕н</th>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th class="px-4 py-2 text-right">р╕Ир╕│р╕Щр╕зр╕Щр╕Цр╕╕р╕З</th>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th class="px-4 py-2 w-1/3 text-center">р╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Бр╕Чр╕╡р╣Ир╕Кр╕▒р╣Ир╕Зр╣Др╕Фр╣Й</th>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th class="px-4 py-2 text-center">р╕Ир╕▒р╕Фр╕Бр╕▓р╕г</th>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </tr>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </thead>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <tbody id="weighing-table-body-${scaleId}">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <tr><td colspan="5" class="text-center p-4 text-stone-400">р╕вр╕▒р╕Зр╣Др╕бр╣Ир╕бр╕╡р╕гр╕▓р╕вр╕Бр╕▓р╕г</td></tr>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </tbody>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </table>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </section>

┬а ┬а ┬а ┬а ┬а ┬а `;

┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а┬а

┬а ┬а ┬а ┬а function renderWeighingStations() {

┬а ┬а ┬а ┬а ┬а ┬а for (let i = 1; i <= 4; i++) {

┬а ┬а ┬а ┬а ┬а ┬а const tabContent = document.getElementById(`tab-weighing-${i}`);

┬а ┬а ┬а ┬а ┬а ┬а if(tabContent) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а tabContent.innerHTML = createWeighingStationHTML(i);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById(`save-weighing-${i}`).addEventListener('click', saveWeighing);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById(`multiplier-weight-${i}`).addEventListener('input', () => calculateTotalWeight(i));

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById(`weighing-weight-${i}`).addEventListener('input', () => calculateTotalWeight(i)); // р╣Ар╕Юр╕┤р╣Ир╕бр╕Ър╕гр╕гр╕Чр╕▒р╕Фр╕Щр╕╡р╣Й

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById(`print-weighing-log-${i}`).addEventListener('click', printWeighingLog);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById(`weighing-table-body-${i}`).addEventListener('click', handleWeighingTableClick);

┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а }

┬а ┬а }



┬а ┬а ┬а ┬а async function saveWeighing(event) {

┬а ┬а ┬а ┬а ┬а ┬а if (!weighingsCollectionRef) return showAlert('р╕вр╕▒р╕Зр╣Др╕бр╣Ир╕Юр╕гр╣Йр╕нр╕бр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ р╕Бр╕гр╕╕р╕Ур╕▓р╕гр╕нр╕кр╕▒р╕Бр╕Др╕гр╕╣р╣И');

┬а ┬а ┬а ┬а ┬а ┬а const scaleId = parseInt(event.target.dataset.scale);

┬а ┬а ┬а ┬а ┬а ┬а const sellerName = document.getElementById(`weighing-seller-${scaleId}`).value.trim();

┬а ┬а ┬а ┬а ┬а ┬а const bags = parseInt(document.getElementById(`weighing-weight-${scaleId}`).value);



┬а ┬а ┬а ┬а ┬а ┬а if (!sellerName || !bags || bags <= 0) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showAlert('р╕Бр╕гр╕╕р╕Ур╕▓р╕Бр╕гр╕нр╕Бр╕Кр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╕Вр╕▓р╕вр╣Бр╕ер╕░р╕Ир╕│р╕Щр╕зр╕Щр╕Цр╕╕р╕Зр╣Гр╕лр╣Йр╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З');

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return;

┬а ┬а ┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а ┬а ┬а try {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (editingWeighingId) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const docRef = doc(weighingsCollectionRef, editingWeighingId);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а await updateDoc(docRef, { sellerName, bags });

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а editingWeighingId = null;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а } else {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а await addDoc(weighingsCollectionRef, {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а sellerName,

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а bags,

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а scaleId: scaleId,

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а timestamp: new Date(),

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а userId

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById(`weighing-seller-${scaleId}`).value = '';

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById(`weighing-weight-${scaleId}`).value = '';

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById(`weighing-seller-${scaleId}`).focus();



┬а ┬а ┬а ┬а ┬а ┬а } catch(error) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а console.error("Error saving weighing: ", error);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showAlert(`р╣Ар╕Бр╕┤р╕Фр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╣Гр╕Щр╕Бр╕▓р╕гр╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Б: ${error.message}`);

┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а function calculateTotalWeight(scaleId) {

┬а ┬а ┬а ┬а ┬а ┬а const totalBagsEl = document.getElementById(`total-bags-${scaleId}`);

┬а ┬а ┬а ┬а ┬а ┬а const multiplierEl = document.getElementById(`multiplier-weight-${scaleId}`);

┬а ┬а ┬а ┬а ┬а ┬а const resultEl = document.getElementById(`total-calculated-weight-${scaleId}`);



┬а ┬а ┬а ┬а ┬а ┬а const totalBags = parseInt(totalBagsEl.textContent) || 0;

┬а ┬а ┬а ┬а ┬а ┬а const multiplier = parseFloat(multiplierEl.value) || 0;



┬а ┬а ┬а ┬а ┬а ┬а resultEl.textContent = (totalBags * multiplier).toFixed(2);

┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а function printWeighingLog(event) {

┬а ┬а ┬а ┬а ┬а ┬а if (!weighingsCollectionRef) return showAlert("р╕вр╕▒р╕Зр╣Др╕бр╣Ир╕Юр╕гр╣Йр╕нр╕бр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ р╕Бр╕гр╕╕р╕Ур╕▓р╕гр╕нр╕кр╕▒р╕Бр╕Др╕гр╕╣р╣И");

┬а ┬а ┬а ┬а ┬а ┬а const scaleId = event.target.dataset.scale;

┬а ┬а ┬а ┬а ┬а ┬а┬а

┬а ┬а ┬а ┬а ┬а ┬а const q = query(weighingsCollectionRef, where("scaleId", "==", parseInt(scaleId)));



┬а ┬а ┬а ┬а ┬а ┬а getDocs(q).then(snapshot => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const today = new Date();

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const todayStart = new Date(today.getFullYear(), today.getMonth(), today.getDate());

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а┬а

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const salesForDay = snapshot.docs

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а .map(doc => doc.data())

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а .filter(data => data.timestamp.toDate() >= todayStart);



┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (salesForDay.length === 0) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showAlert(`р╣Др╕бр╣Ир╕Юр╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╕кр╕│р╕лр╕гр╕▒р╕Ър╕Хр╕▓р╕Кр╕▒р╣Ир╕Зр╕Чр╕╡р╣И ${scaleId} р╣Гр╕Щр╕зр╕▒р╕Щр╕Щр╕╡р╣Й`);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а let tableRows = '';

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а let index = 1;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а salesForDay.sort((a,b) => a.timestamp.toDate() - b.timestamp.toDate()).forEach(data => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬аtableRows += `

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <tr class="border-b">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-2 py-2 text-center">${index++}</td>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-2 py-2">${data.sellerName}</td>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-2 py-2 text-center">${data.bags}</td>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-2 py-2 border-l" style="width: 25%;"></td>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-2 py-2 border-l" style="width: 25%;"></td>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </tr>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а `;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });



┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬аconst reportHTML = `

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <style>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а @media print {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а @page { size: A4; margin: 1.5cm; }

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а body { -webkit-print-color-adjust: exact; print-color-adjust: exact; }

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а .print-container { width: 100%; margin: 0; padding: 0; }

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а .print-table { width: 100%; border-collapse: collapse; font-size: 10pt; }

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а .print-table th, .print-table td { border: 1px solid black; padding: 4px 8px; text-align: left; }

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а .print-table th { background-color: #f5f5f4 !important; }

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а .text-center { text-align: center; }

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </style>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="print-container">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="text-center mb-4">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h2 class="text-xl font-bold">р╕кр╕лр╕Бр╕гр╕Ур╣Мр╕Бр╕нр╕Зр╕Чр╕╕р╕Щр╕кр╕зр╕Щр╕вр╕▓р╕Зр╕Юр╕▓р╕гр╕▓р╣Ар╕Бр╕йр╕Хр╕гр╕кр╕бр╕Ър╕╣р╕гр╕Ур╣М р╕Ир╕│р╕Бр╕▒р╕Ф</h2>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h3 class="text-lg">р╕гр╕▓р╕вр╕Зр╕▓р╕Щр╕Бр╕▓р╕гр╕Кр╕▒р╣Ир╕Зр╕вр╕▓р╕Зр╕Ыр╕гр╕░р╕Ир╕│р╕зр╕▒р╕Щр╕Чр╕╡р╣И ${today.toLocaleDateString('th-TH', { year: 'numeric', month: 'long', day: 'numeric' })} (р╕Хр╕▓р╕Кр╕▒р╣Ир╕Зр╕Чр╕╡р╣И ${scaleId})</h3>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <table class="print-table">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <thead class="bg-stone-200">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <tr class="border-b border-black">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th class="text-center">р╕ер╕│р╕Фр╕▒р╕Ър╕Чр╕╡р╣И</th>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th>р╕Кр╕╖р╣Ир╕н</th>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th class="text-center">р╕Ир╕│р╕Щр╕зр╕Щр╕Цр╕╕р╕З</th>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th>р╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Бр╕Чр╕╡р╣Ир╕Кр╕▒р╣Ир╕Зр╣Др╕Фр╣Й</th>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th>р╕ер╕▓р╕вр╣Ар╕Лр╣Зр╕Щ</th>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </tr>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </thead>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <tbody>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ${tableRows}

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </tbody>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </table>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а `;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.printArea.innerHTML = reportHTML;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а window.print();

┬а ┬а ┬а ┬а ┬а ┬а });

┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а┬а

┬а ┬а ┬а ┬а function setupWeighingListeners() {

┬а ┬а ┬а ┬а ┬а ┬а if (!weighingsCollectionRef) return;

┬а ┬а ┬а ┬а ┬а ┬а for (let i = 1; i <= 4; i++) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const q = query(weighingsCollectionRef, where("scaleId", "==", i));



┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (unsubscribeWeighings[i]) unsubscribeWeighings[i]();



┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а unsubscribeWeighings[i] = onSnapshot(q, (snapshot) => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const todayStart = new Date();

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а todayStart.setHours(0, 0, 0, 0);



┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const tableBody = document.getElementById(`weighing-table-body-${i}`);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (!tableBody) return;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а tableBody.innerHTML = '';

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а let totalBags = 0;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а┬а

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const docs = snapshot.docs.map(doc => ({id: doc.id, ...doc.data()}));

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const todaysDocs = docs.filter(data => data.timestamp.toDate() >= todayStart);



┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (todaysDocs.length === 0) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬аtableBody.innerHTML = '<tr><td colspan="5" class="text-center p-4 text-stone-400">р╕вр╕▒р╕Зр╣Др╕бр╣Ир╕бр╕╡р╕гр╕▓р╕вр╕Бр╕▓р╕г</td></tr>';

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а } else {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬аtodaysDocs.sort((a,b) => b.timestamp.toDate() - a.timestamp.toDate()).forEach(data => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а totalBags += data.bags;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const row = document.createElement('tr');

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а row.className = 'border-b';

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а row.innerHTML = `

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-4 py-2">${data.timestamp.toDate().toLocaleTimeString('th-TH')}</td>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-4 py-2">${data.sellerName}</td>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-4 py-2 text-right">${data.bags}</td>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-4 py-2 w-1/3 text-center border-l"></td>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-4 py-2 text-center space-x-2">

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button class="edit-weighing-btn text-blue-600 hover:text-blue-800 p-1" data-id="${data.id}" data-scale="${i}" title="р╣Бр╕Бр╣Йр╣Др╕В">тЬПя╕П</button>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button class="delete-weighing-btn text-red-600 hover:text-red-800 p-1" data-id="${data.id}" title="р╕ер╕Ъ">ЁЯЧСя╕П</button>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </td>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а `;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а tableBody.appendChild(row);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const totalBagsEl = document.getElementById(`total-bags-${i}`);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (totalBagsEl) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а totalBagsEl.textContent = totalBags;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а calculateTotalWeight(i);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });

┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а async function fetchAndPopulateWeights(sellerName) {

┬а ┬а ┬а ┬а ┬а ┬а ┬аif (!weighingsCollectionRef) return;

┬а ┬а ┬а ┬а ┬а ┬а ┬аconst q = query(weighingsCollectionRef, where("sellerName", "==", sellerName));

┬а ┬а ┬а ┬а ┬а ┬а ┬аconst querySnapshot = await getDocs(q);



┬а ┬а ┬а ┬а ┬а ┬а ┬аconst todayStart = new Date();

┬а ┬а ┬а ┬а ┬а ┬а ┬аtodayStart.setHours(0, 0, 0, 0);



┬а ┬а ┬а ┬а ┬а ┬а ┬аconst todaysDocs = querySnapshot.docs.filter(doc => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const ts = doc.data().timestamp;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (!ts) return false;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return ts.toDate() >= todayStart;

┬а ┬а ┬а ┬а ┬а ┬а ┬а});



┬а ┬а ┬а ┬а ┬а ┬а ┬аif(todaysDocs.length === 0) return;

┬а ┬а ┬а ┬а ┬а ┬а┬а

┬а ┬а ┬а ┬а ┬а ┬а ┬аconst weights = todaysDocs.map(doc => doc.data().bags); // Use bags

┬а ┬а ┬а ┬а ┬а ┬а ┬аconst weightInputs = document.querySelectorAll('#weight-inputs-container .weight-input');

┬а ┬а ┬а ┬а ┬а ┬а┬а

┬а ┬а ┬а ┬а ┬а ┬а ┬аweights.forEach((weight, index) => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if(index < weightInputs.length) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а weightInputs[index].value = weight;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а ┬а});

┬а ┬а ┬а ┬а ┬а ┬а ┬аcalculateTotals();



┬а ┬а ┬а ┬а ┬а ┬а ┬аshowConfirm(`р╕Юр╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╕зр╕▓р╕Зр╕вр╕▓р╕З ${weights.length} р╕гр╕▓р╕вр╕Бр╕▓р╕гр╕Вр╕нр╕З ${sellerName} р╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕ер╣Йр╕▓р╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Щр╕╡р╣Йр╕лр╕гр╕╖р╕нр╣Др╕бр╣И?`, () => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а todaysDocs.forEach(async (d) => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а await deleteDoc(doc(weighingsCollectionRef, d.id));

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });

┬а ┬а ┬а ┬а ┬а ┬а ┬а});

┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а┬а

┬а ┬а ┬а ┬а async function initApp() {

┬а ┬а ┬а ┬а ┬а ┬а if (Object.keys(firebaseConfig).length === 0 || !firebaseConfig.apiKey) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showAlert('р╕Бр╕▓р╕гр╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓ Firebase р╣Др╕бр╣Ир╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З р╣Др╕бр╣Ир╕кр╕▓р╕бр╕▓р╕гр╕Цр╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕нр╕Рр╕▓р╕Щр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Др╕Фр╣Й');

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а console.error('Firebase config is missing.');

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return;

┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а try {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const app = initializeApp(firebaseConfig);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const analytics = getAnalytics(app);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а auth = getAuth(app);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а db = getFirestore(app);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а┬а

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а onAuthStateChanged(auth, async (user) => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (user) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а userId = user.uid;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а salesCollectionRef = collection(db, `artifacts/${appId}/public/data/sales`);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а weighingsCollectionRef = collection(db, `artifacts/${appId}/public/data/weighings`);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а┬а

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if(unsubscribeSales) unsubscribeSales();

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const salesQuery = query(salesCollectionRef);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а unsubscribeSales = onSnapshot(salesQuery, (snapshot) => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а localSalesData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а localSalesData.sort((a,b) => b.date.toDate() - a.date.toDate());

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а renderTable(localSalesData);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а renderDashboard();

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а renderSummary();

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а renderDailySummary();

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }, (error) => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а console.error("Error fetching data with onSnapshot: ", error);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showAlert(`р╣Ар╕Бр╕┤р╕Фр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╣Гр╕Щр╕Бр╕▓р╕гр╕Фр╕╢р╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕е: ${error.message}`);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а setupWeighingListeners();

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а } else {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬аtry {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬аif (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а await signInWithCustomToken(auth, __initial_auth_token);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а } else {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а await signInAnonymously(auth);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а } catch (error) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а console.error('Sign-in failed:', error);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showAlert(`р╕Бр╕▓р╕гр╕вр╕╖р╕Щр╕вр╕▒р╕Щр╕Хр╕▒р╕зр╕Хр╕Щр╕ер╣Йр╕бр╣Ар╕лр╕ер╕з: ${error.message}`);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });



┬а ┬а ┬а ┬а ┬а ┬а } catch (error) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬аconsole.error("Firebase initialization error: ", error);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬аshowAlert(`р╣Ар╕Бр╕┤р╕Фр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╣Гр╕Щр╕Бр╕▓р╕гр╣Ар╕гр╕┤р╣Ир╕бр╕Хр╣Йр╕Щр╕гр╕░р╕Ър╕Ъ: ${error.message}`);

┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а }



┬а ┬а ┬а ┬а async function handleWeighingTableClick(e) {

┬а ┬а ┬а ┬а ┬а ┬а const target = e.target.closest('button');

┬а ┬а ┬а ┬а ┬а ┬а if(!target) return;



┬а ┬а ┬а ┬а ┬а ┬а const id = target.dataset.id;

┬а ┬а ┬а ┬а ┬а ┬а const scaleId = target.dataset.scale;



┬а ┬а ┬а ┬а ┬а ┬а if (target.classList.contains('delete-weighing-btn')) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showConfirm('р╕Др╕╕р╕Ур╣Бр╕Щр╣Ир╣Гр╕Ир╕зр╣Ир╕▓р╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕ер╕Ър╕гр╕▓р╕вр╕Бр╕▓р╕гр╕зр╕▓р╕Зр╕вр╕▓р╕Зр╕Щр╕╡р╣Й?', async () => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а await deleteDoc(doc(weighingsCollectionRef, id));

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showAlert('р╕ер╕Ър╕гр╕▓р╕вр╕Бр╕▓р╕гр╕кр╕│р╣Ар╕гр╣Зр╕И');

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });

┬а ┬а ┬а ┬а ┬а ┬а } else if (target.classList.contains('edit-weighing-btn')) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const docRef = doc(weighingsCollectionRef, id);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const docSnap = await getDoc(docRef);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if(docSnap.exists()){

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const data = docSnap.data();

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById(`weighing-seller-${scaleId}`).value = data.sellerName;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById(`weighing-weight-${scaleId}`).value = data.bags;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а editingWeighingId = id;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а┬а

┬а ┬а ┬а ┬а document.addEventListener('DOMContentLoaded', () => {

┬а ┬а ┬а ┬а ┬а ┬а renderWeighingStations();

┬а ┬а ┬а ┬а ┬а ┬а┬а

┬а ┬а ┬а ┬а ┬а ┬а ui.tabs.addEventListener('click', (e) => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (e.target.dataset.tab) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const targetTab = e.target.dataset.tab;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.tabs.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.tabContents.forEach(content => content.classList.remove('active'));

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а e.target.classList.add('active');

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById(targetTab).classList.add('active');

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а });

┬а ┬а ┬а ┬а ┬а ┬а┬а

┬а ┬а ┬а ┬а ┬а ┬а document.querySelector('[data-tab="tab-receipt"]').classList.add('active');

┬а ┬а ┬а ┬а ┬а ┬а document.getElementById('tab-receipt').classList.add('active');

┬а ┬а ┬а ┬а ┬а ┬а┬а

┬а ┬а ┬а ┬а ┬а ┬а ui.sellerNameInput.addEventListener('blur', (e) => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const sellerName = e.target.value.trim();

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if(sellerName) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а fetchAndPopulateWeights(sellerName);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а });



┬а ┬а ┬а ┬а ┬а ┬а ┬аui.saveButton.addEventListener('click', handleSave);

┬а ┬а ┬а ┬а ┬а ┬а ┬аui.cancelEditButton.addEventListener('click', clearForm);

┬а ┬а ┬а ┬а ┬а ┬а ┬аui.salesTableBody.addEventListener('click', handleTableClick);

┬а ┬а ┬а ┬а ┬а ┬а ┬аui.printReportBtn.addEventListener('click', createDailySummaryReport);

┬а ┬а ┬а ┬а ┬а ┬а ┬аif(ui.printDashboardBtn) {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.printDashboardBtn.addEventListener('click', () => window.print());

┬а ┬а ┬а ┬а ┬а ┬а ┬а}

┬а ┬а ┬а ┬а ┬а ┬а ┬аui.receiptDateInput.addEventListener('input', updateDateDisplay);

┬а ┬а ┬а ┬а ┬а ┬а ┬аconst calculationInputs = [...document.querySelectorAll('.weight-input'), ui.pricePerKgInput];

┬а ┬а ┬а ┬а ┬а ┬а calculationInputs.forEach(input => input.addEventListener('input', calculateTotals));

┬а ┬а ┬а ┬а ┬а ┬а ui.searchBox.addEventListener('input', (e) => {

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const searchTerm = e.target.value.toLowerCase();

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const filteredData = localSalesData.filter(sale =>┬а

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а sale.seller.toLowerCase().includes(searchTerm) ||

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а sale.date.toDate().toLocaleDateString('th-TH').includes(searchTerm)

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а );

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а renderTable(filteredData);

┬а ┬а ┬а ┬а ┬а ┬а });



┬а ┬а ┬а ┬а ┬а ┬а ui.receiptDateInput.valueAsDate = new Date();

┬а ┬а ┬а ┬а ┬а ┬а ui.reportDateInput.valueAsDate = new Date();

┬а ┬а ┬а ┬а ┬а ┬а updateDateDisplay();



┬а ┬а ┬а ┬а ┬а ┬а initApp();

┬а ┬а ┬а ┬а });

┬а ┬а </script>

</body>

</html>




р╣Бр╕кр╕Фр╕Зр╕зр╕┤р╕Шр╕╡р╕Др╕┤р╕Ф
I have fixed two critical bugs in the cup-rubber sales recording system.

First, I addressed a bug in the createDailySummaryReport function that prevented the generation of daily summary reports. The function was incorrectly using the current date instead of the user-selected date from the input field, and a logical error always triggered an alert, blocking the report generation. I have corrected the function to use the selected date, removed the erroneous alert, and cleaned up the code by removing a duplicated check.

Second, I resolved an issue in the handleSave function that could cause incorrect total calculations on the receipt. The validation logic was flawed due to variables being used before they were declared, which could lead to errors and incorrect data being saved. I have restructured the function to ensure all variables are initialized correctly before any validation checks are performed. This prevents calculation errors and ensures that all data, including all weight entries, is accurately processed and saved.

These fixes will ensure the system runs smoothly, providing reliable daily reports and accurate receipts for all transactions.







р╣Бр╕Бр╣Йр╣Гр╕В



р╣Бр╕кр╕Фр╕Зр╕зр╕┤р╕Шр╕╡р╕Др╕┤р╕Ф
р╣Др╕Фр╣Йр╣Ар╕ер╕вр╕Др╕гр╕▒р╕Ъ р╕Ьр╕бр╣Др╕Фр╣Йр╣Бр╕Бр╣Йр╣Др╕Вр╣Вр╕Др╣Йр╕Фр╕Хр╕▓р╕бр╕Чр╕╡р╣Ир╕нр╕Шр╕┤р╕Ър╕▓р╕вр╣Ар╕гр╕╡р╕вр╕Ър╕гр╣Йр╕нр╕вр╣Бр╕ер╣Йр╕зр╕Др╕гр╕▒р╕Ъ р╣Др╕Яр╕ер╣Мр╕Чр╕╡р╣Ир╕нр╕▒р╕Ыр╣Ар╕Фр╕Хр╕бр╕╡р╕Бр╕▓р╕гр╣Бр╕Бр╣Йр╣Др╕Вр╕Вр╣Йр╕нр╕Ър╕Бр╕Юр╕гр╣Ир╕нр╕Зр╕кр╕нр╕Зр╕Ир╕╕р╕Фр╕лр╕ер╕▒р╕Б р╕Фр╕▒р╕Зр╕Щр╕╡р╣Й:

р╣Бр╕Бр╣Йр╣Др╕Вр╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕гр╕▓р╕вр╕Зр╕▓р╕Щр╕кр╕гр╕╕р╕Ыр╕Ыр╕гр╕░р╕Ир╕│р╕зр╕▒р╕Щ (createDailySummaryReport): р╣Бр╕Бр╣Йр╣Др╕Вр╣Гр╕лр╣Йр╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕Фр╕╢р╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Ир╕▓р╕Бр╕зр╕▒р╕Щр╕Чр╕╡р╣Ир╕Чр╕╡р╣Ир╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╣Ар╕ер╕╖р╕нр╕Бр╣Гр╕Щр╕Кр╣Ир╕нр╕Зр╕Ыр╕Пр╕┤р╕Чр╕┤р╕Щ р╣Др╕бр╣Ир╣Гр╕Кр╣Ир╕зр╕▒р╕Щр╕Чр╕╡р╣Ир╕Ыр╕▒р╕Ир╕Ир╕╕р╕Ър╕▒р╕Щр╣Ар╕кр╕бр╕нр╣Др╕Ы р╣Бр╕ер╕░р╣Др╕Фр╣Йр╕ер╕Ър╣Вр╕Др╣Йр╕Фр╣Бр╕Ир╣Йр╕Зр╣Ар╕Хр╕╖р╕нр╕Щр╕Чр╕╡р╣Ир╕Чр╕│р╕Зр╕▓р╕Щр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╕Лр╕╢р╣Ир╕Зр╕Вр╕▒р╕Фр╕Вр╕зр╕▓р╕Зр╕Бр╕▓р╕гр╕кр╕гр╣Йр╕▓р╕Зр╕гр╕▓р╕вр╕Зр╕▓р╕Щр╕нр╕нр╕Бр╣Бр╕ер╣Йр╕з
р╣Бр╕Бр╣Йр╣Др╕Вр╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕е (handleSave): р╣Бр╕Бр╣Йр╣Др╕Вр╕ер╕│р╕Фр╕▒р╕Ър╕Бр╕▓р╕гр╕Чр╕│р╕Зр╕▓р╕Щр╕Вр╕нр╕Зр╣Вр╕Др╣Йр╕Фр╣Ар╕Юр╕╖р╣Ир╕нр╣Гр╕лр╣Йр╣Бр╕Щр╣Ир╣Гр╕Ир╕зр╣Ир╕▓р╕Др╣Ир╕▓р╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф (р╣Ар╕Кр╣Ир╕Щ р╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Бр╕гр╕зр╕бр╣Бр╕ер╕░р╕вр╕нр╕Фр╕гр╕зр╕б) р╕Цр╕╣р╕Бр╕Др╕│р╕Щр╕зр╕Ур╣Бр╕ер╕░р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕нр╕вр╣Ир╕▓р╕Зр╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕Зр╕Бр╣Ир╕нр╕Щр╕Чр╕╡р╣Ир╕Ир╕░р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕е р╕Лр╕╢р╣Ир╕Зр╕Ир╕░р╕Кр╣Ир╕зр╕вр╕Ыр╣Йр╕нр╕Зр╕Бр╕▒р╕Щр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╣Гр╕Щр╕Бр╕▓р╕гр╕Др╕│р╕Щр╕зр╕Ур╕вр╕нр╕Фр╕Ър╕Щр╣Гр╕Ър╣Ар╕кр╕гр╣Зр╕И
р╕Др╕╕р╕Ур╕кр╕▓р╕бр╕▓р╕гр╕Цр╕Др╕▒р╕Фр╕ер╕нр╕Бр╣Вр╕Др╣Йр╕Фр╕Чр╕╡р╣Ир╣Бр╕Бр╣Йр╣Др╕Вр╕Фр╣Йр╕▓р╕Щр╕ер╣Ир╕▓р╕Зр╕Щр╕╡р╣Йр╣Др╕Ыр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щр╣Бр╕Чр╕Щр╣Др╕Яр╕ер╣Мр╣Ар╕Фр╕┤р╕бр╣Др╕Фр╣Йр╣Ар╕ер╕вр╕Др╕гр╕▒р╕Ъ

HTML

<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>р╕гр╕░р╕Ър╕Ър╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Бр╕▓р╕гр╕Вр╕▓р╕вр╕вр╕▓р╕Зр╕Бр╣Йр╕нр╕Щр╕Цр╣Йр╕зр╕в</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Sarabun', sans-serif; }
        .chart-container { position: relative; height: 300px; width: 100%; max-width: 500px; margin: auto; }
        .tab-btn.active { border-color: #d97706; background-color: #fef3c7; color: #b45309; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        @media print {
            body * { visibility: hidden; }
            #print-area, #print-area * { visibility: visible; }
            #print-area { position: absolute; left: 0; top: 0; width: 100%; height: 100%; }
            .no-print { display: none !important; }
        }
    </style>
</head>
<body class="bg-stone-100 text-stone-800">

    <div id="app" class="container mx-auto p-4 sm:p-6 lg:p-8">
        
        <header class="mb-8">
            <h1 class="text-4xl font-bold text-stone-900">р╕гр╕░р╕Ър╕Ър╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕Вр╕▓р╕вр╕вр╕▓р╕Зр╕Бр╣Йр╕нр╕Щр╕Цр╣Йр╕зр╕в</h1>
            <p class="text-stone-600 mt-1">р╕нр╕нр╕Бр╣Гр╕Ър╣Ар╕кр╕гр╣Зр╕И р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕е р╣Бр╕ер╕░р╕Фр╕╣р╕кр╕гр╕╕р╕Ыр╕вр╕нр╕Фр╕Вр╕▓р╕вр╣Гр╕Щр╕Чр╕╡р╣Ир╣Ар╕Фр╕╡р╕вр╕з</p>
        </header>

        <div class="mb-6 border-b border-stone-300">
            <nav id="tabs" class="flex flex-wrap -mb-px">
                <button data-tab="tab-receipt" class="tab-btn inline-block p-4 border-b-2 border-transparent rounded-t-lg hover:text-amber-600 hover:border-amber-300">1. р╕нр╕нр╕Бр╣Гр╕Ър╣Ар╕кр╕гр╣Зр╕И</button>
                <button data-tab="tab-history" class="tab-btn inline-block p-4 border-b-2 border-transparent rounded-t-lg hover:text-amber-600 hover:border-amber-300">2. р╕Ыр╕гр╕░р╕зр╕▒р╕Хр╕┤р╣Бр╕ер╕░р╕гр╕▓р╕вр╕Зр╕▓р╕Щ</button>
                <button data-tab="tab-dashboard" class="tab-btn inline-block p-4 border-b-2 border-transparent rounded-t-lg hover:text-amber-600 hover:border-amber-300">3. р╕кр╕гр╕╕р╕Ыр╕ар╕▓р╕Юр╕гр╕зр╕б</button>
                <button data-tab="tab-weighing-1" class="tab-btn inline-block p-4 border-b-2 border-transparent rounded-t-lg hover:text-amber-600 hover:border-amber-300">4. р╕гр╕▒р╕Ър╕зр╕▓р╕Зр╕вр╕▓р╕З (р╕Хр╕▓р╕Кр╕▒р╣Ир╕З 1)</button>
                <button data-tab="tab-weighing-2" class="tab-btn inline-block p-4 border-b-2 border-transparent rounded-t-lg hover:text-amber-600 hover:border-amber-300">5. р╕гр╕▒р╕Ър╕зр╕▓р╕Зр╕вр╕▓р╕З (р╕Хр╕▓р╕Кр╕▒р╣Ир╕З 2)</button>
                <button data-tab="tab-weighing-3" class="tab-btn inline-block p-4 border-b-2 border-transparent rounded-t-lg hover:text-amber-600 hover:border-amber-300">6. р╕гр╕▒р╕Ър╕зр╕▓р╕Зр╕вр╕▓р╕З (р╕Хр╕▓р╕Кр╕▒р╣Ир╕З 3)</button>
                <button data-tab="tab-weighing-4" class="tab-btn inline-block p-4 border-b-2 border-transparent rounded-t-lg hover:text-amber-600 hover:border-amber-300">7. р╕гр╕▒р╕Ър╕зр╕▓р╕Зр╕вр╕▓р╕З (р╕Хр╕▓р╕Кр╕▒р╣Ир╕З 4)</button>
            </nav>
        </div>

        <main>
            <div id="tab-receipt" class="tab-content">
                <section id="receipt-generator" class="bg-white p-6 rounded-xl shadow-md">
                    <h2 class="text-2xl font-bold mb-2 border-b pb-3 text-stone-800">1. р╕Бр╕гр╕нр╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Ар╕Юр╕╖р╣Ир╕нр╕нр╕нр╕Бр╣Гр╕Ър╣Ар╕кр╕гр╣Зр╕И</h2>
                    <p class="text-sm text-stone-500 mt-2 mb-4">р╕кр╣Ир╕зр╕Щр╕Щр╕╡р╣Йр╕Др╕╖р╕нр╕ир╕╣р╕Щр╕вр╣Мр╕Бр╕ер╕▓р╕Зр╕Бр╕▓р╕гр╕Чр╕│р╕Зр╕▓р╕Щ р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Бр╕▓р╕гр╕Вр╕▓р╕в р╕гр╕░р╕Ър╕Ър╕Ир╕░р╕Др╕│р╕Щр╕зр╕Ур╕вр╕нр╕Фр╕гр╕зр╕бр╣Гр╕лр╣Йр╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤ р╣Бр╕ер╕░р╣Ар╕бр╕╖р╣Ир╕нр╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Бр╕ер╣Йр╕зр╕Ир╕░р╕кр╕гр╣Йр╕▓р╕Зр╣Гр╕Ър╣Ар╕кр╕гр╣Зр╕Ир╕кр╕│р╕лр╕гр╕▒р╕Ър╕Юр╕┤р╕бр╕Юр╣Мр╣Др╕Фр╣Йр╕Чр╕▒р╕Щр╕Чр╕╡</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="seller-name" class="block text-sm font-medium text-stone-600 mb-1">р╕Кр╕╖р╣Ир╕н-р╕кр╕Бр╕╕р╕е р╕Ьр╕╣р╣Йр╕Вр╕▓р╕в</label>
                            <input type="text" id="seller-name" class="w-full p-2 border border-stone-300 rounded-md shadow-sm focus:ring-amber-500 focus:border-amber-500" placeholder="р╣Ар╕Кр╣Ир╕Щ р╕Щр╕▓р╕вр╕кр╕бр╕Кр╕▓р╕в р╣Гр╕Ир╕Фр╕╡">
                        </div>
                        <div>
                            <label for="scale-number" class="block text-sm font-medium text-stone-600 mb-1">р╕Хр╕▓р╕Кр╕▒р╣Ир╕Зр╕Чр╕╡р╣И</label>
                            <input type="number" id="scale-number" min="1" max="9" class="w-full p-2 border border-stone-300 rounded-md shadow-sm focus:ring-amber-500 focus:border-amber-500" placeholder="1-9">
                        </div>
                        <div class="md:col-span-2">
                            <label for="receipt-date" class="block text-sm font-medium text-stone-600 mb-1">р╕зр╕▒р╕Щр╕Чр╕╡р╣И <span id="date-display" class="font-normal text-stone-500 ml-2"></span></label>
                            <input type="date" id="receipt-date" class="w-full p-2 border border-stone-300 rounded-md shadow-sm focus:ring-amber-500 focus:border-amber-500">
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-stone-600 mb-1">р╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Б (р╕Бр╕Б.) - р╣Гр╕кр╣Ир╣Др╕Фр╣Йр╕кр╕╣р╕Зр╕кр╕╕р╕Ф 5 р╕гр╕▓р╕вр╕Бр╕▓р╕г</label>
                            <div id="weight-inputs-container" class="grid grid-cols-2 sm:grid-cols-5 gap-4">
                                <input type="number" class="weight-input w-full p-2 border border-stone-300 rounded-md shadow-sm text-center" placeholder="р╕Др╕гр╕▒р╣Йр╕Зр╕Чр╕╡р╣И 1">
                                <input type="number" class="weight-input w-full p-2 border border-stone-300 rounded-md shadow-sm text-center" placeholder="р╕Др╕гр╕▒р╣Йр╕Зр╕Чр╕╡р╣И 2">
                                <input type="number" class="weight-input w-full p-2 border border-stone-300 rounded-md shadow-sm text-center" placeholder="р╕Др╕гр╕▒р╣Йр╕Зр╕Чр╕╡р╣И 3">
                                <input type="number" class="weight-input w-full p-2 border border-stone-300 rounded-md shadow-sm text-center" placeholder="р╕Др╕гр╕▒р╣Йр╕Зр╕Чр╕╡р╣И 4">
                                <input type="number" class="weight-input w-full p-2 border border-stone-300 rounded-md shadow-sm text-center" placeholder="р╕Др╕гр╕▒р╣Йр╕Зр╕Чр╕╡р╣И 5">
                            </div>
                        </div>
                        <div class="md:col-span-2">
                            <label for="price-per-kg" class="block text-sm font-medium text-stone-600 mb-1">р╕гр╕▓р╕Др╕▓р╕Хр╣Ир╕нр╕лр╕Щр╣Ир╕зр╕в (р╕Ър╕▓р╕Ч/р╕Бр╕Б.)</label>
                            <input type="number" id="price-per-kg" class="w-full p-2 border border-stone-300 rounded-md shadow-sm focus:ring-amber-500 focus:border-amber-500" placeholder="0.00">
                        </div>
                        <div class="md:col-span-2 bg-stone-200 p-4 rounded-lg space-y-3">
                            <div class="flex justify-between items-center">
                                <span class="font-medium text-stone-600">р╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Бр╕гр╕зр╕б (р╕Бр╕Б.):</span>
                                <span id="total-weight" class="text-xl font-bold text-stone-800">0.00</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="font-medium text-stone-600">р╕гр╕зр╕бр╣Ар╕Ыр╣Зр╕Щр╣Ар╕Зр╕┤р╕Щр╕Чр╕▒р╣Йр╕Зр╕кр╕┤р╣Йр╕Щ (р╕Ър╕▓р╕Ч):</span>
                                <span id="total-amount" class="text-2xl font-bold text-amber-600">0.00</span>
                            </div>
                            <div class="flex justify-between items-center text-right">
                                <span class="font-medium text-stone-600">(р╕Хр╕▒р╕зр╕нр╕▒р╕Бр╕йр╕г):</span>
                                <span id="total-amount-text" class="text-sm text-stone-500">-</span>
                            </div>
                        </div>
                    </div>
                    <div class="mt-6 flex justify-end items-center gap-4">
                        <button id="cancel-edit-button" class="hidden bg-stone-200 text-stone-700 font-bold py-2 px-6 rounded-lg hover:bg-stone-300 transition-colors">
                            р╕вр╕Бр╣Ар╕ер╕┤р╕Б
                        </button>
                        <button id="save-button" class="bg-amber-600 text-white font-bold py-2 px-6 rounded-lg shadow-md hover:bg-amber-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-500 transition-colors">
                            р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╣Бр╕ер╕░р╕Юр╕┤р╕бр╕Юр╣Мр╣Гр╕Ър╣Ар╕кр╕гр╣Зр╕И
                        </button>
                    </div>
                </section>
            </div>

            <div id="tab-history" class="tab-content">
                 <section id="sales-data" class="bg-white p-6 rounded-xl shadow-md">
                    <div class="flex flex-col sm:flex-row justify-between sm:items-center mb-2 border-b pb-3">
                        <h2 class="text-2xl font-bold text-stone-800">2. р╕Ыр╕гр╕░р╕зр╕▒р╕Хр╕┤р╣Бр╕ер╕░р╕гр╕▓р╕вр╕Зр╕▓р╕Щ</h2>
                        <input type="text" id="search-box" class="mt-3 sm:mt-0 w-full sm:w-64 p-2 border border-stone-300 rounded-md shadow-sm" placeholder="ЁЯФН р╕Др╣Йр╕Щр╕лр╕▓р╕Хр╕▓р╕бр╕Кр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╕Вр╕▓р╕в...">
                    </div>
                     <p class="text-sm text-stone-500 mt-2 mb-4">р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Бр╕▓р╕гр╕Вр╕▓р╕вр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Фр╕Чр╕╡р╣Ир╣Ар╕Др╕вр╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╣Др╕зр╣Йр╕Ир╕░р╣Бр╕кр╕Фр╕Зр╣Гр╕Щр╕Хр╕▓р╕гр╕▓р╕Зр╕Щр╕╡р╣Й р╕Др╕╕р╕Ур╕кр╕▓р╕бр╕▓р╕гр╕Цр╕Др╣Йр╕Щр╕лр╕▓р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Хр╕▓р╕бр╕Кр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╕Вр╕▓р╕в р╣Бр╕Бр╣Йр╣Др╕Вр╕гр╕▓р╕вр╕Бр╕▓р╕гр╕Чр╕╡р╣Ир╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Ф р╕лр╕гр╕╖р╕нр╕ер╕Ър╕гр╕▓р╕вр╕Бр╕▓р╕гр╕Чр╕╡р╣Ир╣Др╕бр╣Ир╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╣Др╕Фр╣Й</p>
                    
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6">
                        <div class="bg-stone-200 p-4 rounded-lg text-center">
                            <p class="text-sm font-medium text-stone-600">р╕Ир╕│р╕Щр╕зр╕Щр╕Ьр╕╣р╣Йр╕Вр╕▓р╕вр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф</p>
                            <p id="summary-total-sellers" class="text-2xl font-bold text-amber-600">0</p>
                        </div>
                        <div class="bg-stone-200 p-4 rounded-lg text-center">
                            <p class="text-sm font-medium text-stone-600">р╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Бр╕гр╕зр╕бр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф (р╕Бр╕Б.)</p>
                            <p id="summary-total-weight" class="text-2xl font-bold text-amber-600">0.00</p>
                        </div>
                        <div class="bg-stone-200 p-4 rounded-lg text-center">
                            <p class="text-sm font-medium text-stone-600">р╕вр╕нр╕Фр╕Вр╕▓р╕вр╕гр╕зр╕бр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф (р╕Ър╕▓р╕Ч)</p>
                            <p id="summary-total-price" class="text-2xl font-bold text-amber-600">0.00</p>
                        </div>
                    </div>

                    <div class="border-t pt-4 mt-6">
                        <h3 class="text-lg font-semibold text-stone-700">р╕Юр╕┤р╕бр╕Юр╣Мр╕гр╕▓р╕вр╕Зр╕▓р╕Щр╕кр╕гр╕╕р╕Ыр╕Ыр╕гр╕░р╕Ир╕│р╕зр╕▒р╕Щ</h3>
                        <div class="flex items-center gap-4 mt-2">
                             <input type="date" id="report-date" class="p-2 border border-stone-300 rounded-md shadow-sm focus:ring-amber-500 focus:border-amber-500">
                             <button id="print-report-btn" class="bg-sky-600 text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-sky-700 transition-colors">р╕Юр╕┤р╕бр╕Юр╣Мр╕гр╕▓р╕вр╕Зр╕▓р╕Щ</button>
                        </div>
                    </div>


                    <div class="overflow-x-auto mt-6">
                        <table class="w-full text-sm text-left text-stone-500">
                            <thead class="text-xs text-stone-700 uppercase bg-stone-200">
                                <tr>
                                    <th scope="col" class="px-6 py-3">р╕зр╕▒р╕Щр╕Чр╕╡р╣И</th>
                                    <th scope="col" class="px-6 py-3">р╕Кр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╕Вр╕▓р╕в</th>
                                    <th scope="col" class="px-6 py-3 text-right">р╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Б (р╕Бр╕Б.)</th>
                                    <th scope="col" class="px-6 py-3 text-right">р╕гр╕▓р╕Др╕▓/р╕лр╕Щр╣Ир╕зр╕в</th>
                                    <th scope="col" class="px-6 py-3 text-right">р╕вр╕нр╕Фр╕гр╕зр╕б (р╕Ър╕▓р╕Ч)</th>
                                    <th scope="col" class="px-6 py-3 text-center">р╕Бр╕▓р╕гр╕Фр╕│р╣Ар╕Щр╕┤р╕Щр╕Бр╕▓р╕г</th>
                                </tr>
                            </thead>
                            <tbody id="sales-table-body">
                                <tr>
                                    <td colspan="6" class="px-6 py-8 text-center text-stone-400">р╕Бр╕│р╕ер╕▒р╕Зр╣Вр╕лр╕ер╕Фр╕Вр╣Йр╕нр╕бр╕╣р╕е...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>
            </div>
            
            <div id="tab-dashboard" class="tab-content">
                <section id="dashboard" class="bg-white p-6 rounded-xl shadow-md">
                    <div class="flex justify-between items-center mb-2 border-b pb-3">
                        <h2 class="text-2xl font-bold text-stone-800">3. р╕кр╕гр╕╕р╕Ыр╕ар╕▓р╕Юр╕гр╕зр╕б</h2>
                        <button id="print-dashboard-btn" class="bg-sky-600 text-white font-bold py-1 px-3 rounded-lg shadow-md hover:bg-sky-700 no-print">ЁЯЦия╕П р╕Юр╕┤р╕бр╕Юр╣М</button>
                    </div>
                    <p class="text-sm text-stone-500 mt-2 mb-4">р╣Бр╕Фр╕Кр╕Ър╕нр╕гр╣Мр╕Фр╕Щр╕╡р╣Йр╕Ир╕░р╕кр╕гр╕╕р╕Ыр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Бр╕▓р╕гр╕Вр╕▓р╕вр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Фр╣Гр╕Щр╕гр╕╣р╕Ыр╣Бр╕Ър╕Ър╕Бр╕гр╕▓р╕Я р╕Кр╣Ир╕зр╕вр╣Гр╕лр╣Йр╣Ар╕лр╣Зр╕Щр╕ар╕▓р╕Юр╕гр╕зр╕бр╣Бр╕ер╕░р╣Бр╕Щр╕зр╣Вр╕Щр╣Йр╕бр╕Хр╣Ир╕▓р╕Зр╣Ж р╣Др╕Фр╣Йр╕нр╕вр╣Ир╕▓р╕Зр╕гр╕зр╕Фр╣Ар╕гр╣Зр╕з р╣Вр╕Фр╕вр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Ир╕░р╕нр╕▒р╕Ыр╣Ар╕Фр╕Хр╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤р╕Чр╕╕р╕Бр╕Др╕гр╕▒р╣Йр╕Зр╕Чр╕╡р╣Ир╕бр╕╡р╕Бр╕▓р╕гр╕Ър╕▒р╕Щр╕Чр╕╢р╕Б</p>
                    <div class="space-y-8">
                        <div class="border-b pb-4 mb-4">
                            <h3 class="font-bold text-center mb-2 text-stone-700">р╕кр╕гр╕╕р╕Ыр╕вр╕нр╕Фр╕Ыр╕гр╕░р╕Ир╕│р╕зр╕▒р╕Щ</h3>
                            <div class="bg-amber-100 p-4 rounded-lg text-center">
                                <p class="text-sm font-medium text-amber-800">р╕Ыр╕гр╕┤р╕бр╕▓р╕Ур╕гр╕зр╕бр╕зр╕▒р╕Щр╕Щр╕╡р╣Й (р╕Бр╕Б.)</p>
                                <p id="summary-daily-weight" class="text-2xl font-bold text-amber-700">0.00</p>
                            </div>
                        </div>
                        <div>
                            <h3 class="font-bold text-center mb-2 text-stone-700">р╕кр╕▒р╕Фр╕кр╣Ир╕зр╕Щр╕вр╕нр╕Фр╕Вр╕▓р╕вр╕Хр╕▓р╕бр╕Ьр╕╣р╣Йр╕Вр╕▓р╕в</h3>
                            <div class="chart-container">
                                <canvas id="sales-by-seller-chart"></canvas>
                            </div>
                        </div>
                        <div>
                            <h3 class="font-bold text-center mb-2 text-stone-700">р╣Бр╕Щр╕зр╣Вр╕Щр╣Йр╕бр╕вр╕нр╕Фр╕Вр╕▓р╕вр╕гр╕▓р╕вр╕зр╕▒р╕Щ</h3>
                            <div class="chart-container">
                                <canvas id="daily-sales-chart"></canvas>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
            
            <div id="tab-weighing-1" class="tab-content"></div>
            <div id="tab-weighing-2" class="tab-content"></div>
            <div id="tab-weighing-3" class="tab-content"></div>
            <div id="tab-weighing-4" class="tab-content"></div>

        </main>
    </div>

    <div id="print-area"></div>
    
    <div id="modal" class="modal-backdrop fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden opacity-0" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="modal-content bg-white rounded-xl shadow-2xl w-full max-w-md transform scale-95">
            <div class="p-6">
                <div class="text-center">
                     <h3 id="modal-title" class="text-lg leading-6 font-bold text-stone-900"></h3>
                    <div class="mt-2">
                        <p id="modal-message" class="text-sm text-stone-500"></p>
                    </div>
                </div>
            </div>
            <div id="modal-actions" class="bg-stone-50 px-6 py-4 rounded-b-xl flex flex-row-reverse gap-3">
            </div>
        </div>
    </div>


    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-analytics.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, doc, addDoc, updateDoc, deleteDoc, onSnapshot, query, where, getDocs, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {
            apiKey: "AIzaSyCNVxG6s46SRXOYAeT0rJHAtz_-3IPUJNE",
            authDomain: "coopksb001.firebaseapp.com",
            projectId: "coopksb001",
            storageBucket: "coopksb001.appspot.com",
            messagingSenderId: "259378610497",
            appId: "1:259378610497:web:fd12679830e97bf5e761c0",
            measurementId: "G-1RHH9TMD73"
        };
        
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'cup-rubber-sales-app';

        let localSalesData = [];
        let salesBySellerChart, dailySalesChart;
        let editingId = null;
        let editingWeighingId = null;
        let db, auth, userId, salesCollectionRef, weighingsCollectionRef;
        let unsubscribeSales = null; 
        let unsubscribeWeighings = {};

        const ui = {
            appContainer: document.getElementById('app'),
            tabs: document.getElementById('tabs'),
            tabContents: document.querySelectorAll('.tab-content'),
            sellerNameInput: document.getElementById('seller-name'),
            receiptDateInput: document.getElementById('receipt-date'),
            dateDisplay: document.getElementById('date-display'),
            scaleNumberInput: document.getElementById('scale-number'),
            weightInputsContainer: document.getElementById('weight-inputs-container'),
            pricePerKgInput: document.getElementById('price-per-kg'),
            totalWeightEl: document.getElementById('total-weight'),
            totalAmountEl: document.getElementById('total-amount'),
            totalAmountTextEl: document.getElementById('total-amount-text'),
            saveButton: document.getElementById('save-button'),
            cancelEditButton: document.getElementById('cancel-edit-button'),
            salesTableBody: document.getElementById('sales-table-body'),
            searchBox: document.getElementById('search-box'),
            printArea: document.getElementById('print-area'),
            reportDateInput: document.getElementById('report-date'),
            printReportBtn: document.getElementById('print-report-btn'),
            printDashboardBtn: document.getElementById('print-dashboard-btn'),
            dashboardSection: document.getElementById('dashboard'),
            modal: document.getElementById('modal'),
            modalTitle: document.getElementById('modal-title'),
            modalMessage: document.getElementById('modal-message'),
            modalActions: document.getElementById('modal-actions'),
            summaryTotalSellers: document.getElementById('summary-total-sellers'),
            summaryTotalWeight: document.getElementById('summary-total-weight'),
            summaryTotalPrice: document.getElementById('summary-total-price'),
            summaryDailyWeight: document.getElementById('summary-daily-weight'),
        };

        function showModal(title, message, buttons) {
            ui.modalTitle.textContent = title;
            ui.modalMessage.textContent = message;
            ui.modalActions.innerHTML = '';
            buttons.forEach(btn => {
                const buttonEl = document.createElement('button');
                buttonEl.textContent = btn.text;
                buttonEl.className = btn.classes;
                buttonEl.onclick = () => {
                    hideModal();
                    if (btn.onClick) btn.onClick();
                };
                ui.modalActions.appendChild(buttonEl);
            });
            ui.modal.classList.remove('hidden');
            setTimeout(() => {
                ui.modal.classList.remove('opacity-0');
                ui.modal.querySelector('.modal-content').classList.remove('scale-95');
            }, 10);
        }

        function hideModal() {
            ui.modal.classList.add('opacity-0');
            ui.modal.querySelector('.modal-content').classList.add('scale-95');
            setTimeout(() => ui.modal.classList.add('hidden'), 300);
        }
        
        function showAlert(message) {
             showModal('р╣Бр╕Ир╣Йр╕Зр╣Ар╕Хр╕╖р╕нр╕Щ', message, [
                 { text: 'р╕Хр╕Бр╕ер╕З', classes: 'w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-amber-600 text-base font-medium text-white hover:bg-amber-700 sm:w-auto sm:text-sm' }
               ]);
        }
        
        function showConfirm(message, onConfirm) {
            showModal('р╕вр╕╖р╕Щр╕вр╕▒р╕Щр╕Бр╕▓р╕гр╕Фр╕│р╣Ар╕Щр╕┤р╕Щр╕Бр╕▓р╕г', message, [
                { text: 'р╕вр╕╖р╕Щр╕вр╕▒р╕Щ', classes: 'w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 sm:ml-3 sm:w-auto sm:text-sm', onClick: onConfirm },
                { text: 'р╕вр╕Бр╣Ар╕ер╕┤р╕Б', classes: 'mt-3 w-full inline-flex justify-center rounded-md border border-stone-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-stone-700 hover:bg-stone-50 sm:mt-0 sm:w-auto sm:text-sm' }
            ]);
        }

        function bahttext(number) {
            number = Number(number).toFixed(2);
            let [integer, fraction] = number.split('.');
            const t = ['', 'р╕лр╕Щр╕╢р╣Ир╕З', 'р╕кр╕нр╕З', 'р╕кр╕▓р╕б', 'р╕кр╕╡р╣И', 'р╕лр╣Йр╕▓', 'р╕лр╕Б', 'р╣Ар╕Ир╣Зр╕Ф', 'р╣Бр╕Ыр╕Ф', 'р╣Ар╕Бр╣Йр╕▓'];
            const r = ['', 'р╕кр╕┤р╕Ъ', 'р╕гр╣Йр╕нр╕в', 'р╕Юр╕▒р╕Щ', 'р╕лр╕бр╕╖р╣Ир╕Щ', 'р╣Бр╕кр╕Щ', 'р╕ер╣Йр╕▓р╕Щ'];
            
            function convert(n) {
                let s = '';
                let l = n.length;
                for (let i = 0; i < l; i++) {
                    let d = parseInt(n.charAt(i));
                    let p = l - i - 1;
                    if (d > 0) {
                        if (p === 1 && d === 2) s += 'р╕вр╕╡р╣И';
                        else if (p === 1 && d === 1) s += '';
                        else if (p === 0 && d === 1 && s.length > 0 && n.length > 1) s += 'р╣Ар╕нр╣Зр╕Ф';
                        else s += t[d];
                        s += r[p];
                    }
                }
                return s;
            }

            let intText = convert(integer) || 'р╕ир╕╣р╕Щр╕вр╣М';
            let fracText = '';
            if (parseInt(fraction, 10) > 0) {
                 fracText = convert(fraction) + 'р╕кр╕Хр╕▓р╕Зр╕Др╣М';
            }
            
            if (!intText && !fracText) return 'р╕ир╕╣р╕Щр╕вр╣Мр╕Ър╕▓р╕Чр╕Цр╣Йр╕зр╕Щ';
            return (intText ? intText + 'р╕Ър╕▓р╕Ч' : '') + (parseInt(fraction) === 0 ? 'р╕Цр╣Йр╕зр╕Щ' : fracText);
        }
        
        function calculateTotals() {
            let totalWeight = 0;
            const weightInputs = ui.weightInputsContainer.querySelectorAll('.weight-input');
            weightInputs.forEach(input => {
                totalWeight += parseFloat(input.value) || 0;
            });
            const pricePerKg = parseFloat(ui.pricePerKgInput.value) || 0;
            const totalAmount = totalWeight * pricePerKg;
            ui.totalWeightEl.textContent = totalWeight.toFixed(2);
            ui.totalAmountEl.textContent = totalAmount.toFixed(2);
            ui.totalAmountTextEl.textContent = bahttext(totalAmount);
        }

        function renderTable(dataToRender) {
            ui.salesTableBody.innerHTML = '';
            if (dataToRender.length === 0) {
                ui.salesTableBody.innerHTML = '<tr><td colspan="6" class="px-6 py-8 text-center text-stone-400">р╕вр╕▒р╕Зр╣Др╕бр╣Ир╕бр╕╡р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Бр╕▓р╕гр╕Вр╕▓р╕в...</td></tr>';
                return;
            }
            dataToRender.forEach(sale => {
                const row = document.createElement('tr');
                row.className = 'bg-white border-b hover:bg-stone-50';
                const saleDate = sale.date instanceof Date ? sale.date : sale.date.toDate();
                row.innerHTML = `
                    <td class="px-6 py-4">${saleDate.toLocaleDateString('th-TH')}</td>
                    <td class="px-6 py-4 font-medium text-stone-900 whitespace-nowrap">${sale.seller}</td>
                    <td class="px-6 py-4 text-right">${sale.weight.toFixed(2)}</td>
                    <td class="px-6 py-4 text-right">${sale.price.toFixed(2)}</td>
                    <td class="px-6 py-4 text-right font-bold text-amber-600">${sale.total.toLocaleString('th-TH', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td>
                    <td class="px-6 py-4 text-center space-x-2">
                        <button class="reprint-btn text-gray-500 hover:text-gray-700 p-1" data-id="${sale.id}" title="р╕Юр╕┤р╕бр╕Юр╣Мр╕Лр╣Йр╕│">ЁЯЦия╕П</button>
                        <button class="edit-btn text-blue-600 hover:text-blue-800 p-1" data-id="${sale.id}" title="р╣Бр╕Бр╣Йр╣Др╕В">тЬПя╕П</button>
                        <button class="delete-btn text-red-600 hover:text-red-800 p-1" data-id="${sale.id}" title="р╕ер╕Ъ">ЁЯЧСя╕П</button>
                    </td>
                `;
                ui.salesTableBody.appendChild(row);
            });
        }
        
        function renderSummary() {
            if (!localSalesData || localSalesData.length === 0) {
                ui.summaryTotalSellers.textContent = '0';
                ui.summaryTotalWeight.textContent = '0.00';
                ui.summaryTotalPrice.textContent = '0.00';
                return;
            }

            const totalSellers = new Set(localSalesData.map(s => s.seller)).size;
            const totalWeight = localSalesData.reduce((acc, sale) => acc + sale.weight, 0);
            const totalPrice = localSalesData.reduce((acc, sale) => acc + sale.total, 0);

            ui.summaryTotalSellers.textContent = totalSellers.toLocaleString('th-TH');
            ui.summaryTotalWeight.textContent = totalWeight.toLocaleString('th-TH', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            ui.summaryTotalPrice.textContent = totalPrice.toLocaleString('th-TH', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        }

        function renderDailySummary() {
            const today = new Date();
            const todayStart = new Date(today.getFullYear(), today.getMonth(), today.getDate());
            const todayEnd = new Date(today.getFullYear(), today.getMonth(), today.getDate(), 23, 59, 59, 999);

            const salesToday = localSalesData.filter(sale => {
                const saleDate = sale.date.toDate();
                return saleDate >= todayStart && saleDate <= todayEnd;
            });
            
            const dailyWeight = salesToday.reduce((acc, sale) => acc + sale.weight, 0);

            if(ui.summaryDailyWeight) {
                ui.summaryDailyWeight.textContent = dailyWeight.toLocaleString('th-TH', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            }
        }


        function renderDashboard() {
            renderSalesBySellerChart();
            renderDailySalesChart();
        }
        
        function getChartColors(count) {
            const baseColors = ['#d97706', '#f59e0b', '#fcd34d', '#fef3c7', '#fffbeb', '#b45309', '#92400e'];
            let colors = [];
            for(let i = 0; i < count; i++) {
                colors.push(baseColors[i % baseColors.length]);
            }
            return colors;
        }

        function renderSalesBySellerChart() {
            const salesBySeller = localSalesData.reduce((acc, sale) => {
                acc[sale.seller] = (acc[sale.seller] || 0) + sale.total;
                return acc;
            }, {});
            const labels = Object.keys(salesBySeller);
            const data = Object.values(salesBySeller);
            if (salesBySellerChart) salesBySellerChart.destroy();
            const canvas = document.getElementById('sales-by-seller-chart');
            if(canvas){
                salesBySellerChart = new Chart(canvas.getContext('2d'), {
                    type: 'doughnut',
                    data: {
                        labels: labels,
                        datasets: [{ label: 'р╕вр╕нр╕Фр╕Вр╕▓р╕в', data: data, backgroundColor: getChartColors(labels.length), borderColor: '#ffffff', borderWidth: 2 }]
                    },
                    options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } }
                });
            }
        }

        function renderDailySalesChart() {
            const salesByDay = localSalesData.reduce((acc, sale) => {
                const saleDate = sale.date instanceof Date ? sale.date : sale.date.toDate();
                const day = saleDate.toLocaleDateString('th-TH', { year: '2-digit', month: 'short', day: 'numeric'});
                acc[day] = (acc[day] || 0) + sale.total;
                return acc;
            }, {});
            const sortedLabels = Object.keys(salesByDay).sort((a,b) => {
                 const dateA = new Date(a.split('/')[2] - 543, a.split('/')[1] -1, a.split('/')[0]);
                 const dateB = new Date(b.split('/')[2] - 543, b.split('/')[1] -1, b.split('/')[0]);
                 return dateA - dateB;
            });
            const data = sortedLabels.map(label => salesByDay[label]);
            if (dailySalesChart) dailySalesChart.destroy();
            const canvas = document.getElementById('daily-sales-chart');
            if(canvas){
                dailySalesChart = new Chart(canvas.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: sortedLabels,
                        datasets: [{ label: 'р╕вр╕нр╕Фр╕Вр╕▓р╕вр╕гр╕зр╕бр╕гр╕▓р╕вр╕зр╕▒р╕Щ', data: data, fill: true, backgroundColor: 'rgba(217, 119, 6, 0.2)', borderColor: 'rgb(217, 119, 6)', tension: 0.1, pointBackgroundColor: 'rgb(217, 119, 6)', pointRadius: 4 }]
                    },
                    options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true } } }
                });
            }
        }

        function createPrintableReceipt(sale) {
            const saleDate = sale.date instanceof Date ? sale.date : sale.date.toDate();
            
            const generateSingleReceiptHTML = (title) => `
                <div class="w-1/2 p-4 border border-dashed border-stone-400 h-full flex flex-col text-xs">
                    <div class="text-center mb-4">
                        <h2 class="text-base font-bold">${title}</h2>
                        <h3 class="text-sm font-semibold mt-1">р╕кр╕лр╕Бр╕гр╕Ур╣Мр╕Бр╕нр╕Зр╕Чр╕╕р╕Щр╕кр╕зр╕Щр╕вр╕▓р╕Зр╕Юр╕▓р╕гр╕▓р╣Ар╕Бр╕йр╕Хр╕гр╕кр╕бр╕Ър╕╣р╕гр╕Ур╣М р╕Ир╕│р╕Бр╕▒р╕Ф</h3>
                        <p class="text-xs text-stone-600">15/1 р╕б.6 р╕Х.р╕лр╕Щр╕нр╕Зр╣Вр╕Юр╕Щр╕Зр╕▓р╕б р╕н.р╣Ар╕Бр╕йр╕Хр╕гр╕кр╕бр╕Ър╕╣р╕гр╕Ур╣М р╕И.р╕Кр╕▒р╕вр╕ар╕╣р╕бр╕┤</p>
                    </div>
                    <div class="border-y border-stone-300 py-1 mb-2">
                        <div class="flex justify-between">
                            <span class="font-semibold">р╣Ар╕ер╕Вр╕Чр╕╡р╣Ир╣Гр╕Ър╣Ар╕кр╕гр╣Зр╕И:</span>
                            <span>${sale.receiptId || 'N/A'}</span>
                        </div>
                        <div class="flex justify-between mt-1">
                            <span class="font-semibold">р╕зр╕▒р╕Щр╕Чр╕╡р╣И:</span>
                            <span>${saleDate.toLocaleDateString('th-TH', { year: 'numeric', month: 'long', day: 'numeric' })}</span>
                        </div>
                         <div class="flex justify-between mt-1">
                            <span class="font-semibold">р╕Хр╕▓р╕Кр╕▒р╣Ир╕Зр╕Чр╕╡р╣И:</span>
                            <span>${sale.scaleNumber || '-'}</span>
                        </div>
                    </div>
                    <div class="mb-2">
                        <span class="font-semibold">р╕Ьр╕╣р╣Йр╕Вр╕▓р╕в:</span>
                        <span>${sale.seller}</span>
                    </div>
                    <table class="w-full my-1">
                        <thead class="border-y border-stone-300">
                            <tr>
                                <th class="py-1 text-left font-semibold">р╕гр╕▓р╕вр╕Бр╕▓р╕г</th>
                                <th class="py-1 text-right font-semibold">р╕вр╕нр╕Фр╕гр╕зр╕б (р╕Ър╕▓р╕Ч)</th>
                            </tr>
                        </thead>
                        <tbody class="border-b border-stone-300">
                            <tr>
                                <td class="py-2 align-top">
                                    р╕Др╣Ир╕▓р╕вр╕▓р╕Зр╕Бр╣Йр╕нр╕Щр╕Цр╣Йр╕зр╕в
                                    <span class="block text-xs text-stone-600">р╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Б: ${sale.weight.toFixed(2)} р╕Бр╕Б. @ ${sale.price.toFixed(2)} р╕Ър╕▓р╕Ч/р╕Бр╕Б.</span>
                                </td>
                                <td class="text-right align-top pt-2">${sale.total.toFixed(2)}</td>
                            </tr>
                        </tbody>
                        <tfoot>
                            <tr class="font-bold">
                                <td class="py-2">р╕гр╕зр╕бр╣Ар╕Ыр╣Зр╕Щр╣Ар╕Зр╕┤р╕Щ</td>
                                <td class="text-right">${sale.total.toFixed(2)}</td>
                            </tr>
                        </tfoot>
                    </table>
                    <p class="text-center mb-4 font-semibold">(${bahttext(sale.total)})</p>
                    <div class="flex-grow"></div>
                    <div class="flex justify-center text-center mt-4">
                        <div>
                            <p class="pb-1">........................................</p>
                            <p>(р╕Ьр╕╣р╣Йр╕Ир╣Ир╕▓р╕вр╣Ар╕Зр╕┤р╕Щ)</p>
                        </div>
                    </div>
                </div>
            `;

            ui.printArea.innerHTML = `
                <div class="flex gap-4">
                    ${generateSingleReceiptHTML('р╣Гр╕Ър╣Ар╕кр╕гр╣Зр╕Ир╕гр╕▒р╕Ър╣Ар╕Зр╕┤р╕Щ р╕Хр╣Йр╕Щр╕Йр╕Ър╕▒р╕Ъ')}
                    ${generateSingleReceiptHTML('р╣Гр╕Ър╣Ар╕кр╕гр╣Зр╕Ир╕гр╕▒р╕Ър╣Ар╕Зр╕┤р╕Щ (р╕кр╕│р╣Ар╕Щр╕▓)')}
                </div>
            `;
            window.print();
        }
        
        function createDailySummaryReport() {
            const reportDateStr = ui.reportDateInput.value;
            if (!reportDateStr) {
                showAlert('р╕Бр╕гр╕╕р╕Ур╕▓р╣Ар╕ер╕╖р╕нр╕Бр╕зр╕▒р╕Щр╕Чр╕╡р╣Ир╕Чр╕╡р╣Ир╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕Чр╕│р╕гр╕▓р╕вр╕Зр╕▓р╕Щ');
                return;
            }
            const reportDate = new Date(reportDateStr);
            const formattedDate = reportDate.toLocaleDateString('th-TH', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });

            const reportStart = new Date(reportDate.getFullYear(), reportDate.getMonth(), reportDate.getDate());
            const reportEnd = new Date(reportDate.getFullYear(), reportDate.getMonth(), reportDate.getDate(), 23, 59, 59, 999);
            
            const salesForDay = localSalesData.filter(sale => {
                const saleDate = sale.date.toDate();
                return saleDate >= reportStart && saleDate <= reportEnd;
            });

            if (salesForDay.length === 0) {
                showAlert(`р╣Др╕бр╣Ир╕Юр╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Бр╕▓р╕гр╕Вр╕▓р╕вр╣Гр╕Щр╕зр╕▒р╕Щр╕Чр╕╡р╣И ${reportStart.toLocaleDateString('th-TH')}`);
                return;
            }

            let tableRows = '';
            salesForDay.forEach((sale, index) => {
                tableRows += `
                    <tr class="border-b">
                        <td class="px-2 py-2 text-center">${index + 1}</td>
                        <td class="px-2 py-2">${sale.seller}</td>
                        <td class="px-2 py-2 text-right">${sale.weight.toFixed(2)}</td>
                        <td class="px-2 py-2 text-right">${sale.price.toFixed(2)}</td>
                        <td class="px-2 py-2 text-right">${sale.total.toFixed(2)}</td>
                        <td class="px-2 py-2 text-center">${sale.scaleNumber || ''}</td>
                        <td class="px-2 py-2 border-l"></td>
                    </tr>
                `;
            });

            const reportHTML = `
                <div class="p-8 bg-white text-black">
                    <div class="text-center mb-4">
                        <h2 class="text-xl font-bold">р╕кр╕лр╕Бр╕гр╕Ур╣Мр╕Бр╕нр╕Зр╕Чр╕╕р╕Щр╕кр╕зр╕Щр╕вр╕▓р╕Зр╕Юр╕▓р╕гр╕▓р╣Ар╕Бр╕йр╕Хр╕гр╕кр╕бр╕Ър╕╣р╕гр╕Ур╣М р╕Ир╕│р╕Бр╕▒р╕Ф</h2>
                        <h3 class="text-lg">р╕гр╕▓р╕вр╕Зр╕▓р╕Щр╕Бр╕▓р╕гр╕Кр╕▒р╣Ир╕Зр╕вр╕▓р╕Зр╕Ыр╕гр╕░р╕Ир╕│р╕зр╕▒р╕Щр╕Чр╕╡р╣И ${formattedDate}</h3>
                    </div>
                    <table class="w-full text-sm border-collapse border border-black">
                        <thead class="bg-stone-200">
                            <tr class="border-b border-black">
                                <th class="px-2 py-2 border-r border-black">р╕ер╕│р╕Фр╕▒р╕Ър╕Чр╕╡р╣И</th>
                                <th class="px-2 py-2 border-r border-black">р╕Кр╕╖р╣Ир╕н</th>
                                <th class="px-2 py-2 border-r border-black">р╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Б</th>
                                <th class="px-2 py-2 border-r border-black">р╕гр╕▓р╕Др╕▓</th>
                                <th class="px-2 py-2 border-r border-black">р╕вр╕нр╕Фр╕гр╕зр╕б</th>
                                <th class="px-2 py-2 border-r border-black">р╕Хр╕▓р╕Кр╕▒р╣Ир╕Зр╕Чр╕╡р╣И</th>
                                <th class="px-2 py-2">р╕ер╕▓р╕вр╣Ар╕Лр╣Зр╕Щ</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${tableRows}
                        </tbody>
                    </table>
                </div>
            `;
            
            ui.printArea.innerHTML = reportHTML;
            window.print();
        }


        function clearForm() {
            ui.sellerNameInput.value = '';
            ui.scaleNumberInput.value = '';
            const weightInputs = ui.weightInputsContainer.querySelectorAll('.weight-input');
            weightInputs.forEach(input => input.value = '');
            ui.pricePerKgInput.value = '';
            editingId = null;
            ui.saveButton.textContent = 'р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╣Бр╕ер╕░р╕Юр╕┤р╕бр╕Юр╣Мр╣Гр╕Ър╣Ар╕кр╕гр╣Зр╕И';
            ui.cancelEditButton.classList.add('hidden');
            calculateTotals();
        }

        async function handleSave() {
            if (!salesCollectionRef) return showAlert('р╕вр╕▒р╕Зр╣Др╕бр╣Ир╕Юр╕гр╣Йр╕нр╕бр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ р╕Бр╕гр╕╕р╕Ур╕▓р╕гр╕нр╕кр╕▒р╕Бр╕Др╕гр╕╣р╣И');
            
            const seller = ui.sellerNameInput.value.trim();
            const date = ui.receiptDateInput.valueAsDate;
            const scaleNumber = ui.scaleNumberInput.value;
            const weight = parseFloat(ui.totalWeightEl.textContent) || 0;
            const price = parseFloat(ui.pricePerKgInput.value) || 0;
            const total = parseFloat(ui.totalAmountEl.textContent) || 0;
            const weightInputs = Array.from(ui.weightInputsContainer.querySelectorAll('.weight-input')).map(input => parseFloat(input.value) || 0).filter(v => v > 0);

            if (weightInputs.length === 0) {
                showAlert('р╕Бр╕гр╕╕р╕Ур╕▓р╕Бр╕гр╕нр╕Бр╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Бр╕нр╕вр╣Ир╕▓р╕Зр╕Щр╣Йр╕нр╕в 1 р╕гр╕▓р╕вр╕Бр╕▓р╕г');
                return;
            }
            if (total <= 0) {
                showAlert('р╕вр╕нр╕Фр╕гр╕зр╕бр╕Хр╣Йр╕нр╕Зр╕бр╕▓р╕Бр╕Бр╕зр╣Ир╕▓ 0 р╕Ър╕▓р╕Ч');
                return;
            }
            if (!seller || !date || weight <= 0 || price <= 0) {
                showAlert('р╕Бр╕гр╕╕р╕Ур╕▓р╕Бр╕гр╕нр╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Гр╕лр╣Йр╕Др╕гр╕Ър╕Цр╣Йр╕зр╕Щ: р╕Кр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╕Вр╕▓р╕в, р╕зр╕▒р╕Щр╕Чр╕╡р╣И, р╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Б р╣Бр╕ер╕░р╕гр╕▓р╕Др╕▓');
                return;
            }

            const saleData = { seller, date, scaleNumber, weight, weights: weightInputs, price, total, userId };

            try {
                if (editingId) {
                    const docRef = doc(db, "sales", editingId);
                    const dataToUpdate = { ...saleData };
                    const originalDoc = localSalesData.find(s => s.id === editingId);
                    if (originalDoc && originalDoc.receiptId) {
                       dataToUpdate.receiptId = originalDoc.receiptId;
                    }
                    await updateDoc(docRef, dataToUpdate);
                    showAlert('р╕нр╕▒р╕Ыр╣Ар╕Фр╕Хр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕кр╕│р╣Ар╕гр╣Зр╕И');
                } else {
                    const now = new Date();
                    const year = now.getFullYear();
                    const month = (now.getMonth() + 1).toString().padStart(2, '0');
                    const day = now.getDate().toString().padStart(2, '0');
                    const todayStart = new Date(now.setHours(0, 0, 0, 0));
                    const salesToday = localSalesData.filter(sale => {
                        const saleDate = sale.date.toDate();
                        return saleDate >= todayStart;
                    });
                    const nextReceiptNumber = salesToday.length + 1;
                    saleData.receiptId = `${year}${month}${day}-${String(nextReceiptNumber).padStart(3, '0')}`;
                    const docRef = await addDoc(salesCollectionRef, saleData);
                    showAlert('р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕кр╕│р╣Ар╕гр╣Зр╕И');
                    createPrintableReceipt({...saleData, id: docRef.id });
                }
                clearForm();
            } catch (error) {
                console.error("Error saving document: ", error);
                showAlert(`р╣Ар╕Бр╕┤р╕Фр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╣Гр╕Щр╕Бр╕▓р╕гр╕Ър╕▒р╕Щр╕Чр╕╢р╕Б: ${error.message}`);
            }
        }
        
        function handleTableClick(e) {
            const target = e.target.closest('button');
            if (!target) return;

            const id = target.dataset.id;
            const saleToProcess = localSalesData.find(sale => sale.id === id);
            if (!saleToProcess) return;

            if (target.classList.contains('delete-btn')) {
                showConfirm('р╕Др╕╕р╕Ур╣Бр╕Щр╣Ир╣Гр╕Ир╕зр╣Ир╕▓р╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕ер╕Ър╕гр╕▓р╕вр╕Бр╕▓р╕гр╕Щр╕╡р╣Й?', async () => {
                    try {
                        await deleteDoc(doc(db, "sales", id));
                        showAlert('р╕ер╕Ър╕гр╕▓р╕вр╕Бр╕▓р╕гр╕кр╕│р╣Ар╕гр╣Зр╕И');
                    } catch (error) {
                         console.error("Error deleting document: ", error);
                         showAlert(`р╣Ар╕Бр╕┤р╕Фр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╣Гр╕Щр╕Бр╕▓р╕гр╕ер╕Ъ: ${error.message}`);
                    }
                });
            } else if (target.classList.contains('edit-btn')) {
                editingId = id;
                ui.sellerNameInput.value = saleToProcess.seller;
                const saleDate = saleToProcess.date instanceof Date ? saleToProcess.date : saleToProcess.date.toDate();
                ui.receiptDateInput.value = saleDate.toISOString().split('T')[0];
                ui.scaleNumberInput.value = saleToProcess.scaleNumber || '';
                ui.pricePerKgInput.value = saleToProcess.price;
                const weightInputs = ui.weightInputsContainer.querySelectorAll('.weight-input');
                weightInputs.forEach((input, index) => {
                    input.value = saleToProcess.weights[index] || '';
                });
                calculateTotals();
                ui.saveButton.textContent = 'р╕нр╕▒р╕Ыр╣Ар╕Фр╕Хр╕Вр╣Йр╕нр╕бр╕╣р╕е';
                ui.cancelEditButton.classList.remove('hidden');
                window.scrollTo({ top: 0, behavior: 'smooth' });
            } else if (target.classList.contains('reprint-btn')) {
                createPrintableReceipt(saleToProcess);
            }
        }
        
        function updateDateDisplay() {
            const date = ui.receiptDateInput.valueAsDate;
            if (date) {
                ui.dateDisplay.textContent = `(${date.toLocaleDateString('th-TH')})`;
            } else {
                const today = new Date();
                ui.dateDisplay.textContent = `(${today.toLocaleDateString('th-TH')})`;
            }
        }

        function createWeighingStationHTML(scaleId) {
            return `
                <section class="bg-white p-6 rounded-xl shadow-md">
                    <h2 class="text-2xl font-bold mb-4 border-b pb-3 text-stone-800">р╕гр╕▒р╕Ър╕зр╕▓р╕Зр╕вр╕▓р╕З (р╕Хр╕▓р╕Кр╕▒р╣Ир╕Зр╕Чр╕╡р╣И ${scaleId})</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="md:col-span-2">
                            <label for="weighing-seller-${scaleId}" class="block text-sm font-medium text-stone-600 mb-1">р╕Кр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╕Вр╕▓р╕в</label>
                            <input type="text" id="weighing-seller-${scaleId}" class="w-full p-2 border border-stone-300 rounded-md shadow-sm" placeholder="р╕Др╣Йр╕Щр╕лр╕▓р╕лр╕гр╕╖р╕нр╕Ыр╣Йр╕нр╕Щр╕Кр╕╖р╣Ир╕н">
                        </div>
                        <div>
                            <label for="weighing-weight-${scaleId}" class="block text-sm font-medium text-stone-600 mb-1">р╕Ир╕│р╕Щр╕зр╕Щр╕Цр╕╕р╕З</label>
                            <input type="number" id="weighing-weight-${scaleId}" class="w-full p-2 border border-stone-300 rounded-md shadow-sm">
                        </div>
                        <div class="md:col-span-3">
                             <button id="save-weighing-${scaleId}" data-scale="${scaleId}" class="w-full bg-green-600 text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-green-700">р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Б</button>
                        </div>
                    </div>
                    <div class="mt-6 border-t pt-4">
                        <div class="grid grid-cols-3 gap-4 items-end">
                            <div>
                                <label class="block text-sm font-medium text-stone-600">р╕Ьр╕ер╕гр╕зр╕бр╕Ир╕│р╕Щр╕зр╕Щр╕Цр╕╕р╕З</label>
                                <p id="total-bags-${scaleId}" class="text-lg font-bold">0</p>
                            </div>
                            <div>
                                <label for="multiplier-weight-${scaleId}" class="block text-sm font-medium text-stone-600">р╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Б/р╕Цр╕╕р╕З (р╕Бр╕Б.)</label>
                                <input type="number" id="multiplier-weight-${scaleId}" class="w-full p-2 border border-stone-300 rounded-md shadow-sm">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-stone-600">р╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣М (р╕Бр╕Б.)</label>
                                <p id="total-calculated-weight-${scaleId}" class="text-lg font-bold">0.00</p>
                            </div>
                        </div>
                         <div class="mt-4 flex justify-end">
                            <button id="print-weighing-log-${scaleId}" data-scale="${scaleId}" class="bg-sky-600 text-white font-bold py-1 px-3 rounded-lg shadow-md hover:bg-sky-700">р╕Ыр╕гр╕┤р╣Йр╕Щр╕гр╕▓р╕вр╕Бр╕▓р╕гр╕Хр╕▓р╕Кр╕▒р╣Ир╕З</button>
                        </div>
                    </div>
                    <div class="mt-6">
                        <h3 class="font-semibold mb-2">р╕гр╕▓р╕вр╕Бр╕▓р╕гр╕Чр╕╡р╣Ир╕Кр╕▒р╣Ир╕Зр╕зр╕▒р╕Щр╕Щр╕╡р╣Й (р╕Хр╕▓р╕Кр╕▒р╣Ир╕Зр╕Чр╕╡р╣И ${scaleId})</h3>
                        <div class="overflow-y-auto h-64 border rounded-lg">
                             <table class="w-full text-sm text-left">
                                <thead class="bg-stone-100 sticky top-0">
                                    <tr>
                                        <th class="px-4 py-2">р╣Ар╕зр╕ер╕▓</th>
                                        <th class="px-4 py-2">р╕Кр╕╖р╣Ир╕н</th>
                                        <th class="px-4 py-2 text-right">р╕Ир╕│р╕Щр╕зр╕Щр╕Цр╕╕р╕З</th>
                                        <th class="px-4 py-2 w-1/3 text-center">р╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Бр╕Чр╕╡р╣Ир╕Кр╕▒р╣Ир╕Зр╣Др╕Фр╣Й</th>
                                        <th class="px-4 py-2 text-center">р╕Ир╕▒р╕Фр╕Бр╕▓р╕г</th>
                                    </tr>
                                </thead>
                                <tbody id="weighing-table-body-${scaleId}">
                                    <tr><td colspan="5" class="text-center p-4 text-stone-400">р╕вр╕▒р╕Зр╣Др╕бр╣Ир╕бр╕╡р╕гр╕▓р╕вр╕Бр╕▓р╕г</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>
            `;
        }
        
        function renderWeighingStations() {
            for (let i = 1; i <= 4; i++) {
                const tabContent = document.getElementById(`tab-weighing-${i}`);
                if(tabContent) {
                    tabContent.innerHTML = createWeighingStationHTML(i);
                    document.getElementById(`save-weighing-${i}`).addEventListener('click', saveWeighing);
                    document.getElementById(`multiplier-weight-${i}`).addEventListener('input', () => calculateTotalWeight(i));
                    document.getElementById(`weighing-weight-${i}`).addEventListener('input', () => calculateTotalWeight(i)); // р╣Ар╕Юр╕┤р╣Ир╕бр╕Ър╕гр╕гр╕Чр╕▒р╕Фр╕Щр╕╡р╣Й
                    document.getElementById(`print-weighing-log-${i}`).addEventListener('click', printWeighingLog);
                    document.getElementById(`weighing-table-body-${i}`).addEventListener('click', handleWeighingTableClick);
                }
            }
        }

        async function saveWeighing(event) {
            if (!weighingsCollectionRef) return showAlert('р╕вр╕▒р╕Зр╣Др╕бр╣Ир╕Юр╕гр╣Йр╕нр╕бр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ р╕Бр╕гр╕╕р╕Ур╕▓р╕гр╕нр╕кр╕▒р╕Бр╕Др╕гр╕╣р╣И');
            const scaleId = parseInt(event.target.dataset.scale);
            const sellerName = document.getElementById(`weighing-seller-${scaleId}`).value.trim();
            const bags = parseInt(document.getElementById(`weighing-weight-${scaleId}`).value);

            if (!sellerName || !bags || bags <= 0) {
                showAlert('р╕Бр╕гр╕╕р╕Ур╕▓р╕Бр╕гр╕нр╕Бр╕Кр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╕Вр╕▓р╕вр╣Бр╕ер╕░р╕Ир╕│р╕Щр╕зр╕Щр╕Цр╕╕р╕Зр╣Гр╕лр╣Йр╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З');
                return;
            }

            try {
                if (editingWeighingId) {
                    const docRef = doc(weighingsCollectionRef, editingWeighingId);
                    await updateDoc(docRef, { sellerName, bags });
                    editingWeighingId = null;
                } else {
                    await addDoc(weighingsCollectionRef, {
                        sellerName,
                        bags,
                        scaleId: scaleId,
                        timestamp: new Date(),
                        userId
                    });
                }
                document.getElementById(`weighing-seller-${scaleId}`).value = '';
                document.getElementById(`weighing-weight-${scaleId}`).value = '';
                document.getElementById(`weighing-seller-${scaleId}`).focus();

            } catch(error) {
                console.error("Error saving weighing: ", error);
                showAlert(`р╣Ар╕Бр╕┤р╕Фр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╣Гр╕Щр╕Бр╕▓р╕гр╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Б: ${error.message}`);
            }
        }

        function calculateTotalWeight(scaleId) {
            const totalBagsEl = document.getElementById(`total-bags-${scaleId}`);
            const multiplierEl = document.getElementById(`multiplier-weight-${scaleId}`);
            const resultEl = document.getElementById(`total-calculated-weight-${scaleId}`);

            const totalBags = parseInt(totalBagsEl.textContent) || 0;
            const multiplier = parseFloat(multiplierEl.value) || 0;

            resultEl.textContent = (totalBags * multiplier).toFixed(2);
        }

        function printWeighingLog(event) {
            if (!weighingsCollectionRef) return showAlert("р╕вр╕▒р╕Зр╣Др╕бр╣Ир╕Юр╕гр╣Йр╕нр╕бр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ р╕Бр╕гр╕╕р╕Ур╕▓р╕гр╕нр╕кр╕▒р╕Бр╕Др╕гр╕╣р╣И");
            const scaleId = event.target.dataset.scale;
            
            const q = query(weighingsCollectionRef, where("scaleId", "==", parseInt(scaleId)));

            getDocs(q).then(snapshot => {
                const today = new Date();
                const todayStart = new Date(today.getFullYear(), today.getMonth(), today.getDate());
                
                const salesForDay = snapshot.docs
                    .map(doc => doc.data())
                    .filter(data => data.timestamp.toDate() >= todayStart);

                if (salesForDay.length === 0) {
                    showAlert(`р╣Др╕бр╣Ир╕Юр╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╕кр╕│р╕лр╕гр╕▒р╕Ър╕Хр╕▓р╕Кр╕▒р╣Ир╕Зр╕Чр╕╡р╣И ${scaleId} р╣Гр╕Щр╕зр╕▒р╕Щр╕Щр╕╡р╣Й`);
                    return;
                }

                let tableRows = '';
                let index = 1;
                salesForDay.sort((a,b) => a.timestamp.toDate() - b.timestamp.toDate()).forEach(data => {
                     tableRows += `
                         <tr class="border-b">
                             <td class="px-2 py-2 text-center">${index++}</td>
                             <td class="px-2 py-2">${data.sellerName}</td>
                             <td class="px-2 py-2 text-center">${data.bags}</td>
                             <td class="px-2 py-2 border-l" style="width: 25%;"></td>
                             <td class="px-2 py-2 border-l" style="width: 25%;"></td>
                         </tr>
                    `;
                });

                 const reportHTML = `
                     <style>
                         @media print {
                             @page { size: A4; margin: 1.5cm; }
                             body { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
                             .print-container { width: 100%; margin: 0; padding: 0; }
                             .print-table { width: 100%; border-collapse: collapse; font-size: 10pt; }
                             .print-table th, .print-table td { border: 1px solid black; padding: 4px 8px; text-align: left; }
                             .print-table th { background-color: #f5f5f4 !important; }
                             .text-center { text-align: center; }
                         }
                     </style>
                     <div class="print-container">
                         <div class="text-center mb-4">
                             <h2 class="text-xl font-bold">р╕кр╕лр╕Бр╕гр╕Ур╣Мр╕Бр╕нр╕Зр╕Чр╕╕р╕Щр╕кр╕зр╕Щр╕вр╕▓р╕Зр╕Юр╕▓р╕гр╕▓р╣Ар╕Бр╕йр╕Хр╕гр╕кр╕бр╕Ър╕╣р╕гр╕Ур╣М р╕Ир╕│р╕Бр╕▒р╕Ф</h2>
                             <h3 class="text-lg">р╕гр╕▓р╕вр╕Зр╕▓р╕Щр╕Бр╕▓р╕гр╕Кр╕▒р╣Ир╕Зр╕вр╕▓р╕Зр╕Ыр╕гр╕░р╕Ир╕│р╕зр╕▒р╕Щр╕Чр╕╡р╣И ${today.toLocaleDateString('th-TH', { year: 'numeric', month: 'long', day: 'numeric' })} (р╕Хр╕▓р╕Кр╕▒р╣Ир╕Зр╕Чр╕╡р╣И ${scaleId})</h3>
                         </div>
                         <table class="print-table">
                             <thead class="bg-stone-200">
                                 <tr class="border-b border-black">
                                     <th class="text-center">р╕ер╕│р╕Фр╕▒р╕Ър╕Чр╕╡р╣И</th>
                                     <th>р╕Кр╕╖р╣Ир╕н</th>
                                     <th class="text-center">р╕Ир╕│р╕Щр╕зр╕Щр╕Цр╕╕р╕З</th>
                                     <th>р╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Бр╕Чр╕╡р╣Ир╕Кр╕▒р╣Ир╕Зр╣Др╕Фр╣Й</th>
                                     <th>р╕ер╕▓р╕вр╣Ар╕Лр╣Зр╕Щ</th>
                                 </tr>
                             </thead>
                             <tbody>
                                 ${tableRows}
                             </tbody>
                         </table>
                     </div>
                `;
                ui.printArea.innerHTML = reportHTML;
                window.print();
            });
        }
        
        function setupWeighingListeners() {
            if (!weighingsCollectionRef) return;
            for (let i = 1; i <= 4; i++) {
                const q = query(weighingsCollectionRef, where("scaleId", "==", i));

                if (unsubscribeWeighings[i]) unsubscribeWeighings[i]();

                unsubscribeWeighings[i] = onSnapshot(q, (snapshot) => {
                    const todayStart = new Date();
                    todayStart.setHours(0, 0, 0, 0);

                    const tableBody = document.getElementById(`weighing-table-body-${i}`);
                    if (!tableBody) return;
                    tableBody.innerHTML = '';
                    let totalBags = 0;
                    
                    const docs = snapshot.docs.map(doc => ({id: doc.id, ...doc.data()}));
                    const todaysDocs = docs.filter(data => data.timestamp.toDate() >= todayStart);

                    if (todaysDocs.length === 0) {
                         tableBody.innerHTML = '<tr><td colspan="5" class="text-center p-4 text-stone-400">р╕вр╕▒р╕Зр╣Др╕бр╣Ир╕бр╕╡р╕гр╕▓р╕вр╕Бр╕▓р╕г</td></tr>';
                    } else {
                         todaysDocs.sort((a,b) => b.timestamp.toDate() - a.timestamp.toDate()).forEach(data => {
                             totalBags += data.bags;
                             const row = document.createElement('tr');
                             row.className = 'border-b';
                             row.innerHTML = `
                                 <td class="px-4 py-2">${data.timestamp.toDate().toLocaleTimeString('th-TH')}</td>
                                 <td class="px-4 py-2">${data.sellerName}</td>
                                 <td class="px-4 py-2 text-right">${data.bags}</td>
                                 <td class="px-4 py-2 w-1/3 text-center border-l"></td>
                                 <td class="px-4 py-2 text-center space-x-2">
                                     <button class="edit-weighing-btn text-blue-600 hover:text-blue-800 p-1" data-id="${data.id}" data-scale="${i}" title="р╣Бр╕Бр╣Йр╣Др╕В">тЬПя╕П</button>
                                     <button class="delete-weighing-btn text-red-600 hover:text-red-800 p-1" data-id="${data.id}" title="р╕ер╕Ъ">ЁЯЧСя╕П</button>
                                 </td>
                             `;
                             tableBody.appendChild(row);
                         });
                    }

                    const totalBagsEl = document.getElementById(`total-bags-${i}`);
                    if (totalBagsEl) {
                        totalBagsEl.textContent = totalBags;
                        calculateTotalWeight(i);
                    }
                });
            }
        }

        async function fetchAndPopulateWeights(sellerName) {
             if (!weighingsCollectionRef) return;
             const q = query(weighingsCollectionRef, where("sellerName", "==", sellerName));
             const querySnapshot = await getDocs(q);

             const todayStart = new Date();
             todayStart.setHours(0, 0, 0, 0);

             const todaysDocs = querySnapshot.docs.filter(doc => {
                 const ts = doc.data().timestamp;
                 if (!ts) return false;
                 return ts.toDate() >= todayStart;
             });

             if(todaysDocs.length === 0) return;
            
             const weights = todaysDocs.map(doc => doc.data().bags); // Use bags
             const weightInputs = document.querySelectorAll('#weight-inputs-container .weight-input');
            
             weights.forEach((weight, index) => {
                 if(index < weightInputs.length) {
                     weightInputs[index].value = weight;
                 }
             });
             calculateTotals();

             showConfirm(`р╕Юр╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╕зр╕▓р╕Зр╕вр╕▓р╕З ${weights.length} р╕гр╕▓р╕вр╕Бр╕▓р╕гр╕Вр╕нр╕З ${sellerName} р╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕ер╣Йр╕▓р╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Щр╕╡р╣Йр╕лр╕гр╕╖р╕нр╣Др╕бр╣И?`, () => {
                 todaysDocs.forEach(async (d) => {
                     await deleteDoc(doc(weighingsCollectionRef, d.id));
                 });
             });
        }
        
        async function initApp() {
            if (Object.keys(firebaseConfig).length === 0 || !firebaseConfig.apiKey) {
                showAlert('р╕Бр╕▓р╕гр╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓ Firebase р╣Др╕бр╣Ир╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З р╣Др╕бр╣Ир╕кр╕▓р╕бр╕▓р╕гр╕Цр╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕нр╕Рр╕▓р╕Щр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Др╕Фр╣Й');
                console.error('Firebase config is missing.');
                return;
            }
            try {
                const app = initializeApp(firebaseConfig);
                const analytics = getAnalytics(app);
                auth = getAuth(app);
                db = getFirestore(app);
                
                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        userId = user.uid;
                        salesCollectionRef = collection(db, `artifacts/${appId}/public/data/sales`);
                        weighingsCollectionRef = collection(db, `artifacts/${appId}/public/data/weighings`);
                        
                        if(unsubscribeSales) unsubscribeSales();
                        const salesQuery = query(salesCollectionRef);
                        unsubscribeSales = onSnapshot(salesQuery, (snapshot) => {
                            localSalesData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                            localSalesData.sort((a,b) => b.date.toDate() - a.date.toDate());
                            renderTable(localSalesData);
                            renderDashboard();
                            renderSummary();
                            renderDailySummary();
                        }, (error) => {
                            console.error("Error fetching data with onSnapshot: ", error);
                            showAlert(`р╣Ар╕Бр╕┤р╕Фр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╣Гр╕Щр╕Бр╕▓р╕гр╕Фр╕╢р╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕е: ${error.message}`);
                        });
                        setupWeighingListeners();
                    } else {
                         try {
                             if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                                 await signInWithCustomToken(auth, __initial_auth_token);
                             } else {
                                 await signInAnonymously(auth);
                             }
                         } catch (error) {
                             console.error('Sign-in failed:', error);
                             showAlert(`р╕Бр╕▓р╕гр╕вр╕╖р╕Щр╕вр╕▒р╕Щр╕Хр╕▒р╕зр╕Хр╕Щр╕ер╣Йр╕бр╣Ар╕лр╕ер╕з: ${error.message}`);
                         }
                    }
                });

            } catch (error) {
                 console.error("Firebase initialization error: ", error);
                 showAlert(`р╣Ар╕Бр╕┤р╕Фр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╣Гр╕Щр╕Бр╕▓р╕гр╣Ар╕гр╕┤р╣Ир╕бр╕Хр╣Йр╕Щр╕гр╕░р╕Ър╕Ъ: ${error.message}`);
            }
        }

        async function handleWeighingTableClick(e) {
            const target = e.target.closest('button');
            if(!target) return;

            const id = target.dataset.id;
            const scaleId = target.dataset.scale;

            if (target.classList.contains('delete-weighing-btn')) {
                showConfirm('р╕Др╕╕р╕Ур╣Бр╕Щр╣Ир╣Гр╕Ир╕зр╣Ир╕▓р╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕ер╕Ър╕гр╕▓р╕вр╕Бр╕▓р╕гр╕зр╕▓р╕Зр╕вр╕▓р╕Зр╕Щр╕╡р╣Й?', async () => {
                    await deleteDoc(doc(weighingsCollectionRef, id));
                    showAlert('р╕ер╕Ър╕гр╕▓р╕вр╕Бр╕▓р╕гр╕кр╕│р╣Ар╕гр╣Зр╕И');
                });
            } else if (target.classList.contains('edit-weighing-btn')) {
                const docRef = doc(weighingsCollectionRef, id);
                const docSnap = await getDoc(docRef);
                if(docSnap.exists()){
                    const data = docSnap.data();
                    document.getElementById(`weighing-seller-${scaleId}`).value = data.sellerName;
                    document.getElementById(`weighing-weight-${scaleId}`).value = data.bags;
                    editingWeighingId = id;
                }
            }
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            renderWeighingStations();
            
            ui.tabs.addEventListener('click', (e) => {
                if (e.target.dataset.tab) {
                    const targetTab = e.target.dataset.tab;
                    ui.tabs.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
                    ui.tabContents.forEach(content => content.classList.remove('active'));
                    e.target.classList.add('active');
                    document.getElementById(targetTab).classList.add('active');
                }
            });
            
            document.querySelector('[data-tab="tab-receipt"]').classList.add('active');
            document.getElementById('tab-receipt').classList.add('active');
            
            ui.sellerNameInput.addEventListener('blur', (e) => {
                const sellerName = e.target.value.trim();
                if(sellerName) {
                    fetchAndPopulateWeights(sellerName);
                }
            });

             ui.saveButton.addEventListener('click', handleSave);
             ui.cancelEditButton.addEventListener('click', clearForm);
             ui.salesTableBody.addEventListener('click', handleTableClick);
             ui.printReportBtn.addEventListener('click', createDailySummaryReport);
             if(ui.printDashboardBtn) {
                 ui.printDashboardBtn.addEventListener('click', () => window.print());
             }
             ui.receiptDateInput.addEventListener('input', updateDateDisplay);
             const calculationInputs = [...document.querySelectorAll('.weight-input'), ui.pricePerKgInput];
            calculationInputs.forEach(input => input.addEventListener('input', calculateTotals));
            ui.searchBox.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                const filteredData = localSalesData.filter(sale => 
                    sale.seller.toLowerCase().includes(searchTerm) ||
                    sale.date.toDate().toLocaleDateString('th-TH').includes(searchTerm)
                );
                renderTable(filteredData);
            });

            ui.receiptDateInput.valueAsDate = new Date();
            ui.reportDateInput.valueAsDate = new Date();
            updateDateDisplay();

            initApp();
        });
    </script>
</body>
</html>
