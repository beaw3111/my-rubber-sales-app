<!DOCTYPE html>
<html lang="th">

<head>
┬а ┬а <meta charset="UTF-8">
┬а ┬а <meta name="viewport" content="width=device-width, initial-scale=1.0">
┬а ┬а <title>р╕гр╕░р╕Ър╕Ър╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Бр╕▓р╕гр╕Вр╕▓р╕вр╕вр╕▓р╕Зр╕Бр╣Йр╕нр╕Щр╕Цр╣Йр╕зр╕в</title>
┬а ┬а <script src="https://cdn.tailwindcss.com"></script>
┬а ┬а <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
┬а ┬а <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
┬а ┬а <link rel="preconnect" href="https://fonts.googleapis.com">
┬а ┬а <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
┬а ┬а <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;700&display=swap" rel="stylesheet">
┬а ┬а <style>
┬а ┬а ┬а ┬а body {
┬а ┬а ┬а ┬а ┬а ┬а font-family: 'Sarabun', sans-serif;
┬а ┬а ┬а ┬а ┬а ┬а -webkit-print-color-adjust: exact;
┬а ┬а ┬а ┬а ┬а ┬а print-color-adjust: exact;
┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а .chart-container {
┬а ┬а ┬а ┬а ┬а ┬а position: relative;
┬а ┬а ┬а ┬а ┬а ┬а height: 400px;
┬а ┬а ┬а ┬а ┬а ┬а width: 100%;
┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а .tab-btn {
┬а ┬а ┬а ┬а ┬а ┬а transition: all 0.3s ease-in-out;
┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а .tab-btn.active {
┬а ┬а ┬а ┬а ┬а ┬а border-color: #d97706;
┬а ┬а ┬а ┬а ┬а ┬а background-color: #fffbeb;
┬а ┬а ┬а ┬а ┬а ┬а color: #b45309;
┬а ┬а ┬а ┬а ┬а ┬а font-weight: 700;
┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а .tab-content {
┬а ┬а ┬а ┬а ┬а ┬а display: none;
┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а .tab-content.active {
┬а ┬а ┬а ┬а ┬а ┬а display: block;
┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а @media print {
┬а ┬а ┬а ┬а ┬а ┬а body * {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а visibility: hidden;
┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а #print-area,
┬а ┬а ┬а ┬а ┬а ┬а #print-area * {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а visibility: visible;
┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а #print-area {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а position: absolute;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а left: 0;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а top: 0;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а width: 100%;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а height: 100%;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а padding: 0;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а margin: 0;
┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а .no-print {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а display: none !important;
┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а }
┬а ┬а </style>
</head>

<body class="bg-stone-100 text-stone-800">

┬а ┬а <div id="login-screen" class="min-h-screen flex items-center justify-center">
┬а ┬а ┬а ┬а <div class="bg-white p-8 rounded-2xl shadow-2xl w-full max-w-sm">
┬а ┬а ┬а ┬а ┬а ┬а <h2 class="text-2xl font-bold text-center text-stone-800 mb-2">р╕гр╕░р╕Ър╕Ър╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕Вр╕▓р╕вр╕вр╕▓р╕Зр╕Бр╣Йр╕нр╕Щр╕Цр╣Йр╕зр╕в</h2>
┬а ┬а ┬а ┬а ┬а ┬а <p class="text-center text-stone-500 mb-6">р╕Бр╕гр╕╕р╕Ур╕▓р╣Ар╕Вр╣Йр╕▓р╕кр╕╣р╣Ир╕гр╕░р╕Ър╕Ъ</p>
┬а ┬а ┬а ┬а ┬а ┬а <div class="space-y-4">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="username-input" class="block text-sm font-medium text-stone-600">р╕Кр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╣Гр╕Кр╣Й</label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="text" id="username-input" value="admin" class="mt-1 w-full p-3 border border-stone-300 rounded-lg shadow-sm focus:ring-2 focus:ring-amber-500">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="password-input" class="block text-sm font-medium text-stone-600">р╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щ</label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="password" id="password-input" class="mt-1 w-full p-3 border border-stone-300 rounded-lg shadow-sm focus:ring-2 focus:ring-amber-500">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p id="login-error" class="text-sm text-red-600 text-center hidden"></p>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button id="login-button" class="w-full bg-amber-600 text-white font-bold py-3 px-4 rounded-lg shadow-md hover:bg-amber-700 transition-colors">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а р╣Ар╕Вр╣Йр╕▓р╕кр╕╣р╣Ир╕гр╕░р╕Ър╕Ъ
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </button>
┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а <div class="text-center mt-4">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button id="change-password-btn" class="text-sm text-stone-500 hover:text-amber-600 underline">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а р╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щ
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </button>
┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а </div>
┬а ┬а </div>
┬а ┬а┬а
┬а ┬а <div id="app" class="container mx-auto max-w-7xl p-4 sm:p-6 lg:p-8 hidden">
┬а ┬а ┬а ┬а <header class="relative mb-10 text-center">
┬а ┬а ┬а ┬а ┬а ┬а <h1 class="text-4xl font-bold text-stone-900">р╕гр╕░р╕Ър╕Ър╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕Вр╕▓р╕вр╕вр╕▓р╕Зр╕Бр╣Йр╕нр╕Щр╕Цр╣Йр╕зр╕в</h1>
┬а ┬а ┬а ┬а ┬а ┬а <p class="text-xl font-semibold text-stone-700 mt-2">р╕кр╕лр╕Бр╕гр╕Ур╣Мр╕Бр╕нр╕Зр╕Чр╕╕р╕Щр╕кр╕зр╕Щр╕вр╕▓р╕Зр╕Юр╕▓р╕гр╕▓р╣Ар╕Бр╕йр╕Хр╕гр╕кр╕бр╕Ър╕╣р╕гр╕Ур╣М р╕Ир╕│р╕Бр╕▒р╕Ф</p>
┬а ┬а ┬а ┬а ┬а ┬а <p class="text-stone-600 mt-2">р╕нр╕нр╕Бр╣Гр╕Ър╣Ар╕кр╕гр╣Зр╕И р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕е р╣Бр╕ер╕░р╕Фр╕╣р╕кр╕гр╕╕р╕Ыр╕вр╕нр╕Фр╕Вр╕▓р╕вр╣Гр╕Щр╕Чр╕╡р╣Ир╣Ар╕Фр╕╡р╕вр╕з</p>
┬а ┬а ┬а ┬а ┬а ┬а┬а
┬а ┬а ┬а ┬а ┬а ┬а <button id="logout-button" class="absolute top-0 right-0 bg-red-500 text-white font-semibold py-2 px-4 rounded-lg shadow hover:bg-red-600 transition-colors no-print">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а р╕нр╕нр╕Бр╕Ир╕▓р╕Бр╕гр╕░р╕Ър╕Ъ
┬а ┬а ┬а ┬а ┬а ┬а </button>
┬а ┬а ┬а ┬а </header>

┬а ┬а ┬а ┬а <div class="mb-6 border-b border-stone-300 no-print">
┬а ┬а ┬а ┬а ┬а ┬а <nav id="tabs" class="flex flex-wrap -mb-px">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button data-tab="tab-receipt" class="tab-btn inline-block p-4 border-b-4 border-transparent rounded-t-lg hover:text-amber-600 hover:border-amber-300">1. р╕нр╕нр╕Бр╣Гр╕Ър╣Ар╕кр╕гр╣Зр╕И</button>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button data-tab="tab-history" class="tab-btn inline-block p-4 border-b-4 border-transparent rounded-t-lg hover:text-amber-600 hover:border-amber-300">2. р╕Ыр╕гр╕░р╕зр╕▒р╕Хр╕┤р╣Бр╕ер╕░р╕гр╕▓р╕вр╕Зр╕▓р╕Щ</button>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button data-tab="tab-dashboard" class="tab-btn inline-block p-4 border-b-4 border-transparent rounded-t-lg hover:text-amber-600 hover:border-amber-300">3. р╕кр╕гр╕╕р╕Ыр╕ар╕▓р╕Юр╕гр╕зр╕б</button>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button data-tab="tab-weighing-1" class="tab-btn inline-block p-4 border-b-4 border-transparent rounded-t-lg hover:text-amber-600 hover:border-amber-300">4. р╕гр╕▒р╕Ър╕зр╕▓р╕Зр╕вр╕▓р╕З (р╕Хр╕▓р╕Кр╕▒р╣Ир╕З 1)</button>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button data-tab="tab-weighing-2" class="tab-btn inline-block p-4 border-b-4 border-transparent rounded-t-lg hover:text-amber-600 hover:border-amber-300">5. р╕гр╕▒р╕Ър╕зр╕▓р╕Зр╕вр╕▓р╕З (р╕Хр╕▓р╕Кр╕▒р╣Ир╕З 2)</button>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button data-tab="tab-weighing-3" class="tab-btn inline-block p-4 border-b-4 border-transparent rounded-t-lg hover:text-amber-600 hover:border-amber-300">6. р╕гр╕▒р╕Ър╕зр╕▓р╕Зр╕вр╕▓р╕З (р╕Хр╕▓р╕Кр╕▒р╣Ир╕З 3)</button>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button data-tab="tab-weighing-4" class="tab-btn inline-block p-4 border-b-4 border-transparent rounded-t-lg hover:text-amber-600 hover:border-amber-300">7. р╕гр╕▒р╕Ър╕зр╕▓р╕Зр╕вр╕▓р╕З (р╕Хр╕▓р╕Кр╕▒р╣Ир╕З 4)</button>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button data-tab="tab-weighing-summary" class="tab-btn inline-block p-4 border-b-4 border-transparent rounded-t-lg hover:text-amber-600 hover:border-amber-300">8. р╕кр╕гр╕╕р╕Ыр╕Ьр╕ер╕гр╕зр╕бр╕Хр╕▓р╕Кр╕▒р╣Ир╕З</button>
┬а ┬а ┬а ┬а ┬а ┬а </nav>
┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а <main>
┬а ┬а ┬а ┬а ┬а ┬а <div id="tab-receipt" class="tab-content">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <section id="receipt-generator" class="bg-white p-6 sm:p-8 rounded-xl shadow-lg">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h2 class="text-2xl font-bold mb-2 border-b pb-3 text-stone-800">1. р╕Бр╕гр╕нр╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Ар╕Юр╕╖р╣Ир╕нр╕нр╕нр╕Бр╣Гр╕Ър╣Ар╕кр╕гр╣Зр╕И</h2>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p class="text-sm text-stone-500 mt-2 mb-6">р╕кр╣Ир╕зр╕Щр╕Щр╕╡р╣Йр╕Др╕╖р╕нр╕ир╕╣р╕Щр╕вр╣Мр╕Бр╕ер╕▓р╕Зр╕Бр╕▓р╕гр╕Чр╕│р╕Зр╕▓р╕Щ р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Бр╕▓р╕гр╕Вр╕▓р╕в р╕гр╕░р╕Ър╕Ър╕Ир╕░р╕Др╕│р╕Щр╕зр╕Ур╕вр╕нр╕Фр╕гр╕зр╕бр╣Гр╕лр╣Йр╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤ р╣Бр╕ер╕░р╣Ар╕бр╕╖р╣Ир╕нр╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Бр╕ер╣Йр╕зр╕Ир╕░р╕кр╕гр╣Йр╕▓р╕Зр╣Гр╕Ър╣Ар╕кр╕гр╣Зр╕Ир╕кр╕│р╕лр╕гр╕▒р╕Ър╕Юр╕┤р╕бр╕Юр╣Мр╣Др╕Фр╣Йр╕Чр╕▒р╕Щр╕Чр╕╡</p>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-6">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="seller-name" class="block text-sm font-medium text-stone-700 mb-1">р╕Кр╕╖р╣Ир╕н-р╕кр╕Бр╕╕р╕е р╕Ьр╕╣р╣Йр╕Вр╕▓р╕в</label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="text" id="seller-name" class="w-full p-3 border border-stone-300 rounded-lg shadow-sm focus:ring-2 focus:ring-amber-500 focus:border-amber-500" placeholder="р╣Ар╕Кр╣Ир╕Щ р╕Щр╕▓р╕вр╕кр╕бр╕Кр╕▓р╕в р╣Гр╕Ир╕Фр╕╡">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="scale-number" class="block text-sm font-medium text-stone-700 mb-1">р╕Хр╕▓р╕Кр╕▒р╣Ир╕Зр╕Чр╕╡р╣И</label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="number" id="scale-number" min="1" max="9" class="w-full p-3 border border-stone-300 rounded-lg shadow-sm focus:ring-2 focus:ring-amber-500 focus:border-amber-500" placeholder="1-9">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="md:col-span-2">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="receipt-date" class="block text-sm font-medium text-stone-700 mb-1">р╕зр╕▒р╕Щр╕Чр╕╡р╣И <span id="date-display" class="font-normal text-stone-500 ml-2"></span></label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="date" id="receipt-date" class="w-full p-3 border border-stone-300 rounded-lg shadow-sm focus:ring-2 focus:ring-amber-500 focus:border-amber-500">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="md:col-span-2">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label class="block text-sm font-medium text-stone-700 mb-1">р╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Б (р╕Бр╕Б.) - р╣Гр╕кр╣Ир╣Др╕Фр╣Йр╕кр╕╣р╕Зр╕кр╕╕р╕Ф 10 р╕гр╕▓р╕вр╕Бр╕▓р╕г <span class="text-xs text-stone-400">(р╕Бр╕гр╕нр╕Бр╣Ар╕Йр╕Юр╕▓р╕░р╕Кр╣Ир╕нр╕Зр╕Чр╕╡р╣Ир╕Кр╕▒р╣Ир╕З)</span></label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div id="weight-inputs-container" class="grid grid-cols-2 sm:grid-cols-5 gap-4 mt-2">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="number" class="weight-input w-full p-2 border border-stone-300 rounded-md shadow-sm text-center" placeholder="р╕Др╕гр╕▒р╣Йр╕Зр╕Чр╕╡р╣И 1">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="number" class="weight-input w-full p-2 border border-stone-300 rounded-md shadow-sm text-center" placeholder="р╕Др╕гр╕▒р╣Йр╕Зр╕Чр╕╡р╣И 2">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="number" class="weight-input w-full p-2 border border-stone-300 rounded-md shadow-sm text-center" placeholder="р╕Др╕гр╕▒р╣Йр╕Зр╕Чр╕╡р╣И 3">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="number" class="weight-input w-full p-2 border border-stone-300 rounded-md shadow-sm text-center" placeholder="р╕Др╕гр╕▒р╣Йр╕Зр╕Чр╕╡р╣И 4">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="number" class="weight-input w-full p-2 border border-stone-300 rounded-md shadow-sm text-center" placeholder="р╕Др╕гр╕▒р╣Йр╕Зр╕Чр╕╡р╣И 5">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="number" class="weight-input w-full p-2 border border-stone-300 rounded-md shadow-sm text-center" placeholder="р╕Др╕гр╕▒р╣Йр╕Зр╕Чр╕╡р╣И 6">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="number" class="weight-input w-full p-2 border border-stone-300 rounded-md shadow-sm text-center" placeholder="р╕Др╕гр╕▒р╣Йр╕Зр╕Чр╕╡р╣И 7">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="number" class="weight-input w-full p-2 border border-stone-300 rounded-md shadow-sm text-center" placeholder="р╕Др╕гр╕▒р╣Йр╕Зр╕Чр╕╡р╣И 8">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="number" class="weight-input w-full p-2 border border-stone-300 rounded-md shadow-sm text-center" placeholder="р╕Др╕гр╕▒р╣Йр╕Зр╕Чр╕╡р╣И 9">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="number" class="weight-input w-full p-2 border border-stone-300 rounded-md shadow-sm text-center" placeholder="р╕Др╕гр╕▒р╣Йр╕Зр╕Чр╕╡р╣И 10">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="md:col-span-2">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="relative">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="price-per-kg" class="block text-sm font-medium text-stone-700 mb-1">р╕гр╕▓р╕Др╕▓р╕Хр╣Ир╕нр╕лр╕Щр╣Ир╕зр╕в (р╕Ър╕▓р╕Ч/р╕Бр╕Б.)</label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="number" id="price-per-kg" class="w-full p-3 border border-stone-300 rounded-lg shadow-sm focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition-colors" placeholder="0.00">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а _2.5 bottom-2 h-8 w-8 flex items-center justify-center rounded-lg text-white bg-gray-400 hover:bg-gray-500 transition-colors">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span id="price-lock-icon">ЁЯФУ</span>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </button>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="md:col-span-2 bg-amber-50 border border-amber-200 p-4 rounded-lg space-y-4">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="flex justify-between items-center">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span class="font-medium text-stone-600">р╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Бр╕гр╕зр╕б (р╕Бр╕Б.):</span>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span id="total-weight" class="text-2xl font-bold text-stone-800">0.00</span>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="flex justify-between items-center">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span class="font-medium text-stone-600">р╕гр╕зр╕бр╣Ар╕Ыр╣Зр╕Щр╣Ар╕Зр╕┤р╕Щр╕Чр╕▒р╣Йр╕Зр╕кр╕┤р╣Йр╕Щ (р╕Ър╕▓р╕Ч):</span>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span id="total-amount" class="text-3xl font-bold text-amber-600">0.00</span>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="flex justify-between items-center text-right border-t border-amber-200 pt-3">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span class="font-medium text-stone-600">(р╕Хр╕▒р╕зр╕нр╕▒р╕Бр╕йр╕г):</span>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span id="total-amount-text" class="text-md text-stone-500">-</span>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="mt-8 flex justify-end items-center gap-4">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button id="cancel-edit-button" class="hidden bg-stone-200 text-stone-700 font-bold py-3 px-6 rounded-lg hover:bg-stone-300 transition-colors">
┬а ┬а ┬а ┬а _z-index: 5; ┬а ┬а ┬а ┬а ┬а ┬а ┬а  р╕вр╕Бр╣Ар╕ер╕┤р╕Б
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </button>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button id="save-button" class="bg-amber-600 text-white font-bold py-3 px-8 rounded-lg shadow-md hover:bg-amber-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-500 transition-transform hover:scale-105">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╣Бр╕ер╕░р╕Юр╕┤р╕бр╕Юр╣Мр╣Гр╕Ър╣Ар╕кр╕гр╣Зр╕И
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </button>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="border-t pt-6 mt-8">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h3 class="text-xl font-semibold text-stone-700 mb-4">р╕кр╕гр╕╕р╕Ыр╕вр╕нр╕Фр╕Вр╕▓р╕вр╣Бр╕вр╕Бр╕Хр╕▓р╕бр╕Хр╕▓р╕Кр╕▒р╣Ир╕З (р╕зр╕▒р╕Щр╕Щр╕╡р╣Й)</h3>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div id="sales-summary-by-scale" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div id="sales-summary-today-total" class="mt-6 p-4 bg-amber-200 rounded-lg text-center hidden shadow">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h4 class="text-lg font-bold text-amber-800">р╕вр╕нр╕Фр╕гр╕зр╕бр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф (р╕зр╕▒р╕Щр╕Щр╕╡р╣Й)</h4>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="flex justify-center gap-x-8 gap-y-2 flex-wrap mt-2">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span class="text-md text-amber-700">р╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Бр╕гр╕зр╕б: </span>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span id="summary-today-total-weight" class="font-bold text-amber-900 text-xl">0.00</span>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span class="text-md text-amber-700"> р╕Бр╕Б.</span>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span class="text-md text-amber-700">р╕вр╕нр╕Фр╣Ар╕Зр╕┤р╕Щр╕гр╕зр╕б: </span>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span id="summary-today-total-amount" class="font-bold text-amber-900 text-xl">0.00</span>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span class="text-md text-amber-700"> р╕Ър╕▓р╕Ч</span>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а _z-index: 9999;  ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </section>
┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а <div id="tab-history" class="tab-content">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <section id="sales-data" class="bg-white p-6 sm:p-8 rounded-xl shadow-lg">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="flex flex-col sm:flex-row justify-between sm:items-center mb-2 border-b pb-3">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h2 class="text-2xl font-bold text-stone-800">2. р╕Ыр╕гр╕░р╕зр╕▒р╕Хр╕┤р╣Бр╕ер╕░р╕гр╕▓р╕вр╕Зр╕▓р╕Щ</h2>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="text" id="search-box" class="mt-3 sm:mt-0 w-full sm:w-72 p-2 border border-stone-300 rounded-lg shadow-sm focus:ring-2 focus:ring-amber-500" placeholder="ЁЯФН р╕Др╣Йр╕Щр╕лр╕▓р╕Хр╕▓р╕бр╕Кр╕╖р╣Ир╕н, р╕Др╕┤р╕з, р╕лр╕гр╕╖р╕нр╕зр╕▒р╕Щр╕Чр╕╡р╣И...">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p class="text-sm text-stone-500 mt-2 mb-6">р╕Хр╕▓р╕гр╕▓р╕Зр╕Ир╕░р╣Бр╕кр╕Фр╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Бр╕▓р╕гр╕Вр╕▓р╕вр╕кр╕│р╕лр╕гр╕▒р╕Ър╕зр╕▒р╕Щр╕Щр╕╡р╣Йр╣Ар╕Ыр╣Зр╕Щр╕Др╣Ир╕▓р╣Ар╕гр╕┤р╣Ир╕бр╕Хр╣Йр╕Щ р╕Др╕╕р╕Ур╕кр╕▓р╕бр╕▓р╕гр╕Цр╣Гр╕Кр╣Йр╕Кр╣Ир╕нр╕Зр╕Др╣Йр╕Щр╕лр╕▓р╣Ар╕Юр╕╖р╣Ир╕нр╕Фр╕╣р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕вр╣Йр╕нр╕Щр╕лр╕ер╕▒р╕З р╕гр╕зр╕бр╕Цр╕╢р╕Зр╣Бр╕Бр╣Йр╣Др╕Вр╕лр╕гр╕╖р╕нр╕ер╕Ър╕гр╕▓р╕вр╕Бр╕▓р╕гр╣Др╕Фр╣Й</p>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="border rounded-lg p-4 bg-stone-50">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h3 class="text-lg font-semibold text-stone-700 mb-3">р╣Ар╕Др╕гр╕╖р╣Ир╕нр╕Зр╕бр╕╖р╕нр╕гр╕▓р╕вр╕Зр╕▓р╕Щ</h3>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="flex items-center gap-4 flex-wrap">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <select id="report-date-select" class="p-2 border border-stone-300 rounded-md shadow-sm focus:ring-amber-500 focus:border-amber-500 bg-white">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <option value="">--- р╣Ар╕ер╕╖р╕нр╕Бр╕зр╕▒р╕Щр╕Чр╕╡р╣Ир╕Чр╕│р╕гр╕▓р╕вр╕Зр╕▓р╕Щ ---</option>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </select>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button id="print-report-btn" class="bg-sky-600 text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-sky-700 transition-colors">ЁЯЦия╕П р╕Юр╕┤р╕бр╕Юр╣Мр╕гр╕▓р╕вр╕Зр╕▓р╕Щ</button>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button id="export-excel-btn" class="bg-green-600 text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-green-700 transition-colors">ЁЯУД Export to Excel</button>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="overflow-x-auto mt-6 rounded-lg border">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <table class="w-full text-sm text-left text-stone-600">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <thead class="text-xs text-stone-700 uppercase bg-stone-200">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <tr>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th scope="col" class="px-4 py-3 text-center">р╕Др╕┤р╕з</th>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th scope="col" class="px-6 py-3">р╕зр╕▒р╕Щр╕Чр╕╡р╣И</th>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th scope="col" class="px-6 py-3">р╕Кр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╕Вр╕▓р╕в</th>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th scope="col" class="px-6 py-3 text-right">р╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Б (р╕Бр╕Б.)</th>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th scope="col" class="px-6 py-3 text-right">р╕гр╕▓р╕Др╕▓/р╕лр╕Щр╣Ир╕зр╕в</th>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th scope="col" class="px-6 py-3 text-right">р╕вр╕нр╕Фр╕гр╕зр╕б (р╕Ър╕▓р╕Ч)</th>
┬а ┬а ┬а ┬а ┬а ┬а ┬а _z-index: 10; ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th scope="col" class="px-6 py-3 text-center">р╕Бр╕▓р╕гр╕Фр╕│р╣Ар╕Щр╕┤р╕Щр╕Бр╕▓р╕г</th>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </tr>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </thead>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <tbody id="sales-table-body">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <tr>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td colspan="7" class="px-6 py-8 text-center text-stone-400">р╕Бр╕│р╕ер╕▒р╕Зр╣Вр╕лр╕ер╕Фр╕Вр╣Йр╕нр╕бр╕╣р╕е...</td>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </tr>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </tbody>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </table>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </section>
┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а <div id="tab-dashboard" class="tab-content">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <section id="dashboard" class="bg-white p-6 sm:p-8 rounded-xl shadow-lg">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="flex justify-between items-center mb-2 border-b pb-3 no-print">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h2 class="text-2xl font-bold text-stone-800">3. р╕кр╕гр╕╕р╕Ыр╕ар╕▓р╕Юр╕гр╕зр╕б</h2>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button id="print-dashboard-btn" class="bg-sky-600 text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-sky-700 transition-colors">ЁЯЦия╕П р╕Юр╕┤р╕бр╕Юр╣Мр╕лр╕Щр╣Йр╕▓р╕Щр╕╡р╣Й</button>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а<p class="text-sm text-stone-500 mt-2 mb-8 no-print">р╣Бр╕Фр╕Кр╕Ър╕нр╕гр╣Мр╕Фр╕Щр╕╡р╣Йр╕Ир╕░р╕кр╕гр╕╕р╕Ыр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Бр╕▓р╕гр╕Вр╕▓р╕вр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Фр╣Гр╕Щр╕гр╕╣р╕Ыр╣Бр╕Ър╕Ър╕Бр╕гр╕▓р╕Я р╕Кр╣Ир╕зр╕вр╣Гр╕лр╣Йр╣Ар╕лр╣Зр╕Щр╕ар╕▓р╕Юр╕гр╕зр╕бр╣Бр╕ер╕░р╣Бр╕Щр╕зр╣Вр╕Щр╣Йр╕бр╕Хр╣Ир╕▓р╕Зр╣Ж р╣Др╕Фр╣Йр╕нр╕вр╣Ир╕▓р╕Зр╕гр╕зр╕Фр╣Ар╕гр╣Зр╕з</p>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="border-b pb-6 mb-8">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h3 class="font-bold text-center mb-4 text-stone-700 text-xl">р╕кр╕гр╕╕р╕Ыр╕вр╕нр╕Фр╕гр╕зр╕бр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф (All-Time)</h3>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="grid grid-cols-1 sm:grid-cols-3 gap-6">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="bg-stone-100 border border-stone-200 p-6 rounded-lg text-center shadow">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p class="text-md font-medium text-stone-600">р╕Ир╕│р╕Щр╕зр╕Щр╕Ьр╕╣р╣Йр╕Вр╕▓р╕вр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф</p>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p id="summary-total-sellers" class="text-4xl font-bold text-amber-600 mt-2">0</p>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="bg-stone-100 border border-stone-200 p-6 rounded-lg text-center shadow">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p class="text-md font-medium text-stone-600">р╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Бр╕гр╕зр╕бр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф (р╕Бр╕Б.)</p>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p id="summary-total-weight" class="text-4xl font-bold text-amber-600 mt-2">0.00</p>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="bg-stone-100 border border-stone-200 p-6 rounded-lg text-center shadow">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а _z-index: 1000; ┬а ┬а ┬а ┬а ┬а <p class="text-md font-medium text-stone-600">р╕вр╕нр╕Фр╕Вр╕▓р╕вр╕гр╕зр╕бр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф (р╕Ър╕▓р╕Ч)</p>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p id="summary-total-price" class="text-4xl font-bold text-amber-600 mt-2">0.00</p>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="space-y-12">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а<div class="border rounded-xl p-6 shadow-sm">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h3 class="font-bold text-center mb-4 text-stone-700 text-xl">р╕кр╕Цр╕┤р╕Хр╕┤р╕Ыр╕гр╕┤р╕бр╕▓р╕Ур╣Бр╕ер╕░р╕гр╕▓р╕Др╕▓р╕вр╕▓р╕Зр╕гр╕▓р╕вр╕зр╕▒р╕Щ</h3>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="chart-container mx-auto">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <canvas id="daily-stats-chart"></canvas>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </section>
┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а <div id="tab-weighing-1" class="tab-content"></div>
┬а ┬а ┬а ┬а ┬а ┬а <div id="tab-weighing-2" class="tab-content"></div>
┬а ┬а ┬а ┬а ┬а ┬а <div id="tab-weighing-3" class="tab-content"></div>
┬а ┬а ┬а ┬а ┬а ┬а <div id="tab-weighing-4" class="tab-content"></div>

┬а ┬а ┬а ┬а ┬а ┬а <div id="tab-weighing-summary" class="tab-content">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <section class="bg-white p-6 sm:p-8 rounded-xl shadow-lg">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h2 class="text-2xl font-bold mb-6 border-b pb-3 text-stone-800">8. р╕кр╕гр╕╕р╕Ыр╕Ьр╕ер╕гр╕зр╕бр╕Хр╕▓р╕Кр╕▒р╣Ир╕Зр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф (р╕кр╕│р╕лр╕гр╕▒р╕Ър╕зр╕▒р╕Щр╕Щр╕╡р╣Й)</h2>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="space-y-8">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="grid grid-cols-1 md:grid-cols-3 gap-6 bg-stone-50 p-6 rounded-xl border items-center">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="text-center">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p class="text-lg font-medium text-stone-600">р╕Ьр╕ер╕гр╕зр╕бр╕Ир╕│р╕Щр╕зр╕Щр╕Цр╕╕р╕Зр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф</p>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p id="summary-total-bags" class="text-6xl font-bold text-amber-600 mt-2">0</p>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="flex flex-col justify-center">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="summary-multiplier-weight" class="block text-md font-medium text-stone-600 mb-2 text-center">р╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Б/р╕Цр╕╕р╕З (р╕Бр╕Б.)</label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="number" id="summary-multiplier-weight" class="w-full p-3 border border-stone-300 rounded-lg shadow-sm text-center text-xl" placeholder="р╕Бр╕гр╕нр╕Бр╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Бр╣Ар╕Йр╕ер╕╡р╣Ир╕в">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="text-center">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а _z-index: 999; ┬а ┬а ┬а <p class="text-lg font-medium text-stone-600">р╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣Мр╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Бр╕гр╕зр╕б (р╕Бр╕Б.)</p>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p id="summary-calculated-weight" class="text-6xl font-bold text-green-600 mt-2">0.00</p>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="border-t pt-8 mt-8">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h3 class="text-xl font-semibold text-stone-700 mb-4">р╕кр╕Цр╕┤р╕Хр╕┤р╕Бр╕▓р╕гр╕гр╕▒р╕Ър╕зр╕▓р╕Зр╕вр╕▓р╕Зр╕вр╣Йр╕нр╕Щр╕лр╕ер╕▒р╕З</h3>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а<div class="overflow-x-auto rounded-lg border">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а<table class="w-full text-sm text-left text-stone-600">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а<thead class="text-xs text-stone-700 uppercase bg-stone-200">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а<tr>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а<th scope="col" class="px-6 py-3">р╕зр╕▒р╕Щр╕Чр╕╡р╣И</th>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а<th scope="col" class="px-6 py-3 text-center">р╕Ир╕│р╕Щр╕зр╕Щр╕гр╕▓р╕вр╕Бр╕▓р╕г</th>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а<th scope="col" class="px-6 py-3 text-center">р╕Ир╕│р╕Щр╕зр╕Щр╕Цр╕╕р╕Зр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф</th>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а<th scope="col" class="px-6 py-3 text-center">р╕Др╣Ир╕▓р╣Ар╕Йр╕ер╕╡р╣Ир╕вр╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Б/р╕Цр╕╕р╕З (р╕Бр╕Б.)</th>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а</tr>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а</thead>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а<tbody id="weighing-history-body">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а<tr>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а<td colspan="4" class="px-6 py-8 text-center text-stone-400">р╕Бр╕│р╕ер╕▒р╕Зр╣Вр╕лр╕ер╕Фр╕Вр╣Йр╕нр╕бр╕╣р╕е...</td>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а</tr>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а</tbody>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а</table>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а</div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>


┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="border-t pt-8 mt-8">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="bg-red-50 border border-red-200 p-6 rounded-xl">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h3 class="text-lg font-semibold text-red-800">р╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕Вр╣Йр╕нр╕бр╕╣р╕е (р╕Бр╕▓р╕гр╕Бр╕гр╕░р╕Чр╕│р╕Щр╕╡р╣Йр╕бр╕╡р╕Др╕зр╕▓р╕бр╣Ар╕кр╕╡р╣Ир╕вр╕З)</h3>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p class="text-sm text-red-600 mt-1 mb-4">р╣Гр╕Кр╣Йр╕кр╕│р╕лр╕гр╕▒р╕Ър╕ер╣Йр╕▓р╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Бр╕▓р╕гр╕гр╕▒р╕Ър╕зр╕▓р╕Зр╕вр╕▓р╕Зр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Фр╕Вр╕нр╕Зр╕зр╕▒р╕Щр╕Щр╕╡р╣Йр╣Ар╕бр╕╖р╣Ир╕нр╣Ар╕гр╕┤р╣Ир╕бр╕Бр╕▓р╕гр╕Кр╕▒р╣Ир╕Зр╕Ир╕гр╕┤р╕З</p>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button id="delete-all-weighings-btn" class="w-full md:w-auto bg-red-600 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ЁЯЧСя╕П р╕ер╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Чр╕╡р╣Ир╕зр╕▓р╕Зр╣Др╕зр╣Йр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф (р╕кр╕│р╕лр╕гр╕▒р╕Ър╕зр╕▒р╕Щр╕Щр╕╡р╣Й)
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </button>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </section>
┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а </main>
┬а ┬а </div>

┬а ┬а <div id="print-area" class="bg-white"></div>

┬а ┬а <div id="modal" class="modal-backdrop fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden opacity-0 transition-opacity duration-300 no-print" aria-labelledby="modal-title" role="dialog" aria-modal="true">
┬а ┬а ┬а ┬а <div class="modal-content bg-white rounded-xl shadow-2xl w-full max-w-md transform scale-95 transition-transform duration-300">
┬а ┬а ┬а ┬а ┬а ┬а <div class="p-6">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="text-center">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h3 id="modal-title" class="text-lg leading-6 font-bold text-stone-900"></h3>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="mt-2" id="modal-message-container">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p id="modal-message" class="text-sm text-stone-500"></p>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а <div id="modal-actions" class="bg-stone-50 px-6 py-4 rounded-b-xl flex flex-row-reverse gap-3">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а </div>
┬а ┬а </div>

┬а ┬а <script type="module">
┬а ┬а ┬а ┬а /* Copyright (c) 2025 р╕Чр╕╡р╕Ыр╕гр╕Бр╕г р╕Щр╕▓р╕Др╕ир╕┤р╕гр╕┤р╕ир╕┤р╕е. All Rights Reserved. */
┬а ┬а ┬а ┬а import {
┬а ┬а ┬а ┬а ┬а ┬а initializeApp
┬а ┬а ┬а ┬а } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
┬а ┬а ┬а ┬а import {
┬а ┬а ┬а ┬а ┬а ┬а getAnalytics
┬а ┬а ┬а ┬а } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-analytics.js";
┬а ┬а ┬а ┬а import {
┬а ┬а ┬а ┬а ┬а ┬а getAuth,
┬а ┬а ┬а ┬а ┬а ┬а signInAnonymously,
┬а ┬а ┬а ┬а ┬а ┬а onAuthStateChanged
┬а ┬а ┬а ┬а } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
┬а ┬а ┬а ┬а import {
┬а ┬а ┬а ┬а ┬а ┬а getFirestore,
┬а ┬а ┬а ┬а ┬а ┬а collection,
┬а ┬а ┬а ┬а ┬а ┬а doc,
┬а ┬а ┬а ┬а ┬а ┬а addDoc,
┬а ┬а ┬а ┬а ┬а ┬а updateDoc,
┬а ┬а ┬а ┬а ┬а ┬а deleteDoc,
┬а ┬а ┬а ┬а ┬а ┬а onSnapshot,
┬а ┬а ┬а ┬а ┬а ┬а query,
┬а ┬а ┬а ┬а ┬а ┬а where,
┬а ┬а ┬а ┬а ┬а ┬а getDocs,
┬а ┬а ┬а ┬а ┬а ┬а getDoc,
┬а ┬а ┬а ┬а ┬а ┬а writeBatch
┬а ┬а ┬а ┬а } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

┬а ┬а ┬а ┬а // Firebase configuration (provided by the environment or a default)
┬а ┬а ┬а ┬а const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {
┬а ┬а ┬а ┬а ┬а ┬а apiKey: "AIzaSyCNVxG6s46SRXOYAeT0rJHAtz_-3IPUJNE",
┬а ┬а ┬а ┬а ┬а ┬а authDomain: "coopksb001.firebaseapp.com",
┬а ┬а ┬а ┬а ┬а ┬а projectId: "coopksb001",
┬а ┬а ┬а ┬а ┬а ┬а storageBucket: "coopksb001.appspot.com",
┬а ┬а ┬а ┬а ┬а ┬а messagingSenderId: "259378610497",
┬а ┬а ┬а ┬а ┬а ┬а appId: "1:259378610497:web:fd12679830e97bf5e761c0",
┬а ┬а ┬а ┬а ┬а ┬а measurementId: "G-1RHH9TMD73"
┬а ┬а ┬а ┬а };

┬а ┬а ┬а ┬а // Application ID (provided by the environment or a default)
┬а ┬а ┬а ┬а const appId = typeof __app_id !== 'undefined' ? __app_id : 'cup-rubber-sales-app';

┬а ┬а ┬а ┬а // --- NEW: Password Management ---
┬а ┬а ┬а ┬а let currentPassword = localStorage.getItem('customPassword') || 'as54321';

┬а ┬а ┬а ┬а // Global variables
┬а ┬а ┬а ┬а let localSalesData = [];
┬а ┬а ┬а ┬а let localWeighingData = [];
┬а ┬а ┬а ┬а let dailyStatsChart;
┬а ┬а ┬а ┬а let editingId = null;
┬а ┬а ┬а ┬а let editingWeighingId = null;
┬а ┬а ┬а ┬а let db, auth, userId, salesCollectionRef, weighingsCollectionRef;
┬а ┬а ┬а ┬а let unsubscribeSales = null;
┬а ┬а ┬а ┬а let unsubscribeAllWeighings = null;
┬а ┬а ┬а ┬а let unsubscribeWeighings = {};
┬а ┬а ┬а ┬а let dailyWeighingData = {};
┬а ┬а ┬а ┬а let isPriceLocked = false;
┬а ┬а ┬а ┬а let isAppInitialized = false;

┬а ┬а ┬а ┬а // UI elements mapping
┬а ┬а ┬а ┬а const ui = {
┬а ┬а ┬а ┬а ┬а ┬а loginScreen: document.getElementById('login-screen'),
┬а ┬а ┬а ┬а ┬а ┬а appContainer: document.getElementById('app'),
┬а ┬а ┬а ┬а ┬а ┬а loginButton: document.getElementById('login-button'),
┬а ┬а ┬а ┬а ┬а ┬а logoutButton: document.getElementById('logout-button'),
┬а ┬а ┬а ┬а ┬а ┬а usernameInput: document.getElementById('username-input'),
┬а ┬а ┬а ┬а ┬а ┬а passwordInput: document.getElementById('password-input'),
┬а ┬а ┬а ┬а ┬а ┬а loginError: document.getElementById('login-error'),
┬а ┬а ┬а ┬а ┬а ┬а changePasswordBtn: document.getElementById('change-password-btn'),
┬а ┬а ┬а ┬а ┬а ┬а weighingHistoryBody: document.getElementById('weighing-history-body'),
┬а ┬а ┬а ┬а ┬а ┬а tabs: document.getElementById('tabs'),
┬а ┬а ┬а ┬а ┬а ┬а tabContents: document.querySelectorAll('.tab-content'),
┬а ┬а ┬а ┬а ┬а ┬а sellerNameInput: document.getElementById('seller-name'),
┬а ┬а ┬а ┬а ┬а ┬а receiptDateInput: document.getElementById('receipt-date'),
┬а ┬а ┬а ┬а ┬а ┬а dateDisplay: document.getElementById('date-display'),
┬а ┬а ┬а ┬а ┬а ┬а scaleNumberInput: document.getElementById('scale-number'),
┬а ┬а ┬а ┬а ┬а ┬а weightInputsContainer: document.getElementById('weight-inputs-container'),
┬а ┬а ┬а ┬а ┬а ┬а pricePerKgInput: document.getElementById('price-per-kg'),
┬а ┬а ┬а ┬а ┬а ┬а priceLockBtn: document.getElementById('price-lock-btn'),
┬а ┬а ┬а ┬а ┬а ┬а priceLockIcon: document.getElementById('price-lock-icon'),
┬а ┬а ┬а ┬а ┬а ┬а totalWeightEl: document.getElementById('total-weight'),
┬а ┬а ┬а ┬а ┬а ┬а totalAmountEl: document.getElementById('total-amount'),
┬а ┬а ┬а ┬а ┬а ┬а totalAmountTextEl: document.getElementById('total-amount-text'),
┬а ┬а ┬а ┬а ┬а ┬а saveButton: document.getElementById('save-button'),
┬а ┬а ┬а ┬а ┬а ┬а cancelEditButton: document.getElementById('cancel-edit-button'),
┬а ┬а ┬а ┬а ┬а ┬а salesTableBody: document.getElementById('sales-table-body'),
┬а ┬а ┬а ┬а ┬а ┬а searchBox: document.getElementById('search-box'),
┬а ┬а ┬а ┬а ┬а ┬а printArea: document.getElementById('print-area'),
┬а ┬а ┬а ┬а ┬а ┬а reportDateSelect: document.getElementById('report-date-select'),
┬а ┬а ┬а ┬а ┬а ┬а printReportBtn: document.getElementById('print-report-btn'),
┬а ┬а ┬а ┬а ┬а ┬а exportExcelBtn: document.getElementById('export-excel-btn'),
┬а ┬а ┬а ┬а ┬а ┬а printDashboardBtn: document.getElementById('print-dashboard-btn'),
┬а ┬а ┬а ┬а ┬а ┬а dashboardSection: document.getElementById('dashboard'),
┬а ┬а ┬а ┬а ┬а ┬а modal: document.getElementById('modal'),
┬а ┬а ┬а ┬а ┬а ┬а modalTitle: document.getElementById('modal-title'),
┬а ┬а ┬а ┬а ┬а ┬а modalMessageContainer: document.getElementById('modal-message-container'),
┬а ┬а ┬а ┬а ┬а ┬а modalMessage: document.getElementById('modal-message'),
┬а ┬а ┬а ┬а ┬а ┬а modalActions: document.getElementById('modal-actions'),
┬а ┬а ┬а ┬а ┬а ┬а summaryTotalSellers: document.getElementById('summary-total-sellers'),
┬а ┬а ┬а ┬а ┬а ┬а summaryTotalWeight: document.getElementById('summary-total-weight'),
┬а ┬а ┬а ┬а ┬а ┬а summaryTotalPrice: document.getElementById('summary-total-price'),
┬а ┬а ┬а ┬а ┬а ┬а summaryTotalBags: document.getElementById('summary-total-bags'),
┬а ┬а ┬а ┬а ┬а ┬а summaryMultiplierWeight: document.getElementById('summary-multiplier-weight'),
┬а ┬а ┬а ┬а ┬а ┬а summaryCalculatedWeight: document.getElementById('summary-calculated-weight'),
┬а ┬а ┬а ┬а ┬а ┬а deleteAllWeighingsBtn: document.getElementById('delete-all-weighings-btn'),
┬а ┬а ┬а ┬а ┬а ┬а salesSummaryByScale: document.getElementById('sales-summary-by-scale'),
┬а ┬а ┬а ┬а ┬а ┬а salesSummaryTodayTotal: document.getElementById('sales-summary-today-total'),
┬а ┬а ┬а ┬а ┬а ┬а summaryTodayTotalWeight: document.getElementById('summary-today-total-weight'),
┬а ┬а ┬а ┬а ┬а ┬а summaryTodayTotalAmount: document.getElementById('summary-today-total-amount'),
┬а ┬а ┬а ┬а };

┬а ┬а ┬а ┬а // --- Core Application Logic ---

┬а ┬а ┬а ┬а function switchToTab(targetTabId) {
┬а ┬а ┬а ┬а ┬а ┬а ui.tabs.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
┬а ┬а ┬а ┬а ┬а ┬а ui.tabContents.forEach(content => content.classList.remove('active'));
┬а ┬а ┬а ┬а ┬а ┬а const targetButton = document.querySelector(`.tab-btn[data-tab="${targetTabId}"]`);
┬а ┬а ┬а ┬а ┬а ┬а if (targetButton) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а targetButton.classList.add('active');
┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а const targetContent = document.getElementById(targetTabId);
┬а ┬а ┬а ┬а ┬а ┬а if (targetContent) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а targetContent.classList.add('active');
┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а function showModal(title, message, buttons) {
┬а ┬а ┬а ┬а ┬а ┬а ui.modalTitle.textContent = title;
┬а ┬а ┬а ┬а ┬а ┬а ui.modalMessageContainer.innerHTML = message; // Use container for complex HTML
┬а ┬а ┬а ┬а ┬а ┬а ui.modalActions.innerHTML = '';
┬а ┬а ┬а ┬а ┬а ┬а buttons.forEach(btn => {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const buttonEl = document.createElement('button');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а buttonEl.textContent = btn.text;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а buttonEl.className = btn.classes;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а buttonEl.onclick = () => {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const shouldHide = btn.onClick ? btn.onClick() : true;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if(shouldHide !== false) { // handler can return false to prevent auto-hide
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а hideModal();
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а };
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.modalActions.appendChild(buttonEl);
┬а ┬а ┬а ┬а ┬а ┬а });
┬а ┬а ┬а ┬а ┬а ┬а ui.modal.classList.remove('hidden');
┬а ┬а ┬а ┬а ┬а ┬а setTimeout(() => {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.modal.classList.remove('opacity-0');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.modal.querySelector('.modal-content').classList.remove('scale-95');
┬а ┬а ┬а ┬а ┬а ┬а }, 10);
┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а function hideModal() {
┬а ┬а ┬а ┬а ┬а ┬а ui.modal.classList.add('opacity-0');
┬а ┬а ┬а ┬а ┬а ┬а ui.modal.querySelector('.modal-content').classList.add('scale-95');
┬а ┬а ┬а ┬а ┬а ┬а setTimeout(() => ui.modal.classList.add('hidden'), 300);
┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а function showAlert(message) {
┬а ┬а ┬а ┬а ┬а ┬а showModal('р╣Бр╕Ир╣Йр╕Зр╣Ар╕Хр╕╖р╕нр╕Щ', `<p class="text-sm text-stone-500">${message}</p>`, [{
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а text: 'р╕Хр╕Бр╕ер╕З',
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а classes: 'w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-amber-600 text-base font-medium text-white hover:bg-amber-700 sm:w-auto sm:text-sm'
┬а ┬а ┬а ┬а ┬а ┬а }]);
┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а┬а
┬а ┬а ┬а ┬а // ... (The rest of your functions: showConfirm, bahttext, etc., remain the same) ...

┬а ┬а ┬а ┬а function showConfirm(message, onConfirm) {
┬а ┬а ┬а ┬а ┬а ┬а showModal('р╕вр╕╖р╕Щр╕вр╕▒р╕Щр╕Бр╕▓р╕гр╕Фр╕│р╣Ар╕Щр╕┤р╕Щр╕Бр╕▓р╕г', `<p class="text-sm text-stone-500">${message}</p>`, [{
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а text: 'р╕вр╕╖р╕Щр╕вр╕▒р╕Щ',
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а classes: 'w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 sm:ml-3 sm:w-auto sm:text-sm',
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а onClick: onConfirm
┬а ┬а ┬а ┬а ┬а ┬а }, {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а text: 'р╕вр╕Бр╣Ар╕ер╕┤р╕Б',
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а classes: 'mt-3 w-full inline-flex justify-center rounded-md border border-stone-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-stone-700 hover:bg-stone-50 sm:mt-0 sm:w-auto sm:text-sm'
┬а ┬а ┬а ┬а ┬а ┬а }]);
┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а function bahttext(number) {
┬а ┬а ┬а ┬а ┬а ┬а number = Number(number).toFixed(2);
┬а ┬а ┬а ┬а ┬а ┬а let [integer,
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а fraction] = number.split('.');
┬а ┬а ┬а ┬а ┬а ┬а if (parseInt(integer) === 0 && parseInt(fraction) === 0) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return 'р╕ир╕╣р╕Щр╕вр╣Мр╕Ър╕▓р╕Чр╕Цр╣Йр╕зр╕Щ';
┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а const t = ['', 'р╕лр╕Щр╕╢р╣Ир╕З', 'р╕кр╕нр╕З', 'р╕кр╕▓р╕б', 'р╕кр╕╡р╣И', 'р╕лр╣Йр╕▓', 'р╕лр╕Б', 'р╣Ар╕Ир╣Зр╕Ф', 'р╣Бр╕Ыр╕Ф', 'р╣Ар╕Бр╣Йр╕▓'];
┬а ┬а ┬а ┬а ┬а ┬а const r = ['', 'р╕кр╕┤р╕Ъ', 'р╕гр╣Йр╕нр╕в', 'р╕Юр╕▒р╕Щ', 'р╕лр╕бр╕╖р╣Ир╕Щ', 'р╣Бр╕кр╕Щ', 'р╕ер╣Йр╕▓р╕Щ'];
┬а ┬а ┬а ┬а ┬а ┬а const convert = (n) => {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а let s = '';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а let l = n.length;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а for (let i = 0; i < l; i++) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а let d = parseInt(n.charAt(i));
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а let p = l - i - 1;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (d > 0) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (p === 1 && d === 2) s += 'р╕вр╕╡р╣И';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а else if (p === 1 && d === 1) s += '';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а else if (p === 0 && d === 1 && s.length > 0 && n.length > 1 && n.charAt(n.length - 2) !== '0') s += 'р╣Ар╕нр╣Зр╕Ф';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а else s += t[d];
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а s += r[p];
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return s;
┬а ┬а ┬а ┬а ┬а ┬а };
┬а ┬а ┬а ┬а ┬а ┬а let intText = convert(integer);
┬а ┬а ┬а ┬а ┬а ┬а let fracText = convert(fraction);
┬а ┬а ┬а ┬а ┬а ┬а if (intText) intText += 'р╕Ър╕▓р╕Ч';
┬а ┬а ┬а ┬а ┬а ┬а if (fracText) fracText += 'р╕кр╕Хр╕▓р╕Зр╕Др╣М';
┬а _z-index: 99; ┬а ┬а ┬а if (!fracText && intText) fracText = 'р╕Цр╣Йр╕зр╕Щ';
┬а ┬а ┬а ┬а ┬а ┬а return intText + fracText;
┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а function calculateTotals() {
┬а ┬а ┬а ┬а ┬а ┬а let totalWeight = 0;
┬а ┬а ┬а ┬а ┬а ┬а const weightInputs = ui.weightInputsContainer.querySelectorAll('.weight-input');
┬а ┬а ┬а ┬а ┬а ┬а weightInputs.forEach(input => {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а totalWeight += parseFloat(input.value) || 0;
┬а ┬а ┬а ┬а ┬а ┬а });
┬а ┬а ┬а ┬а ┬а ┬а const pricePerKg = parseFloat(ui.pricePerKgInput.value) || 0;
┬а ┬а ┬а ┬а ┬а ┬а const totalAmount = totalWeight * pricePerKg;
┬а ┬а ┬а ┬а ┬а ┬а ui.totalWeightEl.textContent = totalWeight.toFixed(2);
┬а ┬а ┬а ┬а ┬а ┬а ui.totalAmountEl.textContent = totalAmount.toLocaleString('th-TH', {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а minimumFractionDigits: 2,
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а maximumFractionDigits: 2
┬а ┬а ┬а ┬а ┬а ┬а });
┬а ┬а ┬а ┬а ┬а ┬а ui.totalAmountTextEl.textContent = bahttext(totalAmount);
┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а function renderTable(dataToRender) {
┬а ┬а ┬а ┬а ┬а ┬а ui.salesTableBody.innerHTML = '';
┬а ┬а ┬а ┬а ┬а ┬а if (dataToRender.length === 0) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.salesTableBody.innerHTML = '<tr><td colspan="7" class="px-6 py-12 text-center text-stone-400">р╣Др╕бр╣Ир╕Юр╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕е...</td></tr>';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return;
┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а dataToRender.forEach((sale) => {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const row = document.createElement('tr');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а row.className = 'bg-white border-b hover:bg-stone-50';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const saleDate = sale.date instanceof Date ? sale.date : sale.date.toDate();
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а row.innerHTML = `
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-4 py-4 text-center font-medium text-stone-700">${sale.dailyQueueNumber || '-'}</td>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-6 py-4">${saleDate.toLocaleDateString('th-TH')}</td>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-6 py-4 font-medium text-stone-900 whitespace-nowrap">${sale.seller}</td>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-6 py-4 text-right">${sale.weight.toFixed(2)}</td>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-6 py-4 text-right">${sale.price.toFixed(2)}</td>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-6 py-4 text-right font-bold text-amber-600">${sale.total.toLocaleString('th-TH', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-6 py-4 text-center">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="flex items-center justify-center gap-2">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а<button class="reprint-btn text-gray-500 hover:text-gray-800 p-2 rounded-md hover:bg-gray-100" data-id="${sale.id}" title="р╕Юр╕┤р╕бр╕Юр╣Мр╕Лр╣Йр╕│">ЁЯЦия╕П</button>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а<button class="edit-btn text-blue-600 hover:text-blue-800 p-2 rounded-md hover:bg-blue-100" data-id="${sale.id}" title="р╣Бр╕Бр╣Йр╣Др╕В">тЬПя╕П</button>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а<button class="delete-btn text-red-600 hover:text-red-800 p-2 rounded-md hover:bg-red-100" data-id="${sale.id}" title="р╕ер╕Ъ">ЁЯЧСя╕П</button>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </td>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а `;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.salesTableBody.appendChild(row);
┬а ┬а ┬а ┬а ┬а ┬а });
┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а function renderSummary() {
┬а ┬а ┬а ┬а ┬а ┬а if (!localSalesData || localSalesData.length === 0) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.summaryTotalSellers.textContent = '0';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.summaryTotalWeight.textContent = '0.00';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.summaryTotalPrice.textContent = '0.00';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return;
┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а const totalSellers = new Set(localSalesData.map(s => s.seller)).size;
┬а ┬а ┬а ┬а ┬а ┬а const totalWeight = localSalesData.reduce((acc, sale) => acc + sale.weight, 0);
┬а ┬а ┬а ┬а ┬а ┬а const totalPrice = localSalesData.reduce((acc, sale) => acc + sale.total, 0);
┬а ┬а ┬а ┬а ┬а ┬а ui.summaryTotalSellers.textContent = totalSellers.toLocaleString('th-TH');
┬а ┬а ┬а ┬а ┬а ┬а ui.summaryTotalWeight.textContent = totalWeight.toLocaleString('th-TH', {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а minimumFractionDigits: 2,
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а maximumFractionDigits: 2
┬а ┬а ┬а ┬а ┬а ┬а });
┬а ┬а ┬а ┬а ┬а ┬а ui.summaryTotalPrice.textContent = totalPrice.toLocaleString('th-TH', {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а minimumFractionDigits: 2,
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а maximumFractionDigits: 2
┬а ┬а ┬а ┬а ┬а ┬а });
┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а function renderDashboard() {
┬а ┬а ┬а ┬а ┬а ┬а renderDailyStatsChart();
┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а function renderDailyStatsChart() {
┬а ┬а ┬а ┬а ┬а ┬а const statsByDay = localSalesData.reduce((acc, sale) => {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const day = sale.date.toDate().toISOString().split('T')[0];
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (!acc[day]) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а acc[day] = {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а totalWeight: 0,
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а totalValue: 0
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а };
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а acc[day].totalWeight += sale.weight;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а acc[day].totalValue += sale.total;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return acc;
┬а ┬а ┬а ┬а ┬а ┬а }, {});

┬а ┬а ┬а ┬а ┬а ┬а const sortedDays = Object.keys(statsByDay).sort((a, b) => new Date(a) - new Date(b));
┬а ┬а ┬а ┬а ┬а ┬а const labels = sortedDays.map(day => new Date(day).toLocaleDateString('th-TH', {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а year: '2-digit',
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а month: 'short',
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а day: 'numeric'
┬а ┬а ┬а ┬а ┬а ┬а }));
┬а ┬а ┬а ┬а ┬а ┬а const weightData = sortedDays.map(day => statsByDay[day].totalWeight);
┬а ┬а ┬а ┬а ┬а ┬а const priceData = sortedDays.map(day => {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const stats = statsByDay[day];
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return stats.totalWeight > 0 ? stats.totalValue / stats.totalWeight : 0;
┬а ┬а ┬а ┬а ┬а ┬а });

┬а ┬а ┬а ┬а ┬а ┬а if (dailyStatsChart) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а dailyStatsChart.destroy();
┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а const canvas = document.getElementById('daily-stats-chart');
┬а ┬а ┬а ┬а ┬а ┬а if (canvas && labels.length > 0) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а dailyStatsChart = new Chart(canvas.getContext('2d'), {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а data: {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а labels: labels,
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а datasets: [{
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а type: 'bar',
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а label: 'р╕Ыр╕гр╕┤р╕бр╕▓р╕Ур╕вр╕▓р╕З (р╕Бр╕Б.)',
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а data: weightData,
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а backgroundColor: 'rgba(217, 119, 6, 0.6)',
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а borderColor: 'rgb(217, 119, 6)',
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а yAxisID: 'yWeight',
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }, {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а type: 'line',
┬а ┬а ┬а ┬а ┬а ┬а ┬а _z-index: 1000; ┬а ┬а ┬а ┬а ┬а label: 'р╕гр╕▓р╕Др╕▓р╣Ар╕Йр╕ер╕╡р╣Ир╕в (р╕Ър╕▓р╕Ч)',
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а data: priceData,
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а fill: false,
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а backgroundColor: 'rgba(54, 162, 235, 1)',
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а borderColor: 'rgba(54, 162, 235, 1)',
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а tension: 0.1,
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а yAxisID: 'yPrice',
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }]
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а },
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а options: {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а responsive: true,
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а maintainAspectRatio: false,
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а interaction: {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а mode: 'index',
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а intersect: false
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а },
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а scales: {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а x: {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ticks: {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а font: {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а family: "'Sarabun', sans-serif"
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а },
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а yWeight: {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а type: 'linear',
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а display: true,
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а position: 'left',
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а title: {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а display: true,
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а text: 'р╕Ыр╕гр╕┤р╕бр╕▓р╕У (р╕Бр╕Б.)',
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а font: {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а family: "'Sarabun', sans-serif",
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а size: 14
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а },
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а yPrice: {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а type: 'linear',
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а display: true,
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а position: 'right',
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а title: {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а display: true,
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а text: 'р╕гр╕▓р╕Др╕▓р╣Ар╕Йр╕ер╕╡р╣Ир╕в (р╕Ър╕▓р╕Ч)',
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а font: {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а family: "'Sarabun', sans-serif",
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а size: 14
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а },
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а grid: {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а drawOnChartArea: false
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а },
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а plugins: {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а legend: {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а position: 'top',
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а labels: {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а font: {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а family: "'Sarabun', sans-serif"
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а },
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а tooltip: {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а titleFont: { family: "'Sarabun', sans-serif" },
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а bodyFont: { family: "'Sarabun', sans-serif" },
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а footerFont: { family: "'Sarabun', sans-serif" },
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });
┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а┬а
┬а ┬а ┬а ┬а function renderWeighingHistory() {
┬а ┬а ┬а ┬а ┬а ┬а const historyBody = ui.weighingHistoryBody;
┬а ┬а ┬а ┬а ┬а ┬а if (!historyBody) return;

┬а ┬а ┬а ┬а ┬а ┬а const salesWeightByDay = localSalesData.reduce((acc, sale) => {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const day = sale.date.toDate().toISOString().split('T')[0];
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (!acc[day]) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а acc[day] = 0;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а acc[day] += sale.weight;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return acc;
┬а ┬а ┬а ┬а ┬а ┬а }, {});

┬а ┬а ┬а ┬а ┬а ┬а const statsByDay = localWeighingData.reduce((acc, entry) => {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const day = entry.timestamp.toDate().toISOString().split('T')[0];
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (!acc[day]) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а acc[day] = { totalBags: 0, recordCount: 0 };
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а acc[day].totalBags += entry.bags;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а acc[day].recordCount++;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return acc;
┬а ┬а ┬а ┬а ┬а ┬а }, {});

┬а ┬а ┬а ┬а ┬а ┬а const sortedDays = Object.keys(statsByDay).sort((a, b) => new Date(b) - new Date(a));

┬а ┬а ┬а ┬а ┬а ┬а historyBody.innerHTML = '';
┬а ┬а ┬а ┬а ┬а ┬а if (sortedDays.length === 0) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а historyBody.innerHTML = '<tr><td colspan="4" class="px-6 py-8 text-center text-stone-400">р╕вр╕▒р╕Зр╣Др╕бр╣Ир╕бр╕╡р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕вр╣Йр╕нр╕Щр╕лр╕ер╕▒р╕З</td></tr>';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return;
┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а sortedDays.forEach(day => {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const stats = statsByDay[day];
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const currentDate = new Date(day);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а currentDate.setDate(currentDate.getDate() + 1);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const nextDayKey = currentDate.toISOString().split('T')[0];
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const nextDayWeight = salesWeightByDay[nextDayKey] || 0;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const averageWeight = (nextDayWeight > 0 && stats.totalBags > 0)┬а
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ? (nextDayWeight / stats.totalBags)┬а
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а : 0;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const formattedDate = new Date(day).toLocaleDateString('th-TH', {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а year: 'numeric', month: 'long', day: 'numeric'
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const row = document.createElement('tr');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а row.className = 'bg-white border-b hover:bg-stone-50';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а row.innerHTML = `
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-6 py-4 font-medium text-stone-900">${formattedDate}</td>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-6 py-4 text-center">${stats.recordCount.toLocaleString('th-TH')}</td>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-6 py-4 text-center font-bold text-amber-700">${stats.totalBags.toLocaleString('th-TH')}</td>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-6 py-4 text-center font-semibold text-blue-600">${averageWeight.toFixed(2)}</td>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а `;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а historyBody.appendChild(row);
┬а ┬а ┬а ┬а ┬а ┬а });
┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а // --- Other Functions ---
┬а ┬а ┬а ┬а┬а
┬а ┬а ┬а ┬а function createPrintableReceipt(sale) {
┬а ┬а ┬а ┬а ┬а ┬а const saleDate = sale.date instanceof Date ? sale.date : sale.date.toDate();
┬а ┬а ┬а ┬а ┬а ┬а const generateSingleReceiptHTML = (title) => `
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="w-1/2 p-4 flex flex-col text-xs" style="border: 2px dashed #9ca3af; height: 100vh;">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="text-center mb-4">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h2 class="text-base font-bold">${title}</h2>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h3 class="text-sm font-semibold mt-1">р╕кр╕лр╕Бр╕гр╕Ур╣Мр╕Бр╕нр╕Зр╕Чр╕╕р╕Щр╕кр╕зр╕Щр╕вр╕▓р╕Зр╕Юр╕▓р╕гр╕▓р╣Ар╕Бр╕йр╕Хр╕гр╕кр╕бр╕Ър╕╣р╕гр╕Ур╣М р╕Ир╕│р╕Бр╕▒р╕Ф</h3>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p class="text-xs text-stone-600">15/1 р╕б.6 р╕Х.р╕лр╕Щр╕нр╕Зр╣Вр╕Юр╕Щр╕Зр╕▓р╕б р╕н.р╣Ар╕Бр╕йр╕Хр╕гр╕кр╕бр╕Ър╕╣р╕гр╕Ур╣М р╕И.р╕Кр╕▒р╕вр╕ар╕╣р╕бр╕┤</p>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="border-y border-dotted border-stone-400 py-1 mb-2">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="flex justify-between"><span>р╣Ар╕ер╕Вр╕Чр╕╡р╣И:</span><span>${sale.receiptId || 'N/A'}</span></div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="flex justify-between mt-1"><span>р╕зр╕▒р╕Щр╕Чр╕╡р╣И:</span><span>${saleDate.toLocaleDateString('th-TH', { year: 'numeric', month: 'long', day: 'numeric' })}</span></div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="flex justify-between mt-1"><span>р╕Хр╕▓р╕Кр╕▒р╣Ир╕Зр╕Чр╕╡р╣И:</span><span>${sale.scaleNumber || '-'}</span></div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="mb-2"><strong>р╕Ьр╕╣р╣Йр╕Вр╕▓р╕в:</strong> <span class="font-bold text-base">${sale.seller}</span></div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <table class="w-full my-1">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <thead class="border-y border-dotted border-stone-400">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <tr><th class="py-1 text-left font-semibold">р╕гр╕▓р╕вр╕Бр╕▓р╕г</th><th class="py-1 text-right font-semibold">р╕вр╕нр╕Фр╕гр╕зр╕б (р╕Ър╕▓р╕Ч)</th></tr>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </thead>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <tbody class="border-b border-dotted border-stone-400">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а<tr>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а<td class="py-2 align-top">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬ар╕Др╣Ир╕▓р╕вр╕▓р╕Зр╕Бр╣Йр╕нр╕Щр╕Цр╣Йр╕зр╕в
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а<span class="block text-xs text-stone-600">р╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Б: ${sale.weight.toFixed(2)} р╕Бр╕Б. @ ${sale.price.toFixed(2)} р╕Ър╕▓р╕Ч/р╕Бр╕Б.</span>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а</td>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а<td class="text-right align-top pt-2">${sale.total.toLocaleString('th-TH', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а</tr>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </tbody>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <tfoot>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <tr class="font-bold"><td class="py-2 text-base">р╕гр╕зр╕бр╣Ар╕Ыр╣Зр╕Щр╣Ар╕Зр╕┤р╕Щ</td><td class="text-right text-xl">${sale.total.toLocaleString('th-TH', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td></tr>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </tfoot>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </table>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а<div class="text-center text-stone-600 mt-2">(${bahttext(sale.total)})</div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="flex-grow"></div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="flex justify-around text-center mt-12">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а<div><p class="pb-1">........................................</p><p>(р╕Ьр╕╣р╣Йр╕гр╕▒р╕Ър╣Ар╕Зр╕┤р╕Щ)</p></div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а<div><p class="pb-1">........................................</p><p>(р╕Ьр╕╣р╣Йр╕Ир╣Ир╕▓р╕вр╣Ар╕Зр╕┤р╕Щ)</p></div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>`;
┬а ┬а ┬а ┬а ┬а ┬а ui.printArea.innerHTML = `<div class="flex gap-0">${generateSingleReceiptHTML('р╣Гр╕Ър╣Ар╕кр╕гр╣Зр╕Ир╕гр╕▒р╕Ър╣Ар╕Зр╕┤р╕Щ (р╕Хр╣Йр╕Щр╕Йр╕Ър╕▒р╕Ъ)')}${generateSingleReceiptHTML('р╣Гр╕Ър╣Ар╕кр╕гр╣Зр╕Ир╕гр╕▒р╕Ър╣Ар╕Зр╕┤р╕Щ (р╕кр╕│р╣Ар╕Щр╕▓)')}</div>`;
┬а ┬а ┬а ┬а ┬а ┬а window.print();
┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а // ... (The rest of your functions: createDailySummaryReport, clearForm, etc. remain the same) ...

┬а ┬а ┬а ┬а function createDailySummaryReport() {
┬а ┬а ┬а ┬а ┬а ┬а const reportDateStr = ui.reportDateSelect.value;
┬а ┬а ┬а ┬а ┬а ┬а if (!reportDateStr) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showAlert('р╕Бр╕гр╕╕р╕Ур╕▓р╣Ар╕ер╕╖р╕нр╕Бр╕зр╕▒р╕Щр╕Чр╕╡р╣Ир╕Чр╕╡р╣Ир╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕Чр╕│р╕гр╕▓р╕вр╕Зр╕▓р╕Щ');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return;
┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а const reportDate = new Date(reportDateStr);
┬а ┬а ┬а ┬а ┬а ┬а const formattedDate = reportDate.toLocaleDateString('th-TH', {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а year: 'numeric',
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а month: 'long',
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а day: 'numeric'
┬а ┬а ┬а ┬а ┬а ┬а });
┬а ┬а ┬а ┬а ┬а ┬а const reportStart = new Date(reportDate.getFullYear(), reportDate.getMonth(), reportDate.getDate());
┬а ┬а ┬а ┬а ┬а ┬а const reportEnd = new Date(reportDate.getFullYear(), reportDate.getMonth(), reportDate.getDate(), 23, 59, 59, 999);

┬а ┬а ┬а ┬а ┬а ┬а const salesForDay = localSalesData.filter(sale => {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const saleDate = sale.date.toDate();
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return saleDate >= reportStart && saleDate <= reportEnd;
┬а ┬а ┬а ┬а ┬а ┬а }).sort((a, b) => (a.dailyQueueNumber || 0) - (b.dailyQueueNumber || 0));

┬а ┬а ┬а ┬а ┬а ┬а if (salesForDay.length === 0) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showAlert(`р╣Др╕бр╣Ир╕Юр╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Бр╕▓р╕гр╕Вр╕▓р╕вр╣Гр╕Щр╕зр╕▒р╕Щр╕Чр╕╡р╣И ${formattedDate}`);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return;
┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а const totalWeight = salesForDay.reduce((sum, sale) => sum + sale.weight, 0);
┬а ┬а ┬а ┬а ┬а ┬а const totalAmount = salesForDay.reduce((sum, sale) => sum + sale.total, 0);

┬а ┬а ┬а ┬а ┬а ┬а const tableRows = salesForDay.map((sale, index) => `
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <tr class="border-b">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-2 py-2 text-center">${sale.dailyQueueNumber || index + 1}</td>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-2 py-2">${sale.seller}</td>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-2 py-2 text-right">${sale.weight.toFixed(2)}</td>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-2 py-2 text-right">${sale.price.toFixed(2)}</td>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-2 py-2 text-right">${sale.total.toFixed(2)}</td>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-2 py-2 text-center">${sale.scaleNumber || ''}</td>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-2 py-2 border-l"></td>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </tr>
┬а ┬а ┬а ┬а ┬а ┬а `).join('');

┬а ┬а ┬а ┬а ┬а ┬а const reportHTML = `
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="p-8 bg-white text-black">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="text-center mb-6">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h2 class="text-xl font-bold">р╕кр╕лр╕Бр╕гр╕Ур╣Мр╕Бр╕нр╕Зр╕Чр╕╕р╕Щр╕кр╕зр╕Щр╕вр╕▓р╕Зр╕Юр╕▓р╕гр╕▓р╣Ар╕Бр╕йр╕Хр╕гр╕кр╕бр╕Ър╕╣р╕гр╕Ур╣М р╕Ир╕│р╕Бр╕▒р╕Ф</h2>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h3 class="text-lg">р╕гр╕▓р╕вр╕Зр╕▓р╕Щр╕Бр╕▓р╕гр╕Кр╕▒р╣Ир╕Зр╕вр╕▓р╕Зр╕Ыр╕гр╕░р╕Ир╕│р╕зр╕▒р╕Щр╕Чр╕╡р╣И ${formattedDate}</h3>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <table class="w-full text-sm border-collapse border border-black">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <thead class="bg-stone-200">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <tr class="border-b-2 border-black">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th class="px-2 py-2 border-r border-black" style="width: 5%;">р╕Др╕┤р╕з</th>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th class="px-2 py-2 border-r border-black" style="width: 30%;">р╕Кр╕╖р╣Ир╕н</th>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th class="px-2 py-2 border-r border-black" style="width: 15%;">р╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Б</th>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th class="px-2 py-2 border-r border-black" style="width: 15%;">р╕гр╕▓р╕Др╕▓</th>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th class="px-2 py-2 border-r border-black" style="width: 15%;">р╕вр╕нр╕Фр╕гр╕зр╕б</th>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th class="px-2 py-2 border-r border-black" style="width: 5%;">р╕Хр╕▓р╕Кр╕▒р╣Ир╕З</th>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th class="px-2 py-2" style="width: 15%;">р╕ер╕▓р╕вр╣Ар╕Лр╣Зр╕Щ</th>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </tr>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </thead>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <tbody>${tableRows}</tbody>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <tfoot class="font-bold bg-stone-200">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а<tr class="border-t-2 border-black">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а<td class="px-2 py-2 text-right" colspan="2">р╕гр╕зр╕бр╕Чр╕▒р╣Йр╕Зр╕кр╕┤р╣Йр╕Щ</td>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а<td class="px-2 py-2 text-right">${totalWeight.toFixed(2)}</td>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а<td class="px-2 py-2 text-right"></td>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а _z-index: 1000; ┬а ┬а ┬а<td class="px-2 py-2 text-right">${totalAmount.toFixed(2)}</td>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а<td class="px-2 py-2" colspan="2"></td>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а</tr>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </tfoot>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </table>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а `;
┬а ┬а ┬а ┬а ┬а ┬а ui.printArea.innerHTML = reportHTML;
┬а ┬а ┬а ┬а ┬а ┬а window.print();
┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а function clearForm() {
┬а ┬а ┬а ┬а ┬а ┬а ui.sellerNameInput.value = '';
┬а ┬а ┬а ┬а ┬а ┬а ui.scaleNumberInput.value = '';
┬а ┬а ┬а ┬а _z-index: 999; ┬а ┬а ui.weightInputsContainer.querySelectorAll('.weight-input').forEach(input => input.value = '');
┬а ┬а ┬а ┬а ┬а ┬а if (!isPriceLocked) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.pricePerKgInput.value = '';
┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а editingId = null;
┬а ┬а ┬а ┬а ┬а ┬а ui.saveButton.textContent = 'р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╣Бр╕ер╕░р╕Юр╕┤р╕бр╕Юр╣Мр╣Гр╕Ър╣Ар╕кр╕гр╣Зр╕И';
┬а ┬а ┬а ┬а ┬а ┬а ui.cancelEditButton.classList.add('hidden');
┬а ┬а ┬а ┬а ┬а ┬а calculateTotals();
┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а function togglePriceLock() {
┬а ┬а ┬а ┬а ┬а ┬а isPriceLocked = !isPriceLocked;
┬а ┬а ┬а ┬а ┬а ┬а if (isPriceLocked) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.pricePerKgInput.readOnly = true;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.pricePerKgInput.classList.add('bg-stone-200', 'cursor-not-allowed');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.priceLockIcon.textContent = 'ЁЯФТ';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.priceLockBtn.title = 'р╕Ыр╕ер╕Фр╕ер╣Зр╕нр╕Др╕гр╕▓р╕Др╕▓';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.priceLockBtn.classList.replace('bg-gray-400', 'bg-sky-500');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.priceLockBtn.classList.replace('hover:bg-gray-500', 'hover:bg-sky-600');
┬а ┬а ┬а ┬а ┬а ┬а } else {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.pricePerKgInput.readOnly = false;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.pricePerKgInput.classList.remove('bg-stone-200', 'cursor-not-allowed');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.priceLockIcon.textContent = 'ЁЯФУ';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.priceLockBtn.title = 'р╕ер╣Зр╕нр╕Др╕гр╕▓р╕Др╕▓';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.priceLockBtn.classList.replace('bg-sky-500', 'bg-gray-400');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.priceLockBtn.classList.replace('hover:bg-sky-600', 'hover:bg-gray-500');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.pricePerKgInput.focus();
┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а async function handleSave() {
┬а ┬а ┬а ┬а ┬а ┬а if (!salesCollectionRef) return showAlert('р╕вр╕▒р╕Зр╣Др╕бр╣Ир╕Юр╕гр╣Йр╕нр╕бр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ р╕Бр╕гр╕╕р╕Ур╕▓р╕гр╕нр╕кр╕▒р╕Бр╕Др╕гр╕╣р╣И');
┬а ┬а ┬а ┬а ┬а ┬а const seller = ui.sellerNameInput.value.trim();
┬а ┬а ┬а ┬а ┬а ┬а const date = ui.receiptDateInput.valueAsDate;
┬а ┬а ┬а ┬а ┬а ┬а const scaleNumber = ui.scaleNumberInput.value;
┬а ┬а ┬а ┬а ┬а ┬а const weight = parseFloat(ui.totalWeightEl.textContent) || 0;
┬а ┬а ┬а ┬а ┬а ┬а const price = parseFloat(ui.pricePerKgInput.value) || 0;
┬а ┬а ┬а ┬а ┬а ┬а const total = parseFloat(ui.totalAmountEl.textContent.replace(/,/g, '')) || 0;
┬а ┬а ┬а ┬а ┬а ┬а const weightInputs = Array.from(ui.weightInputsContainer.querySelectorAll('.weight-input')).map(input => parseFloat(input.value) || 0).filter(v => v > 0);

┬а ┬а ┬а ┬а ┬а ┬а if (weightInputs.length === 0 || !seller || !date || weight <= 0 || price <= 0) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return showAlert('р╕Бр╕гр╕╕р╕Ур╕▓р╕Бр╕гр╕нр╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Гр╕лр╣Йр╕Др╕гр╕Ър╕Цр╣Йр╕зр╕Щ: р╕Кр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╕Вр╕▓р╕в, р╕зр╕▒р╕Щр╕Чр╕╡р╣И, р╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Б р╣Бр╕ер╕░р╕гр╕▓р╕Др╕▓');
┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а if (total <= 0) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return showAlert('р╕вр╕нр╕Фр╕гр╕зр╕бр╕Хр╣Йр╕нр╕Зр╕бр╕▓р╕Бр╕Бр╕зр╣Ир╕▓ 0 р╕Ър╕▓р╕Ч');
┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а const saleData = {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а seller,
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а date,
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а scaleNumber,
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а weight,
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а weights: weightInputs,
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а price,
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а total,
┬а ┬а ┬а _z-index: 5; ┬а ┬а ┬а ┬а ┬а timestamp: new Date(),
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а userId
┬а ┬а ┬а ┬а ┬а ┬а };

┬а ┬а ┬а ┬а ┬а ┬а try {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (editingId) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const originalDoc = localSalesData.find(s => s.id === editingId);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (originalDoc) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а saleData.dailyQueueNumber = originalDoc.dailyQueueNumber;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а saleData.receiptId = originalDoc.receiptId;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а await updateDoc(doc(salesCollectionRef, editingId), saleData);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showAlert('р╕нр╕▒р╕Ыр╣Ар╕Фр╕Хр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕кр╕│р╣Ар╕гр╣Зр╕И');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а } else {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const recordDateStart = new Date(date.getFullYear(), date.getMonth(), date.getDate());
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const recordDateEnd = new Date(date.getFullYear(), date.getMonth(), date.getDate(), 23, 59, 59, 999);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const salesOnDate = localSalesData.filter(s => s.date.toDate() >= recordDateStart && s.date.toDate() <= recordDateEnd);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а saleData.dailyQueueNumber = salesOnDate.length + 1;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const now = new Date();
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const year = now.getFullYear().toString().slice(-2);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const month = (now.getMonth() + 1).toString().padStart(2, '0');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const day = now.getDate().toString().padStart(2, '0');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const nextReceiptNumber = localSalesData.length + 1;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а saleData.receiptId = `${year}${month}${day}-${String(nextReceiptNumber).padStart(4, '0')}`;

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const docRef = await addDoc(salesCollectionRef, saleData);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а createPrintableReceipt({ ...saleData,
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а id: docRef.id
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а clearForm();
┬а ┬а ┬а ┬а ┬а ┬а } catch (error) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а console.error("Error saving document: ", error);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showAlert(`р╣Ар╕Бр╕┤р╕Фр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╣Гр╕Щр╕Бр╕▓р╕гр╕Ър╕▒р╕Щр╕Чр╕╢р╕Б: ${error.message}`);
┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а function handleTableClick(e) {
┬а ┬а ┬а ┬а ┬а ┬а const target = e.target.closest('button');
┬а ┬а ┬а ┬а ┬а ┬а if (!target) return;
┬а ┬а ┬а ┬а ┬а ┬а const id = target.dataset.id;
┬а ┬а ┬а ┬а ┬а ┬а const saleToProcess = localSalesData.find(sale => sale.id === id);
┬а ┬а ┬а ┬а ┬а ┬а if (!saleToProcess) return;

┬а ┬а ┬а ┬а ┬а ┬а if (target.classList.contains('delete-btn')) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showConfirm('р╕Др╕╕р╕Ур╣Бр╕Щр╣Ир╣Гр╕Ир╕зр╣Ир╕▓р╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕ер╕Ър╕гр╕▓р╕вр╕Бр╕▓р╕гр╕Щр╕╡р╣Й?', async () => {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а try {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а await deleteDoc(doc(salesCollectionRef, id));
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showAlert('р╕ер╕Ър╕гр╕▓р╕вр╕Бр╕▓р╕гр╕кр╕│р╣Ар╕гр╣Зр╕И');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а } catch (error) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showAlert(`р╣Ар╕Бр╕┤р╕Фр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╣Гр╕Щр╕Бр╕▓р╕гр╕ер╕Ъ: ${error.message}`);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });
┬а ┬а ┬а ┬а ┬а ┬а } else if (target.classList.contains('edit-btn')) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а editingId = id;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.sellerNameInput.value = saleToProcess.seller;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.receiptDateInput.value = saleToProcess.date.toDate().toISOString().split('T')[0];
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.scaleNumberInput.value = saleToProcess.scaleNumber || '';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.pricePerKgInput.value = saleToProcess.price;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const weightInputs = ui.weightInputsContainer.querySelectorAll('.weight-input');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а weightInputs.forEach((input, index) => {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а input.value = saleToProcess.weights[index] || '';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а calculateTotals();
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.saveButton.textContent = 'р╕нр╕▒р╕Ыр╣Ар╕Фр╕Хр╕Вр╣Йр╕нр╕бр╕╣р╕е';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.cancelEditButton.classList.remove('hidden');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а switchToTab('tab-receipt');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а window.scrollTo({
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а top: 0,
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а behavior: 'smooth'
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });
┬а ┬а ┬а ┬а ┬а ┬а } else if (target.classList.contains('reprint-btn')) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а createPrintableReceipt(saleToProcess);
┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а function updateDateDisplay() {
┬а ┬а ┬а ┬а ┬а ┬а const date = ui.receiptDateInput.valueAsDate;
┬а ┬а ┬а ┬а ┬а ┬а ui.dateDisplay.textContent = `(${(date || new Date()).toLocaleDateString('th-TH')})`;
┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а function createWeighingStationHTML(scaleId) {
┬а ┬а ┬а ┬а ┬а ┬а return `
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <section class="bg-white p-6 sm:p-8 rounded-xl shadow-lg">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h2 class="text-2xl font-bold mb-6 border-b pb-3 text-stone-800">р╕гр╕▒р╕Ър╕зр╕▓р╕Зр╕вр╕▓р╕З (р╕Хр╕▓р╕Кр╕▒р╣Ир╕Зр╕Чр╕╡р╣И ${scaleId})</h2>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="md:col-span-2">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="weighing-seller-${scaleId}" class="block text-sm font-medium text-stone-600 mb-1">р╕Кр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╕Вр╕▓р╕в</label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="text" id="weighing-seller-${scaleId}" class="w-full p-3 border border-stone-300 rounded-lg shadow-sm" placeholder="р╕Др╣Йр╕Щр╕лр╕▓р╕лр╕гр╕╖р╕нр╕Ыр╣Йр╕нр╕Щр╕Кр╕╖р╣Ир╕н">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="weighing-weight-${scaleId}" class="block text-sm font-medium text-stone-600 mb-1">р╕Ир╕│р╕Щр╕зр╕Щр╕Цр╕╕р╕З</label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="number" id="weighing-weight-${scaleId}" class="w-full p-3 border border-stone-300 rounded-lg shadow-sm" step="any">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="md:col-span-3">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button id="save-weighing-${scaleId}" data-scale="${scaleId}" class="w-full bg-green-600 text-white font-bold py-3 px-4 rounded-lg shadow-md hover:bg-green-700 transition-colors">р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Ир╕│р╕Щр╕зр╕Щр╕Цр╕╕р╕З</button>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="mt-8 overflow-x-auto rounded-lg border">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <table class="w-full text-sm text-left">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <thead class="bg-stone-100 sticky top-0">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <tr>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th class="px-4 py-3">р╣Ар╕зр╕ер╕▓</th>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th class="px-4 py-3">р╕Кр╕╖р╣Ир╕н</th>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th class="px-4 py-3 text-right">р╕Ир╕│р╕Щр╕зр╕Щр╕Цр╕╕р╕З</th>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th class="px-4 py-3 text-center">р╕Ир╕▒р╕Фр╕Бр╕▓р╕г</th>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а _z-index: 10; ┬а </tr>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </thead>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <tbody id="weighing-table-body-${scaleId}">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <tr><td colspan="4" class="text-center p-8 text-stone-400">р╕вр╕▒р╕Зр╣Др╕бр╣Ир╕бр╕╡р╕гр╕▓р╕вр╕Бр╕▓р╕г</td></tr>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </tbody>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </table>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="border-t mt-8 pt-6">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а<h3 class="text-lg font-semibold text-stone-700 mb-3">р╣Ар╕Др╕гр╕╖р╣Ир╕нр╕Зр╕бр╕╖р╕нр╕вр╣Йр╕нр╕Щр╕лр╕ер╕▒р╕З (р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Хр╕▓р╕Кр╕▒р╣Ир╕Зр╕Чр╕╡р╣И ${scaleId})</h3>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а<div class="flex items-center gap-4 flex-wrap">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button id="print-weighing-history-${scaleId}" data-scale="${scaleId}" class="bg-sky-600 text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-sky-700 transition-colors">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ЁЯЦия╕П р╣Ар╕гр╕╡р╕вр╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕вр╣Йр╕нр╕Щр╕лр╕ер╕▒р╕Зр╣Ар╕Юр╕╖р╣Ир╕нр╕Ыр╕гр╕┤р╣Йр╕Щ
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </button>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button id="export-weighing-history-${scaleId}" data-scale="${scaleId}" class="bg-emerald-600 text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-emerald-700 transition-colors">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ЁЯУД р╣Бр╕Ыр╕ер╕Зр╣Др╕Яр╕ер╣Мр╣Ар╕Ыр╣Зр╕Щ .xlsx
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </button>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а</div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </section>
┬а ┬а ┬а ┬а ┬а ┬а `;
┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а function renderWeighingStations() {
┬а ┬а ┬а ┬а ┬а ┬а for (let i = 1; i <= 4; i++) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const tabContent = document.getElementById(`tab-weighing-${i}`);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (tabContent) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а tabContent.innerHTML = createWeighingStationHTML(i);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById(`save-weighing-${i}`).addEventListener('click', saveWeighing);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById(`weighing-table-body-${i}`).addEventListener('click', handleWeighingTableClick);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById(`print-weighing-history-${i}`).addEventListener('click', (e) => {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а printWeighingHistory(e.currentTarget.dataset.scale);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById(`export-weighing-history-${i}`).addEventListener('click', (e) => {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а exportWeighingHistoryToXLSX(e.currentTarget.dataset.scale);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а┬а
┬а ┬а ┬а ┬а function printWeighingHistory(scaleId) {
┬а ┬а ┬а ┬а ┬а ┬а if (!localWeighingData) return showAlert('р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Бр╕▓р╕гр╕зр╕▓р╕Зр╕вр╕▓р╕Зр╕вр╕▒р╕Зр╣Др╕бр╣Ир╕Цр╕╣р╕Бр╣Вр╕лр╕ер╕Ф');

┬а ┬а ┬а ┬а ┬а ┬а const scaleData = localWeighingData.filter(record => record.scaleId == scaleId);

┬а ┬а ┬а ┬а ┬а ┬а if (scaleData.length === 0) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return showAlert(`р╣Др╕бр╣Ир╕Юр╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Бр╕▓р╕гр╕зр╕▓р╕Зр╕вр╕▓р╕Зр╕вр╣Йр╕нр╕Щр╕лр╕ер╕▒р╕Зр╕кр╕│р╕лр╕гр╕▒р╕Ър╕Хр╕▓р╕Кр╕▒р╣Ир╕Зр╕Чр╕╡р╣И ${scaleId}`);
┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а const uniqueDates = Array.from(
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а new Set(scaleData.map(r => r.timestamp.toDate().toISOString().split('T')[0]))
┬а ┬а ┬а ┬а ┬а ┬а ).sort((a, b) => new Date(b) - new Date(a));

┬а ┬а ┬а ┬а ┬а ┬а let modalContentHTML = `
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="space-y-2">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="modal-date-select" class="block text-sm font-medium text-stone-700">р╕Бр╕гр╕╕р╕Ур╕▓р╣Ар╕ер╕╖р╕нр╕Бр╕зр╕▒р╕Щр╕Чр╕╡р╣Ир╕Чр╕╡р╣Ир╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕Юр╕┤р╕бр╕Юр╣М:</label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <select id="modal-date-select" class="w-full p-2 border border-stone-300 rounded-md shadow-sm">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <option value="">-- р╣Ар╕ер╕╖р╕нр╕Бр╕зр╕▒р╕Щр╕Чр╕╡р╣И --</option>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ${uniqueDates.map(dateStr => {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const dateObj = new Date(dateStr);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const formattedDate = dateObj.toLocaleDateString('th-TH', { year: 'numeric', month: 'long', day: 'numeric' });
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return `<option value="${dateStr}">${formattedDate}</option>`;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }).join('')}
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </select>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а `;

┬а ┬а ┬а ┬а ┬а ┬а showModal(`р╕Юр╕┤р╕бр╕Юр╣Мр╕гр╕▓р╕вр╕Зр╕▓р╕Щр╕вр╣Йр╕нр╕Щр╕лр╕ер╕▒р╕З (р╕Хр╕▓р╕Кр╕▒р╣Ир╕Зр╕Чр╕╡р╣И ${scaleId})`, modalContentHTML, [
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а text: 'ЁЯЦия╕П р╕Юр╕┤р╕бр╕Юр╣Мр╕гр╕▓р╕вр╕Зр╕▓р╕Щ',
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а classes: 'w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-sky-600 text-base font-medium text-white hover:bg-sky-700 sm:ml-3 sm:w-auto sm:text-sm',
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а onClick: () => {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const selectedDate = document.getElementById('modal-date-select').value;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (!selectedDate) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬аsetTimeout(() => {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showAlert('р╕Бр╕гр╕╕р╕Ур╕▓р╣Ар╕ер╕╖р╕нр╕Бр╕зр╕▒р╕Щр╕Чр╕╡р╣Ир╕Бр╣Ир╕нр╕Щ');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // Re-show the main modal
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а setTimeout(() => printWeighingHistory(scaleId), 350);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }, 10);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return false; // Prevent modal from closing
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const reportData = scaleData
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а .filter(record => record.timestamp.toDate().toISOString().split('T')[0] === selectedDate)
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а .sort((a, b) => a.timestamp.toDate() - b.timestamp.toDate());

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const formattedPrintDate = new Date(selectedDate).toLocaleDateString('th-TH', { year: 'numeric', month: 'long', day: 'numeric' });

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const tableRows = reportData.map(record => {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const timestamp = record.timestamp.toDate();
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return `
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <tr class="border-b">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-2 py-2">${timestamp.toLocaleTimeString('th-TH')}</td>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-2 py-2">${record.sellerName}</td>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-2 py-2 text-right">${record.bags}</td>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </tr>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а `;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }).join('');

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const reportHTML = `
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="p-8 bg-white text-black">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="text-center mb-6">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h2 class="text-xl font-bold">р╕гр╕▓р╕вр╕Зр╕▓р╕Щр╕Бр╕▓р╕гр╕гр╕▒р╕Ър╕зр╕▓р╕Зр╕вр╕▓р╕З р╕Ыр╕гр╕░р╕Ир╕│р╕зр╕▒р╕Щр╕Чр╕╡р╣И ${formattedPrintDate}</h2>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h3 class="text-lg">р╕Хр╕▓р╕Кр╕▒р╣Ир╕Зр╕Чр╕╡р╣И ${scaleId}</h3>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p>р╕кр╕лр╕Бр╕гр╕Ур╣Мр╕Бр╕нр╕Зр╕Чр╕╕р╕Щр╕кр╕зр╕Щр╕вр╕▓р╕Зр╕Юр╕▓р╕гр╕▓р╣Ар╕Бр╕йр╕Хр╕гр╕кр╕бр╕Ър╕╣р╕гр╕Ур╣М р╕Ир╕│р╕Бр╕▒р╕Ф</p>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <table class="w-full text-sm border-collapse border border-black">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <thead class="bg-stone-200">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <tr class="border-b-2 border-black">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th class="px-2 py-2 border-r border-black" style="width: 20%;">р╣Ар╕зр╕ер╕▓</th>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th class="px-2 py-2 border-r border-black" style="width: 60%;">р╕Кр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╕Вр╕▓р╕в</th>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th class="px-2 py-2 border-r border-black" style="width: 20%;">р╕Ир╕│р╕Щр╕зр╕Щр╕Цр╕╕р╕З</th>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </tr>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </thead>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <tbody>${tableRows}</tbody>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </table>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а `;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.printArea.innerHTML = reportHTML;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а setTimeout(() => window.print(), 100); // Add a small delay for rendering
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return true; // Allow modal to close
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а },
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а text: 'р╕вр╕Бр╣Ар╕ер╕┤р╕Б',
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а classes: 'mt-3 w-full inline-flex justify-center rounded-md border border-stone-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-stone-700 hover:bg-stone-50 sm:mt-0 sm:w-auto sm:text-sm'
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а ]);
┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а┬а
┬а ┬а ┬а ┬а // ... (The rest of your functions: exportWeighingHistoryToXLSX, exportToExcel, etc. remain the same) ...

┬а ┬а ┬а ┬а function exportWeighingHistoryToXLSX(scaleId) {
┬а ┬а ┬а ┬а ┬а ┬а if (!localWeighingData) return showAlert('р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Бр╕▓р╕гр╕зр╕▓р╕Зр╕вр╕▓р╕Зр╕вр╕▒р╕Зр╣Др╕бр╣Ир╕Цр╕╣р╕Бр╣Вр╕лр╕ер╕Ф');

┬а ┬а ┬а ┬а ┬а ┬а const scaleData = localWeighingData
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а .filter(record => record.scaleId == scaleId)
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а .sort((a, b) => b.timestamp.toDate() - a.timestamp.toDate());
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а┬а
┬а ┬а ┬а ┬а ┬а ┬а if (scaleData.length === 0) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return showAlert(`р╣Др╕бр╣Ир╕Юр╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Бр╕▓р╕гр╕зр╕▓р╕Зр╕вр╕▓р╕Зр╕вр╣Йр╕нр╕Щр╕лр╕ер╕▒р╕Зр╕кр╕│р╕лр╕гр╕▒р╕Ър╕Хр╕▓р╕Кр╕▒р╣Ир╕Зр╕Чр╕╡р╣И ${scaleId} р╣Ар╕Юр╕╖р╣Ир╕н Export`);
┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а const headers = ['р╕зр╕▒р╕Щр╕Чр╕╡р╣И', 'р╣Ар╕зр╕ер╕▓', 'р╕Кр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╕Вр╕▓р╕в', 'р╕Ир╕│р╕Щр╕зр╕Щр╕Цр╕╕р╕З'];
┬а ┬а ┬а ┬а ┬а ┬а const exportData = [headers];

┬а ┬а ┬а ┬а ┬а ┬а scaleData.forEach(record => {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const timestamp = record.timestamp.toDate();
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а exportData.push([
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а timestamp.toLocaleDateString('th-TH'),
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а timestamp.toLocaleTimeString('th-TH'),
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а record.sellerName,
┬а ┬а ┬а ┬а ┬а _z-index: 999; ┬а ┬а ┬а record.bags
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ]);
┬а ┬а ┬а ┬а ┬а ┬а });

┬а ┬а ┬а ┬а ┬а ┬а const ws = XLSX.utils.aoa_to_sheet(exportData);
┬а ┬а ┬а ┬а ┬а ┬а ws['!cols'] = [{ wch: 15 }, { wch: 15 }, { wch: 30 }, { wch: 15 }];
┬а ┬а ┬а ┬а ┬а ┬а┬а
┬а ┬а ┬а ┬а ┬а ┬а const wb = XLSX.utils.book_new();
┬а ┬а ┬а ┬а ┬а ┬а XLSX.utils.book_append_sheet(wb, ws, `р╕Ыр╕гр╕░р╕зр╕▒р╕Хр╕┤р╕Хр╕▓р╕Кр╕▒р╣Ир╕Зр╕Чр╕╡р╣И ${scaleId}`);

┬а ┬а ┬а ┬а ┬а ┬а XLSX.writeFile(wb, `weighing-history-scale-${scaleId}.xlsx`);
┬а ┬а ┬а ┬а }


┬а ┬а ┬а ┬а function exportToExcel() {
┬а ┬а ┬а ┬а ┬а ┬а if (localSalesData.length === 0) return showAlert('р╣Др╕бр╣Ир╕бр╕╡р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Бр╕▓р╕гр╕Вр╕▓р╕вр╕кр╕│р╕лр╕гр╕▒р╕Ъ Export');
┬а ┬а ┬а ┬а ┬а ┬а const salesByDate = localSalesData.reduce((acc, sale) => {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const d = sale.date.toDate();
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const dateKey = `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (!acc[dateKey]) acc[dateKey] = [];
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а acc[dateKey].push(sale);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return acc;
┬а ┬а ┬а ┬а ┬а ┬а }, {});
┬а ┬а ┬а ┬а ┬а ┬а const wb = XLSX.utils.book_new();
┬а ┬а ┬а ┬а ┬а ┬а const sortedDates = Object.keys(salesByDate).sort((a, b) => new Date(b) - new Date(a));
┬а ┬а ┬а ┬а ┬а ┬а sortedDates.forEach(dateKey => {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const daySales = salesByDate[dateKey].sort((a, b) => (a.dailyQueueNumber || 0) - (b.dailyQueueNumber || 0));
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const headers = ['р╕Др╕┤р╕з', 'р╕зр╕▒р╕Щр╕Чр╕╡р╣И', 'р╕Кр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╕Вр╕▓р╕в', 'р╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Б (р╕Бр╕Б.)', 'р╕гр╕▓р╕Др╕▓/р╕лр╕Щр╣Ир╕зр╕в (р╕Ър╕▓р╕Ч)', 'р╕вр╕нр╕Фр╕гр╕зр╕б (р╕Ър╕▓р╕Ч)', 'р╕Хр╕▓р╕Кр╕▒р╣Ир╕Зр╕Чр╕╡р╣И'];
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const exportData = [headers];
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а daySales.forEach(sale => {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а exportData.push([
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а sale.dailyQueueNumber || '', sale.date.toDate().toLocaleDateString('th-TH'), sale.seller,
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а sale.weight, sale.price, sale.total, sale.scaleNumber || ''
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ]);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const ws = XLSX.utils.aoa_to_sheet(exportData);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ws['!cols'] = [{ wch: 5 }, { wch: 15 }, { wch: 25 }, { wch: 15 }, { wch: 15 }, { wch: 15 }, { wch: 10 }];
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а for (let R = 1; R < exportData.length; ++R) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а for (let C of [3, 4, 5]) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const cell_ref = XLSX.utils.encode_cell({
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а c: C,
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а r: R
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (ws[cell_ref]) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ws[cell_ref].t = 'n';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ws[cell_ref].z = '#,##0.00';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const dateParts = dateKey.split('-');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const sheetName = `${dateParts[2]}-${dateParts[1]}-${dateParts[0].substring(2)}`;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а XLSX.utils.book_append_sheet(wb, ws, sheetName);
┬а ┬а ┬а ┬а ┬а ┬а });
┬а ┬а ┬а ┬а ┬а ┬а const today = new Date().toISOString().slice(0, 10);
┬а ┬а ┬а ┬а ┬а ┬а XLSX.writeFile(wb, `daily-sales-report-${today}.xlsx`);
┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а async function saveWeighing(event) {
┬а ┬а ┬а ┬а ┬а ┬а if (!weighingsCollectionRef) return showAlert('р╕вр╕▒р╕Зр╣Др╕бр╣Ир╕Юр╕гр╣Йр╕нр╕бр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ р╕Бр╕гр╕╕р╕Ур╕▓р╕гр╕нр╕кр╕▒р╕Бр╕Др╕гр╕╣р╣И');
┬а ┬а ┬а ┬а ┬а ┬а const scaleId = parseInt(event.target.dataset.scale);
┬а ┬а ┬а ┬а ┬а ┬а const sellerNameInput = document.getElementById(`weighing-seller-${scaleId}`);
┬а ┬а ┬а ┬а ┬а ┬а const bagsInput = document.getElementById(`weighing-weight-${scaleId}`);
┬а ┬а ┬а ┬а ┬а ┬а const sellerName = sellerNameInput.value.trim();
┬а ┬а ┬а ┬а ┬а ┬а const bags = parseFloat(bagsInput.value);

┬а ┬а ┬а ┬а ┬а ┬а if (!sellerName || !bags || bags <= 0) return showAlert('р╕Бр╕гр╕╕р╕Ур╕▓р╕Бр╕гр╕нр╕Бр╕Кр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╕Вр╕▓р╕вр╣Бр╕ер╕░р╕Ир╕│р╕Щр╕зр╕Щр╕Цр╕╕р╕Зр╣Гр╕лр╣Йр╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З');

┬а ┬а ┬а ┬а ┬а ┬а try {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (editingWeighingId) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а await updateDoc(doc(weighingsCollectionRef, editingWeighingId), {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а sellerName,
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а bags
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а editingWeighingId = null;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а } else {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а await addDoc(weighingsCollectionRef, {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а sellerName,
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а bags,
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а scaleId,
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а timestamp: new Date(),
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а userId
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а sellerNameInput.value = '';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а bagsInput.value = '';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а sellerNameInput.focus();
┬а ┬а ┬а ┬а ┬а ┬а } catch (error) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showAlert(`р╣Ар╕Бр╕┤р╕Фр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╣Гр╕Щр╕Бр╕▓р╕гр╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Б: ${error.message}`);
┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а function calculateSummaryTotalWeight() {
┬а ┬а ┬а ┬а ┬а ┬а const totalBags = parseFloat(ui.summaryTotalBags.textContent) || 0;
┬а ┬а ┬а ┬а ┬а ┬а const multiplier = parseFloat(ui.summaryMultiplierWeight.value) || 0;
┬а ┬а ┬а ┬а ┬а ┬а ui.summaryCalculatedWeight.textContent = (totalBags * multiplier).toFixed(2);
┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а function updateWeighingSummary() {
┬а ┬а ┬а ┬а ┬а ┬а let totalBags = 0;
┬а ┬а ┬а ┬а ┬а ┬а for (const scaleId in dailyWeighingData) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а totalBags += dailyWeighingData[scaleId].reduce((sum, doc) => sum + doc.bags, 0);
┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а ui.summaryTotalBags.textContent = totalBags;
┬а ┬а ┬а ┬а ┬а ┬а calculateSummaryTotalWeight();
┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а async function deleteAllTodaysWeighings() {
┬а ┬а ┬а ┬а ┬а ┬а showConfirm(
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а 'р╕Др╕╕р╕Ур╣Бр╕Щр╣Ир╣Гр╕Ир╕лр╕гр╕╖р╕нр╣Др╕бр╣Ир╕зр╣Ир╕▓р╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕ер╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Бр╕▓р╕гр╕зр╕▓р╕Зр╕вр╕▓р╕Зр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Фр╕Вр╕нр╕Зр╕зр╕▒р╕Щр╕Щр╕╡р╣Й? <strong>р╕Бр╕▓р╕гр╕Бр╕гр╕░р╕Чр╕│р╕Щр╕╡р╣Йр╣Др╕бр╣Ир╕кр╕▓р╕бр╕▓р╕гр╕Цр╕вр╣Йр╕нр╕Щр╕Бр╕ер╕▒р╕Ър╣Др╕Фр╣Й</strong>',
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а async () => {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const todayStart = new Date();
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а todayStart.setHours(0, 0, 0, 0);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const q = query(weighingsCollectionRef, where("timestamp", ">=", todayStart));
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а try {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const querySnapshot = await getDocs(q);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (querySnapshot.empty) return showAlert('р╣Др╕бр╣Ир╕Юр╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Бр╕▓р╕гр╕зр╕▓р╕Зр╕вр╕▓р╕Зр╕Вр╕нр╕Зр╕зр╕▒р╕Щр╕Щр╕╡р╣Йр╣Гр╕лр╣Йр╕ер╕Ъ');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const batch = writeBatch(db);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а querySnapshot.forEach(doc => {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а batch.delete(doc.ref);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а await batch.commit();
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.summaryMultiplierWeight.value = '';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showAlert(`р╕ер╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Бр╕▓р╕гр╕зр╕▓р╕Зр╕вр╕▓р╕Зр╕Вр╕нр╕Зр╕зр╕▒р╕Щр╕Щр╕╡р╣Йр╕Ир╕│р╕Щр╕зр╕Щ ${querySnapshot.size} р╕гр╕▓р╕вр╕Бр╕▓р╕гр╣Ар╕гр╕╡р╕вр╕Ър╕гр╣Йр╕нр╕вр╣Бр╕ер╣Йр╕з`);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а } catch (error) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showAlert(`р╣Ар╕Бр╕┤р╕Фр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╣Гр╕Щр╕Бр╕▓р╕гр╕ер╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕е: ${error.message}`);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а );
┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а function setupWeighingListeners() {
┬а ┬а ┬а ┬а ┬а ┬а if (!weighingsCollectionRef) return;
┬а ┬а ┬а ┬а ┬а ┬а for (let i = 1; i <= 4; i++) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const q = query(weighingsCollectionRef, where("scaleId", "==", i));
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (unsubscribeWeighings[i]) unsubscribeWeighings[i]();

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а unsubscribeWeighings[i] = onSnapshot(q, (snapshot) => {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const todayStart = new Date();
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а todayStart.setHours(0, 0, 0, 0);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const tableBody = document.getElementById(`weighing-table-body-${i}`);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (!tableBody) return;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а tableBody.innerHTML = '';

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const docs = snapshot.docs.map(doc => ({
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а id: doc.id,
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ...doc.data()
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }));
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const todaysDocs = docs.filter(data => data.timestamp.toDate() >= todayStart);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а dailyWeighingData[i] = todaysDocs;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а updateWeighingSummary();

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (todaysDocs.length === 0) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а tableBody.innerHTML = '<tr><td colspan="4" class="text-center p-8 text-stone-400">р╕вр╕▒р╕Зр╣Др╕бр╣Ир╕бр╕╡р╕гр╕▓р╕вр╕Бр╕▓р╕г</td></tr>';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а } else {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а todaysDocs.sort((a, b) => b.timestamp.toDate() - a.timestamp.toDate()).forEach(data => {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const row = document.createElement('tr');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а row.className = 'border-b odd:bg-stone-50';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а row.innerHTML = `
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а<td class="px-4 py-3">${data.timestamp.toDate().toLocaleTimeString('th-TH')}</td>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а<td class="px-4 py-3 font-medium">${data.sellerName}</td>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а<td class="px-4 py-3 text-right font-bold text-amber-700">${data.bags}</td>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а<td class="px-4 py-3 text-center">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а<div class="flex items-center justify-center gap-1">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а<button class="edit-weighing-btn text-blue-600 p-2 rounded-md hover:bg-blue-100" data-id="${data.id}" data-scale="${i}" title="р╣Бр╕Бр╣Йр╣Др╕В">тЬПя╕П</button>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а<button class="delete-weighing-btn text-red-600 p-2 rounded-md hover:bg-red-100" data-id="${data.id}" title="р╕ер╕Ъ">ЁЯЧСя╕П</button>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а</div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а</td>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а`;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а tableBody.appendChild(row);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });
┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а async function fetchAndPopulateWeights(sellerName) {
┬а ┬а ┬а ┬а ┬а ┬а if (!weighingsCollectionRef || editingId) return; // Do not fetch if editing a record
┬а ┬а ┬а ┬а ┬а ┬а const q = query(weighingsCollectionRef, where("sellerName", "==", sellerName));
┬а ┬а ┬а ┬а ┬а ┬а const querySnapshot = await getDocs(q);
┬а ┬а ┬а ┬а ┬а ┬а const todayStart = new Date();
┬а ┬а ┬а ┬а ┬а ┬а todayStart.setHours(0, 0, 0, 0);

┬а ┬а ┬а ┬а ┬а ┬а const todaysDocs = querySnapshot.docs.filter(doc => doc.data().timestamp?.toDate() >= todayStart);
┬а ┬а ┬а ┬а ┬а ┬а if (todaysDocs.length === 0) return;

┬а ┬а ┬а ┬а ┬а ┬а const weights = todaysDocs.map(doc => doc.data().bags);
┬а ┬а ┬а ┬а ┬а ┬а const weightInputs = document.querySelectorAll('#weight-inputs-container .weight-input');

┬а ┬а ┬а ┬а ┬а ┬а // Clear previous weights before populating
┬а ┬а ┬а ┬а ┬а ┬а weightInputs.forEach(input => input.value = '');
┬а ┬а ┬а ┬а ┬а ┬а weights.forEach((weight, index) => {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (index < weightInputs.length) weightInputs[index].value = weight;
┬а ┬а ┬а ┬а ┬а ┬а });
┬а ┬а ┬а ┬а ┬а ┬а calculateTotals();

┬а ┬а ┬а ┬а ┬а ┬а showConfirm(`р╕Юр╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╕зр╕▓р╕Зр╕вр╕▓р╕З ${weights.reduce((a,b)=>a+b,0)} р╕Цр╕╕р╕З р╕Вр╕нр╕З <strong>${sellerName}</strong><br>р╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕ер╣Йр╕▓р╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Щр╕╡р╣Йр╕лр╕ер╕▒р╕Зр╕Ир╕▓р╕Бр╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╣Гр╕Ър╣Ар╕кр╕гр╣Зр╕Ир╕лр╕гр╕╖р╕нр╣Др╕бр╣И?`, async () => {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const batch = writeBatch(db);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а todaysDocs.forEach(d => batch.delete(d.ref));
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а await batch.commit();
┬а ┬а ┬а ┬а ┬а ┬а });
┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а┬а
┬а ┬а ┬а ┬а async function initializeFirebaseAndAuth() {
┬а ┬а ┬а ┬а ┬а ┬а if (isAppInitialized) return;┬а
┬а ┬а ┬а ┬а ┬а ┬а┬а
┬а ┬а ┬а ┬а ┬а ┬а if (Object.keys(firebaseConfig).length === 0 || !firebaseConfig.apiKey) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return showAlert('р╕Бр╕▓р╕гр╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓ Firebase р╣Др╕бр╣Ир╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З р╣Др╕бр╣Ир╕кр╕▓р╕бр╕▓р╕гр╕Цр╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕нр╕Рр╕▓р╕Щр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Др╕Фр╣Й');
┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а try {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const app = initializeApp(firebaseConfig);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а getAnalytics(app);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а auth = getAuth(app);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а db = getFirestore(app);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а onAuthStateChanged(auth, async (user) => {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (user && !isAppInitialized) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а userId = user.uid;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а salesCollectionRef = collection(db, "artifacts", appId, "public", "data", "sales");
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а weighingsCollectionRef = collection(db, "artifacts", appId, "public", "data", "weighings");

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (unsubscribeSales) unsubscribeSales();
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а unsubscribeSales = onSnapshot(query(salesCollectionRef), (snapshot) => {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а localSalesData = snapshot.docs.map(doc => ({
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а id: doc.id, ...doc.data() }));
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а localSalesData.sort((a, b) => b.timestamp.toDate() - a.timestamp.toDate());
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if(document.getElementById('search-box')) ui.searchBox.dispatchEvent(new Event('input'));
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а renderDashboard();
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а renderSummary();
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а renderScaleSummaries();
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а populateReportDateSelector();
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (unsubscribeAllWeighings) unsubscribeAllWeighings();
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а unsubscribeAllWeighings = onSnapshot(query(weighingsCollectionRef), (snapshot) => {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а localWeighingData = snapshot.docs.map(doc => ({
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а id: doc.id, ...doc.data() }));
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а renderWeighingHistory();
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а setupWeighingListeners();
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а isAppInitialized = true;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а } else if (!user) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а isAppInitialized = false;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if(unsubscribeSales) unsubscribeSales();
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if(unsubscribeAllWeighings) unsubscribeAllWeighings();
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а Object.keys(unsubscribeWeighings).forEach(k => unsubscribeWeighings[k]());
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а┬а
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (!auth.currentUser) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а await signInAnonymously(auth);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а┬а
┬а ┬а ┬а ┬а ┬а ┬а } catch (error) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showAlert(`р╣Ар╕Бр╕┤р╕Фр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╣Гр╕Щр╕Бр╕▓р╕гр╣Ар╕гр╕┤р╣Ир╕бр╕Хр╣Йр╕Щр╕гр╕░р╕Ър╕Ъ: ${error.message}`);
┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а async function handleWeighingTableClick(e) {
┬а ┬а ┬а ┬а ┬а ┬а const target = e.target.closest('button');
┬а ┬а ┬а ┬а ┬а ┬а if (!target) return;
┬а ┬а ┬а ┬а ┬а ┬а const id = target.dataset.id;
┬а ┬а ┬а ┬а ┬а ┬а const scaleId = target.dataset.scale;

┬а ┬а ┬а ┬а ┬а ┬а if (target.classList.contains('delete-weighing-btn')) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showConfirm('р╕Др╕╕р╕Ур╣Бр╕Щр╣Ир╣Гр╕Ир╕зр╣Ир╕▓р╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕ер╕Ър╕гр╕▓р╕вр╕Бр╕▓р╕гр╕зр╕▓р╕Зр╕вр╕▓р╕Зр╕Щр╕╡р╣Й?', async () => {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а await deleteDoc(doc(weighingsCollectionRef, id));
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showAlert('р╕ер╕Ър╕гр╕▓р╕вр╕Бр╕▓р╕гр╕кр╕│р╣Ар╕гр╣Зр╕И');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });
┬а ┬а ┬а ┬а ┬а ┬а } else if (target.classList.contains('edit-weighing-btn')) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const docSnap = await getDoc(doc(weighingsCollectionRef, id));
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (docSnap.exists()) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const data = docSnap.data();
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById(`weighing-seller-${scaleId}`).value = data.sellerName;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById(`weighing-weight-${scaleId}`).value = data.bags;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а editingWeighingId = id;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а document.getElementById(`weighing-seller-${scaleId}`).focus();
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а function renderScaleSummaries() {
┬а ┬а ┬а ┬а ┬а ┬а const today = new Date();
┬а ┬а ┬а ┬а ┬а ┬а today.setHours(0, 0, 0, 0);
┬а ┬а ┬а ┬а ┬а ┬а const salesByScaleToday = localSalesData.reduce((acc, sale) => {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (sale.date.toDate() >= today) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const scale = sale.scaleNumber || 'р╣Др╕бр╣Ир╕гр╕░р╕Ър╕╕';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (!acc[scale]) acc[scale] = {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а totalWeight: 0,
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а totalAmount: 0,
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а count: 0
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а };
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а acc[scale].totalWeight += sale.weight;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а acc[scale].totalAmount += sale.total;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а acc[scale].count++;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return acc;
┬а ┬а ┬а ┬а ┬а ┬а }, {});

┬а ┬а ┬а ┬а ┬а ┬а ui.salesSummaryByScale.innerHTML = '';
┬а ┬а ┬а ┬а ┬а ┬а if (Object.keys(salesByScaleToday).length === 0) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.salesSummaryByScale.innerHTML = '<div class="col-span-full text-center text-stone-500 py-4">р╣Др╕бр╣Ир╕бр╕╡р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Бр╕▓р╕гр╕Вр╕▓р╕вр╕кр╕│р╕лр╕гр╕▒р╕Ър╕зр╕▒р╕Щр╕Щр╕╡р╣Й</div>';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.salesSummaryTodayTotal.classList.add('hidden');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return;
┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а let totalWeightToday = 0;
┬а ┬а ┬а ┬а ┬а ┬а let totalAmountToday = 0;

┬а ┬а ┬а ┬а ┬а ┬а Object.keys(salesByScaleToday).sort().forEach(scale => {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const summary = salesByScaleToday[scale];
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а totalWeightToday += summary.totalWeight;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а totalAmountToday += summary.totalAmount;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const summaryHtml = `
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="bg-amber-50 border border-amber-200 p-3 rounded-lg text-center shadow-sm">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p class="text-sm font-medium text-amber-800">р╕Хр╕▓р╕Кр╕▒р╣Ир╕Зр╕Чр╕╡р╣И ${scale}</p>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p class="text-lg font-bold text-amber-700">${summary.totalWeight.toFixed(2)} р╕Бр╕Б.</p>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p class="text-sm text-amber-600">${summary.totalAmount.toLocaleString('th-TH', {minimumFractionDigits: 2, maximumFractionDigits: 2})} р╕Ър╕▓р╕Ч</p>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а `;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.salesSummaryByScale.insertAdjacentHTML('beforeend', summaryHtml);
┬а ┬а ┬а ┬а ┬а ┬а });

┬а ┬а ┬а ┬а ┬а ┬а ui.summaryTodayTotalWeight.textContent = totalWeightToday.toFixed(2);
┬а ┬а ┬а ┬а ┬а ┬а ui.summaryTodayTotalAmount.textContent = totalAmountToday.toLocaleString('th-TH', {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а minimumFractionDigits: 2,
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а maximumFractionDigits: 2
┬а ┬а ┬а ┬а ┬а ┬а });
┬а ┬а ┬а ┬а ┬а ┬а ui.salesSummaryTodayTotal.classList.remove('hidden');
┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а function populateReportDateSelector() {
┬а ┬а ┬а ┬а ┬а ┬а const dateSet = new Set(localSalesData.map(sale => sale.date.toDate().toISOString().split('T')[0]));
┬а ┬а ┬а ┬а ┬а ┬а const sortedDates = Array.from(dateSet).sort((a, b) => new Date(b) - new Date(a));

┬а ┬а ┬а ┬а ┬а ┬а const currentValue = ui.reportDateSelect.value;
┬а ┬а ┬а ┬а ┬а ┬а while (ui.reportDateSelect.options.length > 1) ui.reportDateSelect.remove(1);

┬а ┬а ┬а ┬а ┬а ┬а sortedDates.forEach(dateStr => {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const option = document.createElement('option');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а option.value = dateStr;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а option.textContent = new Date(dateStr).toLocaleDateString('th-TH', {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а year: 'numeric',
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а month: 'long',
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а day: 'numeric'
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.reportDateSelect.appendChild(option);
┬а ┬а ┬а ┬а ┬а ┬а });
┬а ┬а ┬а ┬а ┬а ┬а ui.reportDateSelect.value = currentValue;
┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а┬а
┬а ┬а ┬а ┬а // --- NEW: Change Password Modal Logic ---
┬а ┬а ┬а ┬а function promptChangePassword() {
┬а ┬а ┬а ┬а ┬а ┬а const modalContentHTML = `
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="space-y-4 text-left">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="old-password-input" class="block text-sm font-medium text-stone-600">р╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щр╣Ар╕Бр╣Ир╕▓</label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="password" id="old-password-input" class="mt-1 w-full p-3 border border-stone-300 rounded-lg shadow-sm">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="new-password-input" class="block text-sm font-medium text-stone-600">р╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щр╣Гр╕лр╕бр╣И</label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="password" id="new-password-input" class="mt-1 w-full p-3 border border-stone-300 rounded-lg shadow-sm">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="confirm-password-input" class="block text-sm font-medium text-stone-600">р╕вр╕╖р╕Щр╕вр╕▒р╕Щр╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щр╣Гр╕лр╕бр╣И</label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="password" id="confirm-password-input" class="mt-1 w-full p-3 border border-stone-300 rounded-lg shadow-sm">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p id="change-password-error" class="text-sm text-red-600 text-center hidden"></p>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а `;
┬а ┬а ┬а ┬а ┬а ┬а┬а
┬а ┬а ┬а ┬а ┬а ┬а showModal('р╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щ', modalContentHTML, [
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а text: 'р╕вр╕╖р╕Щр╕вр╕▒р╕Щр╕Бр╕▓р╕гр╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╣Бр╕Ыр╕ер╕З',
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а classes: 'w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-amber-600 text-base font-medium text-white hover:bg-amber-700 sm:ml-3 sm:w-auto sm:text-sm',
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а onClick: () => {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const oldPassword = document.getElementById('old-password-input').value;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const newPassword = document.getElementById('new-password-input').value;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const confirmPassword = document.getElementById('confirm-password-input').value;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const errorEl = document.getElementById('change-password-error');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а┬а
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (oldPassword !== currentPassword) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а errorEl.textContent = 'р╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щр╣Ар╕Бр╣Ир╕▓р╣Др╕бр╣Ир╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а errorEl.classList.remove('hidden');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return false; // Prevent modal from closing
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (newPassword.length < 4) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬аerrorEl.textContent = 'р╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щр╣Гр╕лр╕бр╣Ир╕Хр╣Йр╕нр╕Зр╕бр╕╡р╕нр╕вр╣Ир╕▓р╕Зр╕Щр╣Йр╕нр╕в 4 р╕Хр╕▒р╕зр╕нр╕▒р╕Бр╕йр╕г';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬аerrorEl.classList.remove('hidden');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬аreturn false;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (newPassword !== confirmPassword) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а errorEl.textContent = 'р╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щр╣Гр╕лр╕бр╣Ир╣Бр╕ер╕░р╕Бр╕▓р╕гр╕вр╕╖р╕Щр╕вр╕▒р╕Щр╣Др╕бр╣Ир╕Хр╕гр╕Зр╕Бр╕▒р╕Щ';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а errorEl.classList.remove('hidden');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return false;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // Success
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а localStorage.setItem('customPassword', newPassword);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а currentPassword = newPassword;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showAlert('р╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щр╕кр╕│р╣Ар╕гр╣Зр╕Ир╣Бр╕ер╣Йр╕з');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return true; // Allow modal to close
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а },
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а text: 'р╕вр╕Бр╣Ар╕ер╕┤р╕Б',
┬а ┬а ┬а _z-index: 1000; ┬а ┬а ┬а ┬а classes: 'mt-3 w-full inline-flex justify-center rounded-md border border-stone-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-stone-700 hover:bg-stone-50 sm:mt-0 sm:w-auto sm:text-sm'
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а ]);
┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а document.addEventListener('DOMContentLoaded', () => {

┬а ┬а ┬а ┬а ┬а ┬а // --- Login and Session Handling ---
┬а ┬а ┬а ┬а ┬а ┬а const handleLogin = () => {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬аconst username = ui.usernameInput.value.trim();
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬аconst password = ui.passwordInput.value.trim();

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬аif (username === 'admin' && password === currentPassword) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.loginScreen.classList.add('hidden');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.appContainer.classList.remove('hidden');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а sessionStorage.setItem('isLoggedIn', 'true');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.loginError.classList.add('hidden');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.passwordInput.value = '';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (!isAppInitialized) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬аinitializeFirebaseAndAuth();
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а} else {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.loginError.textContent = 'р╕Кр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╕лр╕гр╕╖р╕нр╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щр╣Др╕бр╣Ир╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.loginError.classList.remove('hidden');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.passwordInput.value = '';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.passwordInput.focus();
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а}
┬а ┬а ┬а ┬а ┬а ┬а };
┬а ┬а ┬а ┬а ┬а ┬а┬а
┬а ┬а ┬а ┬а ┬а ┬а if (sessionStorage.getItem('isLoggedIn') === 'true') {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.loginScreen.classList.add('hidden');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.appContainer.classList.remove('hidden');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а initializeFirebaseAndAuth();
┬а ┬а ┬а ┬а ┬а ┬а } else {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.loginScreen.classList.remove('hidden');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.appContainer.classList.add('hidden');
┬а ┬а ┬а ┬а ┬а ┬а }
