<!DOCTYPE html>
<html lang="th">
<head>
┬а ┬а <meta charset="UTF-8">
┬а ┬а <meta name="viewport" content="width=device-width, initial-scale=1.0">
┬а ┬а <title>р╕гр╕░р╕Ър╕Ър╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Бр╕▓р╕гр╕Вр╕▓р╕вр╕вр╕▓р╕Зр╕Бр╣Йр╕нр╕Щр╕Цр╣Йр╕зр╕в</title>
┬а ┬а <!-- Chosen Palette: Warm Harmony (Stone, Amber, White) -->
┬а ┬а <!-- Application Structure Plan: A task-oriented dashboard with a two-column layout. The left column is dedicated to primary user actions: the receipt generation form and the sales data table. The right column contains the analytics dashboard. A new summary section has been added above the sales table to provide high-level aggregate data, giving users immediate feedback on overall performance. -->
┬а ┬а <!-- Visualization & Content Choices: - Summary Metrics -> Goal: Inform -> Method: HTML cards -> Interaction: Auto-updates from Firestore. Justification: To provide a quick, high-level overview of key performance indicators (total sellers, weight, revenue) without needing to scan the entire table. - All other choices remain as before, creating a comprehensive system from data entry to high-level analysis. -->
┬а ┬а <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
┬а ┬а <script src="https://cdn.tailwindcss.com"></script>
┬а ┬а <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
┬а ┬а <link rel="preconnect" href="https://fonts.googleapis.com">
┬а ┬а <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
┬а ┬а <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;700&display=swap" rel="stylesheet">
┬а ┬а <style>
┬а ┬а ┬а ┬а body { font-family: 'Sarabun', sans-serif; }
┬а ┬а ┬а ┬а .chart-container { position: relative; height: 300px; width: 100%; max-width: 500px; margin: auto; }
┬а ┬а ┬а ┬а .modal-backdrop { transition: opacity 0.3s ease; }
┬а ┬а ┬а ┬а .modal-content { transition: transform 0.3s ease; }
┬а ┬а ┬а ┬а @media print {
┬а ┬а ┬а ┬а ┬а ┬а body * { visibility: hidden; }
┬а ┬а ┬а ┬а ┬а ┬а #print-area, #print-area * { visibility: visible; }
┬а ┬а ┬а ┬а ┬а ┬а #print-area { position: absolute; left: 0; top: 0; width: 100%; height: 100%; }
┬а ┬а ┬а ┬а }
┬а ┬а </style>
</head>
<body class="bg-stone-100 text-stone-800">

┬а ┬а <div id="app" class="container mx-auto p-4 sm:p-6 lg:p-8">
┬а ┬а ┬а ┬а 
┬а ┬а ┬а ┬а <header class="mb-8">
┬а ┬а ┬а ┬а ┬а ┬а <h1 class="text-4xl font-bold text-stone-900">р╕гр╕░р╕Ър╕Ър╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕Вр╕▓р╕вр╕вр╕▓р╕Зр╕Бр╣Йр╕нр╕Щр╕Цр╣Йр╕зр╕в</h1>
┬а ┬а ┬а ┬а ┬а ┬а <p class="text-stone-600 mt-1">р╕нр╕нр╕Бр╣Гр╕Ър╣Ар╕кр╕гр╣Зр╕И р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕е р╣Бр╕ер╕░р╕Фр╕╣р╕кр╕гр╕╕р╕Ыр╕вр╕нр╕Фр╕Вр╕▓р╕вр╣Гр╕Щр╕Чр╕╡р╣Ир╣Ар╕Фр╕╡р╕вр╕з</p>
┬а ┬а ┬а ┬а </header>

┬а ┬а ┬а ┬а <main class="grid grid-cols-1 lg:grid-cols-3 gap-8">

┬а ┬а ┬а ┬а ┬а ┬а <div class="lg:col-span-2 space-y-8">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а 
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <section id="receipt-generator" class="bg-white p-6 rounded-xl shadow-md">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h2 class="text-2xl font-bold mb-2 border-b pb-3 text-stone-800">1. р╕Бр╕гр╕нр╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Ар╕Юр╕╖р╣Ир╕нр╕нр╕нр╕Бр╣Гр╕Ър╣Ар╕кр╕гр╣Зр╕И</h2>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p class="text-sm text-stone-500 mt-2 mb-4">р╕кр╣Ир╕зр╕Щр╕Щр╕╡р╣Йр╕Др╕╖р╕нр╕ир╕╣р╕Щр╕вр╣Мр╕Бр╕ер╕▓р╕Зр╕Бр╕▓р╕гр╕Чр╕│р╕Зр╕▓р╕Щ р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Бр╕▓р╕гр╕Вр╕▓р╕в р╕гр╕░р╕Ър╕Ър╕Ир╕░р╕Др╕│р╕Щр╕зр╕Ур╕вр╕нр╕Фр╕гр╕зр╕бр╣Гр╕лр╣Йр╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤ р╣Бр╕ер╕░р╣Ар╕бр╕╖р╣Ир╕нр╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Бр╕ер╣Йр╕зр╕Ир╕░р╕кр╕гр╣Йр╕▓р╕Зр╣Гр╕Ър╣Ар╕кр╕гр╣Зр╕Ир╕кр╕│р╕лр╕гр╕▒р╕Ър╕Юр╕┤р╕бр╕Юр╣Мр╣Др╕Фр╣Йр╕Чр╕▒р╕Щр╕Чр╕╡</p>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="seller-name" class="block text-sm font-medium text-stone-600 mb-1">р╕Кр╕╖р╣Ир╕н-р╕кр╕Бр╕╕р╕е р╕Ьр╕╣р╣Йр╕Вр╕▓р╕в</label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="text" id="seller-name" class="w-full p-2 border border-stone-300 rounded-md shadow-sm focus:ring-amber-500 focus:border-amber-500" placeholder="р╣Ар╕Кр╣Ир╕Щ р╕Щр╕▓р╕вр╕кр╕бр╕Кр╕▓р╕в р╣Гр╕Ир╕Фр╕╡">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="receipt-date" class="block text-sm font-medium text-stone-600 mb-1">р╕зр╕▒р╕Щр╕Чр╕╡р╣И <span id="date-display" class="font-normal text-stone-500 ml-2"></span></label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="date" id="receipt-date" class="w-full p-2 border border-stone-300 rounded-md shadow-sm focus:ring-amber-500 focus:border-amber-500">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="md:col-span-2">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label class="block text-sm font-medium text-stone-600 mb-1">р╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Б (р╕Бр╕Б.) - р╣Гр╕кр╣Ир╣Др╕Фр╣Йр╕кр╕╣р╕Зр╕кр╕╕р╕Ф 5 р╕гр╕▓р╕вр╕Бр╕▓р╕г</label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div id="weight-inputs-container" class="grid grid-cols-2 sm:grid-cols-5 gap-4">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="number" class="weight-input w-full p-2 border border-stone-300 rounded-md shadow-sm text-center" placeholder="р╕Др╕гр╕▒р╣Йр╕Зр╕Чр╕╡р╣И 1">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="number" class="weight-input w-full p-2 border border-stone-300 rounded-md shadow-sm text-center" placeholder="р╕Др╕гр╕▒р╣Йр╕Зр╕Чр╕╡р╣И 2">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="number" class="weight-input w-full p-2 border border-stone-300 rounded-md shadow-sm text-center" placeholder="р╕Др╕гр╕▒р╣Йр╕Зр╕Чр╕╡р╣И 3">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="number" class="weight-input w-full p-2 border border-stone-300 rounded-md shadow-sm text-center" placeholder="р╕Др╕гр╕▒р╣Йр╕Зр╕Чр╕╡р╣И 4">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="number" class="weight-input w-full p-2 border border-stone-300 rounded-md shadow-sm text-center" placeholder="р╕Др╕гр╕▒р╣Йр╕Зр╕Чр╕╡р╣И 5">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <label for="price-per-kg" class="block text-sm font-medium text-stone-600 mb-1">р╕гр╕▓р╕Др╕▓р╕Хр╣Ир╕нр╕лр╕Щр╣Ир╕зр╕в (р╕Ър╕▓р╕Ч/р╕Бр╕Б.)</label>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="number" id="price-per-kg" class="w-full p-2 border border-stone-300 rounded-md shadow-sm focus:ring-amber-500 focus:border-amber-500" placeholder="0.00">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="md:col-span-2 bg-stone-200 p-4 rounded-lg space-y-3">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="flex justify-between items-center">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span class="font-medium text-stone-600">р╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Бр╕гр╕зр╕б (р╕Бр╕Б.):</span>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span id="total-weight" class="text-xl font-bold text-stone-800">0.00</span>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="flex justify-between items-center">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span class="font-medium text-stone-600">р╕гр╕зр╕бр╣Ар╕Ыр╣Зр╕Щр╣Ар╕Зр╕┤р╕Щр╕Чр╕▒р╣Йр╕Зр╕кр╕┤р╣Йр╕Щ (р╕Ър╕▓р╕Ч):</span>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span id="total-amount" class="text-2xl font-bold text-amber-600">0.00</span>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="flex justify-between items-center text-right">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span class="font-medium text-stone-600">(р╕Хр╕▒р╕зр╕нр╕▒р╕Бр╕йр╕г):</span>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span id="total-amount-text" class="text-sm text-stone-500">-</span>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="mt-6 flex justify-end items-center gap-4">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button id="cancel-edit-button" class="hidden bg-stone-200 text-stone-700 font-bold py-2 px-6 rounded-lg hover:bg-stone-300 transition-colors">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а р╕вр╕Бр╣Ар╕ер╕┤р╕Б
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </button>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button id="save-button" class="bg-amber-600 text-white font-bold py-2 px-6 rounded-lg shadow-md hover:bg-amber-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-500 transition-colors">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╣Бр╕ер╕░р╕Юр╕┤р╕бр╕Юр╣Мр╣Гр╕Ър╣Ар╕кр╕гр╣Зр╕И
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </button>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </section>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <section id="sales-data" class="bg-white p-6 rounded-xl shadow-md">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="flex flex-col sm:flex-row justify-between sm:items-center mb-2 border-b pb-3">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h2 class="text-2xl font-bold text-stone-800">2. р╕Ыр╕гр╕░р╕зр╕▒р╕Хр╕┤р╕Бр╕▓р╕гр╕Вр╕▓р╕вр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф</h2>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <input type="text" id="search-box" class="mt-3 sm:mt-0 w-full sm:w-64 p-2 border border-stone-300 rounded-md shadow-sm" placeholder="ЁЯФН р╕Др╣Йр╕Щр╕лр╕▓р╕Хр╕▓р╕бр╕Кр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╕Вр╕▓р╕в...">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а<p class="text-sm text-stone-500 mt-2 mb-4">р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Бр╕▓р╕гр╕Вр╕▓р╕вр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Фр╕Чр╕╡р╣Ир╣Ар╕Др╕вр╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╣Др╕зр╣Йр╕Ир╕░р╣Бр╕кр╕Фр╕Зр╣Гр╕Щр╕Хр╕▓р╕гр╕▓р╕Зр╕Щр╕╡р╣Й р╕Др╕╕р╕Ур╕кр╕▓р╕бр╕▓р╕гр╕Цр╕Др╣Йр╕Щр╕лр╕▓р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Хр╕▓р╕бр╕Кр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╕Вр╕▓р╕в р╣Бр╕Бр╣Йр╣Др╕Вр╕гр╕▓р╕вр╕Бр╕▓р╕гр╕Чр╕╡р╣Ир╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Ф р╕лр╕гр╕╖р╕нр╕ер╕Ър╕гр╕▓р╕вр╕Бр╕▓р╕гр╕Чр╕╡р╣Ир╣Др╕бр╣Ир╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╣Др╕Фр╣Й</p>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="bg-stone-200 p-4 rounded-lg text-center">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p class="text-sm font-medium text-stone-600">р╕Ир╕│р╕Щр╕зр╕Щр╕Ьр╕╣р╣Йр╕Вр╕▓р╕вр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф</p>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p id="summary-total-sellers" class="text-2xl font-bold text-amber-600">0</p>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="bg-stone-200 p-4 rounded-lg text-center">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p class="text-sm font-medium text-stone-600">р╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Бр╕гр╕зр╕бр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф (р╕Бр╕Б.)</p>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p id="summary-total-weight" class="text-2xl font-bold text-amber-600">0.00</p>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="bg-stone-200 p-4 rounded-lg text-center">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p class="text-sm font-medium text-stone-600">р╕вр╕нр╕Фр╕Вр╕▓р╕вр╕гр╕зр╕бр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф (р╕Ър╕▓р╕Ч)</p>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p id="summary-total-price" class="text-2xl font-bold text-amber-600">0.00</p>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="overflow-x-auto">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <table class="w-full text-sm text-left text-stone-500">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <thead class="text-xs text-stone-700 uppercase bg-stone-200">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <tr>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th scope="col" class="px-6 py-3">р╕зр╕▒р╕Щр╕Чр╕╡р╣И</th>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th scope="col" class="px-6 py-3">р╕Кр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╕Вр╕▓р╕в</th>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th scope="col" class="px-6 py-3 text-right">р╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Б (р╕Бр╕Б.)</th>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th scope="col" class="px-6 py-3 text-right">р╕гр╕▓р╕Др╕▓/р╕лр╕Щр╣Ир╕зр╕в</th>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th scope="col" class="px-6 py-3 text-right">р╕вр╕нр╕Фр╕гр╕зр╕б (р╕Ър╕▓р╕Ч)</th>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th scope="col" class="px-6 py-3 text-center">р╕Бр╕▓р╕гр╕Фр╕│р╣Ар╕Щр╕┤р╕Щр╕Бр╕▓р╕г</th>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </tr>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </thead>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <tbody id="sales-table-body">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <tr>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td colspan="6" class="px-6 py-8 text-center text-stone-400">р╕Бр╕│р╕ер╕▒р╕Зр╣Вр╕лр╕ер╕Фр╕Вр╣Йр╕нр╕бр╕╣р╕е...</td>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </tr>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </tbody>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </table>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </section>
┬а ┬а ┬а ┬а ┬а ┬а </div>

┬а ┬а ┬а ┬а ┬а ┬а <div class="lg:col-span-1 space-y-8">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <section id="dashboard" class="bg-white p-6 rounded-xl shadow-md">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h2 class="text-2xl font-bold mb-2 border-b pb-3 text-stone-800">3. р╕кр╕гр╕╕р╕Ыр╕ар╕▓р╕Юр╕гр╕зр╕б</h2>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p class="text-sm text-stone-500 mt-2 mb-4">р╣Бр╕Фр╕Кр╕Ър╕нр╕гр╣Мр╕Фр╕Щр╕╡р╣Йр╕Ир╕░р╕кр╕гр╕╕р╕Ыр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Бр╕▓р╕гр╕Вр╕▓р╕вр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Фр╣Гр╕Щр╕гр╕╣р╕Ыр╣Бр╕Ър╕Ър╕Бр╕гр╕▓р╕Я р╕Кр╣Ир╕зр╕вр╣Гр╕лр╣Йр╣Ар╕лр╣Зр╕Щр╕ар╕▓р╕Юр╕гр╕зр╕бр╣Бр╕ер╕░р╣Бр╕Щр╕зр╣Вр╕Щр╣Йр╕бр╕Хр╣Ир╕▓р╕Зр╣Ж р╣Др╕Фр╣Йр╕нр╕вр╣Ир╕▓р╕Зр╕гр╕зр╕Фр╣Ар╕гр╣Зр╕з р╣Вр╕Фр╕вр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Ир╕░р╕нр╕▒р╕Ыр╣Ар╕Фр╕Хр╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤р╕Чр╕╕р╕Бр╕Др╕гр╕▒р╣Йр╕Зр╕Чр╕╡р╣Ир╕бр╕╡р╕Бр╕▓р╕гр╕Ър╕▒р╕Щр╕Чр╕╢р╕Б</p>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="space-y-8">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h3 class="font-bold text-center mb-2 text-stone-700">р╕кр╕▒р╕Фр╕кр╣Ир╕зр╕Щр╕вр╕нр╕Фр╕Вр╕▓р╕вр╕Хр╕▓р╕бр╕Ьр╕╣р╣Йр╕Вр╕▓р╕в</h3>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="chart-container">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <canvas id="sales-by-seller-chart"></canvas>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h3 class="font-bold text-center mb-2 text-stone-700">р╣Бр╕Щр╕зр╣Вр╕Щр╣Йр╕бр╕вр╕нр╕Фр╕Вр╕▓р╕вр╕гр╕▓р╕вр╕зр╕▒р╕Щ</h3>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="chart-container">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <canvas id="daily-sales-chart"></canvas>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </section>
┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а </main>
┬а ┬а </div>

┬а ┬а <div id="print-area" class="p-8 bg-white text-black"></div>
┬а ┬а 
┬а ┬а <div id="modal" class="modal-backdrop fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden opacity-0" aria-labelledby="modal-title" role="dialog" aria-modal="true">
┬а ┬а ┬а ┬а <div class="modal-content bg-white rounded-xl shadow-2xl w-full max-w-md transform scale-95">
┬а ┬а ┬а ┬а ┬а ┬а <div class="p-6">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="text-center">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а<h3 id="modal-title" class="text-lg leading-6 font-bold text-stone-900"></h3>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="mt-2">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p id="modal-message" class="text-sm text-stone-500"></p>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а <div id="modal-actions" class="bg-stone-50 px-6 py-4 rounded-b-xl flex flex-row-reverse gap-3">
┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а </div>
┬а ┬а </div>


┬а ┬а <script type="module">
┬а ┬а ┬а ┬а import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
┬а ┬а ┬а ┬а import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
┬а ┬а ┬а ┬а import { getFirestore, collection, doc, addDoc, updateDoc, deleteDoc, onSnapshot, query } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

┬а ┬а ┬а ┬а const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
┬а ┬а ┬а ┬а const appId = typeof __app_id !== 'undefined' ? __app_id : 'cup-rubber-sales-app';

┬а ┬а ┬а ┬а let localSalesData = [];
┬а ┬а ┬а ┬а let salesBySellerChart, dailySalesChart;
┬а ┬а ┬а ┬а let editingId = null;
┬а ┬а ┬а ┬а let db, auth, userId, salesCollectionRef;

┬а ┬а ┬а ┬а const ui = {
┬а ┬а ┬а ┬а ┬а ┬а sellerNameInput: document.getElementById('seller-name'),
┬а ┬а ┬а ┬а ┬а ┬а receiptDateInput: document.getElementById('receipt-date'),
┬а ┬а ┬а ┬а ┬а ┬а dateDisplay: document.getElementById('date-display'),
┬а ┬а ┬а ┬а ┬а ┬а weightInputsContainer: document.getElementById('weight-inputs-container'),
┬а ┬а ┬а ┬а ┬а ┬а pricePerKgInput: document.getElementById('price-per-kg'),
┬а ┬а ┬а ┬а ┬а ┬а totalWeightEl: document.getElementById('total-weight'),
┬а ┬а ┬а ┬а ┬а ┬а totalAmountEl: document.getElementById('total-amount'),
┬а ┬а ┬а ┬а ┬а ┬а totalAmountTextEl: document.getElementById('total-amount-text'),
┬а ┬а ┬а ┬а ┬а ┬а saveButton: document.getElementById('save-button'),
┬а ┬а ┬а ┬а ┬а ┬а cancelEditButton: document.getElementById('cancel-edit-button'),
┬а ┬а ┬а ┬а ┬а ┬а salesTableBody: document.getElementById('sales-table-body'),
┬а ┬а ┬а ┬а ┬а ┬а searchBox: document.getElementById('search-box'),
┬а ┬а ┬а ┬а ┬а ┬а printArea: document.getElementById('print-area'),
┬а ┬а ┬а ┬а ┬а ┬а modal: document.getElementById('modal'),
┬а ┬а ┬а ┬а ┬а ┬а modalTitle: document.getElementById('modal-title'),
┬а ┬а ┬а ┬а ┬а ┬а modalMessage: document.getElementById('modal-message'),
┬а ┬а ┬а ┬а ┬а ┬а modalActions: document.getElementById('modal-actions'),
┬а ┬а ┬а ┬а ┬а ┬а summaryTotalSellers: document.getElementById('summary-total-sellers'),
┬а ┬а ┬а ┬а ┬а ┬а summaryTotalWeight: document.getElementById('summary-total-weight'),
┬а ┬а ┬а ┬а ┬а ┬а summaryTotalPrice: document.getElementById('summary-total-price'),
┬а ┬а ┬а ┬а };

┬а ┬а ┬а ┬а function showModal(title, message, buttons) {
┬а ┬а ┬а ┬а ┬а ┬а ui.modalTitle.textContent = title;
┬а ┬а ┬а ┬а ┬а ┬а ui.modalMessage.textContent = message;
┬а ┬а ┬а ┬а ┬а ┬а ui.modalActions.innerHTML = '';
┬а ┬а ┬а ┬а ┬а ┬а buttons.forEach(btn => {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const buttonEl = document.createElement('button');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а buttonEl.textContent = btn.text;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а buttonEl.className = btn.classes;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а buttonEl.onclick = () => {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а hideModal();
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (btn.onClick) btn.onClick();
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а };
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.modalActions.appendChild(buttonEl);
┬а ┬а ┬а ┬а ┬а ┬а });
┬а ┬а ┬а ┬а ┬а ┬а ui.modal.classList.remove('hidden');
┬а ┬а ┬а ┬а ┬а ┬а setTimeout(() => {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.modal.classList.remove('opacity-0');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.modal.querySelector('.modal-content').classList.remove('scale-95');
┬а ┬а ┬а ┬а ┬а ┬а }, 10);
┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а function hideModal() {
┬а ┬а ┬а ┬а ┬а ┬а ui.modal.classList.add('opacity-0');
┬а ┬а ┬а ┬а ┬а ┬а ui.modal.querySelector('.modal-content').classList.add('scale-95');
┬а ┬а ┬а ┬а ┬а ┬а setTimeout(() => ui.modal.classList.add('hidden'), 300);
┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а 
┬а ┬а ┬а ┬а function showAlert(message) {
┬а ┬а ┬а ┬а ┬а ┬а ┬аshowModal('р╣Бр╕Ир╣Йр╕Зр╣Ар╕Хр╕╖р╕нр╕Щ', message, [
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а { text: 'р╕Хр╕Бр╕ер╕З', classes: 'w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-amber-600 text-base font-medium text-white hover:bg-amber-700 sm:w-auto sm:text-sm' }
┬а ┬а ┬а ┬а ┬а ┬а ┬а]);
┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а 
┬а ┬а ┬а ┬а function showConfirm(message, onConfirm) {
┬а ┬а ┬а ┬а ┬а ┬а showModal('р╕вр╕╖р╕Щр╕вр╕▒р╕Щр╕Бр╕▓р╕гр╕Фр╕│р╣Ар╕Щр╕┤р╕Щр╕Бр╕▓р╕г', message, [
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а { text: 'р╕вр╕╖р╕Щр╕вр╕▒р╕Щ', classes: 'w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 sm:ml-3 sm:w-auto sm:text-sm', onClick: onConfirm },
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а { text: 'р╕вр╕Бр╣Ар╕ер╕┤р╕Б', classes: 'mt-3 w-full inline-flex justify-center rounded-md border border-stone-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-stone-700 hover:bg-stone-50 sm:mt-0 sm:w-auto sm:text-sm' }
┬а ┬а ┬а ┬а ┬а ┬а ]);
┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а function bahttext(number) {
┬а ┬а ┬а ┬а ┬а ┬а number = Number(number).toFixed(2);
┬а ┬а ┬а ┬а ┬а ┬а let [integer, fraction] = number.split('.');
┬а ┬а ┬а ┬а ┬а ┬а const t = ['', 'р╕лр╕Щр╕╢р╣Ир╕З', 'р╕кр╕нр╕З', 'р╕кр╕▓р╕б', 'р╕кр╕╡р╣И', 'р╕лр╣Йр╕▓', 'р╕лр╕Б', 'р╣Ар╕Ир╣Зр╕Ф', 'р╣Бр╕Ыр╕Ф', 'р╣Ар╕Бр╣Йр╕▓'];
┬а ┬а ┬а ┬а ┬а ┬а const r = ['', 'р╕кр╕┤р╕Ъ', 'р╕гр╣Йр╕нр╕в', 'р╕Юр╕▒р╕Щ', 'р╕лр╕бр╕╖р╣Ир╕Щ', 'р╣Бр╕кр╕Щ', 'р╕ер╣Йр╕▓р╕Щ'];
┬а ┬а ┬а ┬а ┬а ┬а 
┬а ┬а ┬а ┬а ┬а ┬а function convert(n) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а let s = '';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а let l = n.length;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а for (let i = 0; i < l; i++) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а let d = parseInt(n.charAt(i));
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а let p = l - i - 1;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (d > 0) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (p === 1 && d === 2) s += 'р╕вр╕╡р╣И';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а else if (p === 1 && d === 1) s += '';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а else if (p === 0 && d === 1 && s.length > 0 && n.length > 1) s += 'р╣Ар╕нр╣Зр╕Ф';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а else s += t[d];
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а s += r[p];
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return s;
┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а let intText = convert(integer) || 'р╕ир╕╣р╕Щр╕вр╣М';
┬а ┬а ┬а ┬а ┬а ┬а let fracText = '';
┬а ┬а ┬а ┬а ┬а ┬а if (parseInt(fraction, 10) > 0) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬аfracText = convert(fraction) + 'р╕кр╕Хр╕▓р╕Зр╕Др╣М';
┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а
┬а ┬а ┬а ┬а ┬а ┬а if (!intText && !fracText) return 'р╕ир╕╣р╕Щр╕вр╣Мр╕Ър╕▓р╕Чр╕Цр╣Йр╕зр╕Щ';
┬а ┬а ┬а ┬а ┬а ┬а return (intText ? intText + 'р╕Ър╕▓р╕Ч' : '') + (parseInt(fraction) === 0 ? 'р╕Цр╣Йр╕зр╕Щ' : fracText);
┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а 
┬а ┬а ┬а ┬а function calculateTotals() {
┬а ┬а ┬а ┬а ┬а ┬а let totalWeight = 0;
┬а ┬а ┬а ┬а ┬а ┬а const weightInputs = ui.weightInputsContainer.querySelectorAll('.weight-input');
┬а ┬а ┬а ┬а ┬а ┬а weightInputs.forEach(input => {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а totalWeight += parseFloat(input.value) || 0;
┬а ┬а ┬а ┬а ┬а ┬а });
┬а ┬а ┬а ┬а ┬а ┬а const pricePerKg = parseFloat(ui.pricePerKgInput.value) || 0;
┬а ┬а ┬а ┬а ┬а ┬а const totalAmount = totalWeight * pricePerKg;
┬а ┬а ┬а ┬а ┬а ┬а ui.totalWeightEl.textContent = totalWeight.toFixed(2);
┬а ┬а ┬а ┬а ┬а ┬а ui.totalAmountEl.textContent = totalAmount.toFixed(2);
┬а ┬а ┬а ┬а ┬а ┬а ui.totalAmountTextEl.textContent = bahttext(totalAmount);
┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а function renderTable(dataToRender) {
┬а ┬а ┬а ┬а ┬а ┬а ui.salesTableBody.innerHTML = '';
┬а ┬а ┬а ┬а ┬а ┬а if (dataToRender.length === 0) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.salesTableBody.innerHTML = '<tr><td colspan="6" class="px-6 py-8 text-center text-stone-400">р╕вр╕▒р╕Зр╣Др╕бр╣Ир╕бр╕╡р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Бр╕▓р╕гр╕Вр╕▓р╕в...</td></tr>';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return;
┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а dataToRender.forEach(sale => {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const row = document.createElement('tr');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а row.className = 'bg-white border-b hover:bg-stone-50';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const saleDate = sale.date instanceof Date ? sale.date : sale.date.toDate();
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а row.innerHTML = `
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-6 py-4">${saleDate.toLocaleDateString('th-TH')}</td>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-6 py-4 font-medium text-stone-900 whitespace-nowrap">${sale.seller}</td>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-6 py-4 text-right">${sale.weight.toFixed(2)}</td>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-6 py-4 text-right">${sale.price.toFixed(2)}</td>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-6 py-4 text-right font-bold text-amber-600">${sale.total.toFixed(2)}</td>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="px-6 py-4 text-center space-x-2">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button class="reprint-btn text-gray-500 hover:text-gray-700 p-1" data-id="${sale.id}" title="р╕Юр╕┤р╕бр╕Юр╣Мр╕Лр╣Йр╕│">ЁЯЦия╕П</button>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button class="edit-btn text-blue-600 hover:text-blue-800 p-1" data-id="${sale.id}" title="р╣Бр╕Бр╣Йр╣Др╕В">тЬПя╕П</button>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <button class="delete-btn text-red-600 hover:text-red-800 p-1" data-id="${sale.id}" title="р╕ер╕Ъ">ЁЯЧСя╕П</button>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </td>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а `;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.salesTableBody.appendChild(row);
┬а ┬а ┬а ┬а ┬а ┬а });
┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а 
┬а ┬а ┬а ┬а function renderSummary() {
┬а ┬а ┬а ┬а ┬а ┬а if (!localSalesData || localSalesData.length === 0) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.summaryTotalSellers.textContent = '0';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.summaryTotalWeight.textContent = '0.00';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.summaryTotalPrice.textContent = '0.00';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return;
┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а const totalSellers = new Set(localSalesData.map(s => s.seller)).size;
┬а ┬а ┬а ┬а ┬а ┬а const totalWeight = localSalesData.reduce((acc, sale) => acc + sale.weight, 0);
┬а ┬а ┬а ┬а ┬а ┬а const totalPrice = localSalesData.reduce((acc, sale) => acc + sale.total, 0);

┬а ┬а ┬а ┬а ┬а ┬а ui.summaryTotalSellers.textContent = totalSellers.toLocaleString('th-TH');
┬а ┬а ┬а ┬а ┬а ┬а ui.summaryTotalWeight.textContent = totalWeight.toLocaleString('th-TH', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
┬а ┬а ┬а ┬а ┬а ┬а ui.summaryTotalPrice.textContent = totalPrice.toLocaleString('th-TH', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а function renderDashboard() {
┬а ┬а ┬а ┬а ┬а ┬а renderSalesBySellerChart();
┬а ┬а ┬а ┬а ┬а ┬а renderDailySalesChart();
┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а 
┬а ┬а ┬а ┬а function getChartColors(count) {
┬а ┬а ┬а ┬а ┬а ┬а const baseColors = ['#d97706', '#f59e0b', '#fcd34d', '#fef3c7', '#fffbeb', '#b45309', '#92400e'];
┬а ┬а ┬а ┬а ┬а ┬а let colors = [];
┬а ┬а ┬а ┬а ┬а ┬а for(let i = 0; i < count; i++) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а colors.push(baseColors[i % baseColors.length]);
┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а return colors;
┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а function renderSalesBySellerChart() {
┬а ┬а ┬а ┬а ┬а ┬а const salesBySeller = localSalesData.reduce((acc, sale) => {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а acc[sale.seller] = (acc[sale.seller] || 0) + sale.total;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return acc;
┬а ┬а ┬а ┬а ┬а ┬а }, {});
┬а ┬а ┬а ┬а ┬а ┬а const labels = Object.keys(salesBySeller);
┬а ┬а ┬а ┬а ┬а ┬а const data = Object.values(salesBySeller);
┬а ┬а ┬а ┬а ┬а ┬а if (salesBySellerChart) salesBySellerChart.destroy();
┬а ┬а ┬а ┬а ┬а ┬а salesBySellerChart = new Chart(document.getElementById('sales-by-seller-chart').getContext('2d'), {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а type: 'doughnut',
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а data: {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а labels: labels,
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а datasets: [{ label: 'р╕вр╕нр╕Фр╕Вр╕▓р╕в', data: data, backgroundColor: getChartColors(labels.length), borderColor: '#ffffff', borderWidth: 2 }]
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а },
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } }
┬а ┬а ┬а ┬а ┬а ┬а });
┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а function renderDailySalesChart() {
┬а ┬а ┬а ┬а ┬а ┬а const salesByDay = localSalesData.reduce((acc, sale) => {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const saleDate = sale.date instanceof Date ? sale.date : sale.date.toDate();
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const day = saleDate.toLocaleDateString('th-TH', { year: '2-digit', month: 'short', day: 'numeric'});
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а acc[day] = (acc[day] || 0) + sale.total;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return acc;
┬а ┬а ┬а ┬а ┬а ┬а }, {});
┬а ┬а ┬а ┬а ┬а ┬а const sortedLabels = Object.keys(salesByDay).sort((a,b) => {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬аconst dateA = new Date(a.split('/')[2] - 543, a.split('/')[1] -1, a.split('/')[0]);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬аconst dateB = new Date(b.split('/')[2] - 543, b.split('/')[1] -1, b.split('/')[0]);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬аreturn dateA - dateB;
┬а ┬а ┬а ┬а ┬а ┬а });
┬а ┬а ┬а ┬а ┬а ┬а const data = sortedLabels.map(label => salesByDay[label]);
┬а ┬а ┬а ┬а ┬а ┬а if (dailySalesChart) dailySalesChart.destroy();
┬а ┬а ┬а ┬а ┬а ┬а dailySalesChart = new Chart(document.getElementById('daily-sales-chart').getContext('2d'), {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а type: 'line',
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а data: {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а labels: sortedLabels,
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а datasets: [{ label: 'р╕вр╕нр╕Фр╕Вр╕▓р╕вр╕гр╕зр╕бр╕гр╕▓р╕вр╕зр╕▒р╕Щ', data: data, fill: true, backgroundColor: 'rgba(217, 119, 6, 0.2)', borderColor: 'rgb(217, 119, 6)', tension: 0.1, pointBackgroundColor: 'rgb(217, 119, 6)', pointRadius: 4 }]
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а },
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true } } }
┬а ┬а ┬а ┬а ┬а ┬а });
┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а function createPrintableReceipt(sale) {
┬а ┬а ┬а ┬а ┬а ┬а const saleDate = sale.date instanceof Date ? sale.date : sale.date.toDate();
┬а ┬а ┬а ┬а ┬а ┬а 
┬а ┬а ┬а ┬а ┬а ┬а const generateSingleReceiptHTML = (title) => `
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="w-1/2 p-4 border border-dashed border-stone-400 h-full flex flex-col text-xs">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="text-center mb-4">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h2 class="text-base font-bold">${title}</h2>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <h3 class="text-sm font-semibold mt-1">р╕кр╕лр╕Бр╕гр╕Ур╣Мр╕Бр╕нр╕Зр╕Чр╕╕р╕Щр╕кр╕зр╕Щр╕вр╕▓р╕Зр╕Юр╕▓р╕гр╕▓р╣Ар╕Бр╕йр╕Хр╕гр╕кр╕бр╕Ър╕╣р╕гр╕Ур╣М р╕Ир╕│р╕Бр╕▒р╕Ф</h3>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p class="text-xs text-stone-600">15/1 р╕б.6 р╕Х.р╕лр╕Щр╕нр╕Зр╣Вр╕Юр╕Щр╕Зр╕▓р╕б р╕н.р╣Ар╕Бр╕йр╕Хр╕гр╕кр╕бр╕Ър╕╣р╕гр╕Ур╣М р╕И.р╕Кр╕▒р╕вр╕ар╕╣р╕бр╕┤</p>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="border-y border-stone-300 py-1 mb-2">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="flex justify-between">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span class="font-semibold">р╣Ар╕ер╕Вр╕Чр╕╡р╣Ир╣Гр╕Ър╣Ар╕кр╕гр╣Зр╕И:</span>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span>${sale.receiptId || 'N/A'}</span>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="flex justify-between mt-1">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span class="font-semibold">р╕зр╕▒р╕Щр╕Чр╕╡р╣И:</span>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span>${saleDate.toLocaleDateString('th-TH', { year: 'numeric', month: 'long', day: 'numeric' })}</span>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="mb-2">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span class="font-semibold">р╕Ьр╕╣р╣Йр╕Вр╕▓р╕в:</span>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span>${sale.seller}</span>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <table class="w-full my-1">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <thead class="border-y border-stone-300">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <tr>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th class="py-1 text-left font-semibold">р╕гр╕▓р╕вр╕Бр╕▓р╕г</th>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <th class="py-1 text-right font-semibold">р╕вр╕нр╕Фр╕гр╕зр╕б (р╕Ър╕▓р╕Ч)</th>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </tr>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </thead>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <tbody class="border-b border-stone-300">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <tr>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="py-2 align-top">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а р╕Др╣Ир╕▓р╕вр╕▓р╕Зр╕Бр╣Йр╕нр╕Щр╕Цр╣Йр╕зр╕в
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <span class="block text-xs text-stone-600">р╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Б: ${sale.weight.toFixed(2)} р╕Бр╕Б. @ ${sale.price.toFixed(2)} р╕Ър╕▓р╕Ч/р╕Бр╕Б.</span>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </td>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="text-right align-top pt-2">${sale.total.toFixed(2)}</td>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </tr>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </tbody>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <tfoot>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <tr class="font-bold">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="py-2">р╕гр╕зр╕бр╣Ар╕Ыр╣Зр╕Щр╣Ар╕Зр╕┤р╕Щ</td>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <td class="text-right">${sale.total.toFixed(2)}</td>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </tr>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </tfoot>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </table>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p class="text-center mb-4 font-semibold">(${bahttext(sale.total)})</p>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="flex-grow"></div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="flex justify-center text-center mt-4">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p class="pb-1">........................................</p>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <p>(р╕Ьр╕╣р╣Йр╕гр╕▒р╕Ър╣Ар╕Зр╕┤р╕Щ)</p>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а `;

┬а ┬а ┬а ┬а ┬а ┬а ui.printArea.innerHTML = `
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а <div class="flex gap-4">
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ${generateSingleReceiptHTML('р╣Гр╕Ър╣Ар╕кр╕гр╣Зр╕Ир╕гр╕▒р╕Ър╣Ар╕Зр╕┤р╕Щ р╕Хр╣Йр╕Щр╕Йр╕Ър╕▒р╕Ъ')}
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ${generateSingleReceiptHTML('р╣Гр╕Ър╣Ар╕кр╕гр╣Зр╕Ир╕гр╕▒р╕Ър╣Ар╕Зр╕┤р╕Щ (р╕кр╕│р╣Ар╕Щр╕▓)')}
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а </div>
┬а ┬а ┬а ┬а ┬а ┬а `;
┬а ┬а ┬а ┬а ┬а ┬а window.print();
┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а function clearForm() {
┬а ┬а ┬а ┬а ┬а ┬а ui.sellerNameInput.value = '';
┬а ┬а ┬а ┬а ┬а ┬а const weightInputs = ui.weightInputsContainer.querySelectorAll('.weight-input');
┬а ┬а ┬а ┬а ┬а ┬а weightInputs.forEach(input => input.value = '');
┬а ┬а ┬а ┬а ┬а ┬а ui.pricePerKgInput.value = '';
┬а ┬а ┬а ┬а ┬а ┬а editingId = null;
┬а ┬а ┬а ┬а ┬а ┬а ui.saveButton.textContent = 'р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╣Бр╕ер╕░р╕Юр╕┤р╕бр╕Юр╣Мр╣Гр╕Ър╣Ар╕кр╕гр╣Зр╕И';
┬а ┬а ┬а ┬а ┬а ┬а ui.cancelEditButton.classList.add('hidden');
┬а ┬а ┬а ┬а ┬а ┬а calculateTotals();
┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а async function handleSave() {
┬а ┬а ┬а ┬а ┬а ┬а const seller = ui.sellerNameInput.value.trim();
┬а ┬а ┬а ┬а ┬а ┬а const date = ui.receiptDateInput.valueAsDate;
┬а ┬а ┬а ┬а ┬а ┬а const weight = parseFloat(ui.totalWeightEl.textContent) || 0;
┬а ┬а ┬а ┬а ┬а ┬а const price = parseFloat(ui.pricePerKgInput.value) || 0;
┬а ┬а ┬а ┬а ┬а ┬а const total = parseFloat(ui.totalAmountEl.textContent) || 0;
┬а ┬а ┬а ┬а ┬а ┬а const weightInputs = Array.from(ui.weightInputsContainer.querySelectorAll('.weight-input')).map(input => parseFloat(input.value) || 0).filter(v => v > 0);

┬а ┬а ┬а ┬а ┬а ┬а if (!seller || !date || weight <= 0 || price <= 0) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showAlert('р╕Бр╕гр╕╕р╕Ур╕▓р╕Бр╕гр╕нр╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Гр╕лр╣Йр╕Др╕гр╕Ър╕Цр╣Йр╕зр╕Щ: р╕Кр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╕Вр╕▓р╕в, р╕Щр╣Йр╕│р╕лр╕Щр╕▒р╕Б р╣Бр╕ер╕░р╕гр╕▓р╕Др╕▓');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return;
┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а const saleData = { seller, date, weight, weights: weightInputs, price, total, userId };

┬а ┬а ┬а ┬а ┬а ┬а try {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (editingId) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const docRef = doc(db, salesCollectionRef.path, editingId);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а await updateDoc(docRef, saleData);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showAlert('р╕нр╕▒р╕Ыр╣Ар╕Фр╕Хр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕кр╕│р╣Ар╕гр╣Зр╕И');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а } else {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const now = new Date();
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const year = now.getFullYear();
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const month = (now.getMonth() + 1).toString().padStart(2, '0');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const day = now.getDate().toString().padStart(2, '0');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const todayStart = new Date(now.setHours(0, 0, 0, 0));
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const salesToday = localSalesData.filter(sale => {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const saleDate = sale.date.toDate();
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return saleDate >= todayStart;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const nextReceiptNumber = salesToday.length + 1;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а saleData.receiptId = `${year}${month}${day}-${String(nextReceiptNumber).padStart(3, '0')}`;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const docRef = await addDoc(salesCollectionRef, saleData);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showAlert('р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕кр╕│р╣Ар╕гр╣Зр╕И');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а createPrintableReceipt({...saleData, id: docRef.id });
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а clearForm();
┬а ┬а ┬а ┬а ┬а ┬а } catch (error) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а console.error("Error saving document: ", error);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showAlert(`р╣Ар╕Бр╕┤р╕Фр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╣Гр╕Щр╕Бр╕▓р╕гр╕Ър╕▒р╕Щр╕Чр╕╢р╕Б: ${error.message}`);
┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а 
┬а ┬а ┬а ┬а function handleTableClick(e) {
┬а ┬а ┬а ┬а ┬а ┬а const target = e.target.closest('button');
┬а ┬а ┬а ┬а ┬а ┬а if (!target) return;

┬а ┬а ┬а ┬а ┬а ┬а const id = target.dataset.id;
┬а ┬а ┬а ┬а ┬а ┬а const saleToProcess = localSalesData.find(sale => sale.id === id);
┬а ┬а ┬а ┬а ┬а ┬а if (!saleToProcess) return;

┬а ┬а ┬а ┬а ┬а ┬а if (target.classList.contains('delete-btn')) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showConfirm('р╕Др╕╕р╕Ур╣Бр╕Щр╣Ир╣Гр╕Ир╕зр╣Ир╕▓р╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕ер╕Ър╕гр╕▓р╕вр╕Бр╕▓р╕гр╕Щр╕╡р╣Й?', async () => {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а try {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а await deleteDoc(doc(db, salesCollectionRef.path, id));
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showAlert('р╕ер╕Ър╕гр╕▓р╕вр╕Бр╕▓р╕гр╕кр╕│р╣Ар╕гр╣Зр╕И');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а } catch (error) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬аconsole.error("Error deleting document: ", error);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬аshowAlert(`р╣Ар╕Бр╕┤р╕Фр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╣Гр╕Щр╕Бр╕▓р╕гр╕ер╕Ъ: ${error.message}`);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });
┬а ┬а ┬а ┬а ┬а ┬а } else if (target.classList.contains('edit-btn')) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а editingId = id;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.sellerNameInput.value = saleToProcess.seller;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const saleDate = saleToProcess.date instanceof Date ? saleToProcess.date : saleToProcess.date.toDate();
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.receiptDateInput.value = saleDate.toISOString().split('T')[0];
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.pricePerKgInput.value = saleToProcess.price;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const weightInputs = ui.weightInputsContainer.querySelectorAll('.weight-input');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а weightInputs.forEach((input, index) => {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а input.value = saleToProcess.weights[index] || '';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а calculateTotals();
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.saveButton.textContent = 'р╕нр╕▒р╕Ыр╣Ар╕Фр╕Хр╕Вр╣Йр╕нр╕бр╕╣р╕е';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.cancelEditButton.classList.remove('hidden');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а window.scrollTo({ top: 0, behavior: 'smooth' });
┬а ┬а ┬а ┬а ┬а ┬а } else if (target.classList.contains('reprint-btn')) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а createPrintableReceipt(saleToProcess);
┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а 
┬а ┬а ┬а ┬а function updateDateDisplay() {
┬а ┬а ┬а ┬а ┬а ┬а const date = ui.receiptDateInput.valueAsDate;
┬а ┬а ┬а ┬а ┬а ┬а if (date) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.dateDisplay.textContent = `(${date.toLocaleDateString('th-TH')})`;
┬а ┬а ┬а ┬а ┬а ┬а } else {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const today = new Date();
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ui.dateDisplay.textContent = `(${today.toLocaleDateString('th-TH')})`;
┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а async function initApp() {
┬а ┬а ┬а ┬а ┬а ┬а if (!firebaseConfig || Object.keys(firebaseConfig).length === 0 || !firebaseConfig.apiKey) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а renderTable([]);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а renderSummary();
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showAlert('р╕Бр╕▓р╕гр╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓ Firebase р╣Др╕бр╣Ир╕кр╕бр╕Ър╕╣р╕гр╕Ур╣М р╕Бр╕гр╕╕р╕Ур╕▓р╣Гр╕кр╣Ир╕Вр╣Йр╕нр╕бр╕╣р╕е Config р╣Гр╕Щр╣Др╕Яр╕ер╣М index.html р╕Бр╣Ир╕нр╕Щр╕нр╕▒р╕Ыр╣Вр╕лр╕ер╕Ф');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а console.error('Firebase config is missing or incomplete.');
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а return;
┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а try {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const app = initializeApp(firebaseConfig);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а auth = getAuth(app);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а db = getFirestore(app);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а onAuthStateChanged(auth, async (user) => {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (user) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а userId = user.uid;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а salesCollectionRef = collection(db, "artifacts", appId, "users", userId, "sales");
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const q = query(salesCollectionRef);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а onSnapshot(q, (snapshot) => {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а let sales = [];
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а snapshot.forEach((doc) => {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а sales.push({ id: doc.id, ...doc.data() });
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а sales.sort((a,b) => b.date.toDate() - a.date.toDate());
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а localSalesData = sales;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а renderTable(localSalesData);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а renderDashboard();
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а renderSummary();
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }, (error) => {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а console.error("Error fetching data with onSnapshot: ", error);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showAlert(`р╣Ар╕Бр╕┤р╕Фр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╣Гр╕Щр╕Бр╕▓р╕гр╕Фр╕╢р╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕е: ${error.message}`);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а } else {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬аtry {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а await signInWithCustomToken(auth, __initial_auth_token);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а } else {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а await signInAnonymously(auth);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а } catch (error) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а console.error('Sign-in failed:', error);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а showAlert(`р╕Бр╕▓р╕гр╕вр╕╖р╕Щр╕вр╕▒р╕Щр╕Хр╕▒р╕зр╕Хр╕Щр╕ер╣Йр╕бр╣Ар╕лр╕ер╕з: ${error.message}`);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а });
┬а ┬а ┬а ┬а ┬а ┬а } catch (error) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬аconsole.error("Firebase initialization error: ", error);
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬аshowAlert(`р╣Ар╕Бр╕┤р╕Фр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╣Гр╕Щр╕Бр╕▓р╕гр╣Ар╕гр╕┤р╣Ир╕бр╕Хр╣Йр╕Щр╕гр╕░р╕Ър╕Ъ: ${error.message}`);
┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а 
┬а ┬а ┬а ┬а document.addEventListener('DOMContentLoaded', () => {
┬а ┬а ┬а ┬а ┬а ┬а ui.receiptDateInput.valueAsDate = new Date();
┬а ┬а ┬а ┬а ┬а ┬а updateDateDisplay();
┬а ┬а ┬а ┬а ┬а ┬а ui.saveButton.addEventListener('click', handleSave);
┬а ┬а ┬а ┬а ┬а ┬а ui.cancelEditButton.addEventListener('click', clearForm);
┬а ┬а ┬а ┬а ┬а ┬а ui.salesTableBody.addEventListener('click', handleTableClick);
┬а ┬а ┬а ┬а ┬а ┬а ui.receiptDateInput.addEventListener('input', updateDateDisplay);
┬а ┬а ┬а ┬а ┬а ┬а const calculationInputs = [...ui.weightInputsContainer.querySelectorAll('.weight-input'), ui.pricePerKgInput];
┬а ┬а ┬а ┬а ┬а ┬а calculationInputs.forEach(input => input.addEventListener('input', calculateTotals));
┬а ┬а ┬а ┬а ┬а ┬а ui.searchBox.addEventListener('input', (e) => {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const searchTerm = e.target.value.toLowerCase();
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const filteredData = localSalesData.filter(sale => sale.seller.toLowerCase().includes(searchTerm));
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а renderTable(filteredData);
┬а ┬а ┬а ┬а ┬а ┬а });
┬а ┬а ┬а ┬а ┬а ┬а initApp();
┬а ┬а ┬а ┬а });
┬а ┬а </script>
</body>
</html>
